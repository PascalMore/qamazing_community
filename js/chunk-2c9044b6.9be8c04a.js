(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2c9044b6","chunk-e4f7bdca"],{"0235":function(t,e,a){var i=a("c253");t.exports=function(t,e){var a=[];return i(t,!1,a.push,a,e),a}},"0325":function(t,e,a){t.exports={default:a("bcd6"),__esModule:!0}},"03d6":function(t,e,a){var i=a("9c0e"),r=a("6ca1"),n=a("39ad")(!1),s=a("5a94")("IE_PROTO");t.exports=function(t,e){var a,o=r(t),h=0,l=[];for(a in o)a!=s&&i(o,a)&&l.push(a);while(e.length>h)i(o,a=e[h++])&&(~n(l,a)||l.push(a));return l}},"051b":function(t,e,a){var i=a("1a14"),r=a("10db");t.exports=a("0bad")?function(t,e,a){return i.f(t,e,r(1,a))}:function(t,e,a){return t[e]=a,t}},"05f5":function(t,e,a){var i=a("7a41"),r=a("ef08").document,n=i(r)&&i(r.createElement);t.exports=function(t){return n?r.createElement(t):{}}},"0983":function(t,e,a){var i=a("c901");t.exports=function(t){return Object(i(t))}},"0ae2":function(t,e,a){var i=a("9876"),r=a("fed5"),n=a("1917");t.exports=function(t){var e=i(t),a=r.f;if(a){var s,o=a(t),h=n.f,l=0;while(o.length>l)h.call(t,s=o[l++])&&e.push(s)}return e}},"0b99":function(t,e,a){"use strict";var i=a("19fa")(!0);a("393a")(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,e=this._t,a=this._i;return a>=e.length?{value:void 0,done:!0}:(t=i(e,a),this._i+=t.length,{value:t,done:!1})}))},"0bad":function(t,e,a){t.exports=!a("4b8b")((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},"0d37":function(t,e,a){a("fc96");var i=a("5524").Object;t.exports=function(t,e){return i.defineProperties(t,e)}},1098:function(t,e,a){"use strict";e.__esModule=!0;var i=a("17ed"),r=h(i),n=a("f893"),s=h(n),o="function"===typeof s.default&&"symbol"===typeof r.default?function(t){return typeof t}:function(t){return t&&"function"===typeof s.default&&t.constructor===s.default&&t!==s.default.prototype?"symbol":typeof t};function h(t){return t&&t.__esModule?t:{default:t}}e.default="function"===typeof s.default&&"symbol"===o(r.default)?function(t){return"undefined"===typeof t?"undefined":o(t)}:function(t){return t&&"function"===typeof s.default&&t.constructor===s.default&&t!==s.default.prototype?"symbol":"undefined"===typeof t?"undefined":o(t)}},"10db":function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},1148:function(t,e,a){"use strict";var i=a("a691"),r=a("1d80");t.exports="".repeat||function(t){var e=String(r(this)),a="",n=i(t);if(n<0||n==1/0)throw RangeError("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(a+=e);return a}},1609:function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},1648:function(t,e,a){a("dfe5"),a("0b99"),a("658f"),a("6561"),a("dcfd"),a("9e12"),a("97ee"),t.exports=a("5524").Map},1727:function(t,e,a){t.exports={default:a("7d42"),__esModule:!0}},"17ed":function(t,e,a){t.exports={default:a("511f"),__esModule:!0}},1836:function(t,e,a){var i=a("6ca1"),r=a("6438").f,n={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],o=function(t){try{return r(t)}catch(e){return s.slice()}};t.exports.f=function(t){return s&&"[object Window]"==n.call(t)?o(t):r(i(t))}},1917:function(t,e){e.f={}.propertyIsEnumerable},"19fa":function(t,e,a){var i=a("fc5e"),r=a("c901");t.exports=function(t){return function(e,a){var n,s,o=String(r(e)),h=i(a),l=o.length;return h<0||h>=l?t?"":void 0:(n=o.charCodeAt(h),n<55296||n>56319||h+1===l||(s=o.charCodeAt(h+1))<56320||s>57343?t?o.charAt(h):n:t?o.slice(h,h+2):s-56320+(n-55296<<10)+65536)}}},"1a14":function(t,e,a){var i=a("77e9"),r=a("faf5"),n=a("3397"),s=Object.defineProperty;e.f=a("0bad")?Object.defineProperty:function(t,e,a){if(i(t),e=n(e,!0),i(a),r)try{return s(t,e,a)}catch(o){}if("get"in a||"set"in a)throw TypeError("Accessors not supported!");return"value"in a&&(t[e]=a.value),t}},"1eeb":function(t,e,a){a("3c9f")("Set")},"22bf":function(t,e,a){a("dfe5"),a("0b99"),a("658f"),a("c579"),a("365c"),a("5cb7"),t.exports=a("5524").Promise},"23dd":function(t,e,a){var i=a("6aa8"),r=a("cc15a")("iterator"),n=a("8a0d");t.exports=a("5524").getIteratorMethod=function(t){if(void 0!=t)return t[r]||t["@@iterator"]||n[i(t)]}},2405:function(t,e,a){var i=a("7a41");t.exports=function(t,e){if(!i(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},"24a2":function(t,e,a){var i=a("77e9"),r=a("7a41"),n=a("f2c2");t.exports=function(t,e){if(i(t),r(e)&&e.constructor===t)return e;var a=n.f(t),s=a.resolve;return s(e),a.promise}},"26dd":function(t,e,a){"use strict";var i=a("6f4f"),r=a("10db"),n=a("92f0"),s={};a("051b")(s,a("cc15a")("iterator"),(function(){return this})),t.exports=function(t,e,a){t.prototype=i(s,{next:r(1,a)}),n(t,e+" Iterator")}},"2ad9":function(t,e,a){var i=a("6aa8"),r=a("0235");t.exports=function(t){return function(){if(i(this)!=t)throw TypeError(t+"#toJSON isn't generic");return r(this)}}},"2b12":function(t,e,a){"use strict";a("e25e"),Object.defineProperty(e,"__esModule",{value:!0});var i=a("3834"),r=n(i);function n(t){return t&&t.__esModule?t:{default:t}}function s(){this.HistoryData,this.BuyData,this.SellData,this.IndexClose,this.NetCalculateModel=0,this.InitialCapital=1e4,this.Data=new r.default,this.SetPolicyData=function(t){this.HistoryData=t.KLineData,this.BuyData=t.BuyData,this.SellData=t.SellData,t.IndexClose&&(this.IndexClose=t.IndexClose)},this.ClearData=function(){this.Data=new r.default},this.GetBSData=function(t){for(var e=null,a=0;a<this.HistoryData.length;++a){var i=this.HistoryData[a];if(i.Date>=t){e=a;break}}if(null===e)return null;console.log("[RegressionTest::GetBSData] startDate="+t+" index="+e);var r=[],n=null;for(a=e;a<this.HistoryData.length;++a){var s=this.BuyData[a],o=this.SellData[a],h=this.HistoryData[a];if(null===n){if(s>0){var l={Data:h,Count:0};a+1<this.HistoryData.length&&(l.NextOpen=this.HistoryData[a+1].Open),n={B:[l],S:null}}}else{for(var u in n.B)++n.B[u].Count;if(s>0){l={Data:h,Count:0};a+1<this.HistoryData.length&&(l.NextOpen=this.HistoryData[a+1].Open),n.B.push(l)}else o>0&&(n.S={Data:h},r.push(n),n=null)}}var C={StartDate:this.HistoryData[e].Date,StartIndex:e,Count:this.HistoryData.length-e,BSData:r};return console.log("[RegressionTest::GetBSData] data",C),C},this.Calculate=function(t){var e={Count:t.Count,Max:null,Min:null,Average:null},a={Count:0,Days:0,Success:0,Fail:0,SuccessRate:0};for(var i in t.BSData){var r=t.BSData[i];for(var n in r.B){var s=r.B[n];null===e.Max?e.Max=s.Count:e.Max<s.Count&&(e.Max=s.Count),null===e.Min?e.Min=s.Count:e.Min>s.Count&&(e.Min=s.Count),++a.Count,a.Days+=s.Count,r.S.Data.Close>s.Data.Open?++a.Success:++a.Fail}}a.Count>0&&(e.Average=a.Days/a.Count,a.SuccessRate=a.Success/a.Count);var o,h=1;for(var i in t.BSData){r=t.BSData[i];o=1===this.NetCalculateModel&&r.B[0].NextOpen>0?r.B[0].NextOpen:r.B[0].Data.Open;var l=r.S.Data.Close,u=(l-o)/o+1;h*=u}h-=1;var C=this.HistoryData[t.StartIndex].Close,D=this.HistoryData[this.HistoryData.length-1].Close,c=(D-C)/C;console.log("[RegressionTest::Calculate] stock profit first["+this.HistoryData[t.StartIndex].Date+", YClose="+this.HistoryData[t.StartIndex].YClose+"] end["+this.HistoryData[this.HistoryData.length-1].Date+", Close="+this.HistoryData[this.HistoryData.length-1].Close+"]");var f=this.CaclulateNetValue(t),d=null,m=null;f&&f.length>0&&(d=this.CaclulateMaxDropdown(f),this.IndexClose&&(m=this.CaclulateBeta(f)));var v={Day:e,Trade:a,Profit:h,StockProfit:c,Excess:h-c,NetValue:f,MaxDropdown:d,Beta:m,BSDataPair:t.BSData};return console.log("[RegressionTest::Calculate] NetCalculateModel, result ",this.NetCalculateModel,v),v},this.CaclulateNetValue=function(t){for(var e,a=t.StartIndex,i=[],r={Position:0,Cache:this.InitialCapital},n=null,s=a;s<this.HistoryData.length;++s){var o=this.BuyData[s],h=this.SellData[s],l=this.HistoryData[s],u={Date:l.Date,Position:r.Position,Cache:r.Cache,Open:l.Open,Close:l.Close};if(u.MarketValue=u.Position*u.Close+u.Cache,null===n){if(o>0){n={B:{Data:l},S:null},e=1===this.NetCalculateModel&&s+1<this.HistoryData.length&&this.HistoryData[s+1].Open>0?this.HistoryData[s+1].Open:u.Open;var C=parseInt(u.Cache/e),D=u.Cache-e*C;u.Position=C,u.Cache=D,u.MarketValue=u.Position*u.Close+u.Cache}}else if(h>0){n.S={Data:l},n=null;var c=u.Position*u.Close;u.Position=0,u.Cache+=c,u.MarketValue=u.Position*u.Close+u.Cache}r.Position=u.Position,r.Cache=u.Cache,u.Net=u.MarketValue/this.InitialCapital,this.IndexClose&&(u.IndexClose=this.IndexClose[s]),i.push(u)}if(i.length<=0)return[];var f=[];for(s=0;s<i.length;++s){var d=i[s],m={Net:d.Net,Date:d.Date,Close:d.Close};d.IndexClose&&(m.IndexClose=d.IndexClose),f.push(m)}return f},this.CaclulateMaxDropdown=function(t){for(var e,a=t[0].Net,i=0,r=1;r<t.length;++r){var n=t[r],s=1-n.Net/a;i<s&&(i=s,e=n),a<n.Net&&(a=n.Net)}return console.log("[RegressionTest::CaclulateMaxDropdown] maxDay",e),i},this.CaclulateBeta=function(t){for(var e=t[0],a=[],i=[],r=0,n=0,s=1;s<t.length;++s){a[s-1]=0,i[s-1]=0;var o=t[s];o.IndexClose>0&&e.IndexClose>0&&(a[s-1]=(o.IndexClose-e.IndexClose)/e.IndexClose),o.Net>0&&e.Net>0&&(i[s-1]=(o.Net-e.Net)/e.Net),r+=a[s-1],n+=i[s-1],e=o}var h=r/a.length,l=n/i.length,u=0;for(s=0;s<a.length;++s)u+=(i[s]-l)*(a[s]-h);var C=0;for(s=0;s<a.length;++s)C+=(a[s]-h)*(a[s]-h);return u/C},this.Execute=function(t){for(var e in t){var a=t[e];if(this.Data.has(a.Name))console.log("[RegressionTest::Execute] id="+e+" Name="+a.Name+" Date:"+a.Date+" is exsit.");else{console.log("[RegressionTest::Execute] id="+e+" Name="+a.Name+" Date:"+a.Date);var i=this.GetBSData(a.Date),r=this.Calculate(i);this.Data.set(a.Name,r)}}}}s.CaclulateOverlayData=function(t){if(!t.Main||!t.Sub)return null;var e=t.Main.length;for(var a in t.Sub){var i=t.Sub[a];if(i.length!=e)return console.log("[RegressionTest::OverlayData] id="+a+" data count not match. MainData count="+e),null}var r=[],n={Sub:[]};n.Main=t.Main[0],r.push([]);for(a=0;a<t.Sub.length;++a){var s=t.Sub[a];n.Sub[a]=s[0],r.push([])}for(a=0;a<t.Main.length;++a){var o=t.Main[a],h=(o-n.Main)/n.Main;r[0][a]=h;for(var l=0;l<t.Sub.length;++l){s=t.Sub[l];var u=s[a],C=(u-n.Sub[l])/n.Sub[l];r[l+1][a]=C}}return r},s.GetPolicyData=function(t){var e={KLineData:null,IndexClose:null,BuyData:null,SellData:null};for(var a in e.KLineData=t.HistoryData.Data,t.OutVar){var i=t.OutVar[a];"INDEXCLOSE"==i.Name?e.IndexClose=i.Data:"DRAWICON"==i.Name&&i.Draw&&i.Draw.Icon&&(13===i.Draw.Icon.ID?e.BuyData=i.Draw.DrawData:14===i.Draw.Icon.ID&&(e.SellData=i.Draw.DrawData))}return e.KLineData&&e.BuyData&&e.SellData?e:null},e.default={RegressionTest:s}},"2e2e":function(t,e,a){a("d62d")("Set")},"2f9a":function(t,e){t.exports=function(){}},"301c":function(t,e,a){a("e198")("asyncIterator")},3397:function(t,e,a){var i=a("7a41");t.exports=function(t,e){if(!i(t))return t;var a,r;if(e&&"function"==typeof(a=t.toString)&&!i(r=a.call(t)))return r;if("function"==typeof(a=t.valueOf)&&!i(r=a.call(t)))return r;if(!e&&"function"==typeof(a=t.toString)&&!i(r=a.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},"33e7":function(t,e,a){"use strict";var i=a("ef08"),r=a("512c"),n=a("e34a"),s=a("4b8b"),o=a("051b"),h=a("899e"),l=a("c253"),u=a("ba43"),C=a("7a41"),D=a("92f0"),c=a("1a14").f,f=a("acd1")(0),d=a("0bad");t.exports=function(t,e,a,m,v,S){var I=i[t],p=I,T=v?"set":"add",A=p&&p.prototype,g={};return d&&"function"==typeof p&&(S||A.forEach&&!s((function(){(new p).entries().next()})))?(p=e((function(e,a){u(e,p,t,"_c"),e._c=new I,void 0!=a&&l(a,v,e[T],e)})),f("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(t){var e="add"==t||"set"==t;t in A&&(!S||"clear"!=t)&&o(p.prototype,t,(function(a,i){if(u(this,p,t),!e&&S&&!C(a))return"get"==t&&void 0;var r=this._c[t](0===a?0:a,i);return e?this:r}))})),S||c(p.prototype,"size",{get:function(){return this._c.size}})):(p=m.getConstructor(e,t,v,T),h(p.prototype,a),n.NEED=!0),D(p,t),g[t]=p,r(r.G+r.W+r.F,g),S||m.setStrong(p,t,v),p}},"365c":function(t,e,a){"use strict";var i=a("512c"),r=a("5524"),n=a("ef08"),s=a("db37"),o=a("24a2");i(i.P+i.R,"Promise",{finally:function(t){var e=s(this,r.Promise||n.Promise),a="function"==typeof t;return this.then(a?function(a){return o(e,t()).then((function(){return a}))}:t,a?function(a){return o(e,t()).then((function(){throw a}))}:t)}})},37873:function(t,e,a){a("c183");var i=a("5524").Object;t.exports=function(t,e,a){return i.defineProperty(t,e,a)}},3834:function(t,e,a){t.exports={default:a("1648"),__esModule:!0}},"393a":function(t,e,a){"use strict";var i=a("e444"),r=a("512c"),n=a("ba01"),s=a("051b"),o=a("8a0d"),h=a("26dd"),l=a("92f0"),u=a("ce7a"),C=a("cc15a")("iterator"),D=!([].keys&&"next"in[].keys()),c="@@iterator",f="keys",d="values",m=function(){return this};t.exports=function(t,e,a,v,S,I,p){h(a,e,v);var T,A,g,F=function(t){if(!D&&t in x)return x[t];switch(t){case f:return function(){return new a(this,t)};case d:return function(){return new a(this,t)}}return function(){return new a(this,t)}},E=e+" Iterator",L=S==d,M=!1,x=t.prototype,N=x[C]||x[c]||S&&x[S],O=N||F(S),y=S?L?F("entries"):O:void 0,R="Array"==e&&x.entries||N;if(R&&(g=u(R.call(new t)),g!==Object.prototype&&g.next&&(l(g,E,!0),i||"function"==typeof g[C]||s(g,C,m))),L&&N&&N.name!==d&&(M=!0,O=function(){return N.call(this)}),i&&!p||!D&&!M&&x[C]||s(x,C,O),o[e]=O,o[E]=m,S)if(T={values:L?O:F(d),keys:I?O:F(f),entries:y},p)for(A in T)A in x||n(x,A,T[A]);else r(r.P+r.F*(D||M),e,T);return T}},"39ad":function(t,e,a){var i=a("6ca1"),r=a("d16a"),n=a("9d11");t.exports=function(t){return function(e,a,s){var o,h=i(e),l=r(h.length),u=n(s,l);if(t&&a!=a){while(l>u)if(o=h[u++],o!=o)return!0}else for(;l>u;u++)if((t||u in h)&&h[u]===a)return t||u||0;return!t&&-1}}},"3c9f":function(t,e,a){"use strict";var i=a("512c");t.exports=function(t){i(i.S,t,{of:function(){var t=arguments.length,e=new Array(t);while(t--)e[t]=arguments[t];return new this(e)}})}},"3df4":function(t,e,a){"use strict";var i=a("add8"),r=a("2405"),n="Set";t.exports=a("33e7")(n,(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(t){return i.def(r(this,n),t=0===t?0:t,t)}},i)},"408a":function(t,e,a){var i=a("c6b6");t.exports=function(t){if("number"!=typeof t&&"Number"!=i(t))throw TypeError("Incorrect invocation");return+t}},4849:function(t,e,a){t.exports={default:a("37873"),__esModule:!0}},"498a":function(t,e,a){"use strict";var i=a("23e7"),r=a("58a8").trim,n=a("e070");i({target:"String",proto:!0,forced:n("trim")},{trim:function(){return r(this)}})},"4b8b":function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},"4d20":function(t,e,a){var i=a("1917"),r=a("10db"),n=a("6ca1"),s=a("3397"),o=a("9c0e"),h=a("faf5"),l=Object.getOwnPropertyDescriptor;e.f=a("0bad")?l:function(t,e){if(t=n(t),e=s(e,!0),h)try{return l(t,e)}catch(a){}if(o(t,e))return r(!i.f.call(t,e),t[e])}},"4d88":function(t,e){var a={}.toString;t.exports=function(t){return a.call(t).slice(8,-1)}},"4de9":function(t,e){t.exports=function(t,e,a){var i=void 0===a;switch(e.length){case 0:return i?t():t.call(a);case 1:return i?t(e[0]):t.call(a,e[0]);case 2:return i?t(e[0],e[1]):t.call(a,e[0],e[1]);case 3:return i?t(e[0],e[1],e[2]):t.call(a,e[0],e[1],e[2]);case 4:return i?t(e[0],e[1],e[2],e[3]):t.call(a,e[0],e[1],e[2],e[3])}return t.apply(a,e)}},"4e71":function(t,e,a){a("e198")("observable")},"4e82":function(t,e,a){"use strict";var i=a("23e7"),r=a("1c0b"),n=a("7b0b"),s=a("d039"),o=a("b301"),h=[],l=h.sort,u=s((function(){h.sort(void 0)})),C=s((function(){h.sort(null)})),D=o("sort"),c=u||!C||D;i({target:"Array",proto:!0,forced:c},{sort:function(t){return void 0===t?l.call(n(this)):l.call(n(this),r(t))}})},"4ebc7":function(t,e,a){var i=a("4d88");t.exports=Array.isArray||function(t){return"Array"==i(t)}},"511f":function(t,e,a){a("0b99"),a("658f"),t.exports=a("fcd4").f("iterator")},"512c":function(t,e,a){var i=a("ef08"),r=a("5524"),n=a("9c0c7"),s=a("051b"),o=a("9c0e"),h="prototype",l=function(t,e,a){var u,C,D,c=t&l.F,f=t&l.G,d=t&l.S,m=t&l.P,v=t&l.B,S=t&l.W,I=f?r:r[e]||(r[e]={}),p=I[h],T=f?i:d?i[e]:(i[e]||{})[h];for(u in f&&(a=e),a)C=!c&&T&&void 0!==T[u],C&&o(I,u)||(D=C?T[u]:a[u],I[u]=f&&"function"!=typeof T[u]?a[u]:v&&C?n(D,i):S&&T[u]==D?function(t){var e=function(e,a,i){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,a)}return new t(e,a,i)}return t.apply(this,arguments)};return e[h]=t[h],e}(D):m&&"function"==typeof D?n(Function.call,D):D,m&&((I.virtual||(I.virtual={}))[u]=D,t&l.R&&p&&!p[u]&&s(p,u,D)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},5524:function(t,e){var a=t.exports={version:"2.6.11"};"number"==typeof __e&&(__e=a)},"5a94":function(t,e,a){var i=a("b367")("keys"),r=a("8b1a");t.exports=function(t){return i[t]||(i[t]=r(t))}},"5cb7":function(t,e,a){"use strict";var i=a("512c"),r=a("f2c2"),n=a("c2a3");i(i.S,"Promise",{try:function(t){var e=r.f(this),a=n(t);return(a.e?e.reject:e.resolve)(a.v),e.promise}})},6042:function(t,e,a){"use strict";e.__esModule=!0;var i=a("4849"),r=n(i);function n(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e,a){return e in t?(0,r.default)(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}},6438:function(t,e,a){var i=a("03d6"),r=a("9742").concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return i(t,r)}},6561:function(t,e,a){"use strict";var i=a("add8"),r=a("2405"),n="Map";t.exports=a("33e7")(n,(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(t){var e=i.getEntry(r(this,n),t);return e&&e.v},set:function(t,e){return i.def(r(this,n),0===t?0:t,e)}},i,!0)},"658f":function(t,e,a){a("6858");for(var i=a("ef08"),r=a("051b"),n=a("8a0d"),s=a("cc15a")("toStringTag"),o="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),h=0;h<o.length;h++){var l=o[h],u=i[l],C=u&&u.prototype;C&&!C[s]&&r(C,s,l),n[l]=n.Array}},6858:function(t,e,a){"use strict";var i=a("2f9a"),r=a("ea34"),n=a("8a0d"),s=a("6ca1");t.exports=a("393a")(Array,"Array",(function(t,e){this._t=s(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,a=this._i++;return!t||a>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?a:"values"==e?t[a]:[a,t[a]])}),"values"),n.Arguments=n.Array,i("keys"),i("values"),i("entries")},"693d":function(t,e,a){"use strict";var i=a("ef08"),r=a("9c0e"),n=a("0bad"),s=a("512c"),o=a("ba01"),h=a("e34a").KEY,l=a("4b8b"),u=a("b367"),C=a("92f0"),D=a("8b1a"),c=a("cc15a"),f=a("fcd4"),d=a("e198"),m=a("0ae2"),v=a("4ebc7"),S=a("77e9"),I=a("7a41"),p=a("0983"),T=a("6ca1"),A=a("3397"),g=a("10db"),F=a("6f4f"),E=a("1836"),L=a("4d20"),M=a("fed5"),x=a("1a14"),N=a("9876"),O=L.f,y=x.f,R=E.f,P=i.Symbol,w=i.JSON,b=w&&w.stringify,B="prototype",_=c("_hidden"),H=c("toPrimitive"),V={}.propertyIsEnumerable,G=u("symbol-registry"),k=u("symbols"),Y=u("op-symbols"),U=Object[B],W="function"==typeof P&&!!M.f,X=i.QObject,K=!X||!X[B]||!X[B].findChild,J=n&&l((function(){return 7!=F(y({},"a",{get:function(){return y(this,"a",{value:7}).a}})).a}))?function(t,e,a){var i=O(U,e);i&&delete U[e],y(t,e,a),i&&t!==U&&y(U,e,i)}:y,z=function(t){var e=k[t]=F(P[B]);return e._k=t,e},q=W&&"symbol"==typeof P.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof P},Z=function(t,e,a){return t===U&&Z(Y,e,a),S(t),e=A(e,!0),S(a),r(k,e)?(a.enumerable?(r(t,_)&&t[_][e]&&(t[_][e]=!1),a=F(a,{enumerable:g(0,!1)})):(r(t,_)||y(t,_,g(1,{})),t[_][e]=!0),J(t,e,a)):y(t,e,a)},Q=function(t,e){S(t);var a,i=m(e=T(e)),r=0,n=i.length;while(n>r)Z(t,a=i[r++],e[a]);return t},j=function(t,e){return void 0===e?F(t):Q(F(t),e)},$=function(t){var e=V.call(this,t=A(t,!0));return!(this===U&&r(k,t)&&!r(Y,t))&&(!(e||!r(this,t)||!r(k,t)||r(this,_)&&this[_][t])||e)},tt=function(t,e){if(t=T(t),e=A(e,!0),t!==U||!r(k,e)||r(Y,e)){var a=O(t,e);return!a||!r(k,e)||r(t,_)&&t[_][e]||(a.enumerable=!0),a}},et=function(t){var e,a=R(T(t)),i=[],n=0;while(a.length>n)r(k,e=a[n++])||e==_||e==h||i.push(e);return i},at=function(t){var e,a=t===U,i=R(a?Y:T(t)),n=[],s=0;while(i.length>s)!r(k,e=i[s++])||a&&!r(U,e)||n.push(k[e]);return n};W||(P=function(){if(this instanceof P)throw TypeError("Symbol is not a constructor!");var t=D(arguments.length>0?arguments[0]:void 0),e=function(a){this===U&&e.call(Y,a),r(this,_)&&r(this[_],t)&&(this[_][t]=!1),J(this,t,g(1,a))};return n&&K&&J(U,t,{configurable:!0,set:e}),z(t)},o(P[B],"toString",(function(){return this._k})),L.f=tt,x.f=Z,a("6438").f=E.f=et,a("1917").f=$,M.f=at,n&&!a("e444")&&o(U,"propertyIsEnumerable",$,!0),f.f=function(t){return z(c(t))}),s(s.G+s.W+s.F*!W,{Symbol:P});for(var it="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;it.length>rt;)c(it[rt++]);for(var nt=N(c.store),st=0;nt.length>st;)d(nt[st++]);s(s.S+s.F*!W,"Symbol",{for:function(t){return r(G,t+="")?G[t]:G[t]=P(t)},keyFor:function(t){if(!q(t))throw TypeError(t+" is not a symbol!");for(var e in G)if(G[e]===t)return e},useSetter:function(){K=!0},useSimple:function(){K=!1}}),s(s.S+s.F*!W,"Object",{create:j,defineProperty:Z,defineProperties:Q,getOwnPropertyDescriptor:tt,getOwnPropertyNames:et,getOwnPropertySymbols:at});var ot=l((function(){M.f(1)}));s(s.S+s.F*ot,"Object",{getOwnPropertySymbols:function(t){return M.f(p(t))}}),w&&s(s.S+s.F*(!W||l((function(){var t=P();return"[null]"!=b([t])||"{}"!=b({a:t})||"{}"!=b(Object(t))}))),"JSON",{stringify:function(t){var e,a,i=[t],r=1;while(arguments.length>r)i.push(arguments[r++]);if(a=e=i[1],(I(e)||void 0!==t)&&!q(t))return v(e)||(e=function(t,e){if("function"==typeof a&&(e=a.call(this,t,e)),!q(e))return e}),i[1]=e,b.apply(w,i)}}),P[B][H]||a("051b")(P[B],H,P[B].valueOf),C(P,"Symbol"),C(Math,"Math",!0),C(i.JSON,"JSON",!0)},"6aa8":function(t,e,a){var i=a("4d88"),r=a("cc15a")("toStringTag"),n="Arguments"==i(function(){return arguments}()),s=function(t,e){try{return t[e]}catch(a){}};t.exports=function(t){var e,a,o;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(a=s(e=Object(t),r))?a:n?i(e):"Object"==(o=i(e))&&"function"==typeof e.callee?"Arguments":o}},"6ca1":function(t,e,a){var i=a("9fbb"),r=a("c901");t.exports=function(t){return i(r(t))}},"6d2f":function(t,e,a){var i=a("8a0d"),r=a("cc15a")("iterator"),n=Array.prototype;t.exports=function(t){return void 0!==t&&(i.Array===t||n[r]===t)}},"6f4f":function(t,e,a){var i=a("77e9"),r=a("85e7"),n=a("9742"),s=a("5a94")("IE_PROTO"),o=function(){},h="prototype",l=function(){var t,e=a("05f5")("iframe"),i=n.length,r="<",s=">";e.style.display="none",a("9141").appendChild(e),e.src="javascript:",t=e.contentWindow.document,t.open(),t.write(r+"script"+s+"document.F=Object"+r+"/script"+s),t.close(),l=t.F;while(i--)delete l[h][n[i]];return l()};t.exports=Object.create||function(t,e){var a;return null!==t?(o[h]=i(t),a=new o,o[h]=null,a[s]=t):a=l(),void 0===e?a:r(a,e)}},"6fe5":function(t,e,a){var i=a("da84"),r=a("58a8").trim,n=a("5899"),s=i.parseFloat,o=1/s(n+"-0")!==-1/0;t.exports=o?function(t){var e=r(String(t)),a=s(e);return 0===a&&"-"==e.charAt(0)?-0:a}:s},7183:function(t,e,a){"use strict";a("a4d3"),a("e01a"),a("7db0"),a("c975"),a("4e82"),a("b0c0"),a("d3b7"),a("e25e"),a("25f0"),a("5319"),a("159b"),Object.defineProperty(e,"__esModule",{value:!0});var i,r=a("6042"),n=f(r),s=a("1727"),o=f(s),h=a("3834"),l=f(h),u=a("8d65"),C=f(u),D=a("1157"),c=f(D);function f(t){return t&&t.__esModule?t:{default:t}}function d(){this.Domain="https://opensource.zealink.com",this.CacheDomain="https://opensourcecache.zealink.com"}var m=new d;function v(){this.Stop,this.Down,this.Up,this.Unchanged,this.UpStock={Symbol:null,Name:null},this.DownStock={Symbol:null,Name:null}}function S(){this.Good,this.GoodIncrease={Day1:null,Week1:null,Week4:null}}function I(t,e,a){this.arySymbol=new Array,this.SortField=t,this.Order=e,this.TagID=new C.default([a])}function p(){this.ROE,this.Date,this.PerSEarning,this.EPS,this.PerNetAsset,this.NProfit,this.NProfitIncrease,this.NnetProfit,this.NnProfitIncrease,this.NnProfitSpeed,this.Benford,this.SetData=function(t){isNaN(t.roe)||(this.ROE=t.roe),isNaN(t.finance.date)||(this.Date=t.finance.date),isNaN(t.finance.persearning)||(this.PerSEarning=t.finance.persearning),isNaN(t.finance.eps)||(this.EPS=t.finance.eps),isNaN(t.finance.pernetasset)||(this.PerNetAsset=t.finance.pernetasset),isNaN(t.finance.nprofit)||(this.NProfit=t.finance.nprofit),isNaN(t.finance.nprofitincrease)||(this.NProfitIncrease=t.finance.nprofitincrease),isNaN(t.finance.nnetprofit)||(this.NnetProfit=t.finance.nnetprofit),isNaN(t.finance.nnprofitincrease)||(this.NnProfitIncrease=t.finance.nnprofitincrease),isNaN(t.finance.nnprofitspeed)||(this.NnProfitSpeed=t.finance.nnprofitspeed),isNaN(t.finance.benford)||(this.Benford=t.finance.benford)}}function T(){this.Date,this.A,this.Total,this.ARate,this.SetData=function(t){isNaN(t.capital.date)||(this.Date=t.capital.date),isNaN(t.capital.a)||(this.A=t.capital.a),isNaN(t.capital.total)||(this.Total=t.capital.total),isNaN(t.capital.arate)||(this.ARate=t.capital.arate)}}function A(){this.SuperIn,this.SuperOut,this.BigIn,this.BigOut,this.MidIn,this.MidOut,this.SmallIn,this.SmallOut,this.MainIn,this.MainOut,this.MainNetIn,this.SetData=function(t){this.SuperIn=t.superin,this.SuperOut=t.superout,this.BigIn=t.bigin,this.BigOut=t.bigout,this.MidIn=t.midin,this.MidOut=t.midout,this.SmallIn=t.smallin,this.SmallOut=t.smallout,this.MainIn=t.mainin,this.MainOut=t.mainout,this.MainNetIn=t.mainnetin}}function g(){this.SuperIn,this.SuperOut,this.BigIn,this.BigOut,this.MidIn,this.MidOut,this.SmallIn,this.SmallOut,this.MainIn,this.MainOut,this.MainNetIn,this.MainNetInRatio,this.SetData=function(t){this.SuperIn=t.superin,this.SuperOut=t.superout,this.BigIn=t.bigin,this.BigOut=t.bigout,this.MidIn=t.midin,this.MidOut=t.midout,this.SmallIn=t.smallin,this.SmallOut=t.smallout,this.MainIn=t.mainin,this.MainOut=t.mainout,this.MainNetIn=t.mainnetin,this.MainNetInRatio=t.mainnetinratio}}function F(){this.DDX,this.DDY,this.DDZ,this.SetData=function(t){this.DDX=t.ddx,this.DDY=t.ddy,this.DDZ=t.ddz}}function E(){this.Name,this.Business,this.Vol,this.Price,this.ReleaseDate,this.Competence,this.SetData=function(t){t.company&&(this.Name=t.company.name,this.Business=t.company.business,this.Vol=t.company.vol,this.Price=t.company.price,this.ReleaseDate=t.company.releasedate,this.Competence=t.company.corecompetence)}}function L(){this.Industry,this.Region,this.Concept,this.SetData=function(t){this.SetIndustryData(t),this.SetRegionData(t),this.SetConceptData(t)},this.SetIndustryData=function(t){if(t.industry)for(var e in this.Industry=[],t.industry){var a=t.industry[e];this.Industry.push({Name:a.name,Symbol:a.symbol})}},this.SetRegionData=function(t){if(t.region)for(var e in this.Region=[],t.region){var a=t.region[e];this.Region.push({Name:a.name,Symbol:a.symbol})}},this.SetConceptData=function(t){if(t.concept)for(var e in this.Concept=[],t.concept){var a=t.concept[e];this.Concept.push({Name:a.name,Symbol:a.symbol})}}}function M(){this.IsMargin=!1,this.IsHK=!1,this.IsSHHK=!1,this.IsSZHK=!1,this.STType=0,this.HK,this.SetData=function(t){t.events&&(isNaN(t.events.margin)||(this.IsMargin=1==t.events.margin),isNaN(t.events.hk)||(this.IsHK=1==t.events.hk),isNaN(t.events.shhk)||(this.IsSHHK=1==t.events.shhk),isNaN(t.events.szhk)||(this.IsSZHK=1==t.events.szhk),isNaN(t.events.st)||(this.STType=t.events.st),this.IsHK&&t.events.hksymbol&&t.events.hkname&&(this.HK={Symbol:t.events.hksymbol,Name:t.events.hkname}))}}function x(t){var e=t.toUpperCase();if(e.indexOf(".SH")>0){if(e=e.replace(".SH",""),"0"==e.charAt(0)&&parseInt(e)<=3e3)return!0}else if(e.indexOf(".SZ")>0){if(e=e.replace(".SZ",""),"3"==e.charAt(0)&&"9"==e.charAt(1))return!0}else if(e.indexOf(".CI")>0)return!0;return!1}function N(t){this.Symbol=t,this.Name,this.Open,this.Price,this.High,this.Low,this.YClose,this.Vol,this.Amount,this.Date,this.Time,this.ExchangeRate,this.Amplitude,this.VolRatio,this.Increase,this.MaxPrice,this.MinPrice,this.RFPrice,this.IndexTop,this.Week,this.MinuteAmplitude={},this.RiseFallSpeed={},this.MAmount={},this.GetBaseData=function(t,e){switch(this.BaseDataTagID.add(t),e){case O.SYMBOL:return this.Symbol;case O.NAME:return this.Name;case O.OPEN:return this.Open;case O.PRICE:return this.Price;case O.YCLOSE:return this.YClose;case O.HIGH:return this.High;case O.LOW:return this.Low;case O.VOL:return this.Vol;case O.AMOUNT:return this.Amount;case O.DATE:return this.Date;case O.TIME:return this.Time;case O.INCREASE:return this.Increase;case O.EXCHANGE_RATE:return this.ExchangeRate;case O.AMPLITUDE:return this.Amplitude;case O.MAX_PRICE:return this.MaxPrice;case O.MIN_PRICE:return this.MinPrice;case O.RISE_FALL_PRICE:return this.RFPrice;case O.VOLRATIO:return this.VolRatio;case O.INDEXTOP:return this.IndexTop;case O.WEEK:return this.Week}},this.Heat,this.GetHeatData=function(t){return this.HeatTagID.add(t),this.Heat},this.Sort=new l.default,this.GetSortData=function(t,e,a){var i=e.toString()+"-"+a.toString();if(!this.Sort.has(i)){var r=new I(e,a,t);return this.Sort.set(i,r),r}r=this.Sort.get(i);return r.TagID.add(t),r},this.Buy5,this.GetBuy5=function(t){return this.BuySellTagID.add(t),this.Buy5},this.Sell5,this.GetSell5=function(t){return this.BuySellTagID.add(t),this.Sell5},this.Deal,this.GetDeal=function(t){return this.DealTagID.add(t),this.Deal},this.MarketValue,this.FlowMarketValue,this.Bookrate,this.Bookdiffer,this.PE,this.PE2,this.PE3,this.PB,this.GetDerivative=function(t,e){switch(this.DerivativeTagID.add(t),e){case O.MARKET_VALUE:return this.MarketValue;case O.FLOW_MARKET_VALUE:return this.FlowMarketValue;case O.BOOK_RATE:return this.Bookrate;case O.BOOK_DIFFER:return this.Bookdiffer;case O.PE:return this.PE;case O.PE2:return this.PE2;case O.PE3:return this.PE3;case O.PB:return this.PB}},this.Finance,this.GetFinance=function(t,e){if(!this.Finance)return this.FinanceTagID.add(t),null;switch(e){case O.ROE:return this.Finance.ROE;case O.FINANCE_DATE:return this.Finance.Date;case O.FINANCE_PERSEARNING:return this.Finance.PerSEarning;case O.FINANCE_PERNETASSET:return this.Finance.PerNetAsset;case O.FINANCE_NPROFIT:return this.Finance.NProfit;case O.FINANCE_NPROFITINCREASE:return this.Finance.NProfitIncrease;case O.FINANCE_NNETPROFIT:return this.Finance.NnetProfit;case O.FINANCE_NNPROFITINCREASE:return this.Finance.NnProfitIncrease;case O.FINANCE_NNPROFITSPEED:return this.Finance.NnProfitSpeed;case O.FINANCE_EPS:return this.Finance.EPS;case O.FINANCE_BENFORD:return this.Finance.Benford}},this.Capital,this.GetCapital=function(t,e){if(!this.Capital)return this.CapitalTagID.add(t),null;switch(e){case O.CAPITAL_TOTAL:return this.Capital.Total;case O.CAPITAL_A:return this.Capital.A;case O.CAPTIAL_ARATE:return this.Capital.ARate}},this.CapitalFlowDay,this.CapitalFlowDay3,this.CapitalFlowDay5,this.CapitalFlowDay10,this.GetCapitalFlowDay=function(t,e){var a=null;switch(e){case O.CAPITAL_FLOW_DAY:this.CapitalFlowDayID.add(t),this.CapitalFlowDay&&(a=this.CapitalFlowDay);break;case O.CAPITAL_FLOW_DAY3:this.CapitalFlowDay3ID.add(t),this.CapitalFlowDay3&&(a=this.CapitalFlowDay3);break;case O.CAPITAL_FLOW_DAY5:this.CapitalFlowDay5ID.add(t),this.CapitalFlowDay5&&(a=this.CapitalFlowDay5);break;case O.CAPITAL_FLOW_DAY10:this.CapitalFlowDay10ID.add(t),this.CapitalFlowDay10&&(a=this.CapitalFlowDay10);break}return a},this.DDE,this.DDE3,this.DDE5,this.DDE10,this.GetDDE=function(t,e){var a=null;switch(e){case O.DDE:this.DDEID.add(t),this.DDE&&(a=this.DDE);break;case O.DDE3:this.DDE3ID.add(t),this.DDE3&&(a=this.DDE3);break;case O.DDE5:this.DDE5ID.add(t),this.DDE5&&(a=this.DDE5);break;case O.DDE10:this.DDE10ID.add(t),this.DDE10&&(a=this.DDE10);break}return a},this.Event,this.GetEvent=function(t,e){return this.Event?this.Event:(this.EventTagID.add(t),null)},this.Company,this.GetCompany=function(t,e){if(!this.Company)return this.CompanyTagID.add(t),null;switch(e){case O.COMPANY_NAME:return this.Company.Name;case O.COMPANY_BUSINESS:return this.Company.Business;case O.COMPANY_VOL:return this.Company.Vol;case O.COMPANY_PRICE:return this.Company.Price;case O.COMPANY_RELEASEDATE:return this.Company.ReleaseDate;case O.COMPANY_COMPETENCE:return this.Company.Competence}},this.Plate,this.GetPlate=function(t,e){if(!this.Plate)return this.PlateTagID.add(t),null;switch(e){case O.PLATE_INDUSTRY:return this.Plate.Industry;case O.PLATE_CONCEPT:return this.Plate.Concept;case O.PLATE_REGION:return this.Plate.Region}},this.TagID=new C.default,this.BaseDataTagID=new C.default,this.HeatTagID=new C.default,this.BuySellTagID=new C.default,this.DealTagID=new C.default,this.DerivativeTagID=new C.default,this.FinanceTagID=new C.default,this.CapitalTagID=new C.default,this.CapitalFlowDayID=new C.default,this.CapitalFlowDay3ID=new C.default,this.CapitalFlowDay5ID=new C.default,this.CapitalFlowDay10ID=new C.default,this.DDEID=new C.default,this.DDE3ID=new C.default,this.DDE5ID=new C.default,this.DDE10ID=new C.default,this.EventTagID=new C.default,this.CompanyTagID=new C.default,this.PlateTagID=new C.default,this.AttachTagID=function(t){this.TagID.add(t)},this.ClearTagID=function(){this.TagID.clear(),this.BaseDataTagID.clear(),this.HeatTagID.clear(),this.BuySellTagID.clear(),this.DealTagID.clear(),this.DerivativeTagID.clear(),this.FinanceTagID.clear(),this.CapitalTagID.clear(),this.CapitalFlowDayID.clear(),this.CapitalFlowDay3ID.clear(),this.CapitalFlowDay5ID.clear(),this.CapitalFlowDay10ID.clear(),this.DDEID.clear(),this.DDE3ID.clear(),this.DDE5ID.clear(),this.DDE10ID.clear(),this.EventTagID.clear(),this.CompanyTagID.clear();var t=!0,e=!1,a=void 0;try{for(var i,r=(0,o.default)(this.Sort);!(t=(i=r.next()).done);t=!0){var n=i.value;n[1].TagID.clear()}}catch(s){e=!0,a=s}finally{try{!t&&r.return&&r.return()}finally{if(e)throw a}}},this.RemoveTagID=function(t){this.TagID.delete(t),this.BaseDataTagID.delete(t),this.HeatTagID.delete(t),this.BuySellTagID.delete(t),this.DealTagID.delete(t),this.DerivativeTagID.delete(t),this.FinanceTagID.delete(t),this.CapitalTagID.delete(t),this.CapitalFlowDayID.delete(t),this.CapitalFlowDay3ID.delete(t),this.CapitalFlowDay5ID.delete(t),this.CapitalFlowDay10ID.delete(t),this.DDEID.delete(t),this.DDE3ID.delete(t),this.DDE5ID.delete(t),this.DDE10ID.delete(t),this.EventTagID.delete(t),this.CompanyTagID.delete(t);var e=!0,a=!1,i=void 0;try{for(var r,n=(0,o.default)(this.Sort);!(e=(r=n.next()).done);e=!0){var s=r.value;s[1].TagID.delete(t)}}catch(h){a=!0,i=h}finally{try{!e&&n.return&&n.return()}finally{if(a)throw i}}},this.SetBaseData=function(t){this.Name=t.name,this.YClose=t.yclose,this.Price=t.price,this.High=t.high,this.Low=t.low,this.Open=t.open,this.Vol=t.vol,this.Amount=t.amount,this.Date=t.date,this.Time=t.time,this.Increase=t.increase,isNaN(t.exchangerate)||(this.ExchangeRate=t.exchangerate),isNaN(t.amplitude)||(this.Amplitude=t.amplitude),isNaN(t.volratio)||(this.VolRatio=t.volratio),this.Name.indexOf("ST")>=0?(this.MaxPrice=1.05*this.Open,this.MinPrice=.95*this.Open):(this.MaxPrice=1.1*this.Open,this.MinPrice=.9*this.Open),this.Price&&this.YClose&&(this.RFPrice=this.Price-this.YClose),t.week&&(this.Week={},this.Week.Week1=t.week.week1,this.Week.Week4=t.week.week4,this.Week.Week13=t.week.week13,this.Week.Week26=t.week.week26,this.Week.Week52=t.week.week52)},this.SetDerivativeData=function(t){this.MarketValue=t.marketvalue,this.FlowMarketValue=t.flowmarketvalue,this.Bookrate=t.bookrate,this.Bookdiffer=t.bookdiffer,this.PE=t.pe,this.PE2=t.pe2,this.PE3=t.pe3,this.PB=t.pb},this.SetFinanceData=function(t){console.log(t),t.finance&&(this.Finance=new p,this.Finance.SetData(t))},this.SetCapitalData=function(t){t.capital&&(this.Capital=new T,this.Capital.SetData(t))},this.SetIndexBaseData=function(t){this.SetBaseData(t);var e=new v;t.indextop&&(e.Up=t.indextop.up,e.Down=t.indextop.down,e.Unchanged=t.indextop.unchanged,e.Stop=t.indextop.stop,e.UpStock.Symbol=t.indextop.upstock.symbol,e.UpStock.Name=t.indextop.upstock.name,e.DownStock.Symbol=t.indextop.downstock.symbol,e.DownStock.Name=t.indextop.downstock.name),this.IndexTop=e},this.SetBuySellData=function(t){for(var e in this.SetBaseData(t),this.Buy5=new Array,this.Sell5=new Array,t.buy){var a=t.buy[e];this.Buy5.push({Price:a.price,Vol:a.vol})}for(var e in t.sell){a=t.sell[e];this.Sell5.push({Price:a.price,Vol:a.vol})}},this.SetDealData=function(t){for(var e in this.Price=t.price,this.High=t.high,this.Low=t.low,this.Vol=t.vol,this.Amount=t.amount,this.Date=t.date,this.Time=t.time,this.Increase=t.increase,this.Deal=new Array,t.deal){var a=t.deal[e];if(!isNaN(a.price)&&!isNaN(a.time)){var i="";0===a.bs?i="B":1===a.bs&&(i="S"),this.Deal.push({Price:a.price,Amount:a.amount,Vol:a.vol,Time:a.time,BS:i})}}},this.SetHeatData=function(t){var e=new S;e.Good=t.quadrant.good,e.GoodIncrease.Day1=t.quadrant.gincrease.day1,e.GoodIncrease.Week1=t.quadrant.gincrease.week1,e.GoodIncrease.Week4=t.quadrant.gincrease.week4,this.Heat=e},this.SetCapitalFlowDayData=function(t,e){if(t)switch(e){case w.CAPITAL_FLOW_DAY_DATA:this.CapitalFlowDay=new A,this.CapitalFlowDay.SetData(t);break;case w.CAPITAL_FLOW_DAY3_DATA:this.CapitalFlowDay3=new g,this.CapitalFlowDay3.SetData(t);break;case w.CAPITAL_FLOW_DAY5_DATA:this.CapitalFlowDay5=new g,this.CapitalFlowDay5.SetData(t);break;case w.CAPITAL_FLOW_DAY10_DATA:this.CapitalFlowDay10=new g,this.CapitalFlowDay10.SetData(t);break}},this.SetDDE=function(t,e){if(t){switch(e){case w.DDE_DAY_DATA:this.DDE=new F,this.DDE.SetData(t);break;case w.DDE_DAY3_DATA:this.DDE3=new F,this.DDE3.SetData(t);break;case w.DDE_DAY5_DATA:this.DDE5=new F,this.DDE5.SetData(t);break;case w.DDE_DAY10_DATA:this.DDE10=new F,this.DDE10.SetData(t);break}return t}},this.SetEventData=function(t){t.events&&(this.Event=new M,this.Event.SetData(t))},this.SetCompanyData=function(t){t.company&&(this.Company=new E,this.Company.SetData(t))},this.SetPlateData=function(t){(t.industry||t.region||t.concept)&&(this.Plate=new L,this.Plate.SetData(t))},this.SetData=function(t){t.name&&(this.Name=t.name),isNaN(t.yclose)||(this.YClose=t.yclose),isNaN(t.price)||(this.Price=t.price),isNaN(t.high)||(this.High=t.high),isNaN(t.low)||(this.Low=t.low),isNaN(t.vol)||(this.Vol=t.vol),isNaN(t.amount)||(this.Amount=t.amount),isNaN(t.date)||(this.Date=t.date),isNaN(t.time)||(this.Time=t.time),isNaN(t.increase)||(this.Increase=t.increase),isNaN(t.marketvalue)||(this.MarketValue=t.marketvalue),isNaN(t.flowmarketvalue)||(this.FlowMarketValue=t.flowmarketvalue),isNaN(t.bookrate)||(this.Bookrate=t.bookrate),isNaN(t.bookdiffer)||(this.Bookdiffer=t.bookdiffer),isNaN(t.pe)||(this.PE=t.pe),isNaN(t.pb)||(this.PB=t.pb),t.finance&&this.SetFinanceData(t),t.finance&&this.SetFinanceDetailData(t),t.capital&&this.SetCapitalData(t),t.mamplitude&&(isNaN(t.mamplitude[1])||(this.MinuteAmplitude.M1=t.mamplitude[1]),isNaN(t.mamplitude[3])||(this.MinuteAmplitude.M3=t.mamplitude[3]),isNaN(t.mamplitude[5])||(this.MinuteAmplitude.M5=t.mamplitude[5]),isNaN(t.mamplitude[10])||(this.MinuteAmplitude.M10=t.mamplitude[10]),isNaN(t.mamplitude[15])||(this.MinuteAmplitude.M15=t.mamplitude[15])),t.risefallspeed&&(isNaN(t.risefallspeed[1])||(this.RiseFallSpeed.M1=t.risefallspeed[1]),isNaN(t.risefallspeed[3])||(this.RiseFallSpeed.M3=t.risefallspeed[3]),isNaN(t.risefallspeed[5])||(this.RiseFallSpeed.M5=t.risefallspeed[5]),isNaN(t.risefallspeed[10])||(this.RiseFallSpeed.M10=t.risefallspeed[10]),isNaN(t.risefallspeed[15])||(this.RiseFallSpeed.M15=t.risefallspeed[15])),t.mamount&&(isNaN(t.mamount[1])||(this.MAmount.M1=t.mamount[1]),isNaN(t.mamount[3])||(this.MAmount.M5=t.mamount[3]),isNaN(t.mamount[5])||(this.MAmount.M5=t.mamount[5]),isNaN(t.mamount[10])||(this.MAmount.M10=t.mamount[10]),isNaN(t.mamount[15])||(this.MAmount.M15=t.mamount[15]))}}var O={SYMBOL:0,NAME:1,OPEN:2,PRICE:3,HIGH:4,LOW:5,YCLOSE:6,VOL:7,AMOUNT:8,DATE:9,TIME:10,INCREASE:11,BUY5:12,SELL5:13,DEAL:14,AMPLITUDE:15,MARKET_VALUE:16,FLOW_MARKET_VALUE:17,BOOK_RATE:18,BOOK_DIFFER:19,PE:20,PB:21,EXCHANGE_RATE:23,ROE:24,FINANCE_DATE:25,FINANCE_PERSEARNING:26,FINANCE_PERNETASSET:27,FINANCE_NPROFIT:28,FINANCE_NPROFITINCREASE:29,FINANCE_NNETPROFIT:30,FINANCE_NNPROFITINCREASE:31,FINANCE_NNPROFITSPEED:32,FINANCE_EPS:33,MAX_PRICE:34,MIN_PRICE:35,RISE_FALL_PRICE:36,FINANCE_BENFORD:37,RISEFALLSPEED_1:38,RISEFALLSPEED_3:39,RISEFALLSPEED_5:40,RISEFALLSPEED_10:41,RISEFALLSPEED_15:42,MINUTE_AMPLITUDE_1:43,MINUTE_AMPLITUDE_3:44,MINUTE_AMPLITUDE_5:45,MINUTE_AMPLITUDE_10:46,MINUTE_AMPLITUDE_15:47,MINUTE_AMOUNT_1:48,MINUTE_AMOUNT_3:49,MINUTE_AMOUNT_5:50,MINUTE_AMOUNT_10:51,MINUTE_AMOUNT_15:52,COMPANY_NAME:53,PLATE_INDUSTRY:54,PLATE_CONCEPT:55,PLATE_REGION:56,COMPANY_BUSINESS:57,COMPANY_VOL:58,COMPANY_PRICE:59,COMPANY_RELEASEDATE:60,COMPANY_COMPETENCE:61,CAPITAL_FLOW_DAY:67,CAPITAL_FLOW_DAY3:68,CAPITAL_FLOW_DAY5:69,CAPITAL_FLOW_DAY10:70,DDE:71,DDE3:72,DDE5:73,DDE10:74,EVENTS:75,CAPITAL_A:76,CAPITAL_TOTAL:77,CAPTIAL_ARATE:78,VOLRATIO:79,PE2:80,PE3:81,INDEXTOP:100,WEEK:101,HEAT:102},y={m_mapFiled:new l.default([[O.NAME,"name"],[O.SYMBOL,"symbol"],[O.PRICE,"price"],[O.INCREASE,"increase"],[O.PE,"pe"],[O.FINANCE_BENFORD,"finance.benford"],[O.YCLOSE,"yclose"],[O.RISEFALLSPEED_1,"risefallspeed.1"],[O.RISEFALLSPEED_3,"risefallspeed.3"],[O.RISEFALLSPEED_5,"risefallspeed.5"],[O.RISEFALLSPEED_10,"risefallspeed.10"],[O.RISEFALLSPEED_15,"risefallspeed.15"],[O.MINUTE_AMPLITUDE_1,"mamplitude.1"],[O.MINUTE_AMPLITUDE_3,"mamplitude.3"],[O.MINUTE_AMPLITUDE_5,"mamplitude.5"],[O.MINUTE_AMPLITUDE_10,"mamplitude.10"],[O.MINUTE_AMPLITUDE_15,"mamplitude.15"],[O.MINUTE_AMOUNT_1,"mamount.1"],[O.MINUTE_AMOUNT_3,"mamount.3"],[O.MINUTE_AMOUNT_5,"mamount.5"],[O.MINUTE_AMOUNT_10,"mamount.10"],[O.MINUTE_AMOUNT_15,"mamount.15"]]),GetFieldName:function(t){return this.m_mapFiled.has(t)?this.m_mapFiled.get(t):null}};function R(t,e){this.JSStock=t,this.TagID=e,this.Get=function(e,a){var i=t.Get(e,this.TagID);if(!i)return null;switch(a){case O.SYMBOL:case O.NAME:case O.OPEN:case O.PRICE:case O.YCLOSE:case O.HIGH:case O.LOW:case O.VOL:case O.AMOUNT:case O.DATE:case O.TIME:case O.INCREASE:case O.EXCHANGE_RATE:case O.AMPLITUDE:case O.MAX_PRICE:case O.MIN_PRICE:case O.RISE_FALL_PRICE:case O.INDEXTOP:case O.WEEK:case O.VOLRATIO:return i.GetBaseData(this.TagID,a);case O.HEAT:return i.GetHeatData(this.TagID);case O.BUY5:return i.GetBuy5(this.TagID);case O.SELL5:return i.GetSell5(this.TagID);case O.DEAL:return i.GetDeal(this.TagID);case O.MARKET_VALUE:case O.FLOW_MARKET_VALUE:case O.BOOK_RATE:case O.BOOK_DIFFER:case O.PE:case O.PE2:case O.PE3:case O.PB:return i.GetDerivative(this.TagID,a);case O.ROE:case O.FINANCE_DATE:case O.FINANCE_PERSEARNING:case O.FINANCE_PERNETASSET:case O.FINANCE_NPROFIT:case O.FINANCE_NPROFITINCREASE:case O.FINANCE_NNETPROFIT:case O.FINANCE_NNPROFITINCREASE:case O.FINANCE_NNPROFITSPEED:case O.FINANCE_EPS:case O.FINANCE_BENFORD:return i.GetFinance(this.TagID,a);case O.PLATE_INDUSTRY:case O.PLATE_CONCEPT:case O.PLATE_REGION:return i.GetPlate(this.TagID,a);case O.CAPITAL_FLOW_DAY:case O.CAPITAL_FLOW_DAY3:case O.CAPITAL_FLOW_DAY5:case O.CAPITAL_FLOW_DAY10:return i.GetCapitalFlowDay(this.TagID,a);case O.DDE:case O.DDE3:case O.DDE5:case O.DDE10:return i.GetDDE(this.TagID,a);case O.EVENTS:return i.GetEvent(this.TagID,a);case O.COMPANY_NAME:case O.COMPANY_BUSINESS:case O.COMPANY_VOL:case O.COMPANY_PRICE:case O.COMPANY_RELEASEDATE:case O.COMPANY_COMPETENCE:return i.GetCompany(this.TagID,a);case O.CAPITAL_A:case O.CAPTIAL_ARATE:case O.CAPITAL_TOTAL:return i.GetCapital(this.TagID,a);default:return null}},this.GetSort=function(e,a,i){var r=t.Get(e,this.TagID);return null==r?r:r.GetSortData(this.TagID,a,i)},this.EndRead=function(t){1==t&&this.JSStock.ReqeustData()},this.SetQueryField=function(t,e){for(var a in e)this.Get(t,e[a])}}function P(){this.Symbol,this.Callback,this.Order=-1,this.SortField,this.Field,this.Plate,this.Data=new l.default,this.ApiUrl=m.Domain+"/API/StockHistoryDay",this.PageSize=20,this.PageIndex=1,this.Count,this.currentData=null,this.RequsetData=function(t,e){var a=this,i="string"==typeof a.Symbol?[this.Symbol]:this.Symbol,r=i?i.length:0;this.Plate?this.currentData={plate:this.Plate,symbol:i,start:0,end:this.PageSize,field:this.Field,orderfield:this.SortField,order:this.Order,condition:t.GetQuery(),condition2:e?e.GetQuery():[]}:this.currentData={symbol:i,start:0,end:r,field:this.Field,orderfield:this.SortField,order:this.Order,condition:t.GetQuery(),condition2:e?e.GetQuery():[]},c.default.ajax({url:this.ApiUrl,data:a.currentData,method:"POST",dataType:"json",success:function(e){a.Count=e.data.count,a.RecvData(e,t)},fail:function(e){a.RecvError(e,t)}})},this.GetNextPage=function(){var t=this;this.PageSize*this.PageIndex<this.Count?(this.currentData.start=this.PageSize*this.PageIndex,this.PageIndex++,this.currentData.end=this.PageSize*this.PageIndex,c.default.ajax({url:this.ApiUrl,data:t.currentData,method:"POST",dataType:"json",success:function(e){t.RecvData(e)},fail:function(e){t.RecvError(e)}})):alert("数据已全部加载")},this.RecvData=function(t,e){var a=t.data;for(var i in a.stock){var r=a.stock[i],n=r.symbol,s={};this.Data.has(n)?s=this.Data.get(n):(s={Symbol:r.symbol,Name:r.name,Data:new l.default},this.Data.set(n,s)),this.SetStockData(r,s)}this.Callback&&this.Callback(this,e)},this.SetStockData=function(t,e){for(var a in t.stockday){var i=t.stockday[a],r=i.date,n=new l.default;this.SetFinanceData(i,n),this.SetBlocktradingData(i,n),this.SetChangesData(i,n),this.SetLiftingData(i,n),this.SetPforecastData(i,n),this.SetShortIndicatorsData(i,n),e.Data.set(r,n)}return e},this.SetFinanceData=function(t,e){var a=t.finance1;a&&(isNaN(a.nprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_NPROFITINCREASE,a.nprofitincrease),isNaN(a.nnprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_NNPROFITINCREASE,a.nnprofitincrease),isNaN(a.nnprofitspeed)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_NNPROFITSPEED,a.nnprofitspeed),isNaN(a.benford)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_BENFORD,a.benford));var i=t.announcement1;i&&(isNaN(i.year)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_YEAR,i.year),isNaN(i.quarter)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_QUARTER,i.quarter));a=t.finance2;a&&(isNaN(a.nprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_NPROFITINCREASE,a.nprofitincrease),isNaN(a.nnprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_NNPROFITINCREASE,a.nnprofitincrease),isNaN(a.nnprofitspeed)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_NNPROFITSPEED,a.nnprofitspeed),isNaN(a.benford)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_BENFORD,a.benford));i=t.announcement2;i&&(isNaN(i.year)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_YEAR,i.year),isNaN(i.quarter)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_QUARTER,i.quarter));a=t.finance3;a&&(isNaN(a.nprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_NPROFITINCREASE,a.nprofitincrease),isNaN(a.nnprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_NNPROFITINCREASE,a.nnprofitincrease),isNaN(a.nnprofitspeed)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_NNPROFITSPEED,a.nnprofitspeed),isNaN(a.benford)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_BENFORD,a.benford));i=t.announcement3;i&&(isNaN(i.year)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_YEAR,i.year),isNaN(i.quarter)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_QUARTER,i.quarter));a=t.finance4;a&&(isNaN(a.nprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_NPROFITINCREASE,a.nprofitincrease),isNaN(a.nnprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_NNPROFITINCREASE,a.nnprofitincrease),isNaN(a.nnprofitspeed)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_NNPROFITSPEED,a.nnprofitspeed),isNaN(a.benford)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_BENFORD,a.benford));i=t.announcement4;i&&(isNaN(i.year)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_YEAR,i.year),isNaN(i.quarter)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_QUARTER,i.quarter))},this.SetBlocktradingData=function(t,e){var a=t.blocktrading;a&&e.set(STOCK_HISTORY_FIELD_NAME.BLOCK_TRADING,{Premium:a.premium,Price:a.price,Vol:a.vol,Amount:a.amount})},this.SetChangesData=function(t,e){var a=t.changes;a&&e.set(STOCK_HISTORY_FIELD_NAME.HOLDERS_CHANGES,{List:a.list})},this.SetLiftingData=function(t,e){var a=t.lifting;a&&e.set(STOCK_HISTORY_FIELD_NAME.LIFTING,{Lifting:a})},this.SetPforecastData=function(t,e){var a=t.pforecast;a&&e.set(STOCK_HISTORY_FIELD_NAME.PFORECAST,{Lowprofit:a[0].lowprofit,Highprofit:a[0].highprofit,Lowchange:a[0].lowchange,Highchange:a[0].highchange,Reportdate:a[0].reportdate})},this.SetShortIndicatorsData=function(t,e){var a=t.policy;if(a){var i=["三只乌鸦","乌云盖顶","黄昏之星","巨量阴线","头肩顶","射击之星","倾盆大雨","断头铡刀","淡友反攻","空方炮","连续1周空头排列"],r=0,n=[],s=0,o="";a.forEach((function(t){var e=i.some((function(e){return e===t.name}));e&&(r++,n.push(t.time))})),r?(s=Math.max.apply(n,n),o=a.find((function(t){return t.time===s})).name):o="",console.log(o,r,"latestName-targetedCount"),e.set(STOCK_HISTORY_FIELD_NAME.SHORTIND_ICATORS,{latestIndicatorName:o,indicatorCount:r})}},this.RecvError=function(t,e){},this.CreateCondition=function(t){return new QueryCondition(t)}}b.Init=function(){var t=new b;return t},b.SetDomain=function(t,e){t&&(m.Domain=t),e&&(m.CacheDomain=e)},b.GetSearchStock=function(t){return new B(t)},b.GetShortTerm=function(t){return new H(t)},b.GetDealDay=function(t){return new V(t)},b.GetBlockMember=function(t){return new G(t)},b.GetBlockTop=function(){return new k},b.GetMinuteImage=function(t){return new Y(t)},b.GetHistoryDayData=function(t){return new U(t)},b.GetDealPriceListData=function(t){return new W(t)},b.GetLatestDetailData=function(t){return new X(t)},b.GetAnalylisPlate=function(){return new K},b.GetStockHistory=function(){return new P};var w={BASE_DATA:1,INDEX_BASE_DATA:2,HEAT_DATA:3,SORT_DATA:4,BUY_SELL_DATA:5,DEAL_DATA:6,DERIVATIVE_DATA:7,FINANCE_DATA:8,SEARCH_STOCK_DATA:9,SELF_STOCK_DATA:10,LOGON_DATA:11,BLOCK_MEMBER_DATA:13,SHORT_TERM_DATA:14,COMPANY_DATA:15,PLATE_DATA:16,CAPITAL_DATA:17,CAPITAL_FLOW_DAY_DATA:23,CAPITAL_FLOW_DAY3_DATA:24,CAPITAL_FLOW_DAY5_DATA:25,CAPITAL_FLOW_DAY10_DATA:26,DDE_DAY_DATA:27,DDE_DAY3_DATA:28,DDE_DAY5_DATA:29,DDE_DAY10_DATA:30,DEAL_DAY_DATA:105,EVENT_DATA:106,IMAGE_MINUTE_DATA:107,HISTORY_DAY_DATA:108,DEAL_PRICE_LIST_DATA:109,LATEST_DETAIL_DATA:110};function b(){this.MapStock=new l.default,this.MapTagCallback=new l.default,this.RequestVersion=new Array([100,100,100]),this.RealtimeApiUrl=m.Domain+"/API/Stock",this.PlateQuadrantApiUrl=m.Domain+"/API/StockPlateQuadrant",this.IsAutoUpdate=!0,this.AutoUpateTimeout=15e3,this.Timeout,this.NetworkFilter,this.GetStockRead=function(t,e){var a=!0,i=!1,r=void 0;try{for(var n,s=(0,o.default)(this.MapStock);!(a=(n=s.next()).done);a=!0){var h=n.value;h[1].RemoveTagID(t)}}catch(u){i=!0,r=u}finally{try{!a&&s.return&&s.return()}finally{if(i)throw r}}this.MapTagCallback.set(t,e);var l=new R(this,t);return l},this.Unsubscribe=function(t){var e=!0,a=!1,i=void 0;try{for(var r,n=(0,o.default)(this.MapStock);!(e=(r=n.next()).done);e=!0){var s=r.value;s[1].RemoveTagID(t)}}catch(h){a=!0,i=h}finally{try{!e&&n.return&&n.return()}finally{if(a)throw i}}},this.UnsubscribeStock=function(t,e){var a=!0,i=!1,r=void 0;try{for(var n,s=(0,o.default)(this.MapStock);!(a=(n=s.next()).done);a=!0){var h=n.value;if(h[0]===t){e?h[1].RemoveTagID(e):h[1].ClearTagID(),console.log("[JSStock::UnsubscribeStock] symbol="+t+", tagID="+e);break}}}catch(l){i=!0,r=l}finally{try{!a&&s.return&&s.return()}finally{if(i)throw r}}},this.Get=function(t,e){this.MapStock.has(t)||this.MapStock.set(t,new N(t));var a=this.MapStock.get(t);return e&&a.AttachTagID(e),a},this.RequestData=function(){this.ClearTimer();var t=new Array,e=new Array,a=new Array,i=new Array,r=new Array,n=new Array,s=new Array,h=[],l=[],u=[],C=[],D=[],c=[],f=[],d=[],m=new Array,v=new Array,S=new Array,I=new Array,p=!0,T=!1,A=void 0;try{for(var g,F=(0,o.default)(this.MapStock);!(p=(g=F.next()).done);p=!0){var E=g.value,L=E[1],M=E[0];L.BaseDataTagID.size>0&&(x(M)?e.push(M):t.push(M)),L.BuySellTagID.size>0&&i.push(M),L.CapitalFlowDayID.size>0&&h.push(M),L.CapitalFlowDay3ID.size>0&&l.push(M),L.CapitalFlowDay5ID.size>0&&u.push(M),L.CapitalFlowDay10ID.size>0&&C.push(M),L.DDEID.size>0&&D.push(M),L.DDE3ID.size>0&&c.push(M),L.DDE5ID.size>0&&f.push(M),L.DDE10ID.size>0&&d.push(M),L.HeatTagID.size>0&&a.push(M),L.DealTagID.size>0&&r.push(M),L.DerivativeTagID.size>0&&n.push(M),L.FinanceTagID.size>0&&s.push(M),L.CapitalTagID.size>0&&I.push(M),null==L.Event&&L.EventTagID.size>0&&m.push(M),null==L.Company&&L.CompanyTagID.size>0&&v.push(M),null==E[1].Plate&&E[1].PlateTagID.size>0&&S.push(E[0])}}catch(N){T=!0,A=N}finally{try{!p&&F.return&&F.return()}finally{if(T)throw A}}i.length>0&&this.RequestBuySellData(i),t.length>0&&this.RequestBaseData(t),e.length>0&&this.RequestIndexBaseData(e),a.length>0&&this.RequestIndexHeatData(a),r.length>0&&this.RequestDealData(r),n.length>0&&this.RequestDerivativeData(n),s.length>0&&this.RequestFinanceData(s),I.length>0&&this.RequestCapitalData(I),h.length>0&&this.RequestSubDocumentData(h,"flowday"),l.length>0&&this.RequestSubDocumentData(l,"flowday3"),u.length>0&&this.RequestSubDocumentData(u,"flowday5"),C.length>0&&this.RequestSubDocumentData(C,"flowday10"),D.length>0&&this.RequestSubDocumentData(D,"dde"),c.length>0&&this.RequestSubDocumentData(c,"dde3"),f.length>0&&this.RequestSubDocumentData(f,"dde5"),d.length>0&&this.RequestSubDocumentData(d,"dde10"),m.length>0&&this.RequestEventData(m),v.length>0&&this.RequestCompanyData(v),S.length>0&&this.RequestPlateData(S),this.ReqeustAllSortData()},this.ReqeustData=this.RequestData,this.RequestBaseData=function(t){var e=this,a=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","increase","exchangerate","amplitude","volratio"];if(this.NetworkFilter){var i={Name:"JSStock::RequestBaseData",Explain:"股票基础数据",ID:w.BASE_DATA,Request:{Url:e.RealtimeApiUrl,Data:{field:a,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,(function(t){e.RecvData(t,w.BASE_DATA)})),1==i.PreventDefault)return}c.default.ajax({url:this.RealtimeApiUrl,data:{field:a,symbol:t},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,w.BASE_DATA)},error:function(t){e.RecvError(t,w.BASE_DATA)}})},this.RequestDerivativeData=function(t){var e=this,a=["name","symbol","marketvalue","flowmarketvalue","pe","pe2","pe3","pb","bookrate","bookdiffer"];if(this.NetworkFilter){var i={Name:"JSStock::RequestDerivativeData",Explain:"实时衍生数据",ID:w.DERIVATIVE_DATA,Request:{Url:e.RealtimeApiUrl,Data:{field:a,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,(function(t){e.RecvData(t,w.DERIVATIVE_DATA)})),1==i.PreventDefault)return}c.default.ajax({url:this.RealtimeApiUrl,data:{field:a,symbol:t},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,w.DERIVATIVE_DATA)},error:function(t){e.RecvError(t,w.DERIVATIVE_DATA)}})},this.RequestFinanceData=function(t){var e=this,a=["name","symbol","roe","finance"];if(this.NetworkFilter){var i={Name:"JSStock::RequestFinanceData",Explain:"财务数据",ID:w.FINANCE_DATA,Request:{Url:e.RealtimeApiUrl,Data:{field:a,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,(function(t){e.RecvData(t,w.FINANCE_DATA)})),1==i.PreventDefault)return}c.default.ajax({url:this.RealtimeApiUrl,data:{field:a,symbol:t},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,w.FINANCE_DATA)},error:function(t){e.RecvError(t,w.FINANCE_DATA)}})},this.RequestCapitalData=function(t){var e=this,a=["name","symbol","capital"];if(this.NetworkFilter){var i={Name:"JSStock::RequestCapitalData",Explain:"股本数据",ID:w.CAPITAL_DATA,Request:{Url:e.RealtimeApiUrl,Data:{field:a,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,(function(t){e.RecvData(t,w.CAPITAL_DATA)})),1==i.PreventDefault)return}c.default.ajax({url:this.RealtimeApiUrl,data:{field:a,symbol:t},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,w.CAPITAL_DATA)},error:function(t){e.RecvError(t,w.CAPITAL_DATA)}})},this.RequestBuySellData=function(t){var e=this,a=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","increase","buy","sell","exchangerate","amplitude"];if(this.NetworkFilter){var i={Name:"JSStock::RequestBuySellData",Explain:"买卖盘数据",ID:w.BUY_SELL_DATA,Request:{Url:e.RealtimeApiUrl,Data:{field:a,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,(function(t){e.RecvData(t,w.BUY_SELL_DATA)})),1==i.PreventDefault)return}c.default.ajax({url:this.RealtimeApiUrl,data:{field:a,symbol:t},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,w.BUY_SELL_DATA)},error:function(t){e.RecvError(t,w.BUY_SELL_DATA)}})},this.RequestDealData=function(t){var e=this,a=["name","symbol","price","high","low","vol","amount","date","time","increase","deal"];if(this.NetworkFilter){var i={Name:"JSStock::RequestDealData",Explain:"分笔数据",ID:w.DEAL_DATA,Request:{Url:e.RealtimeApiUrl,Data:{field:a,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,(function(t){e.RecvData(t,w.DEAL_DATA)})),1==i.PreventDefault)return}c.default.ajax({url:this.RealtimeApiUrl,data:{field:a,symbol:t},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,w.DEAL_DATA)},error:function(t){e.RecvError(t,w.DEAL_DATA)}})},this.RequestIndexBaseData=function(t){var e=this,a=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","indextop","increase"];if(this.NetworkFilter){var i={Name:"JSStock::RequestIndexBaseData",Explain:"指数基础数据(包含上涨下跌家数)",ID:w.INDEX_BASE_DATA,Request:{Url:e.RealtimeApiUrl,Data:{field:a,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,(function(t){e.RecvData(t,w.INDEX_BASE_DATA)})),1==i.PreventDefault)return}c.default.ajax({url:this.RealtimeApiUrl,data:{field:a,symbol:t},type:"post",dataType:"json",async:!0,success:function(t){console.log(t),e.RecvData(t,w.INDEX_BASE_DATA)},error:function(t){e.RecvError(t,w.INDEX_BASE_DATA)}})},this.RequestIndexHeatData=function(t){var e=this;c.default.ajax({url:this.PlateQuadrantApiUrl,data:{plate:t},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,w.HEAT_DATA)},error:function(t){e.RecvError(t,w.HEAT_DATA)}})},this.ReqeustAllSortData=function(){var t=new Array,e=!0,a=!1,i=void 0;try{for(var r,n=(0,o.default)(this.MapStock);!(e=(r=n.next()).done);e=!0){var s=r.value;if(x(s[0])&&!(null==s[1].Sort||s[1].Sort.size<=0)){var h=!0,l=!1,u=void 0;try{for(var C,D=(0,o.default)(s[1].Sort);!(h=(C=D.next()).done);h=!0){var c=C.value,f=c[1],d={Plate:s[0],SortField:f.SortField,Order:f.Order,TagID:f.TagID};t.push(d)}}catch(v){l=!0,u=v}finally{try{!h&&D.return&&D.return()}finally{if(l)throw u}}}}}catch(v){a=!0,i=v}finally{try{!e&&n.return&&n.return()}finally{if(a)throw i}}for(var m in t){c=t[m];this.ReqeustSortData(c)}},this.ReqeustSortData=function(t){var e=this,a=t,i="";switch(a.SortField){case O.INCREASE:i="increase";break;case O.PRICE:i="price";break;default:return}var r=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","increase","exchangerate"];if(this.NetworkFilter){var n={Name:"JSStock::ReqeustSortData",Explain:"板块排序数据",ID:w.SORT_DATA,Request:{Url:e.RealtimeApiUrl,Data:{field:r,plate:[t.Plate],orderfield:i,order:t.Order,ordernull:1,filterstop:1},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(n,(function(t){e.RecvData(t,w.SORT_DATA,a)})),1==n.PreventDefault)return}c.default.ajax({url:this.RealtimeApiUrl,data:{field:r,plate:[t.Plate],orderfield:i,order:t.Order,ordernull:1,filterstop:1},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,w.SORT_DATA,a)},error:function(t){e.RecvError(t,w.SORT_DATA,a)}})},this.RequestSubDocumentData=function(t,e){var a=this,i=new l.default([["flowday",{Field:"flowday",RecvID:w.CAPITAL_FLOW_DAY_DATA}],["flowday3",{Field:"flowday3",RecvID:w.CAPITAL_FLOW_DAY3_DATA}],["flowday5",{Field:"flowday5",RecvID:w.CAPITAL_FLOW_DAY5_DATA}],["flowday10",{Field:"flowday10",RecvID:w.CAPITAL_FLOW_DAY10_DATA}],["dde",{Field:"dde",RecvID:w.DDE_DAY_DATA}],["dde3",{Field:"dde3",RecvID:w.DDE_DAY3_DATA}],["dde5",{Field:"dde5",RecvID:w.DDE_DAY5_DATA}],["dde10",{Field:"dde10",RecvID:w.DDE_DAY10_DATA}]]);if(i.has(e)){var r=i.get(e);if(this.NetworkFilter){var n={Name:"JSStock::RequestSubDocumentData",Explain:"子文档数据",ID:r.RecvID,Request:{Url:a.RealtimeApiUrl,Data:{field:["symbol",r.Field],symbol:t,start:0,end:50},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(n,(function(t){a.RecvData(t,r.RecvID)})),1==n.PreventDefault)return}c.default.ajax({url:this.RealtimeApiUrl,data:{field:["symbol",r.Field],symbol:t,start:0,end:50},type:"post",dataType:"json",success:function(t){a.RecvData(t,r.RecvID)},error:function(t){a.RecvError(t,r.RecvID)}})}},this.RequestEventData=function(t){var e=this;c.default.ajax({url:this.RealtimeApiUrl,data:{field:["symbol","events.margin","events.shhk","events.hk","events.st","events.hksymbol","events.hkname","events.szhk"],symbol:t,start:0,end:50},type:"POST",dataType:"json",success:function(t){e.RecvData(t,w.EVENT_DATA)},error:function(t){e.RecvError(t,w.EVENT_DATA)}})},this.RequestCompanyData=function(t){var e=this;c.default.ajax({url:this.RealtimeApiUrl,data:{field:["name","symbol","company"],symbol:t,start:0,end:50},type:"POST",dataType:"json",success:function(t){e.RecvData(t,w.COMPANY_DATA)},error:function(t){e.RecvError(t,w.COMPANY_DATA)}})},this.RequestPlateData=function(t){var e=this;c.default.ajax({url:this.RealtimeApiUrl,data:{field:["name","symbol","industry","region","concept"],symbol:t,start:0,end:50},type:"POST",dataType:"json",success:function(t){e.RecvData(t,w.PLATE_DATA)},error:function(t){e.RecvError(t,w.PLATE_DATA)}})},this.RecvError=function(t,e,a){console.log("RecvError: datatype="+e.toString()),console.log(t);var i=this;this.Timeout&&clearTimeout(this.Timeout),this.Timeout=setTimeout((function(){i.ReqeustData()}),2*this.AutoUpateTimeout)},this.RecvData=function(t,e,a){var i;switch(e){case w.BASE_DATA:case w.INDEX_BASE_DATA:i=this.RecvBaseData(t,e);break;case w.HEAT_DATA:i=this.RecvHeatData(t,e);break;case w.SORT_DATA:i=this.RecvSortData(t,e,a);break;case w.BUY_SELL_DATA:i=this.RecvBuySellData(t,e);break;case w.DEAL_DATA:i=this.RecvDealData(t,e);break;case w.DERIVATIVE_DATA:i=this.RecvDerivativeData(t,e);break;case w.FINANCE_DATA:i=this.RecvFinanceData(t,e);break;case w.CAPITAL_DATA:i=this.RecvCapitalData(t,e);break;case w.CAPITAL_FLOW_DAY_DATA:case w.CAPITAL_FLOW_DAY3_DATA:case w.CAPITAL_FLOW_DAY5_DATA:case w.CAPITAL_FLOW_DAY10_DATA:case w.DDE_DAY_DATA:case w.DDE_DAY3_DATA:case w.DDE_DAY5_DATA:case w.DDE_DAY10_DATA:i=this.RecvSubDocumentData(t,e);break;case w.EVENT_DATA:i=this.RecvEventData(t,e);break;case w.COMPANY_DATA:i=this.RecvCompanyData(t,e);break;case w.PLATE_DATA:i=this.RecvPlateData(t,e);break}var r=!0,n=!1,s=void 0;try{for(var h,l=(0,o.default)(i);!(r=(h=l.next()).done);r=!0){var u=h.value;this.MapTagCallback.has(u[0])&&this.MapTagCallback.get(u[0])(u[0],u[1],e,this)}}catch(C){n=!0,s=C}finally{try{!r&&l.return&&l.return()}finally{if(n)throw s}}this.AutoUpdate()},this.ClearTimer=function(){this.Timeout&&(clearTimeout(this.Timeout),this.Timeout=null)},this.AutoUpdate=function(){if(this.ClearTimer(),this.IsAutoUpdate){var t=this,e=!1,a=!0,i=!1,r=void 0;try{for(var n,s=(0,o.default)(this.MapStock);!(a=(n=s.next()).done);a=!0){var h=n.value,l=J.GetMarketStatus(h[0]);if(2==l)return void(this.Timeout=setTimeout((function(){t.ReqeustData()}),this.AutoUpateTimeout));1==l&&(e=!0)}}catch(u){i=!0,r=u}finally{try{!a&&s.return&&s.return()}finally{if(i)throw r}}e&&(this.Timeout=setTimeout((function(){t.AutoUpdate()}),this.AutoUpateTimeout))}},this.RecvBaseData=function(t,e){var a=new l.default;for(var i in t.stock){var r=t.stock[i],n=this.MapStock.get(r.symbol);if(n){switch(e){case w.BASE_DATA:n.SetBaseData(r);break;case w.INDEX_BASE_DATA:n.SetIndexBaseData(r);break;default:continue}if(n.TagID.size>0){var s=!0,h=!1,u=void 0;try{for(var C,D=(0,o.default)(n.TagID);!(s=(C=D.next()).done);s=!0){var c=C.value;a.has(c)?a.get(c).push(n.Symbol):a.set(c,new Array(n.Symbol))}}catch(f){h=!0,u=f}finally{try{!s&&D.return&&D.return()}finally{if(h)throw u}}}}}return a},this.RecvBuySellData=function(t,e){var a=new l.default;for(var i in t.stock){var r=t.stock[i],n=this.MapStock.get(r.symbol);if(n){if(n.SetBuySellData(r),n.TagID.size>0){var s=!0,h=!1,u=void 0;try{for(var C,D=(0,o.default)(n.TagID);!(s=(C=D.next()).done);s=!0){var c=C.value;a.has(c)?a.get(c).push(n.Symbol):a.set(c,new Array(n.Symbol))}}catch(I){h=!0,u=I}finally{try{!s&&D.return&&D.return()}finally{if(h)throw u}}}if(n.BuySellTagID.size>0){var f=!0,d=!1,m=void 0;try{for(var v,S=(0,o.default)(n.BuySellTagID);!(f=(v=S.next()).done);f=!0){c=v.value;a.has(c)?a.get(c).push(n.Symbol):a.set(c,new Array(n.Symbol))}}catch(I){d=!0,m=I}finally{try{!f&&S.return&&S.return()}finally{if(d)throw m}}}}}return a},this.RecvDerivativeData=function(t,e){var a=new l.default;for(var i in t.stock){var r=t.stock[i],n=this.MapStock.get(r.symbol);if(n&&(n.SetDerivativeData(r),n.DerivativeTagID.size>0)){var s=!0,h=!1,u=void 0;try{for(var C,D=(0,o.default)(n.DerivativeTagID);!(s=(C=D.next()).done);s=!0){var c=C.value;a.has(c)?a.get(c).push(n.Symbol):a.set(c,new Array(n.Symbol))}}catch(f){h=!0,u=f}finally{try{!s&&D.return&&D.return()}finally{if(h)throw u}}}}return a},this.RecvFinanceData=function(t,e){var a=new l.default;for(var i in t.stock){var r=t.stock[i],n=this.MapStock.get(r.symbol);if(n&&(n.SetFinanceData(r),n.FinanceTagID.size>0)){var s=!0,h=!1,u=void 0;try{for(var C,D=(0,o.default)(n.FinanceTagID);!(s=(C=D.next()).done);s=!0){var c=C.value;a.has(c)?a.get(c).push(n.Symbol):a.set(c,new Array(n.Symbol))}}catch(f){h=!0,u=f}finally{try{!s&&D.return&&D.return()}finally{if(h)throw u}}}}return a},this.RecvCapitalData=function(t,e){var a=new l.default;for(var i in t.stock){var r=t.stock[i],n=this.MapStock.get(r.symbol);if(n&&(n.SetCapitalData(r),n.CapitalTagID.size>0)){var s=!0,h=!1,u=void 0;try{for(var C,D=(0,o.default)(n.CapitalTagID);!(s=(C=D.next()).done);s=!0){var c=C.value;a.has(c)?a.get(c).push(n.Symbol):a.set(c,new Array(n.Symbol))}}catch(f){h=!0,u=f}finally{try{!s&&D.return&&D.return()}finally{if(h)throw u}}}}return a},this.RecvDealData=function(t,e){var a=new l.default;for(var i in t.stock){var r=t.stock[i],n=this.MapStock.get(r.symbol);if(n&&(n.SetDealData(r),n.DealTagID.size>0)){var s=!0,h=!1,u=void 0;try{for(var C,D=(0,o.default)(n.DealTagID);!(s=(C=D.next()).done);s=!0){var c=C.value;a.has(c)?a.get(c).push(n.Symbol):a.set(c,new Array(n.Symbol))}}catch(f){h=!0,u=f}finally{try{!s&&D.return&&D.return()}finally{if(h)throw u}}}}return a},this.RecvHeatData=function(t,e){var a=new l.default;for(var i in t.data){var r=t.data[i],n=this.MapStock.get(r.symbol);if(n&&(n.SetHeatData(r),n.HeatTagID.size>0)){var s=!0,h=!1,u=void 0;try{for(var C,D=(0,o.default)(n.HeatTagID);!(s=(C=D.next()).done);s=!0){var c=C.value;a.has(c)?a.get(c).push(n.Symbol):a.set(c,new Array(n.Symbol))}}catch(f){h=!0,u=f}finally{try{!s&&D.return&&D.return()}finally{if(h)throw u}}}}return a},this.RecvSortData=function(t,e,a){var i=new l.default,r=new Array,n=this.MapStock.get(a.Plate);for(var s in t.stock){var h=t.stock[s];if(r.push(h.symbol),this.MapStock.has(h.symbol)){var u=this.MapStock.get(h.symbol);u.SetBaseData(h)}else{u=new N(h.symbol);u.SetBaseData(h),this.MapStock.set(h.symbol,u)}}var C=a.SortField.toString()+"-"+a.Order.toString();if(!n.Sort.has(C))return i;var D=n.Sort.get(C);D.arySymbol=r;var c=!0,f=!1,d=void 0;try{for(var m,v=(0,o.default)(a.TagID);!(c=(m=v.next()).done);c=!0){h=m.value;i.set(h,new Array([n.Symbol]))}}catch(S){f=!0,d=S}finally{try{!c&&v.return&&v.return()}finally{if(f)throw d}}return i},this.RecvSubDocumentData=function(t,e){var a=new l.default;for(var i in t.stock){var r=t.stock[i],n=this.MapStock.get(r.symbol);if(n){var s=null;switch(e){case w.CAPITAL_FLOW_DAY_DATA:n.SetCapitalFlowDayData(r.flowday,e),s=n.CapitalFlowDayID;break;case w.CAPITAL_FLOW_DAY3_DATA:n.SetCapitalFlowDayData(r.flowday3,e),s=n.CapitalFlowDay3ID;break;case w.CAPITAL_FLOW_DAY5_DATA:n.SetCapitalFlowDayData(r.flowday5,e),s=n.CapitalFlowDay5ID;break;case w.CAPITAL_FLOW_DAY10_DATA:n.SetCapitalFlowDayData(r.flowday10,e),s=n.CapitalFlowDay10ID;break;case w.DDE_DAY_DATA:n.SetDDE(r.dde,e),s=n.DDEID;break;case w.DDE_DAY3_DATA:n.SetDDE(r.dde3,e),s=n.DDE3ID;break;case w.DDE_DAY5_DATA:n.SetDDE(r.dde5,e),s=n.DDE5ID;break;case w.DDE_DAY10_DATA:n.SetDDE(r.dde10,e),s=n.DDE10ID;break}if(s&&s.size>0){var h=!0,u=!1,C=void 0;try{for(var D,c=(0,o.default)(s);!(h=(D=c.next()).done);h=!0){var f=D.value;a.has(f)?a.get(f).push(n.Symbol):a.set(f,new Array(n.Symbol))}}catch(d){u=!0,C=d}finally{try{!h&&c.return&&c.return()}finally{if(u)throw C}}}}}return a},this.RecvEventData=function(t,e){var a=new l.default;for(var i in t.stock){var r=t.stock[i],n=this.MapStock.get(r.symbol);if(n&&(n.SetEventData(r),n.EventTagID.size>0)){var s=!0,h=!1,u=void 0;try{for(var C,D=(0,o.default)(n.EventTagID);!(s=(C=D.next()).done);s=!0){var c=C.value;a.has(c)?a.get(c).push(n.Symbol):a.set(c,new Array(n.Symbol))}}catch(f){h=!0,u=f}finally{try{!s&&D.return&&D.return()}finally{if(h)throw u}}}}return a},this.RecvCompanyData=function(t,e){var a=new l.default;for(var i in t.stock){var r=t.stock[i],n=this.MapStock.get(r.symbol);if(n&&(n.SetCompanyData(r),n.CompanyTagID.size>0)){var s=!0,h=!1,u=void 0;try{for(var C,D=(0,o.default)(n.CompanyTagID);!(s=(C=D.next()).done);s=!0){var c=C.value;a.has(c)?a.get(c).push(n.Symbol):a.set(c,new Array(n.Symbol))}}catch(f){h=!0,u=f}finally{try{!s&&D.return&&D.return()}finally{if(h)throw u}}}}return a},this.RecvPlateData=function(t,e){var a=new l.default;for(var i in t.stock){var r=t.stock[i],n=this.MapStock.get(r.symbol);if(n&&(n.SetPlateData(r),n.PlateTagID.size>0)){var s=!0,h=!1,u=void 0;try{for(var C,D=(0,o.default)(n.PlateTagID);!(s=(C=D.next()).done);s=!0){var c=C.value;a.has(c)?a.get(c).push(n.Symbol):a.set(c,new Array(n.Symbol))}}catch(f){h=!0,u=f}finally{try{!s&&D.return&&D.return()}finally{if(h)throw u}}}}return a}}function B(t){this.SearchStockApiUrl=m.Domain+"/API/StockSpell",this.UpdateUICallback=t,this.PageSize=50,this.Count,this.EndOffset,this.Data=new Array,this.SearchString="",this.SearchType=0,this.Search=function(t,e){if(this.SearchString==t&&this.SearchType==e)"function"==typeof this.UpdateUICallback&&this.UpdateUICallback(this);else{this.SearchString=t,this.SearchType=e,this.Count=0,this.EndOffset=0,this.Data=[];var a=this.PageSize-1;this.ReqeustSearchStock(this.SearchString,this.SearchType,this.EndOffset,a)}},this.IsEndPage=function(){return this.Count<=0||this.EndOffset>this.Count-1},this.NextPage=function(){if(!(this.EndOffset+1>this.Count)){var t=this.EndOffset+this.PageSize;this.ReqeustSearchStock(this.SearchString,this.SearchType,this.EndOffset,t)}},this.ReqeustSearchStock=function(t,e,a,i){var r=this;c.default.ajax({url:this.SearchStockApiUrl,data:{input:t,start:a,end:i,type:e},type:"post",dataType:"json",async:!0,success:function(t){r.RecvSearchStockData(t,w.SEARCH_STOCK_DATA)},error:function(t){r.RecvError(t,w.SEARCH_STOCK_DATA)}})},this.RecvSearchStockData=function(t){for(var e in t.stock){var a=t.stock[e];this.Data.push({Name:a.name,Symbol:a.symbol,Type:a.type})}0==t.count?(this.Count=0,this.EndOffset=0):(0==this.Count&&(this.Count=t.count),this.EndOffset=t.end,this.Count>0&&this.EndOffset>this.Count&&(this.EndOffset=this.Count-1)),"function"==typeof this.UpdateUICallback&&this.UpdateUICallback(this)},this.RecvError=function(t,e){console.log("[SearchStock::RecvError] datatype="+e.toString()),console.log(t),"function"==typeof this.UpdateUICallback&&this.UpdateUICallback(this,"error")}}function _(){this.IsAutoUpdate=!0,this.AutoUpateTimeout=5e3,this.Timeout,this.ApiUrl,this.Data,this.Error,this.UpdateUICallback,this.RequestData=function(){},this.Stop=function(){this.IsAutoUpdate=!1,this.Timeout&&clearTimeout(this.Timeout)},this.AutoUpate=function(){if(this.Timeout&&clearTimeout(this.Timeout),this.IsAutoUpdate&&(this.Timeout&&clearTimeout(this.Timeout),this.IsAutoUpdate)){var t=this;if(this.Symbol){var e=J.GetMarketStatus(this.Symbol);2==e?this.Timeout=setTimeout((function(){t.RequestData()}),this.AutoUpateTimeout):1==e&&(this.Timeout=setTimeout((function(){t.AutoUpdate()}),this.AutoUpateTimeout))}else{t=this;var a=new Date,i=100*a.getHours()+a.getMinutes();a.getDay()>0&&a.getDay()<6&&i>=930&&i<1530&&(this.Timeout=setTimeout((function(){t.RequestData()}),this.AutoUpateTimeout))}}},this.InvokeUpdateUICallback=function(){this.UpdateUICallback&&this.UpdateUICallback(this)}}function H(t){this.newMethod=_,this.newMethod(),delete this.newMethod,this.Symbol=t,this.ApiUrl=m.Domain+"/API/StockShortTerm",this.Count=20,this.RequestData=function(){var t=this,e={count:this.Count};this.Symbol&&(e.symbol=this.Symbol),c.default.ajax({url:this.ApiUrl,data:e,type:"post",dataType:"json",async:!0,success:function(e){t.RecvData(e,w.SHORT_TERM_DATA)},fail:function(e){t.RecvError(e,w.SHORT_TERM_DATA)}})},this.RecvData=function(t,e){for(var a in this.Data=[],t.shortterm){var i=t.shortterm[a];this.Data.push({Date:i.date,Name:i.name,Symbol:i.symbol,Time:i.time,Content:i.content,TypeInfo:i.typeinfo,Type:i.type})}this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()},this.RecvError=function(t,e){}}function V(t){this.newMethod=_,this.newMethod(),delete this.newMethod,this.Symbol=t,this.Date,this.RequestData=function(){this.Data=null,this.Error=null;var t=this,e=m.CacheDomain+"/cache/dealday/day/"+this.Date+"/"+this.Symbol+".json";console.log("[DealDay::RequestData] cache url ",e),c.default.ajax({url:e,type:"get",dataType:"json",async:!0,success:function(e){t.RecvData(e,w.DEAL_DAY_DATA)},error:function(e){t.RecvError(e,w.DEAL_DAY_DATA)}})},this.RecvData=function(t,e){if(t.day&&t.deal){var a=t.deal.amount,i=t.deal.price,r=t.deal.time,n=t.deal.vol,s=t.deal.flag;if(s&&n&&r&&i&&a){for(var h={Date:t.date,Open:t.day.open,Close:t.day.price,YClose:t.day.yclose,Symbol:t.symbol,Name:t.name,Deal:[],PriceList:[]},u=new l.default,C=0,D=Math.min(r.length,n.length,s.length,i.length,a.length),c=0;c<D;++c){var f,d={Time:r[c],Vol:n[c],Flag:"",Price:i[c],Amount:a[c]};0===s[c]?d.Flag="B":1===s[c]&&(d.Flag="S"),d.Time>15e4&&(d.Time=15e4),h.Deal.push(d),u.has(d.Price)?(f=u.get(d.Price),f.Vol+=d.Vol):(f={Vol:d.Vol,Price:d.Price,BuyVol:0,SellVol:0,NoneVol:0},u.set(d.Price,f)),0===s[c]?f.BuyVol+=d.Vol:1===s[c]?f.SellVol+=d.Vol:f.NoneVol+=d.Vol,C+=d.Vol}var m=!0,v=!1,S=void 0;try{for(var I,p=(0,o.default)(u);!(m=(I=p.next()).done);m=!0){var T=I.value,A=T[1];C>0&&(A.Proportion=A.Vol/C),h.PriceList.push(A)}}catch(g){v=!0,S=g}finally{try{!m&&p.return&&p.return()}finally{if(v)throw S}}h.PriceList.sort((function(t,e){return e.Price-t.Price})),this.Data=h,this.InvokeUpdateUICallback()}else this.InvokeUpdateUICallback()}else this.InvokeUpdateUICallback()},this.RecvError=function(t,e){console.log("[DealDay::RecvError] status="+t.status+" statusText="+t.statusText+" responseText="+t.responseText),this.Error={Status:t.status,Message:t.responseText},this.InvokeUpdateUICallback()}}function G(t){this.newMethod=_,this.newMethod(),delete this.newMethod,this.ApiUrl=m.Domain+"/API/StockBlockMember",this.PageSize=10,this.Start=0,this.OrderField,this.Order,this.Symbol=t,this.OrderNull=0,this.Field=new Array,this.Data=new Array,this.PageInfo,this.SetField=function(t){for(var e in this.Field=new Array,t){var a=t[e],i=y.GetFieldName(a);null!=i&&this.Field.push(i)}return this.Field.length>0},this.SetOrder=function(t,e){this.Order=null,this.OrderField=null;var a=y.GetFieldName(t);return null!=a&&(this.OrderField=a,this.Order=e,!0)},this.RequestData=function(){this.Data=[];var t=this;c.default.ajax({url:this.ApiUrl,data:{symbol:this.Symbol,field:this.Field,order:this.Order,orderfield:this.OrderField,start:this.Start,end:this.Start+this.PageSize,ordernull:this.OrderNull},type:"post",dataType:"json",success:function(e){t.RecvData(e,w.BLOCK_MEMBER_DATA)},error:function(e){t.RecvError(e,w.BLOCK_MEMBER_DATA)}})},this.RecvData=function(t,e){for(var a in t.stock){var i=t.stock[a];if(null!=i.symbol){var r=new N(i.symbol);r.SetData(i),this.Data.push(r)}}this.PageInfo={Count:t.count,Start:t.start,End:t.end},"function"==typeof this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()},this.RecvError=function(t,e){}}function k(){this.newMethod=_,this.newMethod(),delete this.newMethod,this.BlockType=1,this.Count=20,this.OrderField="increase",this.Order=-1,this.Field=["symbol","price","name","vol","increase","indextop","risefall"],this.ApiUrl=m.Domain+"/API/StockBlockTop",this.SetField=function(t){},this.ReqeustData=function(){var t=this;c.default.ajax({url:this.ApiUrl,data:{blocktype:this.BlockType,start:0,end:this.Count,field:this.Field,orderfield:this.OrderField,order:this.Order},type:"post",dataType:"json",async:!0,success:function(e){t.RecvData(e,w.BLOCK_TOP_DATA)},fail:function(e){t.RecvError(e,w.BLOCK_TOP_DATA)}})},this.RecvData=function(t,e){var a=t;for(var i in this.Data=[],this.resCount=a.count,a.stock){var r=a.stock[i];if(null!=r.indextop)var n={Down:r.indextop.down,Stop:r.indextop.stop,Up:r.indextop.up,Unchanged:r.indextop.unchanged,DownStock:{Name:r.indextop.downstock.name,Symbol:r.indextop.downstock.symbol},UpStock:{Name:r.indextop.upstock.name,Symbol:r.indextop.upstock.symbol}};this.Data.push({Name:r.name,Symbol:r.symbol,Increase:r.increase,Risefall:r.risefall,IndexTop:n})}this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()},this.RecvError=function(t,e){}}function Y(t){this.newMethod=_,this.newMethod(),delete this.newMethod,this.ApiUrl=m.Domain+"/API/StockMinuteImage",this.Symbol=[t],this.Data=[],this.RequestData=function(){this.Data=[];var t=this;c.default.ajax({url:this.ApiUrl,data:{symbol:this.Symbol},type:"post",dataType:"json",success:function(e){t.RecvData(e,w.IMAGE_MINUTE_DATA)},error:function(e){t.RecvError(e,w.IMAGE_MINUTE_DATA)}})},this.RecvData=function(t,e){for(var a in t.symbol){var i={Symbol:t.symbol[a],Image:t.imagerelative[a]};this.Data.push(i)}"function"==typeof this.UpdateUICallback&&this.UpdateUICallback(this)},this.RecvError=function(t,e){}}function U(t){this.newMethod=_,this.newMethod(),delete this.newMethod,this.Symbol=t,this.RequestData=function(){this.Data=null,this.Error=null;var t=this,e=m.CacheDomain+"/cache/historyday/all/"+this.Symbol+".json";console.log("[HistoryDayData::RequestData] cache url ",e),c.default.ajax({url:e,type:"get",dataType:"json",async:!0,success:function(e){t.RecvData(e,w.HISTORY_DAY_DATA)},error:function(e){t.RecvError(e,w.HISTORY_DAY_DATA)}})},this.RecvData=function(t,e){if(t.symbol&&t.name){var a=t.amount,i=t.close,r=t.date,n=t.high,s=t.low,o=t.open,h=t.vol,l=t.yclose;if(a&&i&&r&&n&&s&&o&&h&&l){for(var u={UpdateDate:t.update,Symbol:t.symbol,Name:t.name,KLine:[]},C=0;C<r.length;++C){var D={Date:r[C],YClose:l[C],Open:o[C],High:n[C],Low:s[C],Close:i[C],Vol:h[C],Amount:a[C]};u.KLine.push(D)}this.Data=u,this.InvokeUpdateUICallback()}else this.InvokeUpdateUICallback()}else this.InvokeUpdateUICallback()},this.RecvError=function(t,e){console.log("[HistoryDayData::RecvError] status="+t.status+" statusText="+t.statusText+" responseText="+t.responseText),this.Error={Status:t.status,Message:t.responseText},this.InvokeUpdateUICallback()},this.GetWeekData=function(){if(!this.Data||!this.Data.KLine)return[];var t=this.GetDayPeriodData(1);return t},this.GetMonthData=function(){if(!this.Data||!this.Data.KLine)return[];var t=this.GetDayPeriodData(2);return t},this.GetDayPeriodData=function(t){var e=new Array,a=0,i=null;for(var r in this.Data.KLine){var n=!1,s=this.Data.KLine[r];switch(t){case 1:var o=this.GetFirday(s.Date);o!=a&&(n=!0,a=o);break;case 2:parseInt(s.Date/100)!=parseInt(a/100)&&(n=!0,a=s.Date);break;case 3:parseInt(s.Date/1e4)!=parseInt(a/1e4)&&(n=!0,a=s.Date);break}if(n){if(i={},i.Date=s.Date,e.push(i),null==s.Open||null==s.Close)continue;i.Open=s.Open,i.High=s.High,i.Low=s.Low,i.YClose=s.YClose,i.Close=s.Close,i.Vol=s.Vol,i.Amount=s.Amount}else{if(null==i)continue;if(null==s.Open||null==s.Close)continue;null==i.Open||null==i.Close?(i.Open=s.Open,i.High=s.High,i.Low=s.Low,i.YClose=s.YClose,i.Close=s.Close,i.Vol=s.Vol,i.Amount=s.Amount):(i.High<s.High&&(i.High=s.High),i.Low>s.Low&&(i.Low=s.Low),i.Close=s.Close,i.Vol+=s.Vol,i.Amount+=s.Amount,i.Date=s.Date)}}return e},this.GetFirday=function(t){var e=new Date(parseInt(t/1e4),t/100%100-1,t%100),a=e.getDay();if(5==a)return t;var i=e.getTime();if(a<5){var r=864e5*(5-a);i+=r}else{r=864e5*(a-5);i-=r}e.setTime(i);var n=1e4*e.getFullYear()+100*(e.getMonth()+1)+e.getDate();e.getDay();return n}}function W(t){this.newMethod=_,this.newMethod(),delete this.newMethod,this.Symbol=t,this.ApiUrl=m.Domain+"/API/StockPriceList",this.RequestData=function(){if(this.Symbol){var t=this,e={};Array.isArray(this.Symbol)?e.Symbol=this.Symbol:e.Symbol=[this.Symbol],c.default.ajax({url:this.ApiUrl,data:e,type:"post",dataType:"json",async:!0,success:function(e){t.RecvData(e,w.DEAL_PRICE_LIST_DATA)},fail:function(e){t.RecvError(e,w.DEAL_PRICE_LIST_DATA)}})}},this.RecvData=function(t,e){if(this.Data=null,!(t.statistics.length<=0)){this.Data={Day:{},PriceList:[]};var a=t.data[0];this.Data.Day={Date:a.date,YClose:a.yclose,Price:a.price,Vol:a.vol,Time:a.time},this.Data.Stock={Symbol:a.symbol,Name:a.name};var i=t.statistics[0];for(var r in i.list){var n=i.list[r],s={Price:n[0],Vol:n[1],BuyVol:n[2],SellVol:n[3],NoneVol:n[4]};a.vol>0&&(s.Proportion=s.Vol/a.vol),this.Data.PriceList.push(s)}this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()}},this.RecvError=function(t,e){}}function X(t){this.newMethod=_,this.newMethod(),delete this.newMethod,this.IsAutoUpdate=!1,this.Symbol=t,this.PageSize=20,this.Request=function(t,e){this.Error=null;var a=this,i=t*e,r=i+e,n=m.Domain+"/API/StockDetail";console.log("[LatestDetailData::RequestData] url="+n+", start="+i+" , end="+r),c.default.ajax({url:n,data:{symbol:this.Symbol,start:i,end:r},type:"post",dataType:"json",async:!0,success:function(t){a.RecvData(t,w.LATEST_DETAIL_DATA)},error:function(t){a.RecvError(t,w.LATEST_DETAIL_DATA)}})},this.RequestData=function(){this.Data={Deal:[],Count:0,Reqeust:{PageIndex:0},Response:{}},this.Request(0,this.PageSize)},this.RequestPage=function(t){this.Data||(this.Data={Deal:[],Count:0}),this.Data.Reqeust={PageIndex:t},this.Data.Response={};for(var e=t*this.PageSize,a=e+this.PageSize,i=!0,r=e;r<a;++r)if(!this.Data.Deal[r]){i=!1;break}i?(this.Data.Response={Start:e,End:a},this.InvokeUpdateUICallback()):this.Request(t,this.PageSize)},this.RecvData=function(t,e){if(this.Data.Count=t.count,t.detail){this.Data.Day={YClose:t.yclose,Open:t.open,Close:t.price,Date:t.date},this.Data.Stock={Symbol:t.symbol,Name:t.name};for(var a=t.start,i=0,r=a;i<t.detail.length;++i,++r){var n=t.detail[i],s={Time:n[0],Price:n[1],Vol:n[2],Amount:n[3],Flag:""};0===n[4]?s.Flag="B":1===n[4]&&(s.Flag="S"),this.Data.Deal[r]=s}this.Data.Response={Start:t.start,End:t.end},this.InvokeUpdateUICallback()}else this.InvokeUpdateUICallback()},this.RecvError=function(t,e){console.log("[LatestDetailData::RecvError] status="+t.status+" statusText="+t.statusText+" responseText="+t.responseText),this.Error={Status:t.status,Message:t.responseText},this.InvokeUpdateUICallback()}}function K(){this.newMethod=_,this.newMethod(),delete this.newMethod,this.ApiUrl=m.Domain+"/api/StockListAnalyze",this.PolicyGuid,this.Plate="",this.SymbolList=[],this.RequestData=function(){var t=this;c.default.ajax({url:t.ApiUrl,data:{PolicyGuid:t.PolicyGuid,Plate:t.Plate,Symbol:t.SymbolList},type:"post",dataType:"json",async:!0,success:function(e){t.RecvData(e)},error:function(e){t.RecvError(e)}})},this.RecvData=function(t){this.Data={};var e=t;if(0!=e.count){if(e.concept){var a=[];for(var i in e.concept.data){var r=e.concept.data[i],n={};n.Name=r[0],n.Symbol=r[1],n.Ratio=r[2],n.Count=r[3],n.Increase=r[4],n.Price=r[5],n.Week1=r[6],n.Week4=r[7],a.push(n)}this.Data.Concept=a}e.distributed&&(this.Data.Distributed=e.distributed),e.industry&&(this.Data.Industry=e.industry),e.quadrant&&(this.Data.Quadrant=e.quadrant),e.region&&(this.Data.Region=e.region),this.UpdateUICallback&&this.UpdateUICallback(this)}},this.RecvError=function(t){console.log(t)}}var J={SH:".SH",SZ:".SZ",HK:".HK",SHFE:".SHF",CFFEX:".CFE",DCE:".DCE",CZCE:".CZC",USA:".USA",IsUSA:function(t){return!!t&&t.indexOf(this.USA)>0},IsSH:function(t){var e=t.length-this.SH.length,a=t.indexOf(this.SH);return a==e},IsSZ:function(t){var e=t.length-this.SZ.length,a=t.indexOf(this.SZ);return a==e},IsHK:function(t){var e=t.length-this.HK.length,a=t.indexOf(this.HK);return a==e},IsSHFE:function(t){return t.indexOf(this.SHFE)>0},IsCFFEX:function(t){return t.indexOf(this.CFFEX)>0},IsDCE:function(t){return t.indexOf(this.DCE)>0},IsCZCE:function(t){return t.indexOf(this.CZCE)>0},IsChinaFutures:function(t){return this.IsCFFEX(t)||this.IsCZCE(t)||this.IsDCE(t)||this.IsSHFE(t)},IsSHSZ:function(t){return this.IsSZ(t)||this.IsSH(t)},IsSHSZFund:function(t){if(!t)return!1;if(this.IsSH(t)){if("5"==t.charAt(0)&&"1"==t.charAt(1))return!0}else if(this.IsSZ(t)&&"1"==t.charAt(0)&&("5"==t.charAt(1)||"6"==t.charAt(1)||"7"==t.charAt(1)||"8"==t.charAt(1)))return!0;return!1},IsSHSZIndex:function(t){if(!t)return!1;var e=t.toUpperCase();if(this.IsSH(e)){var a=e.replace(".SH","");if("0"==e.charAt(0)&&parseInt(a)<=3e3)return!0}else if(this.IsSZ(e)){if("3"==e.charAt(0)&&"9"==e.charAt(1))return!0}else if(e.indexOf(".CI")>0)return!0;return!1},IsSHSZStockA:function(t){if(!t)return!1;var e=t.toUpperCase();if(this.IsSH(e)){e.replace(".SH","");if("6"==e.charAt(0))return!0}else if(this.IsSZ(e)&&"0"==e.charAt(0)){if("0"==e.charAt(1)&&"2"==e.charAt(1))return!0;if("7"!=e.charAt(1)&&"8"!=e.charAt(1))return!0}return!1},IsSHStockSTAR:function(t){if(!t)return!1;var e=t.toUpperCase();return!!this.IsSH(e)&&("6"==e.charAt(0)&&"8"==e.charAt(1)&&"8"==e.charAt(2))},GetMarketStatus:function(t){if(!t)return 0;var e=t.toUpperCase();if(this.IsUSA(e)){var a=GetLocalTime(-4);return r=a.getDay(),n=100*a.getHours()+a.getMinutes(),6==r||0==r?0:n>1730?3:n<930?1:2}var i=new Date,r=i.getDay(),n=100*i.getHours()+i.getMinutes();return 6==r||0==r?0:n>1540?3:n<925?1:2}};e.default=(i={JSStockInit:b.Init,STOCK_FIELD_NAME:O,JSStock:b,StockRead:R},(0,n.default)(i,"STOCK_FIELD_NAME",O),(0,n.default)(i,"RECV_DATA_TYPE",w),i)},7510:function(t,e,a){"use strict";t.exports.Chart=a("9b25").default,t.exports.Stock=a("7183").default,t.exports.RegressionTest=a("2b12").default},"76ef":function(t,e,a){var i=a("512c");i(i.S,"Object",{create:a("6f4f")})},"77e9":function(t,e,a){var i=a("7a41");t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},"7a41":function(t,e){t.exports=function(t){return"object"===typeof t?null!==t:"function"===typeof t}},"7d42":function(t,e,a){a("658f"),a("0b99"),t.exports=a("b1b3")},8034:function(t,e,a){t.exports={default:a("b7fa"),__esModule:!0}},8119:function(t,e,a){a("693d"),a("dfe5"),a("301c"),a("4e71"),t.exports=a("5524").Symbol},"81d56":function(t,e,a){"use strict";var i=a("7b0b"),r=a("23cb"),n=a("50c4");t.exports=function(t){var e=i(this),a=n(e.length),s=arguments.length,o=r(s>1?arguments[1]:void 0,a),h=s>2?arguments[2]:void 0,l=void 0===h?a:r(h,a);while(l>o)e[o++]=t;return e}},"85e7":function(t,e,a){var i=a("1a14"),r=a("77e9"),n=a("9876");t.exports=a("0bad")?Object.defineProperties:function(t,e){r(t);var a,s=n(e),o=s.length,h=0;while(o>h)i.f(t,a=s[h++],e[a]);return t}},8771:function(t,e,a){var i=a("cc15a")("iterator"),r=!1;try{var n=[7][i]();n["return"]=function(){r=!0},Array.from(n,(function(){throw 2}))}catch(s){}t.exports=function(t,e){if(!e&&!r)return!1;var a=!1;try{var n=[7],o=n[i]();o.next=function(){return{done:a=!0}},n[i]=function(){return o},t(n)}catch(s){}return a}},"899e":function(t,e,a){var i=a("051b");t.exports=function(t,e,a){for(var r in e)a&&t[r]?t[r]=e[r]:i(t,r,e[r]);return t}},"8a0d":function(t,e){t.exports={}},"8a87":function(t,e,a){var i=a("512c");i(i.P+i.R,"Set",{toJSON:a("2ad9")("Set")})},"8a8d":function(t,e,a){t.exports={default:a("0d37"),__esModule:!0}},"8b1a":function(t,e){var a=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++a+i).toString(36))}},"8d65":function(t,e,a){t.exports={default:a("afa7"),__esModule:!0}},"8e5c":function(t,e,a){var i=a("ef08"),r=i.navigator;t.exports=r&&r.userAgent||""},"8ecb":function(t,e,a){var i=a("ef08"),r=a("bce0").set,n=i.MutationObserver||i.WebKitMutationObserver,s=i.process,o=i.Promise,h="process"==a("4d88")(s);t.exports=function(){var t,e,a,l=function(){var i,r;h&&(i=s.domain)&&i.exit();while(t){r=t.fn,t=t.next;try{r()}catch(n){throw t?a():e=void 0,n}}e=void 0,i&&i.enter()};if(h)a=function(){s.nextTick(l)};else if(!n||i.navigator&&i.navigator.standalone)if(o&&o.resolve){var u=o.resolve(void 0);a=function(){u.then(l)}}else a=function(){r.call(i,l)};else{var C=!0,D=document.createTextNode("");new n(l).observe(D,{characterData:!0}),a=function(){D.data=C=!C}}return function(i){var r={fn:i,next:void 0};e&&(e.next=r),t||(t=r,a()),e=r}}},9141:function(t,e,a){var i=a("ef08").document;t.exports=i&&i.documentElement},"92f0":function(t,e,a){var i=a("1a14").f,r=a("9c0e"),n=a("cc15a")("toStringTag");t.exports=function(t,e,a){t&&!r(t=a?t:t.prototype,n)&&i(t,n,{configurable:!0,value:e})}},9742:function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},"97ee":function(t,e,a){a("d62d")("Map")},9876:function(t,e,a){var i=a("03d6"),r=a("9742");t.exports=Object.keys||function(t){return i(t,r)}},"9b25":function(t,e,a){"use strict";a("a4d3"),a("e01a"),a("cb29"),a("7db0"),a("c975"),a("fb6a"),a("4e82"),a("a434"),a("b0c0"),a("a9e3"),a("b680"),a("d3b7"),a("acd8"),a("e25e"),a("4d63"),a("25f0"),a("466d"),a("5319"),a("841c"),a("1276"),a("498a"),a("159b"),Object.defineProperty(e,"__esModule",{value:!0});var r,n=a("6042"),s=L(n),o=a("e1de"),h=(L(o),a("a73c")),l=L(h),u=a("8a8d"),C=L(u),D=a("0325"),c=L(D),f=a("1098"),d=L(f),m=a("8034"),v=L(m),S=a("8d65"),I=L(S),p=a("1727"),T=L(p),A=a("3834"),g=L(A),F=a("1157"),E=L(F);function L(t){return t&&t.__esModule?t:{default:t}}var M={Chart:{Log:console.log},Complier:{Log:console.log},JSTable:{Log:console.log}};function x(){}x.HttpRequest=function(t){E.default.ajax({url:t.url,data:t.data,type:t.type,dataType:t.dataType,async:t.async,success:t.success,error:t.error})};var N={MINUTE_ID:101,MULTIDAY_MINUTE_ID:102,HISTORY_MINUTE_ID:103,KLINE_DAY_ID:0,KLINE_WEEK_ID:1,KLINE_TWOWEEK_ID:21,KLINE_MONTH_ID:2,KLINE_QUARTER_ID:9,KLINE_YEAR_ID:3,KLINE_MINUTE_ID:4,KLINE_5_MINUTE_ID:5,KLINE_15_MINUTE_ID:6,KLINE_30_MINUTE_ID:7,KLINE_60_MINUTE_ID:8};function O(){this.DataMap=new g.default,this.Get=function(t){return this.DataMap.has(t)?this.DataMap.get(t):null},this.Add=function(t){this.DataMap.set(t.ID,t)}}var R=new O;function P(){this.DataMap=new g.default([["MA",this.MA],["均线",this.MA],["MA4",this.MA4],["MA5",this.MA5],["MA6",this.MA6],["MA7",this.MA7],["MA8",this.MA8],["BOLL",this.BOLL],["BOLL副图",this.BOLL2],["BBI",this.BBI],["DKX",this.DKX],["MIKE",this.MIKE],["PBX",this.PBX],["ENE",this.ENE],["MACD",this.MACD],["KDJ",this.KDJ],["MACD2",this.MACD2],["VOL",this.VOL],["RSI",this.RSI],["BRAR",this.BRAR],["WR",this.WR],["BIAS",this.BIAS],["OBV",this.OBV],["DMI",this.DMI],["CR",this.CR],["PSY",this.PSY],["CCI",this.CCI],["DMA",this.DMA],["TRIX",this.TRIX],["VR",this.VR],["EMV",this.EMV],["ROC",this.ROC],["MTM",this.MTM],["FSL",this.FSL],["CYR",this.CYR],["MASS",this.MASS],["WAD",this.WAD],["CHO",this.CHO],["ADTM",this.ADTM],["HSL",this.HSL],["BIAS36",this.BIAS36],["BIAS_QL",this.BIAS_QL],["DPO",this.DPO],["OSC",this.OSC],["ATR",this.ATR],["NVI",this.NVI],["PVI",this.PVI],["UOS",this.UOS],["CYW",this.CYW],["LON",this.LON],["NDB",this.NDB],["SKDJ",this.SKDJ],["KD",this.KD],["FKX",this.FKX],["DKCOL",this.DKCOL],["UDL",this.UDL],["MFI",this.MFI],["LWR",this.LWR],["MARSI",this.MARSI],["CYD",this.CYD],["CYF",this.CYF],["TAPI",this.TAPI],["VMACD",this.VMACD],["QACD",this.QACD],["VPT",this.VPT],["WVAD",this.WVAD],["DBQR",this.DBQR],["JS",this.JS],["CYE",this.CYE],["QR",this.QR],["GDX",this.GDX],["JLHB",this.JLHB],["PCNT",this.PCNT],["BTX",this.BTX],["AMO",this.AMO],["VRSI",this.VRSI],["HSCOL",this.HSCOL],["DBQRV",this.DBQRV],["DBLB",this.DBLB],["ACD",this.ACD],["EXPMA",this.EXPMA],["EXPMA_S",this.EXPMA_S],["HMA",this.HMA],["LMA",this.LMA],["VMA",this.VMA],["AMV",this.AMV],["BBIBOLL",this.BBIBOLL],["ALLIGAT",this.ALLIGAT],["ZX",this.ZX],["XS",this.XS],["XS2",this.XS2],["SG-XDT",this.SG_XDT],["SG-SMX",this.SG_SMX],["SG-LB",this.SG_LB],["SG-PF",this.SG_PF],["RAD",this.RAD],["SHT",this.SHT],["ZLJC",this.ZLJC],["ZLMM",this.ZLMM],["SLZT",this.SLZT],["ADVOL",this.ADVOL],["CYC",this.CYC],["CYS",this.CYS],["CYQKL",this.CYQKL],["SCR",this.SCR],["ASR",this.ASR],["SAR",this.SAR],["TJCJL",this.TJCJL],["量比",this.VOLRate],["平均K线",this.HeikinAshi],["ADL",this.ADL],["VOL-TDX",this.VOL_TDX],["EMPTY",this.EMPTY],["CJL2",this.CJL],["ASI",this.ASI],["DC",this.DC],["DEMA",this.DEMA],["VWAP",this.VWAP],["飞龙四式",this.Dragon4_Main],["飞龙四式-附图",this.Dragon4_Fig],["资金分析",this.FundsAnalysis],["融资占比",this.MarginProportion],["负面新闻",this.NewsNegative],["涨跌趋势",this.UpDownAnalyze],["北上资金",this.HK2SHSZ],["股东人数",this.ShareHolder],["两融余额",this.Margin2],["两融余额2",this.Margin3],["Zealink-资金吸筹",this.Zealink_Index1],["Zealink-牛熊区间",this.Zealink_Index2],["Zealink-持仓信号",this.Zealink_Index3],["Zealink-增减持",this.Zealink_Index4],["Zealink-大宗交易",this.Zealink_Index5],["Zealink-信托持股",this.Zealink_Index6],["Zealink-官网新闻",this.Zealink_Index7],["Zealink-高管要闻",this.Zealink_Index8],["Zealink-股权质押",this.Zealink_Index9],["Zealink-操盘BS点",this.Zealink_Index10],["Zealink-操盘BS点2",this.Zealink_Index11],["放心股-操盘BS点",this.FXG_BSPoint],["放心股-涨停多空线",this.FXG_INDEX],["放心股-涨停吸筹区",this.FXG_INDEX2],["放心股-量能黄金点",this.FXG_INDEX3],["五彩K线-十字星",this.COLOR_KSTAR1],["五彩K线-早晨之星",this.COLOR_KSTAR2],["五彩K线-黄昏之星",this.COLOR_KSTAR3],["五彩K线-长十字",this.COLOR_SHI1],["五彩K线-身怀六甲",this.COLOR_K220],["五彩K线-三个白武士",this.COLOR_K300],["五彩K线-三只乌鸦",this.COLOR_K310],["五彩K线-光头阳线",this.COLOR_K380],["五彩K线-光脚阴线",this.COLOR_K390],["五彩K线-垂死十字",this.COLOR_K134],["五彩K线-早晨十字星",this.COLOR_K140],["五彩K线-黄昏十字星",this.COLOR_K150],["五彩K线-射击之星",this.COLOR_K160],["五彩K线-倒转锤头",this.COLOR_K165],["五彩K线-锤头",this.COLOR_K170],["五彩K线-吊颈",this.COLOR_K180],["五彩K线-穿头破脚",this.COLOR_K190],["五彩K线-出水芙蓉",this.COLOR_CSFR],["五彩K线-乌云盖顶",this.COLOR_WYGD],["五彩K线-曙光初现",this.COLOR_SGCJ],["五彩K线-十字胎",this.COLOR_SZTAI],["五彩K线-剑",this.COLOR_SWORD],["五彩K线-平顶",this.COLOR_PINGDING],["五彩K线-平底",this.COLOR_PINGDI],["五彩K线-大阳烛",this.COLOR_DAYANZHU],["五彩K线-大阴烛",this.COLOR_DAYINGZHU],["五彩K线-好友反攻",this.COLOR_HYFG],["五彩K线-跳空缺口",this.COLOR_TKQK],["五彩K线-双飞乌鸦",this.COLOR_SFWY],["五彩K线-上升三部曲",this.COLOR_SSSBQ],["五彩K线-下跌三部曲",this.COLOR_XDSBQ],["五彩K线-长下影",this.COLOR_CHXY],["五彩K线-长上影",this.COLOR_CHSY],["五彩K线-分离",this.COLOR_FENLI],["交易系统-BIAS",this.TRADE_BIAS],["交易系统-CCI",this.TRADE_CCI],["交易系统-DMI",this.TRADE_DMI],["交易系统-KD",this.TRADE_KD],["交易系统-BOLL",this.TRADE_BOLL],["交易系统-KDJ",this.TRADE_KDJ],["交易系统-MA",this.TRADE_MA],["交易系统-MACD",this.TRADE_MACD],["交易系统-MTM",this.TRADE_MTM],["交易系统-PSY",this.TRADE_PSY],["交易系统-ROC",this.TRADE_ROC],["交易系统-RSI",this.TRADE_RSI],["交易系统-VR",this.TRADE_VR],["交易系统-DPSJ",this.TRADE_DPSJ],["TEST",this.TEST]])}if(P.AddIndex=function(t){for(var e in t)R.Add(t[e])},P.prototype.Get=function(t){var e=R.Get(t);if(e)return e;var a=this.DataMap.get(t);return a?a():null},P.prototype.Search=function(t){var e=[],a=new RegExp(t,"i");return this.DataMap.forEach((function(t,i){0!=i.indexOf("交易系统-")&&0!=i.indexOf("五彩K线-")&&i.search(a)>=0&&e.push(i)})),e},P.prototype.MA=function(){var t={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20}],Script:"MA1:MA(CLOSE,M1);\nMA2:MA(CLOSE,M2);\nMA3:MA(CLOSE,M3);"};return t},P.prototype.MA4=function(){var t={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60}],Script:"MA1:MA(CLOSE,M1);\nMA2:MA(CLOSE,M2);\nMA3:MA(CLOSE,M3);\nMA4:MA(CLOSE,M4);"};return t},P.prototype.MA5=function(){var t={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0}],Script:"MA1:MA(CLOSE,M1);\nMA2:MA(CLOSE,M2);\nMA3:MA(CLOSE,M3);\nMA4:MA(CLOSE,M4);\nMA5:MA(CLOSE,M5);"};return t},P.prototype.MA6=function(){var t={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0}],Script:"MA1:MA(CLOSE,M1);\nMA2:MA(CLOSE,M2);\nMA3:MA(CLOSE,M3);\nMA4:MA(CLOSE,M4);\nMA5:MA(CLOSE,M5);\nMA6:MA(CLOSE,M6);"};return t},P.prototype.MA7=function(){var t={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0},{Name:"M7",Value:0}],Script:"MA1:MA(CLOSE,M1);\nMA2:MA(CLOSE,M2);\nMA3:MA(CLOSE,M3);\nMA4:MA(CLOSE,M4);\nMA5:MA(CLOSE,M5);\nMA6:MA(CLOSE,M6);\nMA7:MA(CLOSE,M7);"};return t},P.prototype.MA8=function(){var t={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0},{Name:"M7",Value:0},{Name:"M8",Value:0}],Script:"MA1:MA(CLOSE,M1);\nMA2:MA(CLOSE,M2);\nMA3:MA(CLOSE,M3);\nMA4:MA(CLOSE,M4);\nMA5:MA(CLOSE,M5);\nMA6:MA(CLOSE,M6);\nMA7:MA(CLOSE,M7);\nMA8:MA(CLOSE,M8);"};return t},P.prototype.BOLL=function(){var t={Name:"BOLL",Description:"布林线",IsMainIndex:!0,Args:[{Name:"M",Value:20}],Script:"BOLL:MA(CLOSE,M);\nUB:BOLL+2*STD(CLOSE,M);\nLB:BOLL-2*STD(CLOSE,M);"};return t},P.prototype.BOLL2=function(){var t={Name:"BOLL2",Description:"布林线",IsMainIndex:!1,KLineType:0,Args:[{Name:"M",Value:20}],Script:"BOLL:MA(CLOSE,M);\nUB:BOLL+2*STD(CLOSE,M);\nLB:BOLL-2*STD(CLOSE,M);"};return t},P.prototype.BBI=function(){var t={Name:"BBI",Description:"多空均线",IsMainIndex:!0,Args:[{Name:"M1",Value:3},{Name:"M2",Value:6},{Name:"M3",Value:12},{Name:"M4",Value:24}],Script:"BBI:(MA(CLOSE,M1)+MA(CLOSE,M2)+MA(CLOSE,M3)+MA(CLOSE,M4))/4;"};return t},P.prototype.DKX=function(){var t={Name:"DKX",Description:"多空线",IsMainIndex:!1,Args:[{Name:"M",Value:10}],Script:"MID:=(3*CLOSE+LOW+OPEN+HIGH)/6;\nDKX:(20*MID+19*REF(MID,1)+18*REF(MID,2)+17*REF(MID,3)+\n16*REF(MID,4)+15*REF(MID,5)+14*REF(MID,6)+\n13*REF(MID,7)+12*REF(MID,8)+11*REF(MID,9)+\n10*REF(MID,10)+9*REF(MID,11)+8*REF(MID,12)+\n7*REF(MID,13)+6*REF(MID,14)+5*REF(MID,15)+\n4*REF(MID,16)+3*REF(MID,17)+2*REF(MID,18)+REF(MID,20))/210;\nMADKX:MA(DKX,M);"};return t},P.prototype.MIKE=function(){var t={Name:"MIKE",Description:"麦克支撑压力",IsMainIndex:!0,Args:[{Name:"N",Value:10}],Script:"HLC:=REF(MA((HIGH+LOW+CLOSE)/3,N),1);\nHV:=EMA(HHV(HIGH,N),3);\nLV:=EMA(LLV(LOW,N),3);\nSTOR:EMA(2*HV-LV,3);\nMIDR:EMA(HLC+HV-LV,3);\nWEKR:EMA(HLC*2-LV,3);\nWEKS:EMA(HLC*2-HV,3);\nMIDS:EMA(HLC-HV+LV,3);\nSTOS:EMA(2*LV-HV,3);"};return t},P.prototype.PBX=function(){var t={Name:"PBX",Description:"瀑布线",IsMainIndex:!0,Args:[{Name:"M1",Value:4},{Name:"M2",Value:6},{Name:"M3",Value:9},{Name:"M4",Value:13},{Name:"M5",Value:18},{Name:"M6",Value:24}],Script:"PBX1:(EMA(CLOSE,M1)+MA(CLOSE,M1*2)+MA(CLOSE,M1*4))/3;\nPBX2:(EMA(CLOSE,M2)+MA(CLOSE,M2*2)+MA(CLOSE,M2*4))/3;\nPBX3:(EMA(CLOSE,M3)+MA(CLOSE,M3*2)+MA(CLOSE,M3*4))/3;\nPBX4:(EMA(CLOSE,M4)+MA(CLOSE,M4*2)+MA(CLOSE,M4*4))/3;\nPBX5:(EMA(CLOSE,M5)+MA(CLOSE,M5*2)+MA(CLOSE,M5*4))/3;\nPBX6:(EMA(CLOSE,M6)+MA(CLOSE,M6*2)+MA(CLOSE,M6*4))/3;"};return t},P.prototype.ENE=function(){var t={Name:"ENE",Description:"轨道线",IsMainIndex:!0,Args:[{Name:"N",Value:25},{Name:"M1",Value:6},{Name:"M2",Value:6}],Script:"UPPER:(1+M1/100)*MA(CLOSE,N);\nLOWER:(1-M2/100)*MA(CLOSE,N);\nENE:(UPPER+LOWER)/2;"};return t},P.prototype.MACD=function(){var t={Name:"MACD",Description:"平滑异同平均",IsMainIndex:!1,Args:[{Name:"SHORT",Value:12},{Name:"LONG",Value:26},{Name:"MID",Value:9}],Script:"DIF:EMA(CLOSE,SHORT)-EMA(CLOSE,LONG);\nDEA:EMA(DIF,MID);\nMACD:(DIF-DEA)*2,COLORSTICK;"};return t},P.prototype.MACD2=function(){var t={Name:"MACD",Description:"平滑异同平均",IsMainIndex:!1,Args:[{Name:"SHORT",Value:12},{Name:"LONG",Value:26},{Name:"MID",Value:9}],Script:"DIF2:=EMA(CLOSE,SHORT)-EMA(CLOSE,LONG);\nDEA2:=EMA(DIF2,MID);\nMACD:(DIF2-DEA2)*2,COLORSTICK,LINETHICK50;\nDIF:DIF2;\nDEA:DEA2;"};return t},P.prototype.KDJ=function(){var t={Name:"KDJ",Description:"随机指标",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:"RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;\nK:SMA(RSV,M1,1);\nD:SMA(K,M2,1);\nJ:3*K-2*D;"};return t},P.prototype.VOL=function(){var t={Name:"VOL",Description:"成交量",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],Script:"VOL:VOL,VOLSTICK;\nMA1:MA(VOL,M1);\nMA2:MA(VOL,M2);"};return t},P.prototype.VOL_TDX=function(){var t={Name:"VOL-TDX",Description:"成交量(虚拟)",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],Script:"TOTAL:=IF(PERIOD=1,5,IF(PERIOD=2,15,IF(PERIOD=3,30,IF(PERIOD=4,60,IF(PERIOD=5,TOTALFZNUM,1)))));\nMTIME:=MOD(FROMOPEN,TOTAL);\nCTIME:=IF(MTIME<0.5,TOTAL,MTIME);\nVVOL:IF((CURRBARSCOUNT=1 AND DYNAINFO(8)>1),VOL*(TOTAL+3)/(CTIME+3),DRAWNULL),NODRAW;\nSTICKLINE((CURRBARSCOUNT=1 AND DYNAINFO(8)>1),VVOL,0,-1,-1),COLORYELLOW;\nVOLUME:VOL,VOLSTICK;\nMAVOL1:MA(VOLUME,M1);\nMAVOL2:MA(VOLUME,M2);"};return t},P.prototype.RSI=function(){var t={Name:"RSI",Description:"相对强弱指标",IsMainIndex:!1,Args:[{Name:"N1",Value:6},{Name:"N2",Value:12},{Name:"N3",Value:24}],Script:"LC:=REF(CLOSE,1);\nRSI1:SMA(MAX(CLOSE-LC,0),N1,1)/SMA(ABS(CLOSE-LC),N1,1)*100;\nRSI2:SMA(MAX(CLOSE-LC,0),N2,1)/SMA(ABS(CLOSE-LC),N2,1)*100;\nRSI3:SMA(MAX(CLOSE-LC,0),N3,1)/SMA(ABS(CLOSE-LC),N3,1)*100;"};return t},P.prototype.BRAR=function(){var t={Name:"BRAR",Description:"情绪指标",IsMainIndex:!1,Args:[{Name:"N",Value:26}],Script:"BR:SUM(MAX(0,HIGH-REF(CLOSE,1)),N)/SUM(MAX(0,REF(CLOSE,1)-LOW),N)*100;\nAR:SUM(HIGH-OPEN,N)/SUM(OPEN-LOW,N)*100;"};return t},P.prototype.WR=function(){var t={Name:"WR",Description:"威廉指标",IsMainIndex:!1,Args:[{Name:"N",Value:10},{Name:"N1",Value:6}],Script:"WR1:100*(HHV(HIGH,N)-CLOSE)/(HHV(HIGH,N)-LLV(LOW,N));\nWR2:100*(HHV(HIGH,N1)-CLOSE)/(HHV(HIGH,N1)-LLV(LOW,N1));"};return t},P.prototype.BIAS=function(){var t={Name:"BIAS",Description:"乖离率",IsMainIndex:!1,Args:[{Name:"N1",Value:6},{Name:"N2",Value:12},{Name:"N3",Value:24}],Script:"BIAS1 :(CLOSE-MA(CLOSE,N1))/MA(CLOSE,N1)*100;\nBIAS2 :(CLOSE-MA(CLOSE,N2))/MA(CLOSE,N2)*100;\nBIAS3 :(CLOSE-MA(CLOSE,N3))/MA(CLOSE,N3)*100;"};return t},P.prototype.OBV=function(){var t={Name:"OBV",Description:"累积能量线",IsMainIndex:!1,Args:[{Name:"M",Value:30}],Script:"VA:=IF(CLOSE>REF(CLOSE,1),VOL,-VOL);\nOBV:SUM(IF(CLOSE==REF(CLOSE,1),0,VA),0);\nMAOBV:MA(OBV,M);"};return t},P.prototype.DMI=function(){var t={Name:"DMI",Description:"趋向指标",IsMainIndex:!1,Args:[{Name:"N",Value:14},{Name:"MM",Value:6}],Script:"MTR:=EXPMEMA(MAX(MAX(HIGH-LOW,ABS(HIGH-REF(CLOSE,1))),ABS(REF(CLOSE,1)-LOW)),N);\nHD :=HIGH-REF(HIGH,1);\nLD :=REF(LOW,1)-LOW;\nDMP:=EXPMEMA(IF(HD>0&&HD>LD,HD,0),N);\nDMM:=EXPMEMA(IF(LD>0&&LD>HD,LD,0),N);\nPDI: DMP*100/MTR;\nMDI: DMM*100/MTR;\nADX: EXPMEMA(ABS(MDI-PDI)/(MDI+PDI)*100,MM);\nADXR:EXPMEMA(ADX,MM);"};return t},P.prototype.CR=function(){var t={Name:"CR",Description:"带状能量线",IsMainIndex:!1,Args:[{Name:"N",Value:26},{Name:"M1",Value:10},{Name:"M2",Value:20},{Name:"M3",Value:40},{Name:"M4",Value:62}],Script:"MID:=REF(HIGH+LOW,1)/2;\nCR:SUM(MAX(0,HIGH-MID),N)/SUM(MAX(0,MID-LOW),N)*100;\nMA1:REF(MA(CR,M1),M1/2.5+1);\nMA2:REF(MA(CR,M2),M2/2.5+1);\nMA3:REF(MA(CR,M3),M3/2.5+1);\nMA4:REF(MA(CR,M4),M4/2.5+1);"};return t},P.prototype.PSY=function(){var t={Name:"PSY",Description:"心理线",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:"PSY:COUNT(CLOSE>REF(CLOSE,1),N)/N*100;\rPSYMA:MA(PSY,M);"};return t},P.prototype.CCI=function(){var t={Name:"CCI",Description:"商品路径指标",IsMainIndex:!1,Args:[{Name:"N",Value:14}],Script:"TYP:=(HIGH+LOW+CLOSE)/3;\nCCI:(TYP-MA(TYP,N))/(0.015*AVEDEV(TYP,N));"};return t},P.prototype.DMA=function(){var t={Name:"DMA",Description:"平均差",IsMainIndex:!1,Args:[{Name:"N1",Value:10},{Name:"N2",Value:50},{Name:"M",Value:10}],Script:"DIF:MA(CLOSE,N1)-MA(CLOSE,N2);\nDIFMA:MA(DIF,M);"};return t},P.prototype.TRIX=function(){var t={Name:"TRIX",Description:"三重指数平均线",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:9}],Script:"MTR:=EMA(EMA(EMA(CLOSE,N),N),N);\nTRIX:(MTR-REF(MTR,1))/REF(MTR,1)*100;\nMATRIX:MA(TRIX,M) ;"};return t},P.prototype.VR=function(){var t={Name:"VR",Description:"成交量变异率",IsMainIndex:!1,Args:[{Name:"N",Value:26},{Name:"M",Value:6}],Script:"TH:=SUM(IF(CLOSE>REF(CLOSE,1),VOL,0),N);\nTL:=SUM(IF(CLOSE<REF(CLOSE,1),VOL,0),N);\nTQ:=SUM(IF(CLOSE==REF(CLOSE,1),VOL,0),N);\nVR:100*(TH*2+TQ)/(TL*2+TQ);\nMAVR:MA(VR,M);"};return t},P.prototype.EMV=function(){var t={Name:"EMV",Description:"简易波动指标",IsMainIndex:!1,Args:[{Name:"N",Value:14},{Name:"M",Value:9}],Script:"VOLUME:=MA(VOL,N)/VOL;\nMID:=100*(HIGH+LOW-REF(HIGH+LOW,1))/(HIGH+LOW);\nEMV:MA(MID*VOLUME*(HIGH-LOW)/MA(HIGH-LOW,N),N);\nMAEMV:MA(EMV,M);"};return t},P.prototype.ROC=function(){var t={Name:"ROC",Description:"变动率指标",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:"ROC:100*(CLOSE-REF(CLOSE,N))/REF(CLOSE,N);\nMAROC:MA(ROC,M);"};return t},P.prototype.MTM=function(){var t={Name:"MTM",Description:"动量线",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:"MTM:CLOSE-REF(CLOSE,N);\nMAMTM:MA(MTM,M);"};return t},P.prototype.FSL=function(){var t={Name:"FSL",Description:"分水岭",IsMainIndex:!1,Args:[],Script:"SWL:(EMA(CLOSE,5)*7+EMA(CLOSE,10)*3)/10;\nSWS:DMA(EMA(CLOSE,12),MAX(1,100*(SUM(VOL,5)/(3*CAPITAL))));"};return t},P.prototype.CYR=function(){var t={Name:"CYR",Description:"市场强弱",IsMainIndex:!1,Args:[{Name:"N",Value:13},{Name:"M",Value:5}],Script:"DIVE:=0.01*EMA(AMOUNT,N)/EMA(VOL,N);\nCYR:(DIVE/REF(DIVE,1)-1)*100;\nMACYR:MA(CYR,M);"};return t},P.prototype.MASS=function(){var t={Name:"MASS",Description:"市场强弱",IsMainIndex:!1,Args:[{Name:"N1",Value:9},{Name:"N2",Value:25},{Name:"M",Value:6}],Script:"MASS:SUM(MA(HIGH-LOW,N1)/MA(MA(HIGH-LOW,N1),N1),N2);\nMAMASS:MA(MASS,M);"};return t},P.prototype.WAD=function(){var t={Name:"WAD",Description:"威廉多空力度线",IsMainIndex:!1,Args:[{Name:"M",Value:30}],Script:"MIDA:=CLOSE-MIN(REF(CLOSE,1),LOW);\nMIDB:=IF(CLOSE<REF(CLOSE,1),CLOSE-MAX(REF(CLOSE,1),HIGH),0);\nWAD:SUM(IF(CLOSE>REF(CLOSE,1),MIDA,MIDB),0);\nMAWAD:MA(WAD,M);"};return t},P.prototype.CHO=function(){var t={Name:"CHO",Description:"佳庆指标",IsMainIndex:!1,Args:[{Name:"N1",Value:10},{Name:"N2",Value:20},{Name:"M",Value:6}],Script:"MID:=SUM(VOL*(2*CLOSE-HIGH-LOW)/(HIGH+LOW),0);\nCHO:MA(MID,N1)-MA(MID,N2);\nMACHO:MA(CHO,M);"};return t},P.prototype.ADTM=function(){var t={Name:"ADTM",Description:"动态买卖气指标",IsMainIndex:!1,Args:[{Name:"N",Value:23},{Name:"M",Value:8}],Script:"DTM:=IF(OPEN<=REF(OPEN,1),0,MAX((HIGH-OPEN),(OPEN-REF(OPEN,1))));\nDBM:=IF(OPEN>=REF(OPEN,1),0,MAX((OPEN-LOW),(OPEN-REF(OPEN,1))));\nSTM:=SUM(DTM,N);\nSBM:=SUM(DBM,N);\nADTM:IF(STM>SBM,(STM-SBM)/STM,IF(STM==SBM,0,(STM-SBM)/SBM));\nMAADTM:MA(ADTM,M);"};return t},P.prototype.HSL=function(){var t={Name:"HSL",Description:"换手线",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:"HSL:IF((SETCODE==0||SETCODE==1),100*VOL,VOL)/(FINANCE(7)/100);\nMAHSL:MA(HSL,N);"};return t},P.prototype.BIAS36=function(){var t={Name:"BIAS36",Description:"三六乖离",IsMainIndex:!1,Args:[{Name:"M",Value:6}],Script:"BIAS36:MA(CLOSE,3)-MA(CLOSE,6);\nBIAS612:MA(CLOSE,6)-MA(CLOSE,12);\nMABIAS:MA(BIAS36,M);"};return t},P.prototype.BIAS_QL=function(){var t={Name:"BIAS_QL",Description:"乖离率-传统版",IsMainIndex:!1,Args:[{Name:"N",Value:6},{Name:"M",Value:6}],Script:"BIAS :(CLOSE-MA(CLOSE,N))/MA(CLOSE,N)*100;\nBIASMA :MA(BIAS,M);"};return t},P.prototype.DPO=function(){var t={Name:"DPO",Description:"区间震荡线",IsMainIndex:!1,Args:[{Name:"N",Value:20},{Name:"M",Value:6}],Script:"DPO:CLOSE-REF(MA(CLOSE,N),N/2+1);\nMADPO:MA(DPO,M);"};return t},P.prototype.OSC=function(){var t={Name:"OSC",Description:"变动速率线",IsMainIndex:!1,Args:[{Name:"N",Value:20},{Name:"M",Value:6}],Script:"OSC:100*(CLOSE-MA(CLOSE,N));\nMAOSC:EXPMEMA(OSC,M);"};return t},P.prototype.ATR=function(){var t={Name:"ATR",Description:"真实波幅",IsMainIndex:!1,Args:[{Name:"N",Value:14}],Script:"MTR:MAX(MAX((HIGH-LOW),ABS(REF(CLOSE,1)-HIGH)),ABS(REF(CLOSE,1)-LOW));\nATR:MA(MTR,N);"};return t},P.prototype.NVI=function(){var t={Name:"ATR",Description:"负成交量",IsMainIndex:!1,Args:[{Name:"N",Value:72}],Script:"NVI:100*MULAR(IF(V<REF(V,1),C/REF(C,1),1),0);\nMANVI:MA(NVI,N);"};return t},P.prototype.PVI=function(){var t={Name:"PVI",Description:"正成交量",IsMainIndex:!1,Args:[{Name:"N",Value:72}],Script:"NVI:100*MULAR(IF(V>REF(V,1),C/REF(C,1),1),0);\nMANVI:MA(NVI,N);"};return t},P.prototype.UOS=function(){var t={Name:"UOS",Description:"终极指标",IsMainIndex:!1,Args:[{Name:"N1",Value:7},{Name:"N2",Value:14},{Name:"N3",Value:28},{Name:"M",Value:6}],Script:"TH:=MAX(HIGH,REF(CLOSE,1));\nTL:=MIN(LOW,REF(CLOSE,1));\nACC1:=SUM(CLOSE-TL,N1)/SUM(TH-TL,N1);\nACC2:=SUM(CLOSE-TL,N2)/SUM(TH-TL,N2);\nACC3:=SUM(CLOSE-TL,N3)/SUM(TH-TL,N3);\nUOS:(ACC1*N2*N3+ACC2*N1*N3+ACC3*N1*N2)*100/(N1*N2+N1*N3+N2*N3);\nMAUOS:EXPMEMA(UOS,M);"};return t},P.prototype.CYW=function(){var t={Name:"CYW",Description:"主力控盘",IsMainIndex:!1,Args:[],Script:"VAR1:=CLOSE-LOW;\nVAR2:=HIGH-LOW;\nVAR3:=CLOSE-HIGH;\nVAR4:=IF(HIGH>LOW,(VAR1/VAR2+VAR3/VAR2)*VOL,0);\nCYW: SUM(VAR4,10)/10000, COLORSTICK;"};return t},P.prototype.LON=function(){var t={Name:"LON",Description:"龙系长线",IsMainIndex:!1,Args:[{Name:"N",Value:10}],Script:"LC := REF(CLOSE,1);\nVID := SUM(VOL,2)/(((HHV(HIGH,2)-LLV(LOW,2)))*100);\nRC := (CLOSE-LC)*VID;\nLONG := SUM(RC,0);\nDIFF := SMA(LONG,10,1);\nDEA := SMA(LONG,20,1);\nLON : DIFF-DEA;\nLONMA : MA(LON,10);\nLONT : LON, COLORSTICK;"};return t},P.prototype.NDB=function(){var t={Name:"NDB",Description:"脑电波",IsMainIndex:!1,Args:[{Name:"P1",Value:5},{Name:"P2",Value:10}],Script:"HH:=IF(C/REF(C,1)>1.098 AND L>REF(H,1),2*C-REF(C,1)-H,2*C-H-L);\nV1:= BARSCOUNT(C) - 1;\nV2:= 2 * REF(C, V1) - REF(H, V1) - REF(L, V1);\nDK: SUM(HH, 0) + V2;\nMDK5: MA(DK, P1);\nMDK10: MA(DK, P2);"};return t},P.prototype.SKDJ=function(){var t={Name:"SKDJ",Description:"慢速随机指标",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M",Value:3}],Script:"LOWV:=LLV(LOW,N);\nHIGHV:=HHV(HIGH,N);\nRSV:=EMA((CLOSE-LOWV)/(HIGHV-LOWV)*100,M);\nK:EMA(RSV,M);\nD:MA(K,M);"};return t},P.prototype.KD=function(){var t={Name:"KD",Description:"随机指标KD",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:"RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;\nK:SMA(RSV,M1,1);\nD:SMA(K,M2,1);"};return t},P.prototype.FKX=function(){var t={Name:"FKX",Description:"反K线",IsMainIndex:!0,Args:[],Script:"DRAWKLINE(-LOW, -OPEN, -HIGH, -CLOSE);"};return t},P.prototype.DKCOL=function(){var t={Name:"DKCOL",Description:"多空能量柱(适用于分时主图)",IsMainIndex:!0,Args:[{Name:"N",Value:5}],Script:"FF:=(C-REF(C,N))/REF(C,N);\nSTICKLINE(FF>0,DYNAINFO(3),DYNAINFO(3)*(1+FF),0.5,0),COLORRED;\nSTICKLINE(FF<0,DYNAINFO(3),DYNAINFO(3)*(1+FF),0.5,0),COLORGREEN;"};return t},P.prototype.UDL=function(){var t={Name:"UDL",Description:"引力线",IsMainIndex:!1,Args:[{Name:"N1",Value:3},{Name:"N2",Value:5},{Name:"N3",Value:10},{Name:"N4",Value:20},{Name:"M",Value:6}],Script:"UDL:(MA(CLOSE,N1)+MA(CLOSE,N2)+MA(CLOSE,N3)+MA(CLOSE,N4))/4;\nMAUDL:MA(UDL,M);"};return t},P.prototype.MFI=function(){var t={Name:"MFI",Description:"资金流量指标",IsMainIndex:!1,Args:[{Name:"N",Value:14},{Name:"N2",Value:6}],Script:"TYP := (HIGH + LOW + CLOSE)/3;\nV1:=SUM(IF(TYP>REF(TYP,1),TYP*VOL,0),N)/SUM(IF(TYP<REF(TYP,1),TYP*VOL,0),N);\nMFI:100-(100/(1+V1));"};return t},P.prototype.LWR=function(){var t={Name:"LWR",Description:"LWR威廉指标",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:"RSV:= (HHV(HIGH,N)-CLOSE)/(HHV(HIGH,N)-LLV(LOW,N))*100;\nLWR1:SMA(RSV,M1,1);\nLWR2:SMA(LWR1,M2,1);"};return t},P.prototype.MARSI=function(){var t={Name:"MARSI",Description:"相对强弱平均线",IsMainIndex:!1,Args:[{Name:"M1",Value:10},{Name:"M2",Value:6}],Script:"DIF:=CLOSE-REF(CLOSE,1);\nVU:=IF(DIF>=0,DIF,0);\nVD:=IF(DIF<0,-DIF,0);\nMAU1:=MEMA(VU,M1);\nMAD1:=MEMA(VD,M1);\nMAU2:=MEMA(VU,M2);\nMAD2:=MEMA(VD,M2);\nRSI10:MA(100*MAU1/(MAU1+MAD1),M1);\nRSI6:MA(100*MAU2/(MAU2+MAD2),M2);"};return t},P.prototype.CYD=function(){var t={Name:"CYD",Description:"承接因子",IsMainIndex:!1,Args:[{Name:"N",Value:21}],Script:"CYDS:WINNER(CLOSE)/(VOL/CAPITAL);\nCYDN:WINNER(CLOSE)/MA(VOL/CAPITAL,N);"};return t},P.prototype.CYF=function(){var t={Name:"CYF",Description:"市场能量",IsMainIndex:!1,Args:[{Name:"N",Value:21}],Script:"CYF:100-100/(1+EMA(HSL,N));"};return t},P.prototype.TAPI=function(){var t={Name:"TAPI",Description:"加权指数成交值",IsMainIndex:!1,Args:[{Name:"M",Value:6}],Script:"TAPI:AMOUNT/INDEXC;\nMATAIP:MA(TAPI,M);"};return t},P.prototype.VMACD=function(){var t={Name:"VMACD",Description:"量平滑异同平均",IsMainIndex:!1,Args:[{Name:"SHORT",Value:12},{Name:"LONG",Value:26},{Name:"MID",Value:9}],Script:"DIF:EMA(VOL,SHORT)-EMA(VOL,LONG);\nDEA:EMA(DIF,MID);\nMACD:DIF-DEA,COLORSTICK;"};return t},P.prototype.QACD=function(){var t={Name:"QACD",Description:"快速异同平均",IsMainIndex:!1,Args:[{Name:"N1",Value:12},{Name:"N2",Value:26},{Name:"M",Value:9}],Script:"DIF:EMA(CLOSE,N1)-EMA(CLOSE,N2);\nMACD:EMA(DIF,M);\nDDIF:DIF-MACD;"};return t},P.prototype.VPT=function(){var t={Name:"VPT",Description:"量价曲线",IsMainIndex:!1,Args:[{Name:"N",Value:51},{Name:"M",Value:6}],Script:"VPT:SUM(VOL*(CLOSE-REF(CLOSE,1))/REF(CLOSE,1),N);\nMAVPT:MA(VPT,M);"};return t},P.prototype.WVAD=function(){var t={Name:"WVAD",Description:"威廉变异离散量",IsMainIndex:!1,Args:[{Name:"N",Value:24},{Name:"M",Value:6}],Script:"WVAD:SUM((CLOSE-OPEN)/(HIGH-LOW)*VOL,N)/10000;\nMAWVAD:MA(WVAD,M);"};return t},P.prototype.DBQR=function(){var t={Name:"WVAD",Description:"对比强弱",IsMainIndex:!1,Args:[{Name:"N",Value:5},{Name:"M1",Value:10},{Name:"M2",Value:20},{Name:"M3",Value:60}],Script:"ZS:(INDEXC-REF(INDEXC,N))/REF(INDEXC,N);\nGG:(CLOSE-REF(CLOSE,N))/REF(CLOSE,N);\nMADBQR1:MA(GG,M1);\nMADBQR2:MA(GG,M2);\nMADBQR3:MA(GG,M3);"};return t},P.prototype.JS=function(){var t={Name:"JS",Description:"加速线",IsMainIndex:!1,Args:[{Name:"N",Value:5},{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20}],Script:"JS:100*(CLOSE-REF(CLOSE,N))/(N*REF(CLOSE,N));\nMAJS1:MA(JS,M1);\nMAJS2:MA(JS,M2);\nMAJS3:MA(JS,M3);"};return t},P.prototype.CYE=function(){var t={Name:"CYE",Description:"市场趋势",IsMainIndex:!1,Args:[],Script:"MAL:=MA(CLOSE,5);\nMAS:=MA(MA(CLOSE,20),5);\nCYEL:(MAL-REF(MAL,1))/REF(MAL,1)*100;\nCYES:(MAS-REF(MAS,1))/REF(MAS,1)*100;"};return t},P.prototype.QR=function(){var t={Name:"QR",Description:"强弱指标",IsMainIndex:!1,Args:[{Name:"N",Value:21}],Script:"个股: (CLOSE-REF(CLOSE,N))/REF(CLOSE,N)*100; \n大盘: (INDEXC-REF(INDEXC,N))/REF(INDEXC,N)*100; \n强弱值:EMA(个股-大盘,2),COLORSTICK;"};return t},P.prototype.GDX=function(){var t={Name:"GDX",Description:"轨道线",IsMainIndex:!1,Args:[{Name:"N",Value:30},{Name:"M",Value:9}],Script:"AA:=ABS((2*CLOSE+HIGH+LOW)/4-MA(CLOSE,N))/MA(CLOSE,N); \n轨道:DMA(CLOSE,AA);\n压力线:(1+M/100)*轨道; \n支撑线:(1-M/100)*轨道;"};return t},P.prototype.JLHB=function(){var t={Name:"JLHB",Description:"绝路航标",IsMainIndex:!1,Args:[{Name:"N",Value:7},{Name:"M",Value:5}],Script:"VAR1:=(CLOSE-LLV(LOW,60))/(HHV(HIGH,60)-LLV(LOW,60))*80; \nB:SMA(VAR1,N,1); \nVAR2:SMA(B,M,1); \n绝路航标:IF(CROSS(B,VAR2) AND B<40,50,0);"};return t},P.prototype.PCNT=function(){var t={Name:"PCNT",Description:"幅度比",IsMainIndex:!1,Args:[{Name:"M",Value:5}],Script:"PCNT:(CLOSE-REF(CLOSE,1))/CLOSE*100;\nMAPCNT:EXPMEMA(PCNT,M);"};return t},P.prototype.BTX=function(){var t={Name:"BTX",Description:"宝塔线",IsMainIndex:!1,Args:[],Script:"B1:=REF(C,1);\nB2:= REF(C, 2);\nSS:= IF(C > REF(C, 1) AND REF(C, 1) >= REF(C, 2), 1, IF(C < REF(C, 1) AND REF(C, 1) <= REF(C, 2), -1, IF(C > REF(C, 2) AND REF(C, 2) > REF(C, 1), 2, IF(C < REF(C, 2) AND REF(C, 2) < REF(C, 1), -2, 0))));\nSM:= IF(REF(SS, 1) <> 0, REF(SS, 1), IF(REF(SS, 2) <> 0, REF(SS, 2), IF(REF(SS, 3) <> 0, REF(SS, 3), IF(REF(SS, 5) <> 0, REF(SS, 5), IF(REF(SS, 6) <> 0, REF(SS, 6), IF(REF(SS, 7) <> 0, REF(SS, 7), 0))))));\nMC:= IF(REF(SS, 1) <> 0, B2, IF(SM > 0, MIN(B1, B2), MAX(B1, B2)));\nTOW1:= IF(C > REF(C, 1), C, REF(C, 1));\nTOW2:= IF((SS == -1 OR SS == -2) AND SM > 0, B2, TOW1);\nTOWER:= IF(TOW1 > TOW2, TOW1, TOW2);\nSTICKLINE(SS == 1 OR SM >= 1 AND SS == 0, B1, C, 10, 1), COLORRED;\nSTICKLINE(SS == -1 OR SM <= -1 AND SS == 0, B1, C, 10, 0), COLORCYAN;\nSTICKLINE(SS == 2, B2, C, 10, 1), COLORRED;\nSTICKLINE(SS == -2, B2, C, 10, 0), COLORCYAN;\nSTICKLINE((SS == -1 OR SS == -2) AND SM > 0, B2, B1, 10, 1), COLORRED;\nSTICKLINE((SS == 1 OR SS == 2) AND SM < 0, B2, B1, 10, 0), COLORCYAN;"};return t},P.prototype.AMO=function(){var t={Name:"AMO",Description:"成交金额",IsMainIndex:!1,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],Script:"AMOW:AMOUNT/10000.0,VOLSTICK;\nAMO1:MA(AMOW,M1);\nAMO2:MA(AMOW,M2);"};return t},P.prototype.VRSI=function(){var t={Name:"VRSI",Description:"相对强弱量",IsMainIndex:!1,Args:[{Name:"N1",Value:6},{Name:"N2",Value:12},{Name:"N3",Value:24}],Script:"LC:=REF(VOL,1);\nRSI1:SMA(MAX(VOL-LC,0),N1,1)/SMA(ABS(VOL-LC),N1,1)*100;\nRSI2:SMA(MAX(VOL-LC,0),N2,1)/SMA(ABS(VOL-LC),N2,1)*100;\nRSI3:SMA(MAX(VOL-LC,0),N3,1)/SMA(ABS(VOL-LC),N3,1)*100;"};return t},P.prototype.HSCOL=function(){var t={Name:"HSCOL",Description:"换手柱",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:"HSCOL:IF((SETCODE==0||SETCODE==1),100*VOL,VOL)/(FINANCE(7)/100),VOLSTICK;\nMAHSL:MA(HSCOL,N);"};return t},P.prototype.DBQRV=function(){var t={Name:"DBQRV",Description:"对比强弱量(需下载日线)",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:"ZS:(INDEXV-REF(INDEXV,N))/REF(INDEXV,N);\nGG:(VOL-REF(VOL,N))/REF(VOL,N);"};return t},P.prototype.DBLB=function(){var t={Name:"DBLB",Description:"对比量比(需下载日线)",IsMainIndex:!1,Args:[{Name:"N",Value:5},{Name:"M",Value:5}],Script:"GG:=VOL/SUM(REF(VOL,1),N);\nZS:=INDEXV/SUM(REF(INDEXV,1),N);\nDBLB:GG/ZS;\nMADBLB:MA(DBLB,M);"};return t},P.prototype.ACD=function(){var t={Name:"ACD",Description:"升降线",IsMainIndex:!1,Args:[{Name:"M",Value:20}],Script:"LC:=REF(CLOSE,1);\nDIF:=CLOSE-IF(CLOSE>LC,MIN(LOW,LC),MAX(HIGH,LC));\nACD:SUM(IF(CLOSE==LC,0,DIF),0);\nMAACD:EXPMEMA(ACD,M);"};return t},P.prototype.EXPMA=function(){var t={Name:"EXPMA",Description:"指数平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:12},{Name:"M2",Value:50}],Script:"EXP1:EMA(CLOSE,M1);\nEXP2:EMA(CLOSE,M2);"};return t},P.prototype.EXPMA_S=function(){var t={Name:"EXPMA_S",Description:"指数平均线-副图",IsMainIndex:!1,Args:[{Name:"M1",Value:12},{Name:"M2",Value:50}],Script:"EXP1:EMA(CLOSE,M1);\nEXP2:EMA(CLOSE,M2);"};return t},P.prototype.HMA=function(){var t={Name:"HMA",Description:"高价平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:"HMA1:MA(HIGH,M1);\nHMA2:MA(HIGH,M2);\nHMA3:MA(HIGH,M3);\nHMA4:MA(HIGH,M4);\nHMA5:MA(HIGH,M5);"};return t},P.prototype.LMA=function(){var t={Name:"LMA",Description:"低价平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:"LMA1:MA(LOW,M1);\nLMA2:MA(LOW,M2);\nLMA3:MA(LOW,M3);\nLMA4:MA(LOW,M4);\nLMA5:MA(LOW,M5);"};return t},P.prototype.VMA=function(){var t={Name:"VMA",Description:"变异平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:"VV:=(HIGH+OPEN+LOW+CLOSE)/4;\nVMA1:MA(VV,M1);\nVMA2:MA(VV,M2);\nVMA3:MA(VV,M3);\nVMA4:MA(VV,M4);\nVMA5:MA(VV,M5);"};return t},P.prototype.AMV=function(){var t={Name:"AMV",Description:"成本价均线",IsMainIndex:!1,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:"AMOV:=VOL*(OPEN+CLOSE)/2;\nAMV1:SUM(AMOV,M1)/SUM(VOL,M1);\nAMV2:SUM(AMOV,M2)/SUM(VOL,M2);\nAMV3:SUM(AMOV,M3)/SUM(VOL,M3);\nAMV4:SUM(AMOV,M4)/SUM(VOL,M4);"};return t},P.prototype.BBIBOLL=function(){var t={Name:"BBIBOLL",Description:"多空布林线",IsMainIndex:!0,Args:[{Name:"N",Value:11},{Name:"M",Value:6}],Script:"CV:=CLOSE;\nBBIBOLL:(MA(CV,3)+MA(CV,6)+MA(CV,12)+MA(CV,24))/4;\nUPR:BBIBOLL+M*STD(BBIBOLL,N);\nDWN:BBIBOLL-M*STD(BBIBOLL,N);"};return t},P.prototype.ALLIGAT=function(){var t={Name:"ALLIGAT",Description:"鳄鱼线",IsMainIndex:!0,Args:[],Script:"NN:=(H+L)/2;\n上唇:REF(MA(NN,5),3),COLOR40FF40;\n牙齿:REF(MA(NN,8),5),COLOR0000C0;\n下颚:REF(MA(NN,13),8),COLORFF4040;"};return t},P.prototype.ZX=function(){var t={Name:"ZX",Description:"重心线",IsMainIndex:!1,Args:[],Script:"AV:0.01*AMOUNT/VOL;"};return t},P.prototype.XS=function(){var t={Name:"XS",Description:"薛斯通道",IsMainIndex:!0,Args:[{Name:"N",Value:13}],Script:"VAR2:=CLOSE*VOL;\nVAR3:=EMA((EMA(VAR2,3)/EMA(VOL,3)+EMA(VAR2,6)/EMA(VOL,6)+EMA(VAR2,12)/EMA(VOL,12)+EMA(VAR2,24)/EMA(VOL,24))/4,N);\nSUP:1.06*VAR3;\nSDN:VAR3*0.94;\nVAR4:=EMA(CLOSE,9);\nLUP:EMA(VAR4*1.14,5);\nLDN:EMA(VAR4*0.86,5);"};return t},P.prototype.XS2=function(){var t={Name:"XS2",Description:"薛斯通道II",IsMainIndex:!0,Args:[{Name:"N",Value:102},{Name:"M",Value:7}],Script:"AA:=MA((2*CLOSE+HIGH+LOW)/4,5); \n通道1:AA*N/100; \n通道2:AA*(200-N)/100; \nCC:=ABS((2*CLOSE+HIGH+LOW)/4-MA(CLOSE,20))/MA(CLOSE,20); \nDD:=DMA(CLOSE,CC); \n通道3:(1+M/100)*DD; \n通道4:(1-M/100)*DD;"};return t},P.prototype.SG_XDT=function(){var t={Name:"SG-XDT",Description:"心电图(需下载日线)",IsMainIndex:!1,Args:[{Name:"P1",Value:5},{Name:"P2",Value:10}],Script:"QR:CLOSE/INDEXC*1000;\nMQR1:MA(QR,5);\nMQR2:MA(QR,10);"};return t},P.prototype.SG_SMX=function(){var t={Name:"SG-SMX",Description:"生命线(需下载日线)",IsMainIndex:!1,Args:[{Name:"N",Value:50}],Script:"H1:=HHV(HIGH,N);\nL1:=LLV(LOW,N);\nH2:=HHV(INDEXH,N);\nL2:=LLV(INDEXL,N);\nZY:=CLOSE/INDEXC*2000;\nZY1:EMA(ZY,3);\nZY2:EMA(ZY,17);\nZY3:EMA(ZY,34);"};return t},P.prototype.SG_LB=function(){var t={Name:"SG-LB",Description:"量比(需下载日线)",IsMainIndex:!1,Args:[],Script:"ZY2:=VOL/INDEXV*1000;\n量比:ZY2;\nMA5:MA(ZY2,5);\nMA10:MA(ZY2,10);"};return t},P.prototype.SG_PF=function(){var t={Name:"SG-PF",Description:"强势股评分(需下载日线)",IsMainIndex:!1,Args:[],Script:"ZY1:=CLOSE/INDEXC*1000;\nA1:=IF(ZY1>HHV(ZY1,3),10,0);\nA2:=IF(ZY1>HHV(ZY1,5),15,0);\nA3:=IF(ZY1>HHV(ZY1,10),20,0);\nA4:=IF(ZY1>HHV(ZY1,2),10,0);\nA5:=COUNT(ZY1>REF(ZY1,1) ,9)*5;\n强势股评分:A1+A2+A3+A4+A5;"};return t},P.prototype.RAD=function(){var t={Name:"RAD",Description:"威力雷达(需下载日线)",IsMainIndex:!1,Args:[{Name:"D",Value:3},{Name:"S",Value:30},{Name:"M",Value:30}],Script:"SM:=(OPEN+HIGH+CLOSE+LOW)/4;\nSMID:=MA(SM,D);\nIM:=(INDEXO+INDEXH+INDEXL+INDEXC)/4;\nIMID:=MA(IM,D);\nSI1:=(SMID-REF(SMID,1))/SMID;\nII:=(IMID-REF(IMID,1))/IMID;\nRADER1:SUM((SI1-II)*2,S)*1000;\nRADERMA:SMA(RADER1,M,1);"};return t},P.prototype.SHT=function(){var t={Name:"SHT",Description:"龙系短线",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:"VAR1:=MA((VOL-REF(VOL,1))/REF(VOL,1),5);\nVAR2:=(CLOSE-MA(CLOSE,24))/MA(CLOSE,24)*100;\nMY: VAR2*(1+VAR1);\nSHT: MY, COLORSTICK;\nSHTMA: MA(SHT,N);"};return t},P.prototype.ZLJC=function(){var t={Name:"ZLJC",Description:"主力进出",IsMainIndex:!1,Args:[],Script:"VAR1:=(CLOSE+LOW+HIGH)/3; \nVAR2:=SUM(((VAR1-REF(LOW,1))-(HIGH-VAR1))*VOL/100000/(HIGH-LOW),0); \nVAR3:=EMA(VAR2,1); \nJCS:VAR3; \nJCM:MA(VAR3,12); \nJCL:MA(VAR3,26);"};return t},P.prototype.ZLMM=function(){var t={Name:"ZLMM",Description:"主力买卖",IsMainIndex:!1,Args:[],Script:"LC :=REF(CLOSE,1);\nRSI2:=SMA(MAX(CLOSE-LC,0),12,1)/SMA(ABS(CLOSE-LC),12,1)*100;\nRSI3:=SMA(MAX(CLOSE-LC,0),18,1)/SMA(ABS(CLOSE-LC),18,1)*100;\nMMS:MA(3*RSI2-2*SMA(MAX(CLOSE-LC,0),16,1)/SMA(ABS(CLOSE-LC),16,1)*100,3);\nMMM:EMA(MMS,8);\nMML:MA(3*RSI3-2*SMA(MAX(CLOSE-LC,0),12,1)/SMA(ABS(CLOSE-LC),12,1)*100,5);"};return t},P.prototype.SLZT=function(){var t={Name:"SLZT",Description:"神龙在天",IsMainIndex:!1,Args:[],Script:"白龙: MA(CLOSE,125);\n黄龙: 白龙+2*STD(CLOSE,170);\n紫龙: 白龙-2*STD(CLOSE,145);\n青龙: SAR(125,1,7), LINESTICK;\nVAR2:=HHV(HIGH,70);\nVAR3:=HHV(HIGH,20);\n红龙: VAR2*0.83;\n蓝龙: VAR3*0.91;"};return t},P.prototype.ADVOL=function(){var t={Name:"ADVOL",Description:"龙系离散量",IsMainIndex:!1,Args:[],Script:"A:=SUM(((CLOSE-LOW)-(HIGH-CLOSE))*VOL/10000/(HIGH-LOW),0);\nADVOL:A;\nMA1:MA(A,30);\nMA2:MA(MA1,100);"};return t},P.prototype.CYC=function(){var t={Name:"CYC",Description:"成本均线",IsMainIndex:!0,Args:[{Name:"P1",Value:5},{Name:"P2",Value:13},{Name:"P3",Value:34}],Script:"JJJ:=IF(DYNAINFO(8)>0.01,0.01*DYNAINFO(10)/DYNAINFO(8),DYNAINFO(3));\nDDD:=(DYNAINFO(5)<0.01 || DYNAINFO(6)<0.01);\nJJJT:=IF(DDD,1,(JJJ<(DYNAINFO(5)+0.01) && JJJ>(DYNAINFO(6)-0.01)));\nCYC1:IF(JJJT,0.01*EMA(AMOUNT,P1)/EMA(VOL,P1),EMA((HIGH+LOW+CLOSE)/3,P1));\nCYC2:IF(JJJT,0.01*EMA(AMOUNT,P2)/EMA(VOL,P2),EMA((HIGH+LOW+CLOSE)/3,P2));\nCYC3:IF(JJJT,0.01*EMA(AMOUNT,P3)/EMA(VOL,P3),EMA((HIGH+LOW+CLOSE)/3,P3));\nCYC4:IF(JJJT,DMA(AMOUNT/(100*VOL),100*VOL/FINANCE(7)),EMA((HIGH+LOW+CLOSE)/3,120));"};return t},P.prototype.CYS=function(){var t={Name:"CYS",Description:"市场盈亏",IsMainIndex:!1,Args:[],Script:"CYC13:EMA(AMOUNT,13)/EMA(VOL,13);\nCYS:(CLOSE-CYC13)/CYC13*100;"};return t},P.prototype.CYQKL=function(){var t={Name:"CYQKL",Description:"博弈K线长度",IsMainIndex:!1,Args:[],Script:"KL:100*(WINNER(CLOSE)-WINNER(OPEN));"};return t},P.prototype.SCR=function(){var t={Name:"SCR",Description:"筹码集中度",IsMainIndex:!1,Args:[{Name:"P1",Value:90}],Script:"A:=P1+(100-P1)/2;\nB:=(100-P1)/2;\nCC:=COST(A);\nDD:=COST(B);\nSCR:(CC-DD)/(CC+DD)*100/2;"};return t},P.prototype.ASR=function(){var t={Name:"ASR",Description:"浮筹比例",IsMainIndex:!1,Args:[],Script:"ASR:(WINNER(C*1.1)-WINNER(C*0.9))/WINNER(HHV(H,0))*100;"};return t},P.prototype.SAR=function(){var t={Name:"SAR",Description:"抛物转向",IsMainIndex:!0,Args:[{Name:"P",Value:10},{Name:"STEP",Value:2},{Name:"MAXP",Value:20}],Script:"S:SAR(P,STEP,MAXP),CIRCLEDOT;"};return t},P.prototype.TJCJL=function(){var t={Name:"太极成交量",Description:"太极成交量",IsMainIndex:!0,Args:[],Script:"总手:VOL,NODRAW;\nZZ:=IF(REF(C,1)>REF(O,1) AND O>REF(C,1)*1.014 AND C<O*1.02,1,3);\nV5:=MA(V,5);\nV12:=MA(V,12);\nV34:=MA(V,34);\nC6:=MA(C,6);\nSTICKLINE(VOL,0,VOL,10,0),COLORLIGRAY;\nSTICKLINE(CROSS(C,C6) AND V>V5*1.2 AND V>V12*1.2 AND ZZ>2 AND C>H*0.975,0,VOL,10,0),COLORRED;\nSTICKLINE(CROSS(C6,C) AND V>V5*1.2 AND V>V12*1.2,0,VOL,10,0),COLORGREEN;\nSTICKLINE(VOL>MA(VOL,5)*2 AND V>V34*3 AND C<REF(C,1)*1.05,0,VOL,10,0),COLORYELLOW;\nSTICKLINE(VOL<MA(VOL,5)/2 AND V<V12/2,0,VOL,10,0),COLORBLUE;\nSTICKLINE(VOL>MA(VOL,5)*2 AND V>V34*3 AND C<REF(C,1)*1.05 AND CROSS(C,C6) AND V>V5*1.2 AND V>V12*1.2 AND ZZ>2 AND C>H*0.975,VOL*0.5,0,10,0),COLORRED;\nSTICKLINE(VOL>MA(VOL,5)*2 AND V>V34*3 AND C<REF(C,1)*1.05 AND CROSS(C6,C) AND V>V5*1.2 AND V>V12*1.2,VOL*0.5,0,10,0),COLORRED;"};return t},P.prototype.Dragon4_Main=function(){var t={Name:"飞龙四式",Description:"飞龙四式",IsMainIndex:!0,Args:[{Name:"N1",Value:5},{Name:"N2",Value:10},{Name:"N3",Value:50},{Name:"N4",Value:60}],Script:"蜻蜓点水:=EMA(CLOSE,N1),COLORGRAY;\n魔界:=EMA(CLOSE,N2),COLORGREEN;\n水:=EMA(CLOSE,N3),COLORRED;\nDRAWKLINE(HIGH,OPEN,LOW,CLOSE);\n生命线:MA(CLOSE,N4),COLORBLUE,LINETHICK2;\nDRAWBAND(魔界,'RGB(186,225,250)',水,'RGB(253,194,124)');\nDRAWBAND(蜻蜓点水,'RGB(128,138,135)',魔界,'RGB(0,0,255)');"};return t},P.prototype.Dragon4_Fig=function(){var t={Name:"飞龙四式",Description:"飞龙四式",IsMainIndex:!1,Args:[],Script:"倍:VOL>=REF(V,1)*1.90 AND C>REF(C,1),COLORYELLOW;\n低:VOL<REF(LLV(VOL,13),1),COLORGREEN;\n地:VOL<REF(LLV(VOL,100),1),COLORMAGENTA; \n平:=ABS(VOL-HHV(REF(VOL,1),5))/HHV(REF(VOL,1),5)<=0.03 OR ABS(VOL-REF(VOL,1))/REF(VOL,1)<=0.03,NODRAW,COLORWHITE;\n倍缩:VOL<=REF(V,1)*0.5,COLORFF8000;\n梯量:COUNT(V>REF(V,1),3)==3 AND COUNT(C>O,3)==3,COLORBROWN;\n缩量涨:COUNT(C>REF(C,1),2)==2 AND COUNT(V<REF(V,1),2)==2,COLORBLUE;\nSTICKLINE(C>=REF(C,1),V,0,2,0),COLORRED;\nSTICKLINE(C<REF(C,1),V,0,2,0),COLORGREEN;\nSTICKLINE(倍,0,V,2,0),COLORYELLOW;\nSTICKLINE(低,0,V,2,0),COLORGREEN;\nSTICKLINE(地,0,V,2,0),COLORLIMAGENTA;\nSTICKLINE(平,0,V,2,0),COLORGRAY;\nSTICKLINE(倍缩,0,V,2,0),COLORFF8000;\nSTICKLINE(梯量,0,V,2,0),COLORBROWN;\nSTICKLINE(缩量涨,0,V,2,0),COLORBLUE;"};return t},P.prototype.FundsAnalysis=function(){var t={Name:"资金分析",Description:"资金分析",IsMainIndex:!1,Args:[{Name:"M",Value:55},{Name:"N",Value:34}],Script:"LC:=REF(CLOSE,1);\nRSI:=((SMA(MAX((CLOSE - LC),0),3,1) / SMA(ABS((CLOSE - LC)),3,1)) * 100);\nFF:=EMA(CLOSE,3);\nMA15:=EMA(CLOSE,21); DRAWTEXT(CROSS(85,RSI),75,'▼'),COLORGREEN;\nVAR1:=IF(YEAR>=2038 AND MONTH>=1,0,1);\nVAR2:=REF(LOW,1)*VAR1;\nVAR3:=SMA(ABS(LOW-VAR2),3,1)/SMA(MAX(LOW-VAR2,0),3,1)*100*VAR1;\nVAR4:=EMA(IF(CLOSE*1.3,VAR3*10,VAR3/10),3)*VAR1;\nVAR5:=LLV(LOW,30)*VAR1;\nVAR6:=HHV(VAR4,30)*VAR1;\nVAR7:=IF(MA(CLOSE,58),1,0)*VAR1;\nVAR8:=EMA(IF(LOW<=VAR5,(VAR4+VAR6*2)/2,0),3)/618*VAR7*VAR1;\n吸筹A:IF(VAR8>100,100,VAR8)*VAR1,COLORFB2F3B;\n{吸筹B}STICKLINE(吸筹A>-150,0,吸筹A,8,0),COLORFB2F3B;\n\n散户线: 100*(HHV(HIGH,M)-CLOSE)/(HHV(HIGH,M)-LLV(LOW,M)),COLORAA89BD,LINETHICK2;\nRSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;\nK:=SMA(RSV,3,1);\nD:=SMA(K,3,1);\nJ:=3*K-2*D;\n主力线:EMA(J,5),COLORF39800,LINETHICK2;\nDRAWICON(CROSS(主力线,散户线),主力线,1);\nDRAWICON(CROSS(散户线,主力线),主力线,2);"};return t},P.prototype.MarginProportion=function(){var t={Name:"融资占比(%)",Description:"融资占比",IsMainIndex:!1,Condition:{Period:[N.KLINE_DAY_ID]},Args:[],Script:"占比:MARGIN(2);"};return t},P.prototype.Margin2=function(){var t={Name:"两融余额",Description:"融资融券余额",IsMainIndex:!1,Condition:{Period:[N.KLINE_DAY_ID]},Args:[{Name:"N",Value:5}],Script:"T1:MARGIN(1);\n        T2:MA(MARGIN(1),N);"};return t},P.prototype.Margin3=function(){var t={Name:"两融余额",Description:"融资融券余额",IsMainIndex:!1,Condition:{Period:[N.KLINE_DAY_ID]},Args:[{Name:"N",Value:5}],Script:"T1:=MARGIN(1);\n        T2:=MA(MARGIN(1),N);\n        STICKLINE(T1-T2>=0,0,T1-T2,50,T1>T2),COLORRED;\n        STICKLINE(T1-T2<0,T1-T2,0,50,T1>T2),COLORGREEN;"};return t},P.prototype.FXG_BSPoint=function(){var t={Name:"操盘BS点",Description:"操盘BS点",IsMainIndex:!0,Args:[],Script:"MA5:MA(CLOSE,5);\n        MA13:MA(CLOSE,13);\n        MA21:MA(CLOSE,21);\n        MA34:MA(CLOSE,34);\n        {MA55:MA(CLOSE,55),COLOR0000FF;}\n        {MA120:=MA(CLOSE,120),COLORFFFF00;}\n        天使:=EMA(C,2),COLOR000000;\n        魔鬼:=EMA(SLOPE(C,21)*20+C,42),COLOR000000;\n        买:=CROSS(天使,魔鬼);\n        卖:=CROSS(魔鬼,天使);\n        DRAWICON(买,L*0.97,13);\n        DRAWICON(卖,H*1.03,14);\n        DRAWKLINE_IF(天使>=魔鬼,HIGH,CLOSE,LOW,OPEN),COLORRED;\n        DRAWKLINE_IF(天使<魔鬼,HIGH,CLOSE,LOW,OPEN),COLORBLUE;\n        DRAWKLINE_IF(CROSS(天使,魔鬼),HIGH,CLOSE,LOW,OPEN),COLORYELLOW;\n        DRAWKLINE_IF(CROSS(魔鬼,天使),HIGH,CLOSE,LOW,OPEN),COLORBLACK;"};return t},P.prototype.FXG_INDEX=function(){var t={Name:"涨停多空线",Description:"涨停多空线",IsMainIndex:!1,Args:[],Script:"做多能量线: SMA((CLOSE-LLV(LOW,9))/(HHV(HIGH,9)-LLV(LOW,9))*100,5,1)-8,COLORRED,LINETHICK3;\n做空能量线: SMA((HHV(HIGH,36)-CLOSE)/(HHV(HIGH,36)-LLV(LOW,36))*100,2,1),COLORGREEN,LINETHICK3;\n20,POINTDOT,COLORF00FF0;\n50,POINTDOT,COLORGREEN;\n80,POINTDOT,COLORLIBLUE;"};return t},P.prototype.FXG_INDEX2=function(){var t={Name:"涨停吸筹区",Description:"涨停吸筹区",IsMainIndex:!1,Args:[],Script:"VAR0:=EMA(HHV(HIGH,500),21); \nVAR1:=EMA(HHV(HIGH,250),21);\nVAR2:=EMA(HHV(HIGH,90),21); \nVAR3:=EMA(LLV(LOW,500),21); \nVAR4:=EMA(LLV(LOW,250),21); \nVAR5:=EMA(LLV(LOW,90),21);\n\nVAR6:=EMA((VAR3*0.96+VAR4*0.96+VAR5*0.96+VAR0*0.558+VAR1*0.558+VAR2*0.558)/6,21); \nVAR7:=EMA((VAR3*1.25+VAR4*1.23+VAR5*1.2+VAR0*0.55+VAR1*0.55+VAR2*0.65)/6,21); \nVAR8:=EMA((VAR3*1.3+VAR4*1.3+VAR5*1.3+VAR0*0.68+VAR1*0.68+VAR2*0.68)/6,21); \nVAR9:=EMA((VAR6*3+VAR7*2+VAR8)/6*1.738,21); \nVAR10:=REF(LOW,1); \nVAR11:=SMA(ABS(LOW-VAR10),3,1)/SMA(MAX(LOW-VAR10,0),3,1)*100; \nVAR12:=EMA(IFF(CLOSE*1.35<=VAR9,VAR11*10,VAR11/10),3); \nVAR13:=LLV(LOW,30); \nVAR14:=HHV(VAR12,30); \nVAR15:=IFF(MA(CLOSE,58),1,0); \nVAR16:=EMA(IFF(LOW<=VAR13,(VAR12+VAR14*2)/2,0),3)/618*VAR15;\n\n资金入场:IFF(VAR16>0,VAR16,0),LINETHICK,LINETHICK2, COLORFF0000; \n\nA1:IFF(资金入场>0,资金入场*1.2,0),STICK,LINETHICK5, COLORFF0000;\nA2:IFF(资金入场>0,资金入场*0.8,0),STICK,LINETHICK5, COLORFF6600;\nA3:IFF(资金入场>0,资金入场*0.6,0),STICK,LINETHICK5, COLORFF9900;\nA4:IFF(资金入场>0,资金入场*0.4,0) ,STICK,LINETHICK5,COLORFFCC00;\nA5:IFF(资金入场>0,资金入场*0.2,0) ,STICK,LINETHICK5,COLORFFFF00;"};return t},P.prototype.FXG_INDEX3=function(){var t={Name:"量能黄金点",Description:"量能黄金点",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"A:=IFF((CLOSE>126.32),VOL,VOL); \n主力:=MA(A,4),COLORRED;\n游资:=MA(A,8),COLORYELLOW;\n大户:=MA(A,16),COLORF0F000;\n散户:=MA(A,32),COLOR00FF00;\n主比:=ABS(((主力)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLORRED;\n游比:=ABS(((游资)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLORYELLOW;\n大比:=ABS(((大户)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLORF0F000;\n散比:=ABS(((散户)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLOR00FF00;\n警戒线:MA(A,180),COLORFF66FF;\nSTICKLINE((主力 > 0),0,主力,2.5,0),COLOR1020BB;\nSTICKLINE((主力 > 0),0,主力,0.7,0),COLORRED;\nSTICKLINE((游资 > 0),0,游资,2.5,0),COLOR009CFF;\nSTICKLINE((游资 > 0),0,游资,0.7,0),COLORYELLOW;\nSTICKLINE((大户 > 0),0,大户,2.5,0),COLORFF8800;\nSTICKLINE((大户 > 0),0,大户,0.7,0),COLORLIBLUE;\nSTICKLINE((散户 > 0),0,散户,2.5,0),COLOR00CA00;\nSTICKLINE((散户 > 0),0,散户,0.7,0),COLORGREEN;"};return t},P.prototype.NewsNegative=function(){var t={Name:"负面新闻",Description:"负面新闻统计",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"N",Value:5},{Name:"N2",Value:10}],Script:"负面:NEWS(1);\nMA1:MA(负面,N);\nMA2:MA(负面,N2);"};return t},P.prototype.UpDownAnalyze=function(){var t={Name:"涨跌趋势",Description:"涨跌趋势",IsMainIndex:!1,FloatPrecision:0,Condition:{Period:[N.MINUTE_ID,N.MULTIDAY_MINUTE_ID,N.KLINE_DAY_ID]},Args:[],Script:"上涨家数:UPCOUNT('CNA.CI'),COLORRED;\n下跌家数:DOWNCOUNT('CNA.CI'),COLORGREEN;"};return t},P.prototype.HK2SHSZ=function(){var t={Name:"北上资金",Description:"北上资金",IsMainIndex:!1,FloatPrecision:0,Condition:{Period:[N.MINUTE_ID,N.MULTIDAY_MINUTE_ID,N.KLINE_DAY_ID]},Args:[],Script:"净流入:HK2SHSZ(1),COLORSTICK;"};return t},P.prototype.ShareHolder=function(){var t={Name:"股东人数",Description:"股东人数",IsMainIndex:!1,FloatPrecision:0,Condition:{Period:[N.KLINE_DAY_ID,N.KLINE_MONTH_ID,N.KLINE_WEEK_ID,N.KLINE_YEAR_ID]},Args:[],Script:"人数:FINANCE(100);"};return t},P.prototype.VOLRate=function(){var t={Name:"量比",Description:"量比",IsMainIndex:!1,Condition:{Period:[N.MINUTE_ID,N.MULTIDAY_MINUTE_ID]},Args:[],Script:"LIANGBI:VOLR;"};return t},P.prototype.COLOR_KSTAR1=function(){var t={Name:"十字星",Description:"十字星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:CLOSE==OPEN&&HIGH>LOW;"};return t},P.prototype.COLOR_KSTAR2=function(){var t={Name:"早晨之星",Description:"早晨之星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:(REF(CLOSE,2)/REF(OPEN,2)<0.95) && (REF(OPEN,1) < REF(CLOSE,2)) && (ABS(REF(OPEN,1)-REF(CLOSE,1))/REF(CLOSE,1)<0.03) && CLOSE/OPEN>1.05 && CLOSE>REF(CLOSE,2);"};return t},P.prototype.COLOR_KSTAR3=function(){var t={Name:"黄昏之星",Description:"黄昏之星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:REF(CLOSE,2)/REF(OPEN,2)>1.05 && REF(OPEN,1)>REF(CLOSE,2) && ABS(REF(OPEN,1)-REF(CLOSE,1))/REF(CLOSE,1)<0.03 && CLOSE/OPEN<0.95 && CLOSE<REF(CLOSE,2);"};return t},P.prototype.COLOR_SHI1=function(){var t={Name:"长十字",Description:"长十字",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:CLOSE==OPEN&&HIGH/LOW>1.03;"};return t},P.prototype.COLOR_K220=function(){var t={Name:"身怀六甲",Description:"身怀六甲",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:ABS(REF(CLOSE,1)-REF(OPEN,1))/REF(CLOSE,1)>0.04&&\n            ABS(CLOSE-OPEN)/CLOSE<0.005&&\n            MAX(CLOSE,OPEN)<MAX(REF(CLOSE,1),REF(OPEN,1))&&\n            MIN(CLOSE,OPEN)>MIN(REF(CLOSE,1),REF(OPEN,1));"};return t},P.prototype.COLOR_K300=function(){var t={Name:"三个白武士",Description:"三个白武士",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:UPNDAY(CLOSE,3)&&NDAY(CLOSE,OPEN,3);"};return t},P.prototype.COLOR_K310=function(){var t={Name:"三只乌鸦",Description:"三只乌鸦",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:DOWNNDAY(CLOSE,3)&&NDAY(OPEN,CLOSE,3);"};return t},P.prototype.COLOR_K380=function(){var t={Name:"光头阳线",Description:"光头阳线",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:HIGH==CLOSE&&HIGH>LOW;"};return t},P.prototype.COLOR_K390=function(){var t={Name:"光脚阴线",Description:"光脚阴线",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:LOW==CLOSE&&HIGH>LOW;"};return t},P.prototype.COLOR_K134=function(){var t={Name:"垂死十字",Description:"垂死十字",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:CLOSE==OPEN&&CLOSE==LOW&&CLOSE<HIGH;"};return t},P.prototype.COLOR_K140=function(){var t={Name:"早晨十字星",Description:"早晨十字星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:REF(CLOSE,2)/REF(OPEN,2)<0.95&&\nREF(OPEN,1)<REF(CLOSE,2)&&\nREF(OPEN,1)==REF(CLOSE,1)&&\nCLOSE/OPEN>1.05&&CLOSE>REF(CLOSE,2);"};return t},P.prototype.COLOR_K150=function(){var t={Name:"黄昏十字星",Description:"黄昏十字星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:REF(CLOSE,2)/REF(OPEN,2)>1.05&&\nREF(OPEN,1)>REF(CLOSE,2)&&\nREF(OPEN,1)=REF(CLOSE,1)&&\nCLOSE/OPEN<0.95&&CLOSE<REF(CLOSE,2);"};return t},P.prototype.COLOR_K160=function(){var t={Name:"射击之星",Description:"射击之星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:MIN(OPEN,CLOSE)==LOW&&\nHIGH-LOW>3*(MAX(OPEN,CLOSE)-LOW)&&\nCLOSE>MA(CLOSE,5);"};return t},P.prototype.COLOR_K165=function(){var t={Name:"倒转锤头",Description:"倒转锤头",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:MIN(OPEN,CLOSE)==LOW&&\nHIGH-LOW>3*(MAX(OPEN,CLOSE)-LOW)&&\nCLOSE<MA(CLOSE,5);"};return t},P.prototype.COLOR_K170=function(){var t={Name:"锤头",Description:"锤头",IsMainIndex:!0,InstructionType:2,Script:"OUT:HIGH==MAX(OPEN,CLOSE)&&\nHIGH-LOW>3*(HIGH-MIN(OPEN,CLOSE))&&\nCLOSE<MA(CLOSE,5);"};return t},P.prototype.COLOR_K180=function(){var t={Name:"吊颈",Description:"吊颈",IsMainIndex:!0,InstructionType:2,Script:"OUT:HIGH==MAX(OPEN,CLOSE)&&\nHIGH-LOW>3*(HIGH-MIN(OPEN,CLOSE))&&\nCLOSE>MA(CLOSE,5);"};return t},P.prototype.COLOR_K190=function(){var t={Name:"穿头破脚",Description:"穿头破脚",IsMainIndex:!0,InstructionType:2,Script:"OUT:(REF(CLOSE,1)/REF(OPEN,1)>1.03&&\nCLOSE/OPEN<0.96&&\nCLOSE<REF(OPEN,1)&&OPEN>REF(CLOSE,1))||\n(REF(CLOSE,1)/REF(OPEN,1)<0.97&&\nCLOSE/OPEN>1.04&&\nCLOSE>REF(OPEN,1)&&OPEN<REF(CLOSE,1));"};return t},P.prototype.COLOR_SWORD=function(){var t={Name:"剑",Description:"剑",IsMainIndex:!0,InstructionType:2,Script:"AA:=VOL>REF(VOL,1)||VOL>(CAPITAL*0.1);\nBB:=OPEN>=(REF(HIGH,1))&&REF(HIGH,1)>(REF(HIGH,2)*1.06);\nCC:=CLOSE>(REF(CLOSE,1))-(REF(CLOSE,1)*0.01);\nDD:=CLOSE<(HIGH*0.965) && HIGH>(OPEN*1.05);\nEE:=LOW<OPEN && LOW<CLOSE&&HIGH>(REF(CLOSE,1)*1.06);\nFF:=(HIGH-(MAX(OPEN,CLOSE)))/2>(MIN(OPEN,CLOSE))-LOW;\nGG:=(ABS(OPEN-CLOSE))/2<(MIN(OPEN,CLOSE)-LOW);\nSWORDO:AA&&BB&&CC&&DD&&EE&&FF&&GG;"};return t},P.prototype.COLOR_CSFR=function(){var t={Name:"出水芙蓉",Description:"出水芙蓉",IsMainIndex:!0,InstructionType:2,Script:"A:=CLOSE>OPEN;\nB:=A&&CLOSE>MA(CLOSE,S)&&CLOSE>MA(CLOSE,M)&&CLOSE>MA(CLOSE,LL);\nCC:=B&&OPEN<MA(CLOSE,M)&&OPEN<MA(CLOSE,LL);\nCSFRO:CC&&(CLOSE-OPEN)>0.0618*CLOSE;"};return t},P.prototype.COLOR_WYGD=function(){var t={Name:"乌云盖顶",Description:"乌云盖顶",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( \nREF(CLOSE,1)/REF(OPEN,1)>1.03 AND \nCLOSE/OPEN<0.97 AND \nOPEN>REF(CLOSE,1) AND CLOSE<REF(CLOSE,1), 3);"};return t},P.prototype.COLOR_SGCJ=function(){var t={Name:"曙光初现",Description:"曙光初现",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( \nREF(CLOSE,1)/REF(OPEN,1)<0.97 AND \nCLOSE/OPEN>1.03 AND \nOPEN<REF(CLOSE,1) AND CLOSE>REF(CLOSE,1), 3);"};return t},P.prototype.COLOR_SZTAI=function(){var t={Name:"十字胎",Description:"十字胎",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( ABS(REF(CLOSE,1)-REF(OPEN,1))/REF(CLOSE,1) > 0.04 AND \nCLOSE==OPEN AND CLOSE < MAX(REF(CLOSE,1),REF(OPEN,1)) AND \nCLOSE > MIN(REF(CLOSE,1),REF(OPEN,1)), 2);"};return t},P.prototype.COLOR_PINGDING=function(){var t={Name:"平顶",Description:"平顶",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET(ABS(HIGH-REF(HIGH,1))/HIGH<0.001,2);"};return t},P.prototype.COLOR_PINGDI=function(){var t={Name:"平底",Description:"平底",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET((ABS(LOW-REF(LOW,1))/LOW<0.001 AND \nABS(REF(LOW,1)-REF(LOW,2))/REF(LOW,1)<=0.001),2);"};return t},P.prototype.COLOR_DAYANZHU=function(){var t={Name:"大阳烛",Description:"大阳烛",IsMainIndex:!0,InstructionType:2,Script:"VAR1:CLOSE/OPEN>1.05 AND HIGH/LOW < CLOSE/OPEN+0.018;"};return t},P.prototype.COLOR_DAYINGZHU=function(){var t={Name:"大阴烛",Description:"大阴烛",IsMainIndex:!0,InstructionType:2,Script:"VAR1:OPEN/CLOSE > 1.05 AND HIGH/LOW < OPEN/CLOSE+0.018;"};return t},P.prototype.COLOR_HYFG=function(){var t={Name:"好友反攻",Description:"好友反攻",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( (REF(CLOSE,1)<REF(OPEN,1) AND \nCLOSE>OPEN AND ABS(CLOSE-REF(CLOSE,1))/CLOSE<0.002),2);"};return t},P.prototype.COLOR_TKQK=function(){var t={Name:"跳空缺口",Description:"跳空缺口",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( HIGH<REF(LOW,1) OR LOW>REF(HIGH,1),2);"};return t},P.prototype.COLOR_SFWY=function(){var t={Name:"双飞乌鸦",Description:"双飞乌鸦",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( REF(CLOSE,1)<REF(OPEN,1) AND CLOSE<OPEN AND CLOSE/OPEN<0.98,1);"};return t},P.prototype.COLOR_SSSBQ=function(){var t={Name:"上升三部曲",Description:"上升三部曲",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( \nREF(CLOSE,4)/REF(OPEN,4)>1.03 AND \nREF(CLOSE,3)<REF(OPEN,3) AND \nREF(CLOSE,2)<REF(OPEN,2) AND \nREF(CLOSE,1)<REF(OPEN,1) AND \nREF(LOW,4)<REF(LOW,3) AND \nREF(LOW,4)<REF(LOW,2) AND \nREF(LOW,4)<REF(LOW,1) AND \nREF(HIGH,4)>REF(HIGH,3) AND \nREF(HIGH,4)>REF(HIGH,2) AND \nREF(HIGH,4)>REF(HIGH,1) AND \nCLOSE/OPEN>1.03 AND \nCLOSE>REF(CLOSE,4), 5);"};return t},P.prototype.COLOR_XDSBQ=function(){var t={Name:"下跌三部曲",Description:"下跌三部曲",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( \nREF(CLOSE,4)/REF(OPEN,4)<0.97 AND \nREF(CLOSE,3)>REF(OPEN,3) AND \nREF(CLOSE,2)>REF(OPEN,2) AND \nREF(CLOSE,1)>REF(OPEN,1) AND \nREF(LOW,4)<REF(LOW,3) AND \nREF(LOW,4)<REF(LOW,2) AND \nREF(LOW,4)<REF(LOW,1) AND \nREF(HIGH,4)>REF(HIGH,3) AND \nREF(HIGH,4)>REF(HIGH,2) AND \nREF(HIGH,4)>REF(HIGH,1) AND \nCLOSE/OPEN<0.97 AND \nCLOSE<REF(CLOSE,4), 5);"};return t},P.prototype.COLOR_CHXY=function(){var t={Name:"长下影",Description:"长下影",IsMainIndex:!0,InstructionType:2,Script:"VAR2:(MIN(CLOSE,OPEN)-LOW)/(HIGH-LOW)>0.667;"};return t},P.prototype.COLOR_CHSY=function(){var t={Name:"长上影",Description:"长上影",IsMainIndex:!0,InstructionType:2,Script:"VAR2:(HIGH-MAX(CLOSE,OPEN))/(HIGH-LOW)>0.667,COLORBLUE;"};return t},P.prototype.COLOR_FENLI=function(){var t={Name:"分离",Description:"分离",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( OPEN==REF(OPEN,1) AND (CLOSE-OPEN)*(REF(CLOSE,1)-REF(OPEN,1))<0,2);"};return t},P.prototype.TRADE_BIAS=function(){var t={Name:"BIAS",Description:"乖离率专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:12},{Name:"LL",Value:6},{Name:"LH",Value:6}],Script:"BIAS:=(CLOSE-MA(CLOSE,N))/MA(CLOSE,N)*100;\nENTERLONG:CROSS(-LL,BIAS);\nEXITLONG:CROSS(BIAS,LH);"};return t},P.prototype.TRADE_CCI=function(){var t={Name:"CCI",Description:"CCI专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:14}],Script:"TYP:=(HIGH+LOW+CLOSE)/3;\nCCI:=(TYP-MA(TYP,N))/(0.015*AVEDEV(TYP,N));\nINDEX:=CCI;\nENTERLONG:CROSS(INDEX,-100);\nEXITLONG:CROSS(100,INDEX);"};return t},P.prototype.TRADE_DMI=function(){var t={Name:"DMI",Description:"趋向专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:14}],Script:"MTR:=SUM(MAX(MAX(HIGH-LOW,ABS(HIGH-REF(CLOSE,1))),ABS(LOW-REF(CLOSE,1))),N);\nHD :=HIGH-REF(HIGH,1);\nLD :=REF(LOW,1)-LOW;\nPDM:=SUM(IF(HD>0&&HD>LD,HD,0),N);\nMDM:=SUM(IF(LD>0&&LD>HD,LD,0),N);\nPDI:=PDM*100/MTR;\nMDI:=MDM*100/MTR;\nENTERLONG:CROSS(PDI,MDI);\nEXITLONG:CROSS(MDI,PDI);"};return t},P.prototype.TRADE_KD=function(){var t={Name:"KD",Description:"KD指标专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:"WRSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;\nWK:=SMA(WRSV,M1,1);\nD:=SMA(WK,M2,1);\nENTERLONG:CROSS(WK,D)&&WK<20;\nEXITLONG:CROSS(D,WK)&&WK>80;"};return t},P.prototype.TRADE_BOLL=function(){var t={Name:"BOLL",Description:"布林带专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:20}],Script:"MID :=MA(CLOSE,N);\nUPPER:=MID+2*STD(CLOSE,N);\nLOWER:=MID-2*STD(CLOSE,N);\nENTERLONG:CROSS(CLOSE,LOWER);\nEXITLONG:CROSS(CLOSE,UPPER);"};return t},P.prototype.TRADE_KDJ=function(){var t={Name:"KDJ",Description:"KDJ专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3}],Script:"RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;\nK:=SMA(RSV,M1,1);\nD:=SMA(K,M1,1);\nJ:=3*K-2*D;\nENTERLONG:CROSS(J,0);\nEXITLONG:CROSS(100,J);"};return t},P.prototype.TRADE_MA=function(){var t={Name:"MA",Description:"均线专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"SHORT",Value:5},{Name:"LONG",Value:20}],Script:"ENTERLONG:CROSS(MA(CLOSE,SHORT),MA(CLOSE,LONG));\nEXITLONG:CROSS(MA(CLOSE,LONG),MA(CLOSE,SHORT));"};return t},P.prototype.TRADE_MACD=function(){var t={Name:"MACD",Description:"MACD专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"LONG",Value:26},{Name:"SHORT",Value:12},{Name:"M",Value:9}],Script:"DIFF:=EMA(CLOSE,SHORT) - EMA(CLOSE,LONG);\nDEA  := EMA(DIFF,M);\nMACD := 2*(DIFF-DEA);\nENTERLONG:CROSS(MACD,0);\nEXITLONG:CROSS(0,MACD);"};return t},P.prototype.TRADE_MTM=function(){var t={Name:"MTM",Description:"动力指标专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:6}],Script:"WMTM:=C-REF(C,N);\nENTERLONG:CROSS(WMTM,0);\nEXITLONG:CROSS(0,WMTM);"};return t},P.prototype.TRADE_PSY=function(){var t={Name:"PSY",Description:"PSY心理线专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:12},{Name:"LL",Value:10},{Name:"LH",Value:85}],Script:"MYPSY:=COUNT(CLOSE>REF(CLOSE,1),N)/N*100;\nENTERLONG:CROSS(LL,MYPSY);\nEXITLONG:CROSS(MYPSY,LH);"};return t},P.prototype.TRADE_ROC=function(){var t={Name:"ROC",Description:"变动速率专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:"WROC:=MA(100*(CLOSE-REF(CLOSE,N))/REF(CLOSE,N),M);\nENTERLONG:CROSS(WROC,0);\nEXITLONG:CROSS(0,WROC);"};return t},P.prototype.TRADE_RSI=function(){var t={Name:"RSI",Description:"相对强弱专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:6},{Name:"LL",Value:20},{Name:"LH",Value:80}],Script:"LC:=REF(CLOSE,1);\nWRSI:=SMA(MAX(CLOSE-LC,0),N,1)/SMA(ABS(CLOSE-LC),N,1)*100;\nENTERLONG:CROSS(WRSI,LL);\nEXITLONG:CROSS(LH,WRSI);"};return t},P.prototype.TRADE_VR=function(){var t={Name:"VR",Description:"VR容量比率专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:26},{Name:"LL",Value:70},{Name:"LH",Value:250}],Script:"WVR := SUM((IF(CLOSE>OPEN,VOL,0)+IF(CLOSE=OPEN,VOL/2,0)),N)/SUM((IF(CLOSE<OPEN,VOL,0)+IF(CLOSE=OPEN,VOL/2,0)),N)*100;\nENTERLONG:CROSS(LL,WVR);\nEXITLONG:CROSS(WVR,LH);"};return t},P.prototype.TRADE_DPSJ=function(){var t={Name:"DPSJ",Description:"大盘随机专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N1",Value:18},{Name:"N2",Value:12}],Script:"RSV:=(INDEXC-LLV(INDEXL,N1))/(HHV(INDEXH,N1)-LLV(INDEXL,N1))*100;\nK:=SMA(RSV,N2,1);\nHSL:VOL/100/(FINANCE(7));\nENTERLONG: CROSS(K,20);\nEXITLONG: (CROSS(HSL,5) OR CROSS(K,80));"};return t},P.prototype.Zealink_Index1=function(){var t={Name:"资金吸筹",Description:"资金吸筹",IsMainIndex:!1,Args:[],Script:"VAR1:=REF((LOW+OPEN+CLOSE+HIGH)/4,1);  \nVAR2:= SMA(ABS(LOW - VAR1), 13, 1) / SMA(MAX(LOW - VAR1, 0), 10, 1);\nVAR3:= EMA(VAR2, 10);\nVAR4:= LLV(LOW, 33);\nVAR5:= EMA(IF(LOW <= VAR4, VAR3, 0), 3) * 0.2;\n主力进场: IF(VAR5 > REF(VAR5, 1), VAR5,0), COLORRED, NODRAW;\n洗盘: IF(VAR5 < REF(VAR5, 1),  VAR5,0), COLORYELLOW, NODRAW;\nSTICKLINE(VAR5> REF(VAR5, 1),0, VAR5, 20, 0), COLORRED;\nSTICKLINE(VAR5 < REF(VAR5, 1), 0, VAR5, 20, 0), COLORYELLOW;"};return t},P.prototype.Zealink_Index2=function(){var t={Name:"牛熊区间",Description:"牛熊区间",IsMainIndex:!1,YSpecificMaxMin:{Max:100,Min:1,Count:4},YSplitScale:[1,50,100],Args:[],Script:"短高H:=(20*H+19*REF(H,1)+18*REF(H,2)+17*REF(H,3)+16*REF(H,4)+15*REF(H,5)+14*REF(H,6)\n+ 13 * REF(H, 7) + 12 * REF(H, 8) + 11 * REF(H, 9) + 10 * REF(H, 10) + 9 * REF(H, 11) + 8 * REF(H, 12)\n+ 7 * REF(H, 13) + 6 * REF(H, 14) + 5 * REF(H, 15) + 4 * REF(H, 16) + 3 * REF(H, 17) + 2 * REF(H, 18) +\nREF(H, 20))/ 210, COLORBLUE, LINETHICK1;\n短低L:= (20 * L + 19 * REF(L, 1) + 18 * REF(L, 2) + 17 * REF(L, 3) + 16 * REF(L, 4) + 15 * REF(L, 5) + 14 * REF(L, 6)\n+ 13 * REF(L, 7) + 12 * REF(L, 8) + 11 * REF(L, 9) + 10 * REF(L, 10) + 9 * REF(L, 11) + 8 * REF(L, 12)\n+ 7 * REF(L, 13) + 6 * REF(L, 14) + 5 * REF(L, 15) + 4 * REF(L, 16) + 3 * REF(L, 17) + 2 * REF(L, 18) +\nREF(L, 20)) / 210, COLORBLUE, LINETHICK1;\nD90H:= EMA(短高H, 90), COLORRED, LINETHICK1;\nD90L:= EMA(短低L, 90), COLORRED, LINETHICK1;\nD90差:= D90H - D90L;\nD90顶:= D90H + D90差 * 2, COLORRED, LINETHICK1;\nD90底:= D90L - D90差 * 2, COLORRED, LINETHICK1;\n高0:= (EMA(EMA(H, 25), 25) - EMA(EMA(L, 25), 25)) * 1 + EMA(EMA(H, 25), 25), LINETHICK1, COLORWHITE;\n低0:= EMA(EMA(L, 25), 25) - (EMA(EMA(H, 25), 25) - EMA(EMA(L, 25), 25)) * 1, LINETHICK1, COLORWHITE;\n多头定位:= 低0 >= D90底 AND 高0 >= D90顶;\n空头定位:= 高0 <= D90顶 AND 低0 <= D90底;\n震荡定位:= 低0 >= D90底 AND 高0 <= D90顶;\n牛市: IF(多头定位 == 1, 100, 1), COLORRED, NODRAW;\n熊市: IF(空头定位 == 1, 100, 1), COLORGREEN, NODRAW;\n震荡: IF(震荡定位 == 1, 100, 1), COLORGRAY, NODRAW;\nSTICKLINE(多头定位 == 1, 100, 1, 100, 0), COLORRED;\nSTICKLINE(空头定位 == 1, 100, 1, 100, 0), COLORGREEN;\nSTICKLINE(震荡定位 == 1, 100, 1, 100, 0), COLORGRAY;"};return t},P.prototype.Zealink_Index3=function(){var t={Name:"持仓信号",Description:"持仓信号",IsMainIndex:!0,Args:[],Script:'买线:=EMA(C,2);\n卖线:=EMA(SLOPE(C,30)*5+C,20); \nBU:=CROSS(买线,卖线);\nSEL:=CROSS(卖线,买线);\n\nSTICKLINE(买线>=卖线 AND CLOSE>OPEN,LOW,HIGH,0,1),COLORRED;\nSTICKLINE(买线>=卖线 AND CLOSE<OPEN,LOW,HIGH,0,1),COLORRED;\nSTICKLINE(买线>=卖线 AND CLOSE>OPEN,CLOSE,OPEN,50,1),COLORRED;\nSTICKLINE(买线>=卖线 AND CLOSE<OPEN,CLOSE,OPEN,50,0),COLORRED;\nSTICKLINE(买线<卖线 AND CLOSE<OPEN,LOW,HIGH,0,1),COLORGREEN;\nSTICKLINE(买线<卖线 AND CLOSE>OPEN,LOW,HIGH,0,1),COLORGREEN;\nSTICKLINE(买线<卖线 AND CLOSE<OPEN,CLOSE,OPEN,50,0),COLORGREEN;\nSTICKLINE(买线<卖线 AND CLOSE>OPEN,CLOSE,OPEN,50,1),COLORGREEN;\n\nHHJSJDA:=(3*CLOSE+OPEN+LOW+HIGH)/6;\nHHJSJDB:(19*HHJSJDA+19*REF(HHJSJDA,1)+18*REF(HHJSJDA,2)+17*REF(HHJSJDA,3)+16*REF(HHJSJDA,4)+15*REF(HHJSJDA,5)+14*REF(HHJSJDA,6)\n+13*REF(HHJSJDA,7)+12*REF(HHJSJDA,8)+11*REF(HHJSJDA,9)+10*REF(HHJSJDA,10)+9*REF(HHJSJDA,11)+8*REF(HHJSJDA,12)+7*REF(HHJSJDA,13)+6*REF(HHJSJDA,14)+5*REF(HHJSJDA,15)+4*REF(HHJSJDA,16)+3*REF(HHJSJDA,17)+2*REF\n(HHJSJDA,20)+REF(HHJSJDA,19))/210,COLORYELLOW;\nHHJSJDC:MA(HHJSJDB,5),COLORRED;\n\nSVAR11:=HHV(HIGH,34);\nSVAR14:=CLOSE-REF(CLOSE,1);\nSVAR15:=MAX(SVAR14,0);\nSVAR16:=ABS(SVAR14);\nSVAR17:=SMA(SVAR15,7,1)/SMA(SVAR16,7,1)*100;\nSVAR18:=SMA(SVAR15,13,1)/SMA(SVAR16,13,1)*100;\nSVAR19:=BARSCOUNT(CLOSE);\nSVAR20:=SMA(MAX(SVAR14,0),6,1)/SMA(ABS(SVAR14),6,1)*100;\nSVAR21:=(-200)*(HHV(HIGH,60)-CLOSE)/(HHV(HIGH,60)-LLV(LOW,60))+100;\nSVAR1A:=(CLOSE-LLV(LOW,15))/(HHV(HIGH,15)-LLV(LOW,15))*100;\nSVAR1B:=SMA((SMA(SVAR1A,4,1)-50)*2,3,1);\nSVAR1C:=(INDEXC-LLV(INDEXL,14))/(HHV(INDEXH,14)-LLV(INDEXL,14))*100;\nSVAR1D:=SMA(SVAR1C,4,1);\nSVAR1E:=SMA(SVAR1D,3,1);\nSVAR1F:=(HHV(HIGH,30)-CLOSE)/CLOSE*100;\nSVAR22:=SVAR20<=25 AND SVAR21<-95 AND SVAR1F>20 AND SVAR1B<-30 AND SVAR1E<30 AND SVAR11-CLOSE>=-0.25 AND SVAR17<22 AND SVAR18<28 AND SVAR19>50;\nBUY3:=CROSS(SVAR22,0.5) AND COUNT(SVAR22==1,10)==1;\n\nSVARF:=LOW*0.9;\nSVAR10X:=100-3*SMA((OPEN-LLV(LOW,75))/(HHV(HIGH,75)-LLV(LOW,75))*100,20,1)+2*SMA(SMA((OPEN-LLV(LOW,75))/(HHV(HIGH,75)-LLV(LOW,75))*100,20,1),15,1);\nSVAR11X:=SVARF<REF(SVAR10X,1) AND VOL>REF(VOL,1) AND CLOSE>REF(CLOSE,1);\nBUY2:=SVAR11X AND COUNT(SVAR11X,30)==1;\n\nVAR1:=(CLOSE+HIGH+LOW+OPEN)/4;\nVAR2:=SUMBARS(VOL,CAPITAL);\nVAR3:=HHV(VAR1,VAR2);\nVAR4:=LLV(VAR1,VAR2);\nVAR5:=(2*VAR1-VAR4-REF(VAR4,1))/(VAR3-VAR4);\nVAR6:=(VAR1-VAR4)/(VAR3-VAR4);\nVAR7:=IF(VAR1<=VAR4,VAR5*60,VAR6*60);\nVAR8:=600*(EMA(CLOSE,3)-EMA(LOW,30))/EMA(LOW,30);\nVAR9:=EMA(VAR8,7);\nVARC:=HHV(HIGH,9)-LLV(LOW,9);\nVARD:=HHV(HIGH,9)-CLOSE;\nVARE:=CLOSE-LLV(LOW,9);\nVARF:=VARD/VARC*100-70;\nVAR10:=(CLOSE-LLV(LOW,60))/(HHV(HIGH,60)-LLV(LOW,60))*100;\nVAR11:=(2*CLOSE+HIGH+LOW)/4;\nVAR12:=SMA(VARE/VARC*100,3,1);\nVAR13:=LLV(LOW,34);\nVAR14:=SMA(VAR12,3,1)-SMA(VARF,9,1);\nVAR15:=IF(VAR14>100,VAR14-100,0);\nVAR16:=HHV(HIGH,34);\nVAR17:=EMA((VAR11-VAR13)/(VAR16-VAR13)*100,8);\nVAR18:=EMA(VAR17,5);\nBUY:=STICKLINE(VAR17-VAR18>0,VAR17,VAR18,8,1),COLORRED;\nSELL:=STICKLINE(VAR17-VAR18<0,VAR17,VAR18,8,1),COLORGREEN;\nBUY1:=VAR17>VAR18 AND REF(VAR17,1)<REF(VAR18,1);\nSELL1:=VAR17<VAR18 AND REF(VAR17,1)>REF(VAR18,1);\n\n短高H:=(20*H+19*REF(H,1)+18*REF(H,2)+17*REF(H,3)+16*REF(H,4)+15*REF(H,5)+14*REF(H,6)\n+13*REF(H,7)+12*REF(H,8)+11*REF(H,9)+10*REF(H,10)+9*REF(H,11)+8*REF(H,12)\n+7*REF(H,13)+6*REF(H,14)+5*REF(H,15)+4*REF(H,16)+3*REF(H,17)+2*REF(H,18)+\nREF(H,20))/210,COLORBLUE,LINETHICK1;\n短低L:=(20*L+19*REF(L,1)+18*REF(L,2)+17*REF(L,3)+16*REF(L,4)+15*REF(L,5)+14*REF(L,6)\n+13*REF(L,7)+12*REF(L,8)+11*REF(L,9)+10*REF(L,10)+9*REF(L,11)+8*REF(L,12)\n+7*REF(L,13)+6*REF(L,14)+5*REF(L,15)+4*REF(L,16)+3*REF(L,17)+2*REF(L,18)+\nREF(L,20))/210,COLORBLUE,LINETHICK1;\nD90H:=EMA(短高H,90),COLORRED,LINETHICK1;\nD90L:=EMA(短低L,90),COLORRED,LINETHICK1;\nD90差:=D90H-D90L;\nD90顶:=D90H+D90差*2,COLORRED,LINETHICK1;\nD90底:=D90L-D90差*2,COLORRED,LINETHICK1;\n高0:=(EMA(EMA(H,25),25)-EMA(EMA(L,25),25))*1+EMA(EMA(H,25),25),LINETHICK1,COLORWHITE;\n低0:=EMA(EMA(L,25),25)-(EMA(EMA(H,25),25)-EMA(EMA(L,25),25))*1,LINETHICK1,COLORWHITE;\n多头定位:=低0>=D90底 AND 高0>=D90顶;\n空头定位:=高0<=D90顶 AND 低0<=D90底;\n震荡定位:=低0>=D90底 AND 高0<=D90顶;\n\n牛市:=多头定位==1;\n熊市:=空头定位==1;\n震荡:=震荡定位==1;\n\n非牛市:=熊市 OR 震荡;\n非熊市:=牛市 OR 震荡;\n\nBUY11:=BUY1 AND 非熊市;\nSELL11:=SELL1 AND 震荡定位==0;\n\nBUY111:=BUY11 AND COUNT(BUY11,10)<2;\nBUY0:=BUY111 AND COUNT(BUY111,21)==1;\nSELL111:=SELL11 AND COUNT(SELL11,10)<2;\nSELL0:=SELL111 AND COUNT(SELL111,10)==1;\n\nXK1:=EMA(100*(CLOSE-LLV(LOW,34))/(HHV(HIGH,34)-LLV(LOW,34)),3)/4;\n上穿:=REF(XK1,1)<5 AND XK1>=5;\nBUY4:=上穿 AND COUNT(XK1<2,12)<1;\n\nSELL2:=REF(XK1,1)<=22.5 AND XK1>22.5 AND COUNT(REF(XK1,1)>=22.5 AND XK1<22.5,5)>0;\nSELL3:=REF(XK1,1)>=21.5 AND XK1<21.5 AND COUNT(REF(XK1,1)>=22.5 AND XK1<22.5,12)>1;\nSELL4:=SELL2 OR SELL3 AND COUNT((SELL2 OR SELL3)==1,5)==1;\n\nSUPERDRAWTEXT(BUY0,L,"机会",2,10),COLORRED;\nSUPERDRAWTEXT(SELL0,H,"风险",1,10),COLORGREEN;\nSUPERDRAWTEXT(BUY2,L,"机会",2,10),COLORRED;\nSUPERDRAWTEXT(BUY4,L,"机会",2,10),COLORRED;\nSUPERDRAWTEXT(SELL4,H,"风险",1,10),COLORGREEN;'};return t},P.prototype.Zealink_Index4=function(){var t={Name:"股东实际增减持",Description:"股东实际增减持",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"增持:NEWS(4),NODRAW,COLORRED;\n减持:NEWS(5),NODRAW,COLORGREEN;\nSTICKLINE(增持>0,0,增持,1,0),COLORRED;\nSTICKLINE(减持<0,0,减持,1,0),COLORGREEN;"};return t},P.prototype.Zealink_Index5=function(){var t={Name:"大宗交易",Description:"大宗交易",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"交易次数:NEWS(7);"};return t},P.prototype.Zealink_Index6=function(){var t={Name:"信托持股",Description:"信托持股",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"家数:NEWS(6);"};return t},P.prototype.Zealink_Index7=function(){var t={Name:"官网新闻",Description:"官网新闻",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"个数:NEWS(8);"};return t},P.prototype.Zealink_Index8=function(){var t={Name:"高管要闻",Description:"高管要闻",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"个数:NEWS(9);"};return t},P.prototype.Zealink_Index9=function(){var t={Name:"股权质押",Description:"股权质押",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"次数:NEWS(10);"};return t},P.prototype.Zealink_Index10=function(){var t={Name:"操盘BS点",Description:"操盘BS点",IsMainIndex:!0,FloatPrecision:0,Args:[],Script:"JJ:=(CLOSE+HIGH+LOW)/3; \nA:=EMA(JJ,10); \nB:=REF(A,1);\nM1:=EMA(CLOSE,3);\nM2:=EMA(CLOSE,8); \nM3:=EMA(M2,13); \nM4:=EMA(M2,55); \nB1:=A>B AND REF(A,1)<REF(B,1);\nS1:=A<B AND REF(A,1)>REF(B,1);\nINDEXCLOSE:INDEXC,EXDATA;\nINDEXOPEN:INDEXO,EXDATA;\nDRAWICON(REF(B1,1),L*0.97,13);\nDRAWICON(REF(S1,1),H*1.03,14);"};return t},P.prototype.Zealink_Index11=function(){var t={Name:"操盘BS点",Description:"操盘BS点",IsMainIndex:!0,FloatPrecision:0,Args:[],Script:"JJ:=(CLOSE+HIGH+LOW)/3;\nA:=EMA(JJ,10);\nB:=REF(A,1);\nM1:=EMA(CLOSE,3);\nM2:=EMA(CLOSE,8); \nM3:=EMA(M2,13);\nM4:=EMA(M2,55);\n持股区域:=STICKLINE(A>B,A,B,2,0),COLORYELLOW; \n持币区域:=STICKLINE(A<B,A,B,2,0),COLORBLUE;\n\nVR1:=(C+O+REF(C,1))/3;\nVR3:=HHV(VR1,21);\nVR4:=LLV(VR1,21);\nVR5:=(2*VR1-VR4-REF(VR4,1))/(VR3-VR4);\nVR6:=(VR1-VR4)/(VR3-VR4);\nVR7:=IF(VR1<=VR4,VR5*60,VR6*60);\nVR8:=600*(EMA(C,3)-EMA(L,30))/EMA(L,30);\nVR9:=EMA(VR8,7);\nVRA:=(WINNER(120*C/100)-WINNER(100*C/100))*100;\nVRB:=(-100)*(WINNER(120*C/100)-WINNER(100*C/100))+5;\nVRC:=HHV(H,9)-LLV(L,9);\nVRD:=HHV(H,9)-C;\nVRE:=C-LLV(L,9);\nVRF:=VRD/VRC*100-70;\nVR10:=(C-LLV(L,60))/(HHV(H,60)-LLV(L,60))*100;\nVR11:=(2*C+H+L)/4;\nVR12:=SMA(VRE/VRC*100,3,1);\nVR13:=LLV(L,34);\nVR14:=SMA(VR12,3,1)-SMA(VRF,9,1);\nVR15:=IF(VR14>100,VR14-100,0);\nVR16:=HHV(H,34);\nVR17:=EMA((VR11-VR13)/(VR16-VR13)*100,8);\nVR18:=EMA(VR17,5);\n\nB1:=A>B AND REF(A,1)<REF(B,1);\nS1:=A<B AND REF(A,1)>REF(B,1);\n\nB9:=BARSLAST(REF(B1,1) AND (REF(VR17>VR18,1) OR MIN(VR17,VR18)>REF(MAX(VR17,VR18),1)));\nS9:=BARSLAST(REF(S1,1) AND (REF(VR17<VR18,1) OR MAX(VR17,VR18)<REF(MIN(VR17,VR18),1)));\n\nDRAWICON(REF(B1,1) AND (REF(VR17>VR18,1) OR MIN(VR17,VR18)>REF(MAX(VR17,VR18),1)) AND REF(B9,2)>=S9,L*0.97,13);\nDRAWICON(REF(S1,1) AND (REF(VR17<VR18,1) OR MAX(VR17,VR18)<REF(MIN(VR17,VR18),1)) AND REF(S9,1)>=B9,H*1.03,14);\n\nDRAWKLINE_IF(VR17>VR18,HIGH,CLOSE,LOW,OPEN),COLORRED;\nDRAWKLINE_IF(VR17<VR18,HIGH,CLOSE,LOW,OPEN),COLORBLUE;\n\nINDEXCLOSE:INDEXC,EXDATA;\t\t//取指数的收盘价 回测的时候计算BATE系数用 "};return t},P.prototype.HeikinAshi=function(){var t={Name:"平均K线",Description:"Heikin-Ashi 平均K线",IsMainIndex:!0,KLineType:-1,Args:[],Script:"HCLOSE:(OPEN+HIGH+LOW+CLOSE)/4, NODRAW;\nHOPEN:(REF(OPEN,1)+REF(CLOSE,1))/2,NODRAW;\nHHIGH:MAX(HIGH,MAX(HOPEN,HCLOSE)),NODRAW;\nHLOW:MIN(LOW,MIN(HOPEN,HCLOSE)),NODRAW;\nDRAWKLINE(HHIGH,HOPEN,HLOW,HCLOSE);"};return t},P.prototype.ADL=function(){var t={Name:"腾落指标",Description:"腾落指标",IsMainIndex:!1,StringFormat:2,Condition:{Period:[N.KLINE_DAY_ID,N.KLINE_WEEK_ID,N.KLINE_TWOWEEK_ID,N.KLINE_MONTH_ID,N.KLINE_QUARTER_ID,N.KLINE_YEAR_ID],Include:["000001.SH","000003.SH","000016.SH","000300.SH","000905.SH","399001.SZ"," 399005.SZ","399006.SZ"]},Args:[{Name:"M",Value:7}],Script:"ADL:SUM(ADVANCE-DECLINE,0);\nMAADL:MA(ADL,M);"};return t},P.prototype.EMPTY=function(){var t={Name:"",Description:"空指标",IsMainIndex:!0,Args:[],Script:"VAR2:=C;"};return t},P.prototype.CJL=function(){var t={Name:"CJL",Description:"期货持仓量",IsMainIndex:!1,Args:[],Script:"成交量:VOL,VOLSTICK;\n持仓量:VOLINSTK,LINEOVERLAY;"};return t},P.prototype.ASI=function(){var t={Name:"ASI",Description:"振动升降指标",IsMainIndex:!1,Args:[{Name:"N1",Value:6}],Script:"X_1:=REF(CLOSE,1);\nX_2:=ABS(HIGH-X_1);\nX_3:=ABS(LOW-X_1);\nX_4:=ABS(HIGH-REF(LOW,1));\nX_5:=ABS(X_1-REF(OPEN,1));\nX_6:=IF(X_2>X_3 AND X_2>X_4,X_2+X_3/2+X_5/4,IF(X_3>X_4 AND X_3>X_2,X_3+X_2/2+X_5/4,X_4+X_5/4));\nX_7:=CLOSE-X_1+(CLOSE-OPEN)/2+X_1-REF(OPEN,1);\nX_8:=8*X_7/X_6*MAX(X_2,X_3);\nASI:SUM(X_8,0),LINETHICK2;\nMASI:MA(ASI,N1),LINETHICK2;"};return t},P.prototype.DC=function(){var t={Name:"DC",Description:"唐奇安通道",IsMainIndex:!0,Args:[{Name:"N1",Value:20}],Script:"UPPER:HHV(H,N1),COLORBLUE,LINETHICK2;\nLOWER:LLV(L,N1),COLORBLUE,LINETHICK2;\nMIDDLE:(UPPER+LOWER)/2,COLORRED,LINETHICK3;"};return t},P.prototype.DEMA=function(){var t={Name:"DEMA",Description:"双重指数移动均线",IsMainIndex:!0,Args:[{Name:"N1",Value:10}],Script:"ERR:=C-EMA(C,N1);\nDEMA:EMA(C,10)+EMA(ERR,N1);"};return t},P.prototype.VWAP=function(){var t={Name:"VWAP",Description:"成交量加权平均价",IsMainIndex:!0,Args:[{Name:"N1",Value:10}],Script:"PRICE:=(H+L+C)/3;\nT2:=VOL*PRICE;\nVWAP:SUM(T2,0)/SUM(VOL,0);"};return t},P.prototype.TEST=function(){var t={Name:"TEST",Description:"测试脚本",IsMainIndex:!1,Args:[{Name:"N",Value:10}],Script:"DRAWCHANNEL(OPEN>C,H,L, 'RGB(255,94,102)', 2 ,'5,5','RGBA(58,20,62,0.3)' );"};return t},!M)M={Chart:{Log:console.log},Complier:{Log:console.log}};function w(t){this.DivElement=t,this.DivToolElement=null,this.JSChartContainer,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jschart-drawing",this.CanvasElement.id=Y(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),t.hasChildNodes("canvas")||t.appendChild(this.CanvasElement),this.ModifyIndexDialog=new di(t),this.ChangeIndexDialog=new mi(t),this.MinuteDialog=new vi(t),this.OnSize=function(t){var e=parseInt(this.DivElement.style.height.replace("px",""));this.ToolElement&&(e-=this.ToolElement.style.height.replace("px","")),this.CanvasElement.height=e,this.CanvasElement.width=parseInt(this.DivElement.style.width.replace("px","")),this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var a=V();this.CanvasElement.height*=a,this.CanvasElement.width*=a,M.Chart.Log("[JSChart::OnSize] devicePixelRatio="+window.devicePixelRatio+", height="+this.CanvasElement.height+", width="+this.CanvasElement.width),this.JSChartContainer&&(this.JSChartContainer.OnSize&&t&&1==t.Type?this.JSChartContainer.OnSize():(this.JSChartContainer.Frame&&this.JSChartContainer.Frame.SetSizeChage(!0),this.JSChartContainer.Draw()))},this.AdjustChartBorder=function(t){var e=V();t.Frame.ChartBorder.Left*=e,t.Frame.ChartBorder.Right*=e,t.Frame.ChartBorder.Top*=e,t.Frame.ChartBorder.Bottom*=e},this.AdjustTitleHeight=function(t){var e=V();for(var a in t.Frame.SubFrame)t.Frame.SubFrame[a].Frame.ChartBorder.TitleHeight*=e;t.ChartCorssCursor.TextHeight*=e},this.CreateKLineChartContainer=function(t){var e=null;if(e="历史K线图横屏"===t.Type?new Ha(this.CanvasElement):new Pa(this.CanvasElement),t.NetworkFilter&&(e.NetworkFilter=t.NetworkFilter),e.ModifyIndexDialog=this.ModifyIndexDialog,e.ChangeIndexDialog=this.ChangeIndexDialog,e.MinuteDialog=this.MinuteDialog,1==t.IsShowRightMenu&&(e.RightMenu=new Ti(this.DivElement)),t.ScriptError&&(e.ScriptErrorCallback=t.ScriptError),e.SelectRectRightMenu=new Ai(this.DivElement),1==t.EnableScrollUpDown&&(e.EnableScrollUpDown=t.EnableScrollUpDown),1==t.DisableMouse&&(e.DisableMouse=t.DisableMouse),t.TouchMoveMinAngle&&(e.TouchMoveMinAngle=t.TouchMoveMinAngle),t.KLine&&(t.KLine.DragMode>=0&&(e.DragMode=t.KLine.DragMode),t.KLine.Right>=0&&(e.Right=t.KLine.Right),t.KLine.Period>=0&&(e.Period=t.KLine.Period),t.KLine.MaxReqeustDataCount>0&&(e.MaxReqeustDataCount=t.KLine.MaxReqeustDataCount),t.KLine.Info&&t.KLine.Info.length>0&&e.SetKLineInfo(t.KLine.Info,!1),t.KLine.IndexTreeApiUrl&&(e.ChangeIndexDialog.IndexTreeApiUrl=t.KLine.IndexTreeApiUrl),0==t.KLine.KLineDoubleClick&&(e.MinuteDialog=this.MinuteDialog=null),null!=t.KLine.IndexTreeApiUrl&&(e.ChangeIndexDialog.IndexTreeApiUrl=t.KLine.IndexTreeApiUrl),0==t.KLine.IsShowTooltip&&(e.IsShowTooltip=!1),t.KLine.MaxRequestMinuteDayCount>0&&(e.MaxRequestMinuteDayCount=t.KLine.MaxRequestMinuteDayCount),t.KLine.DrawType&&(e.KLineDrawType=t.KLine.DrawType),t.KLine.FirstShowDate>19910101&&(e.CustomShow={Date:t.KLine.FirstShowDate,PageSize:t.KLine.PageSize}),t.KLine.RightSpaceCount>0&&(e.RightSpaceCount=t.KLine.RightSpaceCount),t.KLine.ZoomType>0&&(e.ZoomType=t.KLine.ZoomType),t.KLine.DataWidth>=1&&(e.KLineSize={DataWidth:t.KLine.DataWidth})),t.EnableFlowCapital){var a=t.EnableFlowCapital;1==a.BIT&&(e.EnableFlowCapital.BIT=a.BIT)}if(t.Page&&(t.Page.Day&&1==t.Page.Day.Enable&&(e.Page.Day.Enable=!0),t.Page.Minute&&1==t.Page.Minute.Enable&&(e.Page.Minute.Enable=!0)),t.DragDownload&&(t.DragDownload.Day&&1==t.DragDownload.Day.Enable&&(e.DragDownload.Day.Enable=!0),t.DragDownload.Minute&&1==t.DragDownload.Minute.Enable&&(e.DragDownload.Minute.Enable=!0)),t.Language&&("CN"===t.Language?e.LanguageID=xa.LANGUAGE_CHINESE_ID:"EN"===t.Language&&(e.LanguageID=xa.LANGUAGE_ENGLISH_ID)),t.SourceDatatLimit&&e.SetSourceDatatLimit(t.SourceDatatLimit),t.DrawPicture&&t.DrawPicture.StorageKey&&e.ChartDrawStorage&&e.ChartDrawStorage.Load(t.DrawPicture.StorageKey),t.DrawTool&&t.DrawTool.StorageKey&&e.ChartDrawStorage&&e.ChartDrawStorage.Load(t.DrawTool.StorageKey),t.StepPixel>0&&(e.StepPixel=t.StepPixel),t.ZoomStepPixel>0&&(e.ZoomStepPixel=t.ZoomStepPixel),1==t.IsApiPeriod&&(e.IsApiPeriod=t.IsApiPeriod),!t.Windows||t.Windows.length<=0)return null;if(e.Create(t.Windows.length,t.Listener),t.Border&&(Le.IsNumber(t.Border.Left)?e.Frame.ChartBorder.Left=t.Border.Left:t.Border.Left=e.Frame.ChartBorder.Left,Le.IsNumber(t.Border.Right)?e.Frame.ChartBorder.Right=t.Border.Right:t.Border.Right=e.Frame.ChartBorder.Right,Le.IsNumber(t.Border.Top)?e.Frame.ChartBorder.Top=t.Border.Top:t.Border.Top=e.Frame.ChartBorder.Top,Le.IsNumber(t.Border.Bottom)?e.Frame.ChartBorder.Bottom=t.Border.Bottom:t.Border.Bottom=e.Frame.ChartBorder.Bottom),this.AdjustChartBorder(e),t.KLine&&t.KLine.PageSize>0){var i=e.GetMaxMinPageSize();i.Max>10&&i.Max<t.KLine.PageSize?e.PageSize=i.Max:i.Min>10&&i.Min>t.KLine.PageSize?e.PageSize=i.Min:e.PageSize=t.KLine.PageSize}if(!0===t.IsCorssOnlyDrawKLine&&(e.ChartCorssCursor.IsOnlyDrawKLine=t.IsCorssOnlyDrawKLine),!0===t.CorssCursorTouchEnd&&(e.CorssCursorTouchEnd=t.CorssCursorTouchEnd),1==t.IsClickShowCorssCursor&&(e.IsClickShowCorssCursor=t.IsClickShowCorssCursor),t.CorssCursorInfo&&(isNaN(t.CorssCursorInfo.Left)||(e.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),isNaN(t.CorssCursorInfo.Right)||(e.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),isNaN(t.CorssCursorInfo.Bottom)||(e.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),!1===t.CorssCursorInfo.IsShowCorss&&(e.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),1==t.CorssCursorInfo.IsShowClose&&(e.ChartCorssCursor.IsShowClose=t.CorssCursorInfo.IsShowClose),t.CorssCursorInfo.PressTime&&(e.PressTime=t.CorssCursorInfo.PressTime),t.CorssCursorInfo.HPenType>0&&(e.ChartCorssCursor.HPenType=t.CorssCursorInfo.HPenType),t.CorssCursorInfo.VPenType>0&&(e.ChartCorssCursor.VPenType=t.CorssCursorInfo.VPenType)),t.CorssCursor={},t.CorssCursor.TitleHeight=e.ChartCorssCursor.TextHeight,t.SplashTitle&&(e.ChartSplashPaint.SplashTitle=t.SplashTitle),t.Frame)for(var r in t.Frame){a=t.Frame[r];e.Frame.SubFrame[r]&&(a.SplitCount&&(e.Frame.SubFrame[r].Frame.YSplitOperator.SplitCount=a.SplitCount),a.StringFormat&&(e.Frame.SubFrame[r].Frame.YSplitOperator.StringFormat=a.StringFormat),Le.IsNumber(a.FloatPrecision)&&(e.Frame.SubFrame[r].Frame.YSplitOperator.FloatPrecision=a.FloatPrecision),a.Custom&&(e.Frame.SubFrame[r].Frame.YSplitOperator.Custom=a.Custom),Le.IsNumber(a.SplitType)&&(e.Frame.SubFrame[r].Frame.YSplitOperator.SplitType=a.SplitType),isNaN(a.Height)||(e.Frame.SubFrame[r].Height=a.Height),!1!==a.IsShowLeftText&&!0!==a.IsShowLeftText||(e.Frame.SubFrame[r].Frame.IsShowYText[0]=a.IsShowLeftText,e.Frame.SubFrame[r].Frame.YSplitOperator.IsShowLeftText=a.IsShowLeftText),!1!==a.IsShowRightText&&!0!==a.IsShowRightText||(e.Frame.SubFrame[r].Frame.IsShowYText[1]=a.IsShowRightText,e.Frame.SubFrame[r].Frame.YSplitOperator.IsShowRightText=a.IsShowRightText),a.TopSpace>=0&&(e.Frame.SubFrame[r].Frame.ChartBorder.TopSpace=a.TopSpace),a.BottomSpace>=0&&(e.Frame.SubFrame[r].Frame.ChartBorder.BottomSpace=a.BottomSpace),a.RightTextPosition>0&&(e.Frame.SubFrame[r].Frame.YTextPosition[1]=a.RightTextPosition),a.LeftTextPosition>0&&(e.Frame.SubFrame[r].Frame.YTextPosition[0]=a.LeftTextPosition),a.YCoordinateType>0&&(e.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=a.YCoordinateType),1==a.IsYReverse&&(e.Frame.SubFrame[0].Frame.CoordinateType=1))}if(t.KLine&&(0==t.KLine.ShowKLine&&(e.ChartPaint[0].IsShow=!1),t.KLine.InfoPosition>0&&(e.ChartPaint[0].InfoPosition=t.KLine.InfoPosition),0==t.KLine.IsShowMaxMinPrice&&(e.ChartPaint[0].IsShowMaxMinPrice=t.KLine.IsShowMaxMinPrice)),t.KLineTitle&&(0==t.KLineTitle.IsShowName&&(e.TitlePaint[0].IsShowName=!1),0==t.KLineTitle.IsShowSettingInfo&&(e.TitlePaint[0].IsShowSettingInfo=!1),0==t.KLineTitle.IsShow&&(e.TitlePaint[0].IsShow=!1)),t.Overlay)for(var r in t.Overlay){a=t.Overlay[r];e.OverlaySymbol(a.Symbol,a)}if(t.ExtendChart)for(var r in t.ExtendChart){a=t.ExtendChart[r];e.CreateExtendChart(a.Name,a)}var n=new P;if(t.ColorIndex){a=t.ColorIndex;var s=n.Get(a.Index);s&&(s.ID=a.Index,e.ColorIndex=new Cr(s.Name,s.Script,s.Args,s))}if(t.TradeIndex){a=t.TradeIndex;var o=n.Get(a.Index);o&&(o.ID=a.Index,e.TradeIndex=new Cr(o.Name,o.Script,o.Args,o))}for(var r in t.Windows){a=t.Windows[r];if(a.Script)e.WindowIndex[r]=new Cr(a.Name,a.Script,a.Args,a);else if(a.JsonData)e.WindowIndex[r]=new ei(a.Name,a.Script,a.Args,a);else if(a.Local&&a.Local.Data)e.WindowIndex[r]=new fr(a.Local.Name,a.Local.Args,{JsonData:a.Local.Data});else if(a.API){var h=a.API;e.WindowIndex[r]=new cr(h.Name,h.Script,h.Args,a)}else{var l=ya.Get(a.Index);if(l)e.WindowIndex[r]=l.Create(),e.CreateWindowIndex(r);else{var u=n.Get(a.Index);if(!u)continue;a.Lock&&(u.Lock=a.Lock),u.ID=a.Index;var C=u.Args;a.Args&&(C=a.Args),a.IsShortTitle&&(u.IsShortTitle=a.IsShortTitle),a.TitleFont&&(u.TitleFont=a.TitleFont),e.WindowIndex[r]=new Cr(u.Name,u.Script,C,u),a.StringFormat>0&&(e.WindowIndex[r].StringFormat=a.StringFormat),a.FloatPrecision>=0&&(e.WindowIndex[r].FloatPrecision=a.FloatPrecision)}}null!=a.Modify&&(e.Frame.SubFrame[r].Frame.ModifyIndex=a.Modify),null!=a.Change&&(e.Frame.SubFrame[r].Frame.ChangeIndex=a.Change),null!=a.Close&&(e.Frame.SubFrame[r].Frame.CloseIndex=a.Close),null!=a.Overlay&&(e.Frame.SubFrame[r].Frame.OverlayIndex=a.Overlay),1==a.IsDrawTitleBG&&(e.Frame.SubFrame[r].Frame.IsDrawTitleBG=a.IsDrawTitleBG),Le.IsNumber(a.TitleHeight)?e.Frame.SubFrame[r].Frame.ChartBorder.TitleHeight=a.TitleHeight:a.TitleHeight=e.Frame.SubFrame[r].Frame.ChartBorder.TitleHeight,0==a.IsShowTitleArraw&&(e.Frame.SubFrame[r].Frame.IsShowTitleArraw=!1),0==a.IsShowIndexName&&(e.Frame.SubFrame[r].Frame.IsShowIndexName=!1),a.IndexParamSpace>=0&&(e.Frame.SubFrame[r].Frame.IndexParamSpace=a.IndexParamSpace)}for(var r in t.OverlayIndexFrameWidth>40&&(e.OverlayIndexFrameWidth=t.OverlayIndexFrameWidth),t.OverlayIndex){a=t.OverlayIndex[r];if(!(a.Windows>=e.Frame.SubFrame.length)){var D={WindowIndex:a.Windows,IndexName:a.Index,ShowRightText:a.ShowRightText};a.Args&&(D.Args=a.Args),a.API&&(D.API=a.API),e.CreateOverlayWindowsIndex(D)}}return this.AdjustTitleHeight(e),e},this.CreateCustomKLineChartContainer=function(t){var e=new Ba(this.CanvasElement);if(e.ModifyIndexDialog=this.ModifyIndexDialog,e.ChangeIndexDialog=this.ChangeIndexDialog,e.MinuteDialog=this.MinuteDialog,1==t.IsShowRightMenu&&(e.RightMenu=new Ti(this.DivElement)),t.KLine&&(t.KLine.DragMode>=0&&(e.DragMode=t.KLine.DragMode),t.KLine.Right>=0&&(e.Right=t.KLine.Right),t.KLine.Period>=0&&(e.Period=t.KLine.Period),t.KLine.MaxReqeustDataCount>0&&(e.MaxReqeustDataCount=t.KLine.MaxReqeustDataCount),t.KLine.Info&&t.KLine.Info.length>0&&e.SetKLineInfo(t.KLine.Info,!1),t.KLine.IndexTreeApiUrl&&(e.ChangeIndexDialog.IndexTreeApiUrl=t.KLine.IndexTreeApiUrl),0==t.KLine.KLineDoubleClick&&(e.MinuteDialog=this.MinuteDialog=null),null!=t.KLine.IndexTreeApiUrl&&(e.ChangeIndexDialog.IndexTreeApiUrl=t.KLine.IndexTreeApiUrl),t.KLine.PageSize>0&&(e.PageSize=t.KLine.PageSize),0==t.KLine.IsShowTooltip&&(e.IsShowTooltip=!1)),t.CustomStock&&(e.CustomStock=t.CustomStock),t.QueryDate&&(e.QueryDate=t.QueryDate),!t.Windows||t.Windows.length<=0)return null;if(e.Create(t.Windows.length),t.Border&&(isNaN(t.Border.Left)||(e.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(e.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(e.Frame.ChartBorder.Top=t.Border.Top)),0==t.IsShowCorssCursorInfo&&(e.ChartCorssCursor.IsShowText=t.IsShowCorssCursorInfo),t.Frame)for(var a in t.Frame){var i=t.Frame[a];i.SplitCount&&(e.Frame.SubFrame[a].Frame.YSplitOperator.SplitCount=i.SplitCount),i.StringFormat&&(e.Frame.SubFrame[a].Frame.YSplitOperator.StringFormat=i.StringFormat)}t.KLineTitle&&(0==t.KLineTitle.IsShowName&&(e.TitlePaint[0].IsShowName=!1),0==t.KLineTitle.IsShowSettingInfo&&(e.TitlePaint[0].IsShowSettingInfo=!1));var r=new P;for(var a in t.Windows){i=t.Windows[a];if(i.Script)e.WindowIndex[a]=new Cr(i.Name,i.Script,i.Args,i);else{var n=ya.Get(i.Index);if(n)e.WindowIndex[a]=n.Create(),e.CreateWindowIndex(a);else{var s=r.Get(i.Index);if(!s)continue;i.Lock&&(s.Lock=i.Lock),e.WindowIndex[a]=new Cr(s.Name,s.Script,s.Args,s)}}null!=i.Modify&&(e.Frame.SubFrame[a].Frame.ModifyIndex=i.Modify),null!=i.Change&&(e.Frame.SubFrame[a].Frame.ChangeIndex=i.Change),isNaN(i.TitleHeight)||(e.Frame.SubFrame[a].Frame.ChartBorder.TitleHeight=i.TitleHeight)}return e},this.CreateMinuteChartContainer=function(t){var e=null;e="分钟走势图横屏"===t.Type?new Va(this.CanvasElement):new wa(this.CanvasElement),t.NetworkFilter&&(e.NetworkFilter=t.NetworkFilter),e.ModifyIndexDialog=this.ModifyIndexDialog,e.ChangeIndexDialog=this.ChangeIndexDialog;var a=2;if(t.Windows&&t.Windows.length>0&&(a+=t.Windows.length),1==t.EnableScrollUpDown&&(e.EnableScrollUpDown=t.EnableScrollUpDown),1==t.DisableMouse&&(e.DisableMouse=t.DisableMouse),t.ScriptError&&(e.ScriptErrorCallback=t.ScriptError),t.Minute&&0==t.Minute.IsShowTooltip&&(e.IsShowTooltip=!1),t.Language&&("CN"===t.Language?e.LanguageID=xa.LANGUAGE_CHINESE_ID:"EN"===t.Language&&(e.LanguageID=xa.LANGUAGE_ENGLISH_ID)),t.Info&&t.Info.length>0&&e.SetMinuteInfo(t.Info,!1),e.Create(a,t.Listener),t.CorssCursorInfo&&(isNaN(t.CorssCursorInfo.Left)||(e.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),isNaN(t.CorssCursorInfo.Right)||(e.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),isNaN(t.CorssCursorInfo.Bottom)||(e.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),!1===t.CorssCursorInfo.IsShowCorss&&(e.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),t.CorssCursorInfo.RightTextFormat>0&&(e.ChartCorssCursor.TextFormat.Right=t.CorssCursorInfo.RightTextFormat),1==t.CorssCursorInfo.IsOnlyDrawMinute&&(e.ChartCorssCursor.IsOnlyDrawMinute=t.CorssCursorInfo.IsOnlyDrawMinute)),t.MinuteInfo&&e.CreateMinuteInfo(t.MinuteInfo),1==t.IsShowRightMenu&&(e.RightMenu=new gi(this.DivElement)),t.DayCount>1&&(e.DayCount=t.DayCount),t.Border&&(isNaN(t.Border.Left)||(e.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(e.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(e.Frame.ChartBorder.Top=t.Border.Top),isNaN(t.Border.Bottom)||(e.Frame.ChartBorder.Bottom=t.Border.Bottom)),t.SplashTitle&&(e.ChartSplashPaint.SplashTitle=t.SplashTitle),this.AdjustChartBorder(e),t.Frame)for(var i in t.Frame){var r=t.Frame[i];e.Frame.SubFrame[i]&&(r.SplitCount&&(e.Frame.SubFrame[i].Frame.YSplitOperator.SplitCount=r.SplitCount),r.StringFormat&&(e.Frame.SubFrame[i].Frame.YSplitOperator.StringFormat=r.StringFormat),0==r.IsShowLeftText&&(e.Frame.SubFrame[i].Frame.IsShowYText[0]=r.IsShowLeftText,e.Frame.SubFrame[i].Frame.YSplitOperator.IsShowLeftText=r.IsShowLeftText),0==r.IsShowRightText&&(e.Frame.SubFrame[i].Frame.IsShowYText[1]=r.IsShowRightText,e.Frame.SubFrame[i].Frame.YSplitOperator.IsShowRightText=r.IsShowRightText),r.Height>=0&&(e.Frame.SubFrame[i].Height=r.Height),r.Custom&&(e.Frame.SubFrame[i].Frame.YSplitOperator.Custom=r.Custom),r.RightTextFormat>0&&(e.Frame.SubFrame[i].Frame.YSplitOperator.RightTextFormat=r.RightTextFormat))}if(t.ExtendChart)for(var i in t.ExtendChart){r=t.ExtendChart[i];e.CreateExtendChart(r.Name,r)}if(t.Overlay)for(var i in t.Overlay){r=t.Overlay[i];e.OverlaySymbol(r.Symbol,r)}t.MinuteLine&&(0==t.MinuteLine.IsDrawAreaPrice&&(e.ChartPaint[0].IsDrawArea=!1),0==t.MinuteLine.IsShowLead&&(e.IsShowLead=!1),0==t.MinuteLine.IsShowAveragePrice&&(e.ChartPaint[1].IsShow=!1),1===t.MinuteLine.SplitType&&(e.Frame.SubFrame[0].Frame.YSplitOperator.SplitType=t.MinuteLine.SplitType)),t.MinuteTitle&&(0==t.MinuteTitle.IsShowName&&(e.TitlePaint[0].IsShowName=!1),!1!==t.MinuteTitle.IsShowDate&&!0!==t.MinuteTitle.IsShowDate||(e.TitlePaint[0].IsShowDate=t.MinuteTitle.IsShowDate)),!0===t.CorssCursorTouchEnd&&(e.CorssCursorTouchEnd=t.CorssCursorTouchEnd),!0===t.IsShowBeforeData&&(e.IsShowBeforeData=t.IsShowBeforeData);var n=new P;for(var i in t.Windows){var s=2+parseInt(i);r=t.Windows[i];if(r.Script)e.WindowIndex[s]=new Cr(r.Name,r.Script,r.Args);else if(r.API){var o=r.API;e.WindowIndex[s]=new cr(o.Name,o.Script,o.Args,r)}else{var h=ya.Get(r.Index);if(h)e.WindowIndex[s]=h.Create(),e.CreateWindowIndex(s);else{var l=n.Get(r.Index);if(!l)continue;l.ID=r.Index;var u=l.Args;r.Args&&(u=r.Args),e.WindowIndex[s]=new Cr(l.Name,l.Script,u,l),r.StringFormat>0&&(e.WindowIndex[s].StringFormat=r.StringFormat),r.FloatPrecision>=0&&(e.WindowIndex[s].FloatPrecision=r.FloatPrecision)}}null!=r.Modify&&(e.Frame.SubFrame[s].Frame.ModifyIndex=r.Modify),null!=r.Change&&(e.Frame.SubFrame[s].Frame.ChangeIndex=r.Change),null!=r.Close&&(e.Frame.SubFrame[s].Frame.CloseIndex=r.Close),isNaN(r.TitleHeight)||(e.Frame.SubFrame[s].Frame.ChartBorder.TitleHeight=r.TitleHeight)}if(this.AdjustTitleHeight(e),t.Function){var C=t.Function;C.RequestMinuteData&&(e.RequestMinuteData=C.RequestMinuteData),C.RecvMinuteData&&(e.RecvMinuteData=C.RecvMinuteData)}return e},this.CreateHistoryMinuteChartContainer=function(t){var e=new ba(this.CanvasElement),a=2;t.Windows&&t.Windows.length>0&&(a+=t.Windows.length),e.Create(a),0==t.IsShowCorssCursorInfo&&(e.ChartCorssCursor.IsShowText=t.IsShowCorssCursorInfo),t.Border&&(isNaN(t.Border.Left)||(e.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(e.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(e.Frame.ChartBorder.Top=t.Border.Top),isNaN(t.Border.Bottom)||(e.Frame.ChartBorder.Bottom=t.Border.Bottom));var i=new P;for(var r in t.Windows){var n=t.Windows[r];if(n.Script)e.WindowIndex[2+parseInt(r)]=new Cr(n.Name,n.Script,n.Args);else{var s=ya.Get(n.Index);if(s)e.WindowIndex[2+parseInt(r)]=s.Create(),e.CreateWindowIndex(2+parseInt(r));else{var o=i.Get(n.Index);if(!o)continue;e.WindowIndex[2+parseInt(r)]=new Cr(o.Name,o.Script,o.Args)}}isNaN(n.TitleHeight)||(e.Frame.SubFrame[2+parseInt(r)].Frame.ChartBorder.TitleHeight=n.TitleHeight)}return e.TradeDate=20181009,t.HistoryMinute.TradeDate&&(e.TradeDate=t.HistoryMinute.TradeDate),null!=t.HistoryMinute.IsShowName&&(e.TitlePaint[0].IsShowName=t.HistoryMinute.IsShowName),null!=t.HistoryMinute.IsShowDate&&(e.TitlePaint[0].IsShowDate=t.HistoryMinute.IsShowDate),e},this.CreateKLineTrainChartContainer=function(t){var e="K线训练横屏"==t.Type,a=new _a(this.CanvasElement,e);if(t.NetworkFilter&&(a.NetworkFilter=t.NetworkFilter),1==t.IsApiPeriod&&(a.IsApiPeriod=t.IsApiPeriod),a.ModifyIndexDialog=this.ModifyIndexDialog,a.ChangeIndexDialog=this.ChangeIndexDialog,t.ScriptError&&(a.ScriptErrorCallback=t.ScriptError),t.KLine&&(t.KLine.Right>=0&&(a.Right=t.KLine.Right),t.KLine.Period>=0&&(a.Period=t.KLine.Period),t.KLine.MaxReqeustDataCount>0&&(a.MaxReqeustDataCount=t.KLine.MaxReqeustDataCount),t.KLine.Info&&t.KLine.Info.length>0&&a.SetKLineInfo(t.KLine.Info,!1),t.KLine.PageSize>0&&(a.PageSize=t.KLine.PageSize),0==t.KLine.IsShowTooltip&&(a.IsShowTooltip=!1),t.KLine.MaxRequestMinuteDayCount>0&&(a.MaxRequestMinuteDayCount=t.KLine.MaxRequestMinuteDayCount),t.KLine.DrawType&&(a.KLineDrawType=t.KLine.DrawType),t.KLine.RightSpaceCount>0&&(a.RightSpaceCount=t.KLine.RightSpaceCount)),t.Train&&(t.Train.DataCount&&(a.TrainDataCount=t.Train.DataCount),t.Train.Callback&&(a.TrainCallback=t.Train.Callback),t.Train.StartDate&&(a.TrainStartDate=t.Train.StartDate)),!t.Windows||t.Windows.length<=0)return null;if(a.Create(t.Windows.length),t.Border&&(isNaN(t.Border.Left)||(a.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(a.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(a.Frame.ChartBorder.Top=t.Border.Top),isNaN(t.Border.Bottom)||(a.Frame.ChartBorder.Bottom=t.Border.Bottom)),this.AdjustChartBorder(a),0==t.IsShowCorssCursorInfo&&(a.ChartCorssCursor.IsShowText=t.IsShowCorssCursorInfo),!0===t.IsCorssOnlyDrawKLine&&(a.ChartCorssCursor.IsOnlyDrawKLine=t.IsCorssOnlyDrawKLine),!0===t.CorssCursorTouchEnd&&(a.CorssCursorTouchEnd=t.CorssCursorTouchEnd),1==t.IsClickShowCorssCursor&&(a.IsClickShowCorssCursor=t.IsClickShowCorssCursor),t.CorssCursorInfo&&(isNaN(t.CorssCursorInfo.Left)||(a.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),isNaN(t.CorssCursorInfo.Right)||(a.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),isNaN(t.CorssCursorInfo.Bottom)||(a.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),!1===t.CorssCursorInfo.IsShowCorss&&(a.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),1==t.CorssCursorInfo.IsShowClose&&(a.ChartCorssCursor.IsShowClose=t.CorssCursorInfo.IsShowClose),t.CorssCursorInfo.PressTime&&(a.PressTime=t.CorssCursorInfo.PressTime),t.CorssCursorInfo.HPenType>0&&(a.ChartCorssCursor.HPenType=t.CorssCursorInfo.HPenType),t.CorssCursorInfo.VPenType>0&&(a.ChartCorssCursor.VPenType=t.CorssCursorInfo.VPenType)),t.CorssCursor={},t.CorssCursor.TitleHeight=a.ChartCorssCursor.TextHeight,t.Frame)for(var i in t.Frame){var r=t.Frame[i];a.Frame.SubFrame[i]&&(r.SplitCount&&(a.Frame.SubFrame[i].Frame.YSplitOperator.SplitCount=r.SplitCount),r.StringFormat&&(a.Frame.SubFrame[i].Frame.YSplitOperator.StringFormat=r.StringFormat),Le.IsNumber(r.FloatPrecision)&&(a.Frame.SubFrame[i].Frame.YSplitOperator.FloatPrecision=r.FloatPrecision),r.Custom&&(a.Frame.SubFrame[i].Frame.YSplitOperator.Custom=r.Custom),Le.IsNumber(r.SplitType)&&(a.Frame.SubFrame[i].Frame.YSplitOperator.SplitType=r.SplitType),r.Height>0&&(a.Frame.SubFrame[i].Height=r.Height),0==r.IsShowLeftText&&(a.Frame.SubFrame[i].Frame.YSplitOperator.IsShowLeftText=r.IsShowLeftText),0==r.IsShowRightText&&(a.Frame.SubFrame[i].Frame.YSplitOperator.IsShowRightText=r.IsShowRightText))}if(t.KLine&&(0==t.KLine.ShowKLine&&(a.ChartPaint[0].IsShow=!1),t.KLine.InfoPosition>0&&(a.ChartPaint[0].InfoPosition=t.KLine.InfoPosition),0==t.KLine.IsShowMaxMinPrice&&(a.ChartPaint[0].IsShowMaxMinPrice=t.KLine.IsShowMaxMinPrice)),t.KLineTitle&&(0==t.KLineTitle.IsShowName&&(a.TitlePaint[0].IsShowName=!1),0==t.KLineTitle.IsShowSettingInfo&&(a.TitlePaint[0].IsShowSettingInfo=!1),0==t.KLineTitle.IsShow&&(a.TitlePaint[0].IsShow=!1)),t.ExtendChart)for(var i in t.ExtendChart){r=t.ExtendChart[i];a.CreateExtendChart(r.Name,r)}var n=new P;for(var i in t.Windows){r=t.Windows[i];if(r.Script)a.WindowIndex[i]=new Cr(r.Name,r.Script,r.Args,r);else{var s=ya.Get(r.Index);if(s)a.WindowIndex[i]=s.Create(),a.CreateWindowIndex(i);else{var o=n.Get(r.Index);if(!o)continue;r.Lock&&(o.Lock=r.Lock),a.WindowIndex[i]=new Cr(o.Name,o.Script,o.Args,o)}}null!=r.Modify&&(a.Frame.SubFrame[i].Frame.ModifyIndex=r.Modify),null!=r.Change&&(a.Frame.SubFrame[i].Frame.ChangeIndex=r.Change),null!=r.Close&&(a.Frame.SubFrame[i].Frame.CloseIndex=r.Close),isNaN(r.TitleHeight)||(a.Frame.SubFrame[i].Frame.ChartBorder.TitleHeight=r.TitleHeight)}return this.AdjustTitleHeight(a),a},this.SetOption=function(t){var e=null;switch(t.Type){case"历史K线图":case"历史K线图横屏":e=this.CreateKLineChartContainer(t);break;case"自定义指数历史K线图":e=this.CreateCustomKLineChartContainer(t);break;case"分钟走势图":case"分钟走势图横屏":e=this.CreateMinuteChartContainer(t);break;case"历史分钟走势图":e=this.CreateHistoryMinuteChartContainer(t);break;case"K线训练":case"K线训练横屏":e=this.CreateKLineTrainChartContainer(t);break;case"简单图形":return this.CreateSimpleChart(t);case"饼图":case"雷达图":return this.CreatePieChart(t);case"地图":return this.CreateMapChart(t);default:return!1}if(!e)return!1;null!=t.IsAutoUpdate&&(e.IsAutoUpdate=t.IsAutoUpdate),t.AutoUpdateFrequency>0&&(e.AutoUpdateFrequency=t.AutoUpdateFrequency),t.Symbol?(e.Draw(),e.ChangeSymbol(t.Symbol),this.JSChartContainer=e,this.DivElement.JSChart=this,this.JSChartContainer.Draw()):(e.DrawEmpty(),this.JSChartContainer=e,this.DivElement.JSChart=this)},this.CreateSimpleChart=function(t){var e=new Ga(this.CanvasElement);t.MainDataControl&&(e.MainDataControl=t.MainDataControl),e.Create(),t.Border&&(isNaN(t.Border.Left)||(e.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(e.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(e.Frame.ChartBorder.Top=t.Border.Top)),e.Draw(),e.RequestData(),this.JSChartContainer=e,this.DivElement.JSChart=this,this.JSChartContainer.Draw()},this.CreatePieChart=function(t){var e=new ka(this.CanvasElement);t.MainDataControl&&(e.MainDataControl=t.MainDataControl),t.Radius&&(e.Radius=t.Radius),e.Create(),t.Border&&(isNaN(t.Border.Left)||(e.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(e.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(e.Frame.ChartBorder.Top=t.Border.Top)),this.AdjustChartBorder(e),t.Frame&&0==t.Frame[0].IsShowBorder&&(e.Frame.IsShowBorder=t.Frame[0].IsShowBorder),e.Draw(),e.RequestData(),this.JSChartContainer=e,this.DivElement.JSChart=this,this.JSChartContainer.Draw()},this.CreateMapChart=function(t){var e=new Ya(this.CanvasElement);t.MainDataControl&&(e.MainDataControl=t.MainDataControl),e.Create(),t.Border&&(isNaN(t.Border.Left)||(e.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(e.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(e.Frame.ChartBorder.Top=t.Border.Top)),e.Draw(),e.RequestData(),this.JSChartContainer=e,this.DivElement.JSChart=this,this.JSChartContainer.Draw()},this.CreateToolbar=function(t){},this.CreateSettingDiv=function(t){},this.Focus=function(){this.CanvasElement&&this.CanvasElement.focus()},this.ChangeSymbol=function(t){this.JSChartContainer&&this.JSChartContainer.ChangeSymbol(t)},this.ChangeIndex=function(t,e,a){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeIndex&&this.JSChartContainer.ChangeIndex(t,e,a)},this.ChangeScriptIndex=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeScriptIndex&&this.JSChartContainer.ChangeScriptIndex(t,e)},this.ChangePyScriptIndex=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangePyScriptIndex&&this.JSChartContainer.ChangePyScriptIndex(t,e)},this.GetIndexInfo=function(){return this.JSChartContainer&&"function"==typeof this.JSChartContainer.GetIndexInfo?this.JSChartContainer.GetIndexInfo():[]},this.ChangeInstructionIndex=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeInstructionIndex&&this.JSChartContainer.ChangeInstructionIndex(t)},this.ChangeInstructionScriptIndex=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeInstructionIndex&&this.JSChartContainer.ChangeInstructionScriptIndex(t)},this.CancelInstructionIndex=function(){this.JSChartContainer&&"function"==typeof this.JSChartContainer.CancelInstructionIndex&&this.JSChartContainer.CancelInstructionIndex()},this.ChangePeriod=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangePeriod&&this.JSChartContainer.ChangePeriod(t,e)},this.ChangeRight=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeRight&&this.JSChartContainer.ChangeRight(t)},this.OverlaySymbol=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.OverlaySymbol&&this.JSChartContainer.OverlaySymbol(t,e)},this.DeleteOverlaySymbol=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.DeleteOverlaySymbol&&this.JSChartContainer.DeleteOverlaySymbol(t)},this.SetFirstShowDate=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.SetFirstShowDate&&this.JSChartContainer.SetFirstShowDate(t)},this.ChangeKLineDrawType=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeKLineDrawType&&this.JSChartContainer.ChangeKLineDrawType(t,e)},this.ChangeIndexWindowCount=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeIndexWindowCount&&this.JSChartContainer.ChangeIndexWindowCount(t,e)},this.ClearOverlaySymbol=function(){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ClearOverlaySymbol&&this.JSChartContainer.ClearOverlaySymbol()},this.DeleteKLineInfo=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.DeleteKLineInfo&&this.JSChartContainer.DeleteKLineInfo(t)},this.ClearKLineInfo=function(){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ClearKLineInfo&&this.JSChartContainer.ClearKLineInfo()},this.AddKLineInfo=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.AddKLineInfo&&this.JSChartContainer.AddKLineInfo(t,e)},this.ChangMainDataControl=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.SetMainDataConotrl&&this.JSChartContainer.SetMainDataConotrl(t)},this.AddOverlayIndex=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.AddOverlayIndex&&this.JSChartContainer.AddOverlayIndex(t)},this.DeleteOverlayWindowsIndex=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.DeleteOverlayWindowsIndex&&this.JSChartContainer.DeleteOverlayWindowsIndex(t)},this.StopAutoUpdate=function(){this.JSChartContainer&&"function"==typeof this.JSChartContainer.StopAutoUpdate&&this.JSChartContainer.StopAutoUpdate()},this.SetDepthMapData=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.SetDepthMapData&&this.JSChartContainer.SetDepthMapData(t,e)},this.ForceLandscape=function(t){this.JSChartContainer&&(M.Chart.Log("[JSChart::ForceLandscape] bForceLandscape="+t),this.JSChartContainer.IsForceLandscape=t)},this.LockIndex=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.LockIndex&&(M.Chart.Log("[JSChart:LockIndex] lockData",t),this.JSChartContainer.LockIndex(t))},this.ChangeTradeDate=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeTradeDate&&(M.Chart.Log("[JSChart:ChangeTradeDate] date",t),this.JSChartContainer.ChangeTradeDate(t))},this.ChangeDayCount=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeDayCount&&(M.Chart.Log("[JSChart:ChangeDayCount] count",t),this.JSChartContainer.ChangeDayCount(t))},this.StartAnimation=function(t){if(this.JSChartContainer&&"function"==typeof this.JSChartContainer.StartAnimation)return M.Chart.Log("[JSChart:StartAnimation] start."),this.JSChartContainer.StartAnimation(t)},this.StopAnimation=function(){if(this.JSChartContainer&&"function"==typeof this.JSChartContainer.StopAnimation)return M.Chart.Log("[JSChart:StopAnimation] start."),this.JSChartContainer.StopAnimation()},this.SaveToImage=function(t,e){if(this.JSChartContainer&&"function"==typeof this.JSChartContainer.SaveToImage)return this.JSChartContainer.SaveToImage(t,e)},this.SaveToImageUrl=function(t,e){if(this.JSChartContainer&&"function"==typeof this.JSChartContainer.SaveToImageUrl)return this.JSChartContainer.SaveToImageUrl(t,e)},this.AddEventCallback=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.AddEventCallback&&(M.Chart.Log("[JSChart:AddEventCallback] ",t),this.JSChartContainer.AddEventCallback(t))},this.SetLanguage=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.SetLanguage&&(M.Chart.Log("[JSChart:SetLanguage] ",t),this.JSChartContainer.SetLanguage(t))},this.ChangeIndexTemplate=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeIndexTemplate&&(M.Chart.Log("[JSChart:ChangeIndexTemplate] ",t),this.JSChartContainer.ChangeIndexTemplate(t))},this.SetChartDrawOption=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.SetChartDrawOption&&(M.Chart.Log("[JSChart:SetChartDrawOption] ",t),this.JSChartContainer.SetChartDrawOption(t))},this.CreateChartDrawPicture=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.CreateChartDrawPicture&&(M.Chart.Log("[JSChart:CreateChartDrawPicture] ",t),this.JSChartContainer.CreateChartDrawPicture(t,e))},this.ClearChartDrawPicture=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ClearChartDrawPicture&&this.JSChartContainer.ClearChartDrawPicture(t)},this.ReloadResource=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ReloadResource&&(M.Chart.Log("[JSChart:ReloadResource] "),this.JSChartContainer.ReloadResource(t))}}w.Init=function(t){var e=new w(t);return e.OnSize(),e},w.SetDomain=function(t,e){t&&(Ma.Domain=t),e&&(Ma.CacheDomain=e)},w.SetPyIndexDomain=function(t){t&&(Ma.PyIndexDomain=t)},w.SetStyle=function(t){t&&Ma.SetStyle(t)},w.SetTextResource=function(t,e){Oa.SetTextResource(t,e)},w.GetLocalization=function(){return Oa},w.GetDevicePixelRatio=function(){return V()},w.CreateGuid=function(){return Y()},w.GetResource=function(){return Ma},w.GetMinuteTimeStringData=function(){return bi},w.GetMinuteCoordinateData=function(){return Bi},w.GetKLineZoom=function(){return Nt},w.GetDivTooltipDataFormat=function(){return Ke},w.SetUSATimeType=function(t){Hi.TimeType=t,Vi.TimeType=t,Gi.TimeType=t,ki.TimeType=t},w.GetChinaFuturesTimeData=function(){return _i},w.AddPeriodCallback=function(t){St.AddPeriodCallback(t)},w.RemovePeriodCallback=function(t){St.RemovePeriodCallback(t)};var b={RECV_KLINE_MATCH:1,RECV_INDEX_DATA:2,RECV_HISTROY_DATA:3,RECV_TRAIN_MOVE_STEP:4,CHART_STATUS:5,BARRAGE_PLAY_END:6,RECV_OVERLAY_INDEX_DATA:7,DBCLICK_KLINE:8,RECV_START_AUTOUPDATE:9,RECV_STOP_AUTOUPDATE:10,ON_CONTEXT_MENU:11,ON_TITLE_DRAW:12,ON_SELECT_RECT:13,RECV_MINUTE_DATA:14,ON_CLICK_INDEXTITLE:15,RECV_KLINE_UPDATE_DATA:16,ON_CLICK_DRAWPICTURE:17,ON_FINISH_DRAWPICTURE:18,ON_INDEXTITLE_DRAW:19,ON_CUSTOM_VERTICAL_DRAW:20,RECV_KLINE_MANUAL_UPDATE_DATA:21},B={OP_SCROLL_LEFT:1,OP_SCROLL_RIGHT:2,OP_ZOOM_OUT:3,OP_ZOOM_IN:4,OP_GOTO_HOME:5},_={DISABLE_DRAG_ID:0,CLICK_TOUCH_MODE_ID:3};function H(t){var e=this;this.ClassName="JSChartContainer";this.Frame,this.ChartPaint=new Array,this.ChartPaintEx=[],this.ChartInfo=new Array,this.ChartInfoPaint,this.ExtendChartPaint=new Array,this.TitlePaint=new Array,this.OverlayChartPaint=new Array,this.ChartDrawPicture=new Array,this.ChartDrawStorage,this.ChartDrawOption={IsLockScreen:!1,Zoom:5},this.CurrentChartDrawPicture=null,this.SelectChartDrawPicture=null,this.ChartCorssCursor,this.IsClickShowCorssCursor=!1,this.ChartSplashPaint=null,this.Canvas=t.getContext("2d"),this.UIElement=t,this.MouseDrag,this.DragMode=1,this.TouchStatus={CorssCursorShow:!1},this.DragTimer,this.EnableScrollUpDown=!1,this.CursorIndex=0,this.LastPoint=new K,this.IsForceLandscape=!1,this.CorssCursorTouchEnd=!1,this.StepPixel=4,this.ZoomStepPixel=5,this.TouchMoveMinAngle=70,this.EnableAnimation=!1,this.Tooltip=document.createElement("div"),this.Tooltip.className="jschart-tooltip",this.Tooltip.style.background=Ma.TooltipBGColor,this.Tooltip.style.opacity=Ma.TooltipAlpha,this.Tooltip.id=Y(),t.parentNode.appendChild(this.Tooltip),this.IsShowTooltip=!0,this.SelectRect=document.createElement("div"),this.SelectRect.className="jschart-selectrect",this.SelectRect.style.background=Ma.SelectRectBGColor,this.SelectRect.id=Y(),this.SelectRect.oncontextmenu=function(){return!1},t.parentNode.appendChild(this.SelectRect),this.SelectRectRightMenu,this.FrameSplitData=new g.default,this.FrameSplitData.set("double",new Fa),this.FrameSplitData.set("price",new Ea),this.mapEvent=new g.default,this.IsOnTouch=!1,this.TouchDrawCount=0,this.DisableMouse=!1,this.LanguageID=xa.LANGUAGE_CHINESE_ID,this.PressTime=500,this.NetworkFilter,this.LastMouseStatus={},this.AddEventCallback=function(t){if(t&&t.event&&t.callback){var e={Callback:t.callback,Source:t};this.mapEvent.set(t.event,e)}},this.RemoveEventCallback=function(t){this.mapEvent.has(t)&&this.mapEvent.delete(t)},this.GetEventCallback=function(t){if(!this.mapEvent.has(t))return null;var e=this.mapEvent.get(t);return e},this.GetIndexEvent=function(){return this.GetEventCallback(b.RECV_INDEX_DATA)},this.GetOverlayIndexEvent=function(){return this.GetEventCallback(b.RECV_OVERLAY_INDEX_DATA)},t.onmousemove=function(t){e.UIOnMouseMove(t)},t.oncontextmenu=function(t){return e.UIOnContextMenu(t)},t.ondblclick=function(t){e.UIOnDblClick(t)},t.onmousedown=function(t){e.UIOnMouseDown(t)},this.UIOnMouseMove=function(t){var e=V(),a=(t.clientX-this.UIElement.getBoundingClientRect().left)*e,i=(t.clientY-this.UIElement.getBoundingClientRect().top)*e;if((!this.ChartSplashPaint||1!=this.ChartSplashPaint.IsEnableSplash)&&1!=this.DisableMouse){var r={X:a,Y:i,IsInClient:this.IsMouseOnClient(a,i)};this.LastMouseStatus.OnMouseMove=r,this.OnMouseMove(a,i,t)}},this.IsMouseOnClient=function(t,e){var a=!1;return this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),a=this.Canvas.isPointInPath(t,e),a},this.UIOnContextMenu=function(t){var e=t.clientX-this.UIElement.getBoundingClientRect().left,a=t.clientY-this.UIElement.getBoundingClientRect().top;return"function"==typeof this.OnRightMenu&&this.OnRightMenu(e,a,t),!1},this.UIOnDblClick=function(t){var e=t.clientX-this.UIElement.getBoundingClientRect().left,a=t.clientY-this.UIElement.getBoundingClientRect().top;this.OnDoubleClick(e,a,t)},this.UIOnMouseDown=function(t){var e=this;if(0!=this.DragMode){var a=V();if(this.IsOnTouch=!0,this.TryClickLock){var i=(t.clientX-this.UIElement.getBoundingClientRect().left)*a,r=(t.clientY-this.UIElement.getBoundingClientRect().top)*a;if(this.TryClickLock(i,r))return}this.HideSelectRect(),this.SelectRectRightMenu&&this.SelectRectRightMenu.Hide(),this.ChartPictureMenu&&this.ChartPictureMenu.Hide();var n={Click:{},LastMove:{}};if(n.Click.X=t.clientX,n.Click.Y=t.clientY,n.LastMove.X=t.clientX,n.LastMove.Y=t.clientY,this.MouseDrag=n,this.SelectChartDrawPicture=null,this.CurrentChartDrawPicture){var s=this.CurrentChartDrawPicture;2==s.Status?this.SetChartDrawPictureThirdPoint(n.Click.X,n.Click.Y):(this.SetChartDrawPictureFirstPoint(n.Click.X,n.Click.Y),this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo())}else{var o={};a=V();o.X=(t.clientX-this.UIElement.getBoundingClientRect().left)*a,o.Y=(t.clientY-this.UIElement.getBoundingClientRect().top)*a,this.GetChartDrawPictureByPoint(o)&&(o.ChartDrawPicture.Status=20,o.ChartDrawPicture.ValueToPoint(),o.ChartDrawPicture.MovePointIndex=o.PointIndex,this.CurrentChartDrawPicture=o.ChartDrawPicture,this.SelectChartDrawPicture=o.ChartDrawPicture,this.OnSelectChartPicture(o.ChartDrawPicture))}document.onmousemove=function(t){e.DocOnMouseMove(t)},document.onmouseup=function(t){e.DocOnMouseUp(t)}}},this.DocOnMouseMove=function(e){if(!this.ChartSplashPaint||1!=this.IsEnableSplash){var a=this.MouseDrag;if(a){var i=Math.abs(a.LastMove.X-e.clientX);if(this.CurrentChartDrawPicture){var r=this.CurrentChartDrawPicture;if(1==r.Status||2==r.Status){if(Math.abs(a.LastMove.X-e.clientX)<5&&Math.abs(a.LastMove.Y-e.clientY)<5)return;this.SetChartDrawPictureSecondPoint(e.clientX,e.clientY)&&this.DrawDynamicInfo()}else if(3==r.Status)this.SetChartDrawPictureThirdPoint(e.clientX,e.clientY)&&this.DrawDynamicInfo();else if(20==r.Status){if(Math.abs(a.LastMove.X-e.clientX)<5&&Math.abs(a.LastMove.Y-e.clientY)<5)return;this.MoveChartDrawPicture(e.clientX-a.LastMove.X,e.clientY-a.LastMove.Y)&&this.DrawDynamicInfo()}a.LastMove.X=e.clientX,a.LastMove.Y=e.clientY}else if(1==this.DragMode){if(i<5)return;var n=!0;a.LastMove.X<e.clientX&&(n=!1),this.UIElement.style.cursor="pointer",this.DataMove(i,n)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()):this.DragDownloadData&&this.DragDownloadData(),a.LastMove.X=e.clientX,a.LastMove.Y=e.clientY}else if(2==this.DragMode){var s=Math.abs(a.LastMove.Y-e.clientY);if(i<5&&s<5)return;var o=a.Click.X-t.getBoundingClientRect().left,h=a.Click.Y-t.getBoundingClientRect().top,l=e.clientX-t.getBoundingClientRect().left,u=e.clientY-t.getBoundingClientRect().top;this.ShowSelectRect(o,h,l,u),a.LastMove.X=e.clientX,a.LastMove.Y=e.clientY}}}},this.DocOnMouseUp=function(e){document.onmousemove=null,document.onmouseup=null;var a=!0;if(this.CurrentChartDrawPicture){var i=this.CurrentChartDrawPicture;2==i.Status||1==i.Status||3==i.Status?(i.PointStatus=i.Status,this.FinishChartDrawPicturePoint()?this.DrawDynamicInfo():a=!1):20==i.Status&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}else if(2==this.DragMode){var r=this.MouseDrag,n=new J;if(n.XStart=r.Click.X-t.getBoundingClientRect().left,n.XEnd=r.LastMove.X-t.getBoundingClientRect().left,n.JSChartContainer=this.JSChartContainer,n.Stock={Symbol:this.Symbol,Name:this.Name},this.GetSelectRectData(n)){var s=this.GetEventCallback(b.ON_SELECT_RECT);if(s&&s.Callback){var o={X:r.LastMove.X-t.getBoundingClientRect().left,Y:r.LastMove.Y-t.getBoundingClientRect().top,SelectData:n};s.Callback(s,o,this)}this.SelectRectRightMenu&&(e.data={Chart:this,X:r.LastMove.X-t.getBoundingClientRect().left,Y:r.LastMove.Y-t.getBoundingClientRect().top,SelectData:n},this.SelectRectRightMenu.DoModal(e))}}M.Chart.Log("[KLineChartContainer::document.onmouseup]",e),this.UIElement.style.cursor="default",this.MouseDrag=null,this.IsOnTouch=!1,!0===a&&(this.CurrentChartDrawPicture=null)},this.IsPhoneDragging=function(t){var e=t.changedTouches.length,a=t.touches.length;return 1==e&&1==a},this.IsPhonePinching=function(t){var e=t.changedTouches.length,a=t.touches.length;return(1==e||2==e)&&2==a},this.PreventTouchEvent=function(t){t.cancelable&&t.preventDefault(),t.stopPropagation()},this.GetToucheData=function(t,e){for(var a=new Array,i=V(),r=0;r<t.touches.length;++r){var n=t.touches[r];e?a.push({clientX:n.clientY*i,clientY:n.clientX*i,pageX:n.pageY*i,pageY:n.pageX*i}):a.push({clientX:n.clientX*i,clientY:n.clientY*i,pageX:n.pageX*i,pageY:n.pageY*i})}return a},this.IsSingleTouch=function(t){var e=t.touches.length;return 1==e},this.StopDragTimer=function(){Le.IsNumber(this.DragTimer)&&(clearTimeout(this.DragTimer),this.DragTimer=null)},this.GetMoveAngle=function(t,e){var a=Math.abs(t.X-e.X),i=Math.abs(t.Y-e.Y),r=180*Math.atan(a/i)/Math.PI;return r},t.ontouchstart=function(t){e.OnTouchStart(t)},t.ontouchmove=function(t){e.OnTouchMove(t)},t.ontouchend=function(t){e.OnTouchEnd(t)},this.OnTouchStart=function(t){this.IsOnTouch=!0,this.TouchDrawCount=0,this.PhonePinch=null,this.StopDragTimer();var e=this.IsSingleTouch(t);if((0==this.EnableScrollUpDown||!e||this.DragMode==_.CLICK_TOUCH_MODE_ID&&1==this.TouchStatus.CorssCursorShow)&&t.cancelable&&t.preventDefault(),this.IsPhoneDragging(t)){if(this.TryClickLock||this.TryClickIndexTitle){var a=this.GetToucheData(t,this.IsForceLandscape),i=this.PointAbsoluteToRelative(a[0].clientX,a[0].clientY,!0),r=i.X,n=i.Y;if(this.TryClickLock&&this.TryClickLock(r,n))return;if(this.TryClickIndexTitle&&this.TryClickIndexTitle(r,n))return}var s=!0;this.ChartDrawOption.IsLockScreen?s=!1:this.DragMode==_.CLICK_TOUCH_MODE_ID?1==this.TouchStatus.CorssCursorShow&&(s=!1):this.DragMode==_.DISABLE_DRAG_ID?s=!1:e||(s=!1);var o={Click:{},LastMove:{}};a=this.GetToucheData(t,this.IsForceLandscape);o.Click.X=a[0].clientX,o.Click.Y=a[0].clientY,o.LastMove.X=a[0].clientX,o.LastMove.Y=a[0].clientY,this.MouseDrag=o,this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null;if(this.CurrentChartDrawPicture){var h=this.CurrentChartDrawPicture;return 2==h.Status?this.SetChartDrawPictureThirdPoint(o.Click.X,o.Click.Y,!0):(this.SetChartDrawPictureFirstPoint(o.Click.X,o.Click.Y,!0),this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo({Corss:!1,Tooltip:!1})),void(t.cancelable&&t.preventDefault())}i=this.PointAbsoluteToRelative(a[0].clientX,a[0].clientY,!0);var l={X:i.X,Y:i.Y};V();if(this.GetChartDrawPictureByPoint(l)){l.ChartDrawPicture.Status=20,l.ChartDrawPicture.ValueToPoint(),l.ChartDrawPicture.MovePointIndex=l.PointIndex,l.ChartDrawPicture.IsSelected=!0,this.CurrentChartDrawPicture=l.ChartDrawPicture,this.SelectChartDrawPicture=l.ChartDrawPicture;var u=this.GetEventCallback(b.ON_CLICK_DRAWPICTURE);if(u&&u.Callback){var C={DrawPicture:l.ChartDrawPicture};u.Callback(u,C,this)}return void(t.cancelable&&t.preventDefault())}if(s){var D=this;this.DragTimer=setTimeout((function(){if(o.Click.X==o.LastMove.X&&o.Click.Y==o.LastMove.Y){D.MouseDrag;D.MouseDrag=null,D.DragMode==_.CLICK_TOUCH_MODE_ID&&(D.TouchStatus.CorssCursorShow=!0),D.MoveCorssCursor(o.Click,t)}}),D.PressTime)}this.ChartDrawOption.IsLockScreen?this.MouseDrag=null:this.DragMode==_.CLICK_TOUCH_MODE_ID||(this.DragMode==_.DISABLE_DRAG_ID?(this.MouseDrag=null,this.MoveCorssCursor(o.Click,t)):this.IsClickShowCorssCursor&&this.MoveCorssCursor(o.Click,t))}else if(this.IsPhonePinching(t)){var c={Start:{},Last:{}};a=this.GetToucheData(t,this.IsForceLandscape);c.Start={X:a[0].pageX,Y:a[0].pageY,X2:a[1].pageX,Y2:a[1].pageY},c.Last={X:a[0].pageX,Y:a[0].pageY,X2:a[1].pageX,Y2:a[1].pageY},this.PhonePinch=c,this.SelectChartDrawPicture=null}},this.OnTouchMove=function(e){var a=this.GetToucheData(e,this.IsForceLandscape);if(this.IsPhoneDragging(e)){var i=this.MouseDrag;if(null==i)this.IsForceLandscape&&(y=t.getBoundingClientRect().width-a[0].clientY),this.ChartDrawOption.IsLockScreen||this.MoveCorssCursor({X:a[0].clientX,Y:a[0].clientY},e);else{var r=this.GetMoveAngle(i.LastMove,{X:a[0].clientX,Y:a[0].clientY}),n=Math.abs(i.LastMove.X-a[0].clientX),s=Math.abs(i.LastMove.Y-a[0].clientY);n=parseInt(n);var o=this.DragMode==_.CLICK_TOUCH_MODE_ID&&1==this.TouchStatus.CorssCursorShow;if(this.CurrentChartDrawPicture){var h=this.CurrentChartDrawPicture;if(1==h.Status||2==h.Status){if(n<5&&s<5)return;this.SetChartDrawPictureSecondPoint(a[0].clientX,a[0].clientY,!0)&&this.DrawDynamicInfo()}else if(3==h.Status)this.SetChartDrawPictureThirdPoint(a[0].clientX,a[0].clientY,!0)&&this.DrawDynamicInfo();else if(20==h.Status){if(n<5&&s<5)return;this.MoveChartDrawPicture(a[0].clientX-i.LastMove.X,a[0].clientY-i.LastMove.Y,!0)&&this.DrawDynamicInfo()}i.LastMove.X=a[0].clientX,i.LastMove.Y=a[0].clientY}else if(o){this.MouseDrag;this.MouseDrag=null,this.MoveCorssCursor(i.Click,e)}else if(1==this.DragMode||0==o){if((s>0&&n<=3||r<=this.TouchMoveMinAngle)&&1==this.EnableScrollUpDown)return void this.StopDragTimer();if(n<5||r<=this.TouchMoveMinAngle)return void this.PreventTouchEvent(e);var l=!0;i.LastMove.X<a[0].clientX&&(l=!1),this.DataMove(n,l)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()):this.DragDownloadData&&this.DragDownloadData(),i.LastMove.X=a[0].clientX,i.LastMove.Y=a[0].clientY}}}else if(this.IsPhonePinching(e)){if(this.DragMode==_.DISABLE_DRAG_ID)return;this.PreventTouchEvent(e);var u=this.PhonePinch;if(!u)return;var C=Math.abs(a[0].pageY-a[1].pageY),D=Math.abs(u.Last.Y-u.Last.Y2),c=C-D,f=Math.abs(a[0].pageX-a[1].pageX),d=Math.abs(u.Last.X-u.Last.X2),m=f-d,v=this.ZoomStepPixel;if(Math.abs(c)<v&&Math.abs(m)<v)return;var S=c;if(Math.abs(c)<v&&(S=m),S>0){var I={};if(I.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(I))return;this.CursorIndex=I.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.StopDragTimer()}else{I={};if(I.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(I))return;this.CursorIndex=I.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.StopDragTimer()}u.Last={X:a[0].pageX,Y:a[0].pageY,X2:a[1].pageX,Y2:a[1].pageY}}this.PreventTouchEvent(e)},this.OnTouchEnd=function(t){M.Chart.Log("[KLineChartContainer:OnTouchEnd]",t);var e=!0;if(this.CurrentChartDrawPicture){var a=this.CurrentChartDrawPicture;2==a.Status||1==a.Status||3==a.Status?(a.PointStatus=a.Status,this.FinishChartDrawPicturePoint()?this.DrawDynamicInfo():e=!1):20==a.Status&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}this.IsOnTouch=!1,!0===e&&(this.CurrentChartDrawPicture=null),this.StopDragTimer(),this.OnTouchFinished(),this.TouchDrawCount=0},this.MoveCorssCursor=function(t,e){var a=V(),i=t.X-this.UIElement.getBoundingClientRect().left*a,r=t.Y-this.UIElement.getBoundingClientRect().top*a;this.DragMode==_.CLICK_TOUCH_MODE_ID&&(this.TouchStatus.CorssCursorShow=!0),this.OnMouseMove(i,r,e)},this.DrawEmpty=function(){this.UIElement.width<=0||this.UIElement.height<=0||(this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.Frame&&(this.Frame.ScreenImageData=null,this.Frame.Draw()))},this.Draw=function(){var t=this;if(this.ChartCorssCursor&&(this.ChartCorssCursor.Status=0),!(this.UIElement.width<=0||this.UIElement.height<=0)){this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var e=V();if(this.Canvas.lineWidth=e,this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash)return this.Frame.Draw(),void this.ChartSplashPaint.Draw();if(this.Frame.SetDrawDepthMap((function(){for(var e in t.ExtendChartPaint){var a=t.ExtendChartPaint[e];a.IsCallbackDraw&&a.Draw()}})),this.Frame.Draw(),this.Frame.DrawCustomVertical){var a=this.GetEventCallback(b.ON_CUSTOM_VERTICAL_DRAW);this.Frame.DrawCustomVertical(a)}for(var i in this.Frame.CalculateLock(),this.ChartPaint){var r=this.ChartPaint[i];r.IsDrawFirst&&r.Draw()}for(var i in this.ChartPaint){r=this.ChartPaint[i];r.IsDrawFirst||r.Draw()}for(var i in this.ChartPaintEx){r=this.ChartPaintEx[i];r.Draw()}for(var i in this.OverlayChartPaint){r=this.OverlayChartPaint[i];r.Draw()}for(var i in this.Frame.DrawOveraly&&this.Frame.DrawOveraly(),this.ExtendChartPaint){r=this.ExtendChartPaint[i];r.IsCallbackDraw||(r.IsDynamic||0!=r.IsAnimation||r.Draw())}for(var i in this.Frame.DrawInsideHorizontal&&this.Frame.DrawInsideHorizontal(),this.Frame.DrawCustomHorizontal&&this.Frame.DrawCustomHorizontal(),this.ChartInfoPaint&&this.ChartInfoPaint.Draw(),this.Frame.DrawLock(),this.Frame.Snapshot(),this.ExtendChartPaint){r=this.ExtendChartPaint[i];r.IsCallbackDraw||r.IsDynamic&&!1===r.DrawAfterTitle&&r.Draw()}null==this.LastPoint.X&&null==this.LastPoint.Y||this.ChartCorssCursor&&(this.ChartCorssCursor.LastPoint=this.LastPoint,this.ChartCorssCursor.CursorIndex=this.CursorIndex,this.DragMode==_.CLICK_TOUCH_MODE_ID?1==this.TouchStatus.CorssCursorShow&&this.ChartCorssCursor.Draw():!0===this.CorssCursorTouchEnd&&this.MouseDrag||1==this.CorssCursorTouchEnd&&0==this.IsOnTouch||this.ChartCorssCursor.Draw());var n=this.GetEventCallback(b.ON_TITLE_DRAW),s=this.GetEventCallback(b.ON_INDEXTITLE_DRAW);for(var i in this.TitlePaint){r=this.TitlePaint[i];r.IsDynamic&&(r.CursorIndex=this.CursorIndex,"DynamicChartTitlePainting"==r.ClassName?r.OnDrawEvent=s:r.OnDrawEvent=n,r.OnDrawEvent&&(r.OnDrawEvent.FunctionName="Draw",r.OnDrawEvent.PointPosition=null),r.Draw())}for(var i in this.ExtendChartPaint){r=this.ExtendChartPaint[i];r.IsCallbackDraw||r.IsDynamic&&!0===r.DrawAfterTitle&&0==r.IsAnimation&&r.Draw()}if(this.EnableAnimation)for(var i in this.ExtendChartPaint){r=this.ExtendChartPaint[i];!0===r.IsAnimation&&r.Draw()}for(var i in this.ChartDrawPicture){r=this.ChartDrawPicture[i];r.Draw()}if(this.CurrentChartDrawPicture&&10!=this.CurrentChartDrawPicture.Status&&this.CurrentChartDrawPicture.Draw(),this.mapEvent.has(b.CHART_STATUS)){var o=this.mapEvent.get(b.CHART_STATUS),h={};"function"==typeof this.GetChartStatus&&(h=this.GetChartStatus()),o.Callback(o,h,this)}++this.TouchDrawCount}},this.DrawDynamicInfo=function(t){if(null!=this.Frame.ScreenImageData){var e=!1;if(this.ChartCorssCursor&&(null==this.ChartCorssCursor.PointX&&null==this.ChartCorssCursor.PointY||(e=!0)),e=!0,0==e)for(var a in this.ExtendChartPaint){var i=this.ExtendChartPaint[a];if(!i.IsCallbackDraw&&(i.IsDynamic&&i.IsEraseBG)){e=!0;break}}for(var a in e&&this.Canvas.putImageData(this.Frame.ScreenImageData,0,0),this.ExtendChartPaint){i=this.ExtendChartPaint[a];i.IsCallbackDraw||i.IsDynamic&&!1===i.DrawAfterTitle&&0==i.IsAnimation&&i.Draw()}this.ChartCorssCursor&&(this.ChartCorssCursor.LastPoint=this.LastPoint,this.ChartCorssCursor.CursorIndex=this.CursorIndex,t&&0==t.Corss||(this.DragMode==_.CLICK_TOUCH_MODE_ID?1==this.TouchStatus.CorssCursorShow&&this.ChartCorssCursor.Draw():!1===this.IsOnTouch&&!0===this.CorssCursorTouchEnd||this.CurrentChartDrawPicture||this.ChartCorssCursor.Draw()));var r=null;for(var a in t&&"OnMouseMove"==t.ParentFunction&&t.Point&&(r=this.Frame.PtInFrame(t.Point.X,t.Point.Y)),this.TitlePaint){i=this.TitlePaint[a];i.IsDynamic&&(i.CursorIndex=this.CursorIndex,i.OnDrawEvent&&(i.OnDrawEvent.FunctionName="DrawDynamicInfo",i.OnDrawEvent.PointPosition=r),i.Draw())}for(var a in this.ExtendChartPaint){i=this.ExtendChartPaint[a];i.IsCallbackDraw||("KLineTooltipPaint"==i.ClassName&&t&&0==t.Tooltip||i.IsDynamic&&!0===i.DrawAfterTitle&&i.Draw())}if(this.EnableAnimation)for(var a in this.ExtendChartPaint){i=this.ExtendChartPaint[a];!0===i.IsAnimation&&i.Draw()}for(var a in this.ChartDrawPicture){i=this.ChartDrawPicture[a];i.Draw()}this.CurrentChartDrawPicture&&10!=this.CurrentChartDrawPicture.Status&&this.CurrentChartDrawPicture.Draw(),++this.TouchDrawCount}},this.DrawAnimation=function(){if(this.EnableAnimation){if(this.Frame.ScreenImageData&&!this.IsOnTouch){for(var t in this.ExtendChartPaint){var e=this.ExtendChartPaint[t];!0===e.IsAnimation&&(e.IsMoveStep=!0)}this.DrawDynamicInfo()}var a=this;window.requestAnimationFrame((function(){a.DrawAnimation()}))}},this.StartAnimation=function(t){var e=!1,a=null;for(var i in this.ExtendChartPaint){var r=this.ExtendChartPaint[i];if("BarragePaint"===r.ClassName){e=!0,a=r.BarrageList;break}}if(!e){var n=new Ee;n.Canvas=this.Canvas,n.ChartBorder=this.Frame.ChartBorder,n.ChartFrame=this.Frame,n.HQChart=this,n.SetOption(t),this.ExtendChartPaint.push(n),a=n.BarrageList}this.EnableAnimation=!0;var s=this;return window.requestAnimationFrame((function(){s.DrawAnimation()})),a},this.StopAnimation=function(){this.EnableAnimation=!1,this.DrawDynamicInfo()},this.OnMouseMove=function(t,e,a){this.LastPoint.X=t,this.LastPoint.Y=e,this.CursorIndex=this.Frame.GetXData(t);var i=!1;if(this.CurrentChartDrawPicture)this.CurrentChartDrawPicture.SetLastPoint&&this.CurrentChartDrawPicture.SetLastPoint({X:t,Y:e}),i=!0;else{var r={};r.X=t,r.Y=e,this.GetChartDrawPictureByPoint(r)?(100===r.PointIndex?this.UIElement.style.cursor="move":this.UIElement.style.cursor="pointer",i=!0):this.MouseDrag||(this.UIElement.style.cursor="default")}var n={ParentFunction:"OnMouseMove",Point:{X:t,Y:e}};if(this.DrawDynamicInfo(n),this.IsShowTooltip&&0==i){var s=new Lt;for(var o in this.ChartPaint){var h=this.ChartPaint[o];if(h.GetTooltipData(t,e,s))break}if(this.ChartInfoPaint&&this.ChartInfoPaint.GetTooltipData(t,e,s),!s.Data)for(var o in this.OverlayChartPaint){h=this.OverlayChartPaint[o];if(h.GetTooltipData(t,e,s))break}if(s.Data){var l=a.clientX-this.UIElement.getBoundingClientRect().left,u=a.clientY-this.UIElement.getBoundingClientRect().top;this.ShowTooltip(l,u,s)}else this.HideTooltip()}},this.OnKeyDown=function(t){var e=t.keyCode?t.keyCode:t.which;switch(e){case 37:if(this.CursorIndex<=.99999){if(!this.DataMoveLeft())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown()}else--this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo(),this.ShowTooltipByKeyDown();break;case 39:var a=0;if(a=this.Frame.XPointCount?this.Frame.XPointCount:this.Frame.SubFrame[0].Frame.XPointCount,this.CursorIndex+1>=a){if(!this.DataMoveRight())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown()}else{var i=null;if(i=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data,!i)break;if(this.CursorIndex+i.DataOffset+1>=i.Data.length)break;++this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo(),this.ShowTooltipByKeyDown()}break;case 38:var r={ZoomType:this.ZoomType};if(r.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(r))break;this.CursorIndex=r.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown();break;case 40:r={ZoomType:this.ZoomType};if(r.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(r))break;this.CursorIndex=r.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown();break;case 46:if(!this.SelectChartDrawPicture)break;var n=this.SelectChartDrawPicture;M.Chart.Log(n,"drawPicturedrawPicturedrawPicture"),this.SelectChartDrawPicture=null,this.ClearChartDrawPicture(n);break;default:return}t.preventDefault?t.preventDefault():t.returnValue=!1},this.OnDoubleClick=function(t,e,a){},this.IsKLineContainer=function(){return"KLineChartContainer"==this.ClassName||"KLineChartHScreenContainer"==this.ClassName||"KLineTrainChartContainer"==this.ClassName},this.UpdatePointByCursorIndex=function(t){var e={X:null,Y:null};e.X=this.Frame.GetXFromIndex(this.CursorIndex);var a=Math.abs(this.CursorIndex-.5);this.IsKLineContainer()&&(a=this.CursorIndex);var i=this.Frame.Data;if(i.DataOffset+a<i.Data.length){var r=i.Data[i.DataOffset+a].Close;e.Y=this.Frame.GetYFromData(r)}if(1==t&&this.ChartCorssCursor)if(1==this.ChartCorssCursor.Status);else{this.LastPoint.X=this.Frame.GetXFromIndex(this.CursorIndex);a=Math.abs(this.CursorIndex-.5);a=parseInt(a.toFixed(0)),this.IsKLineContainer()&&(a=this.CursorIndex),this.LastPoint.Y=null}else 2==t&&this.ChartCorssCursor?(this.LastPoint.Y=null,this.LastPoint.X=null):(this.LastPoint.X=e.X,this.LastPoint.Y=e.Y)},this.ShowTooltipByKeyDown=function(){var t=Math.abs(this.CursorIndex-.5);t=parseInt(t.toFixed(0)),"KLineChartContainer"!=this.ClassName&&"KLineTrainChartContainer"!=this.ClassName||(t=this.CursorIndex);var e=this.Frame.Data,a=new Lt;a.Data=e.Data[e.DataOffset+t],a.ChartPaint=this.ChartPaint[0];var i=V();0===i&&(i=1),this.ShowTooltip(this.LastPoint.X/i,this.LastPoint.Y/i,a)},this.ShowTooltip=function(t,e,a){if(this.IsShowTooltip){var i=V(),r=15/i;if(0===a.Type){U();var n=t,s=e,o=Ke.Create("HistoryDataStringFormat");if(o.Value=a,o.Symbol=this.Symbol,o.LanguageID=this.LanguageID,!o.Operator())return;var h=25*o.LineCount;o.Height>0&&(h=o.Height);var l=o.Width;this.Tooltip.style.width=l+"px",this.Tooltip.style.height=h+"px",this.Tooltip.style.position="absolute",n+l>this.UIElement.getBoundingClientRect().width?this.Tooltip.style.left=n-l+"px":this.Tooltip.style.left=n+"px",this.Tooltip.style.top=s+r+"px",this.Tooltip.className="jschart-tooltip",this.Tooltip.innerHTML=o.Text,this.Tooltip.style.display="block"}else if(1===a.Type){U(),n=t,s=e,o=Ke.Create("KLineInfoDataStringFormat");if(o.Value=a,o.Symbol=this.Symbol,o.LanguageID=this.LanguageID,!o.Operator())return;l=o.Width;this.Tooltip.className="jchart-klineinfo-tooltip",this.Tooltip.style.position="absolute",n+l>this.UIElement.getBoundingClientRect().width?this.Tooltip.style.left=n-l+"px":this.Tooltip.style.left=n+"px",this.Tooltip.style.top=s+r+"px",this.Tooltip.style.width=l+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=o.Text,this.Tooltip.style.display="block"}else if(2==a.Type){n=t,s=e,o=Ke.Create("KLineTradeDataStringFormat");if(o.Value=a,o.Symbol=this.Symbol,o.LanguageID=this.LanguageID,!o.Operator())return;l=o.Width;this.Tooltip.className="jchart-klinetrade-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=n+"px",this.Tooltip.style.top=s+r+"px",this.Tooltip.style.width=l+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=o.Text,this.Tooltip.style.display="block"}else if(3==a.Type){n=t,s=e,o=Ke.Create("MinuteInfoDataStringFormat");if(o.Value=a,o.Symbol=this.Symbol,o.LanguageID=this.LanguageID,!o.Operator())return;l=o.Width;this.Tooltip.className="jchart-minuteinfo-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=n+"px",this.Tooltip.style.top=s+r+"px",this.Tooltip.style.width=l+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=o.Text,this.Tooltip.style.display="block"}}},this.HideTooltip=function(){this.Tooltip.style.display="none"},this.ShowSelectRect=function(t,e,a,i){var r=t,n=e,s=this.Frame.ChartBorder.GetRight(),o=this.Frame.ChartBorder.GetLeft();t>s&&(t=s),a>s&&(a=s),t<o&&(t=o),a<o&&(a=o),t>a&&(r=a),e>i&&(n=i);var h=Math.abs(t-a),l=Math.abs(e-i);this.SelectRect.style.width=h+"px",this.SelectRect.style.height=l+"px",this.SelectRect.style.position="absolute",this.SelectRect.style.left=r+"px",this.SelectRect.style.top=n+"px",this.SelectRect.style.display="block"},this.UpdateSelectRect=function(t,e){if(this.ChartPaint[0].Data){var a=this.ChartPaint[0].Data,i=a.DataOffset,r=t-i,n=e-i,s=this.Frame.GetXFromIndex(r),o=this.Frame.GetXFromIndex(n);M.Chart.Log("[JSChartContainer::UpdateSelectRect]",t,e,s,o);var h=U();this.SelectRect.style.left=s+h.Left+"px",this.SelectRect.style.width=o-s+"px"}},this.HideSelectRect=function(){this.SelectRect.style.display="none"},this.ResetFrameXYSplit=function(){"function"==typeof this.Frame.ResetXYSplit&&this.Frame.ResetXYSplit()},this.UpdateFrameMaxMin=function(){var t=new Array,e=new Array;for(var a in this.ChartPaint){var i=this.ChartPaint[a];0!=i.IsShow&&e.push(this.ChartPaint[a])}for(var a in this.OverlayChartPaint)e.push(this.OverlayChartPaint[a]);for(var a in e){var r=e[a],n=r.GetMaxMin();if(null!=n&&null!=n.Max&&null!=n.Min){var s=null;for(var o in t)if(t[o].Frame==r.ChartFrame){s=t[o];break}s?(s.Range.Max<n.Max&&(s.Range.Max=n.Max),s.Range.Min>n.Min&&(s.Range.Min=n.Min)):(s={},s.Frame=r.ChartFrame,s.Range=n,t.push(s))}}for(var a in t){i=t[a];i.Frame&&i.Range&&(null!=i.Range.Max&&null!=i.Range.Min&&(i.Frame.YSpecificMaxMin?(i.Frame.HorizontalMax=i.Frame.YSpecificMaxMin.Max,i.Frame.HorizontalMin=i.Frame.YSpecificMaxMin.Min):(i.Frame.HorizontalMax=i.Range.Max,i.Frame.HorizontalMin=i.Range.Min),i.Frame.XYSplit=!0))}for(var a in this.Frame.SubFrame){var h=this.Frame.SubFrame[a];for(var o in h.OverlayIndex){var l=h.OverlayIndex[o];l.UpdateFrameMaxMin()}}},this.DataMoveLeft=function(){var t=null;return t=this.Frame.Data?this.Frame.SubFrame[0].Frame.Data:this.Frame.Data,!!t&&(!(t.DataOffset<=0)&&(--t.DataOffset,!0))},this.DataMoveRight=function(){var t=null;if(t=this.Frame.Data?this.Frame.SubFrame[0].Frame.Data:this.Frame.Data,!t)return!1;var e=0;return e=this.Frame.XPointCount?this.Frame.XPointCount:this.Frame.SubFrame[0].Frame.XPointCount,!!e&&(!(e+t.DataOffset>=t.Data.length)&&(++t.DataOffset,!0))},this.UpdataDataoffset=function(){var t=null;if(t=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data,t){for(var e in this.ChartPaint){var a=this.ChartPaint[e];a.Data&&(a.Data.DataOffset=t.DataOffset)}for(var e in this.OverlayChartPaint){a=this.OverlayChartPaint[e];a.Data&&(a.Data.DataOffset=t.DataOffset)}for(var e in this.Frame.SubFrame){var i=this.Frame.SubFrame[e];for(var r in i.OverlayIndex){var n=i.OverlayIndex[r];for(var s in n.ChartPaint){a=n.ChartPaint[s];a.Data&&(a.Data.DataOffset=t.DataOffset)}}}}},this.DataMove=function(t,e){var a=t;if(t=parseInt(t/this.StepPixel),t<=0)return!1;var i=null;if(i=this.Frame.Data?this.Frame.SubFrame[0].Frame.Data:this.Frame.Data,!i)return!1;var r=0;if(r=this.Frame.XPointCount?this.Frame.XPointCount:this.Frame.SubFrame[0].Frame.XPointCount,!r)return!1;if(this.Frame.SubFrame&&this.Frame.SubFrame.length>0&&this.Frame.SubFrame[0].Frame){var n=this.Frame.SubFrame[0].Frame;(n.DataWidth<=1||n.DistanceWidth<=1)&&(t=a*this.StepPixel)}if(e){if(this.RightSpaceCount>0){if(r+i.DataOffset>=i.Data.length+this.RightSpaceCount-1)return!1;i.DataOffset+=t,i.DataOffset+r>=i.Data.length+this.RightSpaceCount&&(i.DataOffset=i.Data.length-(r-this.RightSpaceCount))}else{if(r+i.DataOffset>=i.Data.length)return!1;i.DataOffset+=t,i.DataOffset+r>=i.Data.length&&(i.DataOffset=i.Data.length-r)}return!0}return!(i.DataOffset<=0)&&(i.DataOffset-=t,i.DataOffset<0&&(i.DataOffset=0),!0)},this.GetSubFrameIndex=function(t,e){if(!this.Frame.SubFrame||this.Frame.SubFrame.length<=0)return-1;for(var a in this.Frame.SubFrame){var i=this.Frame.SubFrame[a].Frame,r=i.ChartBorder.GetLeft(),n=i.ChartBorder.GetTop(),s=i.ChartBorder.GetHeight(),o=i.ChartBorder.GetWidth();if(this.Canvas.beginPath(),this.Canvas.rect(r,n,o,s),this.Canvas.isPointInPath(t,e))return parseInt(a)}return 0},this.GetDataIndexByPoint=function(t){var e=this.Frame;this.Frame.SubFrame&&this.Frame.SubFrame.length>0&&(e=this.Frame.SubFrame[0].Frame);var a=null;if(a=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data,a&&e){var i=parseInt(e.GetXData(t));return a.DataOffset+i}},this.GetSelectRectData=function(t){if(Math.abs(t.XStart-t.XEnd)<5)return!1;var e=null;if(e=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data,!e)return!1;var a=this.GetDataIndexByPoint(t.XStart),i=this.GetDataIndexByPoint(t.XEnd);return!(Math.abs(a-i)<2)&&(t.Data=e,a>i?(t.Start=i,t.End=a):(t.Start=a,t.End=i),!0)},this.GetChartDrawPictureByPoint=function(t){for(var e in this.ChartDrawPicture){var a=this.ChartDrawPicture[e],i=a.IsPointIn(t.X,t.Y);if(!1!==i&&i>=0)return t.ChartDrawPicture=a,t.PointIndex=i,!0}return!1},this.SaveToImage=function(t,e){if(this.UIElement.width<=0||this.UIElement.height<=0)return null;if(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash)return null;M.Chart.Log("[JSChartContainer::SaveToImage]",this.UIElement);var a="rgb(255,255,255)";e&&(a=e),this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.Canvas.fillStyle=a,this.Canvas.fillRect(0,0,this.UIElement.width,this.UIElement.height);var i=V();for(var r in this.Canvas.lineWidth=i,this.Frame.Draw(),this.ChartPaint){var n=this.ChartPaint[r];n.IsDrawFirst&&n.Draw()}for(var r in this.ChartPaint){n=this.ChartPaint[r];n.IsDrawFirst||n.Draw()}for(var r in this.ChartPaintEx){n=this.ChartPaintEx[r];n.Draw()}for(var r in this.OverlayChartPaint){n=this.OverlayChartPaint[r];n.Draw()}for(var r in this.ExtendChartPaint){n=this.ExtendChartPaint[r];n.IsDynamic||0!=n.IsAnimation||n.Draw()}for(var r in this.Frame.DrawInsideHorizontal&&this.Frame.DrawInsideHorizontal(),this.Frame.DrawLock(),this.ExtendChartPaint){n=this.ExtendChartPaint[r];n.IsDynamic&&!1===n.DrawAfterTitle&&n.Draw()}for(var r in null==this.LastPoint.X&&null==this.LastPoint.Y||this.ChartCorssCursor&&(this.ChartCorssCursor.LastPoint=this.LastPoint,this.ChartCorssCursor.CursorIndex=this.CursorIndex),this.TitlePaint){n=this.TitlePaint[r];n.IsDynamic&&(n.CursorIndex=this.CursorIndex,n.Draw())}for(var r in this.ExtendChartPaint){n=this.ExtendChartPaint[r];n.IsDynamic&&!0===n.DrawAfterTitle&&0==n.IsAnimation&&n.Draw()}if(this.EnableAnimation)for(var r in this.ExtendChartPaint){n=this.ExtendChartPaint[r];!0===n.IsAnimation&&n.Draw()}for(var r in this.ChartDrawPicture){n=this.ChartDrawPicture[r];n.Draw()}this.CurrentChartDrawPicture&&10!=this.CurrentChartDrawPicture.Status&&this.CurrentChartDrawPicture.Draw();var s=this.UIElement.toDataURL(t||"image/png",1);return M.Chart.Log("[JSChartContainer::SaveToImage] data= ",s),s},this.SaveToImageUrl=function(t,e){t||(t={Format:"image/png",ColorGB:"rgb(255,255,255)"});var a=this.SaveToImage(t.Format,t.ColorGB),i={Base64:a,BucketName:"downloadcache",Path:"hqchart/hq_snapshot"},r=Ma.Domain+"/API/FileUploadForBase64";x.HttpRequest({url:r,method:"POST",dataType:"json",data:i,success:function(t){M.Chart.Log("[JSChartContainer::SaveToImageUrl] recv data",t);var a={Path:t.relativeurl,Domain:"https://opensourcedownload.zealink.com"};a.Url=a.Domain+"/"+a.Path,e&&e(!0,a,"")},error:function(t){M.Chart.Log("[JSChartContainer::SaveToImageUrl] error ",t),e&&e(!1,null,"upload failed")}})},this.SetLanguage=function(t){var e=null;switch(t){case"EN":e=xa.LANGUAGE_ENGLISH_ID;break;case"CN":e=xa.LANGUAGE_CHINESE_ID;break;default:return void console.warn("[JSChartContainer::SetLanguage] language="+t+" error")}if(this.LanguageID!=e){for(var a in this.LanguageID=e,this.ChartCorssCursor&&this.ChartCorssCursor.StringFormatY&&(this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID),this.TitlePaint){var i=this.TitlePaint[a];i&&(i.LanguageID=this.LanguageID)}this.Frame&&this.Frame.SetLanguage&&this.Frame.SetLanguage(this.LanguageID),this.Frame.SetSizeChage(!0),this.Draw()}},this.ReloadTiltePaintResource=function(t){for(var e in this.TitlePaint){var a=this.TitlePaint[e];a.ReloadResource&&a.ReloadResource(t)}},this.ReloadResource=function(t){this.ReloadBorder(t),this.ReloadTiltePaintResource(t.Resource),this.ReloadChartPaint(t.Resource),this.ReloadFrame(t.Resource),this.ReloadChartCorssCursor(t,t.Resource),t.Update?this.Update({UpdateCursorIndexType:2}):1==t.Draw&&this.Draw()},this.ReloadBorder=function(t){if(t){var e=V();if(t.Border){var a=t.Border;Le.IsNumber(a.Left)&&(this.Frame.ChartBorder.Left=a.Left*e),Le.IsNumber(a.Right)&&(this.Frame.ChartBorder.Right=a.Right*e),Le.IsNumber(a.Top)&&(this.Frame.ChartBorder.Top=a.Top*e),Le.IsNumber(a.Bottom)&&(this.Frame.ChartBorder.Bottom=a.Bottom*e)}for(var i in t.Windows){a=t.Windows[i];if(!(i>=this.Frame.SubFrame.length)){var r=this.Frame.SubFrame[i],n=r.Frame.ChartBorder;Le.IsNumber(a.TitleHeight)&&(n.TitleHeight=a.TitleHeight*e)}}for(var i in t.Frame){a=t.Frame[i];if(!(i>=this.Frame.SubFrame.length)){r=this.Frame.SubFrame[i],n=r.Frame.ChartBorder;a.TopSpace>=0&&(n.TopSpace=a.TopSpace*e),a.BottomSpace>=0&&(n.BottomSpace=a.BottomSpace*e)}}}},this.ReloadFrame=function(t){for(var e in this.Frame.SubFrame){var a=this.Frame.SubFrame[e],i=a.Frame;i&&i.ReloadResource&&i.ReloadResource(t)}},this.ReloadChartPaint=function(t){for(var e in this.ChartPaint){var a=this.ChartPaint[e];a&&a.ReloadResource&&a.ReloadResource(t)}},this.ReloadChartCorssCursor=function(t,e){var a=V();if(t&&t.CorssCursor){var i=t.CorssCursor;Le.IsNumber(i.TitleHeight)&&(this.ChartCorssCursor.TextHeight=i.TitleHeight*a)}this.ChartCorssCursor.ReloadResource&&this.ChartCorssCursor.ReloadResource(e)},this.SetDepthMapData=function(t,e){for(var a in t){var i=t[a];for(var r in this.ExtendChartPaint){var n=this.ExtendChartPaint[r];if(n.ID==i.ID){n.Data=i.Data;break}}}e&&this.Draw()}}function V(){return"undefined"==typeof window?1:window.devicePixelRatio||1}function G(t){this.JSChartContainer&&this.JSChartContainer.OnKeyDown&&this.JSChartContainer.OnKeyDown(t)}function k(t,e){var a=1;if(isNaN(t))return t;t<0&&(a=-1);var i=Math.pow(10,e),r=Math.round(Math.abs(t)*i)/i*a;if(/^(\d+(?:\.\d+)?)(e)([\-]?\d+)$/.test(r))var n=r.toFixed2(e);else n=r.toString();var s=n.indexOf(".");s<0&&e>0&&(s=n.length,n+=".");while(n.length<=s+e)n+="0";return n}function Y(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"guid"+(t()+t())+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function U(){var t={},e=0,a=0;return document.documentElement&&document.documentElement.scrollTop?(e=document.documentElement.scrollTop,a=document.documentElement.scrollLeft):document.body&&(e=document.body.scrollTop,a=document.body.scrollLeft),t.Top=e,t.Left=a,t}function W(t){return parseInt(t)+.5}function X(t){return.5+t<<0}function K(){this.X,this.Y}function J(){this.Data,this.JSChartContainer,this.Start,this.End,this.XStart,this.XEnd}function z(){this.Value,this.Message=new Array,this.TextColor=Ma.FrameSplitTextColor,this.Font=Ma.FrameSplitTextFont,this.LineColor=Ma.FrameSplitPen,this.LineType=1}function q(){this.UIElement,this.Left=50,this.Right=80,this.Top=50,this.Bottom=50,this.TitleHeight=24,this.TopSpace=0,this.BottomSpace=0,this.GetChartWidth=function(){return this.UIElement.width},this.GetChartHeight=function(){return this.UIElement.height},this.GetLeft=function(){return this.Left},this.GetRight=function(){return this.UIElement.width-this.Right},this.GetTop=function(){return this.Top},this.GetTopEx=function(){return this.Top+this.TitleHeight+this.TopSpace},this.GetTopTitle=function(){return this.Top+this.TitleHeight},this.GetBottom=function(){return this.UIElement.height-this.Bottom},this.GetBottomEx=function(){return this.UIElement.height-this.Bottom-this.BottomSpace},this.GetWidth=function(){return this.UIElement.width-this.Left-this.Right},this.GetHeight=function(){return this.UIElement.height-this.Top-this.Bottom},this.GetHeightEx=function(){return this.UIElement.height-this.Top-this.Bottom-this.TitleHeight-this.TopSpace-this.BottomSpace},this.GetRightEx=function(){return this.UIElement.width-this.Right-this.TitleHeight-this.TopSpace},this.GetWidthEx=function(){return this.UIElement.width-this.Left-this.Right-this.TitleHeight-this.TopSpace-this.BottomSpace},this.GetLeftEx=function(){return this.Left+this.BottomSpace},this.GetRightTitle=function(){return this.UIElement.width-this.Right-this.TitleHeight},this.GetTitleHeight=function(){return this.TitleHeight}}function Z(){this.HorizontalInfo=new Array,this.VerticalInfo=new Array,this.ClassName="IChartFramePainting",this.Canvas,this.Identify,this.ChartBorder,this.PenBorder=Ma.FrameBorderPen,this.TitleBGColor=Ma.FrameTitleBGColor,this.IsShow=!0,this.SizeChange=!0,this.XYSplit=!0,this.HorizontalMax,this.HorizontalMin,this.XPointCount=10,this.YSplitOperator,this.XSplitOperator,this.Data,this.IsLocked=!1,this.LockPaint=null,this.YSpecificMaxMin=null,this.IsShowBorder=!0,this.IsShowTitleArraw=!0,this.IsShowIndexName=!0,this.IndexParamSpace=2,this.Draw=function(){this.DrawFrame(),this.DrawBorder(),this.SizeChange=!1,this.XYSplit=!1},this.DrawFrame=function(){},this.DrawBorder=function(){if(this.IsShowBorder){var t=W(this.ChartBorder.GetLeft()),e=W(this.ChartBorder.GetTop()),a=W(this.ChartBorder.GetRight()),i=W(this.ChartBorder.GetBottom()),r=a-t,n=i-e;this.Canvas.strokeStyle=this.PenBorder,this.Canvas.strokeRect(t,e,r,n)}},this.DrawTitleBG=function(){if(!(this.ChartBorder.TitleHeight<=0)){var t=W(this.ChartBorder.GetLeft()),e=W(this.ChartBorder.GetTop()),a=W(this.ChartBorder.GetRight()),i=W(this.ChartBorder.GetTopTitle()),r=a-t,n=i-e;this.Canvas.fillStyle=this.TitleBGColor,this.Canvas.fillRect(t,e,r,n)}},this.DrawLock=function(){this.IsLocked&&(null==this.LockPaint&&(this.LockPaint=new Ce),this.LockPaint.Canvas=this.Canvas,this.LockPaint.ChartBorder=this.ChartBorder,this.LockPaint.ChartFrame=this,this.LockPaint.Draw(!0))},this.CalculateLock=function(){this.IsLocked&&(null==this.LockPaint&&(this.LockPaint=new Ce),this.LockPaint.Canvas=this.Canvas,this.LockPaint.ChartBorder=this.ChartBorder,this.LockPaint.ChartFrame=this,this.LockPaint.Draw(!1))},this.SetLock=function(t){t?(this.IsLocked=!0,this.LockPaint||(this.LockPaint=new Ce),t.Callback&&(this.LockPaint.Callback=t.Callback),t.IndexName&&(this.LockPaint.IndexName=t.IndexName),t.ID&&(this.LockPaint.LockID=t.ID),t.BG&&(this.LockPaint.BGColor=t.BG),t.Text&&(this.LockPaint.Title=t.Text),t.TextColor&&(this.LockPaint.TextColor=t.TextColor),t.Font&&(this.LockPaint.Font=t.Font),t.Count&&(this.LockPaint.LockCount=t.Count),t.MinWidth>0&&(this.LockPaint.MinWidth=t.MinWidth)):this.IsLocked=!1},this.GetLockRect=function(){return this.IsLocked&&this.LockPaint?this.LockPaint.LockRect:null},this.ReloadResource=function(t){for(var e in t||(this.PenBorder=Ma.FrameBorderPen,this.TitleBGColor=Ma.FrameTitleBGColor),this.HorizontalInfo){var a=this.HorizontalInfo[e];a.Font&&(a.Font=Ma.FrameSplitTextFont),a.TextColor&&(a.TextColor=Ma.FrameSplitTextColor),a.LineColor&&(a.LineColor=Ma.FrameSplitPen)}for(var e in this.VerticalInfo){a=this.VerticalInfo[e];a.Font&&(a.Font=Ma.FrameSplitTextFont),a.TextColor&&(a.TextColor=Ma.FrameSplitTextColor),a.LineColor&&(a.LineColor=Ma.FrameSplitPen)}}}function Q(){this.newMethod=Z,this.newMethod(),delete this.newMethod,this.Snapshot=function(){},this.SetSizeChage=function(t){this.SizeChange=t,this.Position={X:this.ChartBorder.UIElement.offsetLeft,Y:this.ChartBorder.UIElement.offsetTop,W:this.ChartBorder.UIElement.clientWidth,H:this.ChartBorder.UIElement.clientHeight}}}function $(){this.newMethod=Z,this.newMethod(),delete this.newMethod,this.DataWidth=50*V(),this.DistanceWidth=10*V(),this.MinXDistance=30*V(),this.MinYDistance=10*V(),this.CoordinateType=0,this.IsShowYText=[!0,!0],this.XBottomOffset=Ma.Frame.XBottomOffset,this.YTextPosition=[0,0],this.DrawDepthMapCallback,this.DrawFrame=function(){if(this.XPointCount>0){var t=this.ChartBorder.GetWidth()/(6*this.XPointCount);this.DistanceWidth=2*t,this.DataWidth=4*t}this.DrawHorizontal(),this.DrawVertical()},this.GetYFromData=function(t,e){if(this.Logarithmic&&this.GetYLogarithmicFromData)return this.GetYLogarithmicFromData(t,e);if(!1===e){if(1==this.CoordinateType){var a=this.ChartBorder.GetHeightEx()*(t-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetTopEx()+a}a=this.ChartBorder.GetHeightEx()*(t-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetBottomEx()-a}if(1==this.CoordinateType){if(t<=this.HorizontalMin)return this.ChartBorder.GetTopEx();if(t>=this.HorizontalMax)return this.ChartBorder.GetBottomEx();a=this.ChartBorder.GetHeightEx()*(t-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetTopEx()+a}if(t<=this.HorizontalMin)return this.ChartBorder.GetBottomEx();if(t>=this.HorizontalMax)return this.ChartBorder.GetTopEx();a=this.ChartBorder.GetHeightEx()*(t-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetBottomEx()-a},this.DrawHorizontal=function(){for(var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRight(),a=this.ChartBorder.GetBottom(),i=this.ChartBorder.GetTopTitle(),r=this.ChartBorder.Right,n=this.ChartBorder.Left,s=n>10&&!0===this.IsShowYText[0]&&2!=this.YTextPosition[0],o=r>10&&!0===this.IsShowYText[1]&&2!=this.YTextPosition[1],h=null,l=this.HorizontalInfo.length-1;l>=0;--l){var u=this.HorizontalInfo[l],C=this.GetYFromData(u.Value);null!=C&&Math.abs(C-h)<this.MinYDistance||(C!=a&&(this.Canvas.strokeStyle=u.LineColor,2==u.LineType?(this.Canvas.save(),this.Canvas.setLineDash([5,5]),this.Canvas.beginPath(),this.Canvas.moveTo(t,W(C)),this.Canvas.lineTo(e,W(C)),this.Canvas.stroke(),this.Canvas.restore()):Ma.FrameYLineDash?(this.Canvas.save(),this.Canvas.setLineDash(Ma.FrameYLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(t,W(C)),this.Canvas.lineTo(e,W(C)),this.Canvas.stroke(),this.Canvas.restore()):(this.Canvas.beginPath(),this.Canvas.moveTo(t,W(C)),this.Canvas.lineTo(e,W(C)),this.Canvas.stroke())),this.Canvas.textBaseline=C>=a-2?"bottom":C<=i+2?"top":"middle",null!=u.Message[0]&&s&&(null!=u.Font&&(this.Canvas.font=u.Font),this.Canvas.fillStyle=u.TextColor,this.Canvas.textAlign="right",this.Canvas.fillText(u.Message[0],t-2,C)),null!=u.Message[1]&&o&&(null!=u.Font&&(this.Canvas.font=u.Font),this.Canvas.fillStyle=u.TextColor,this.Canvas.textAlign="left",this.Canvas.fillText(u.Message[1],e+2,C)),h=C)}},this.DrawInsideHorizontal=function(){if(!0!==this.IsHScreen&&(!1!==this.IsShowYText[0]||!1!==this.IsShowYText[1])){var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRight(),a=this.ChartBorder.GetBottom(),i=this.ChartBorder.GetTopTitle(),r=this.ChartBorder.Right,n=this.ChartBorder.Left,s=(this.ChartBorder.TitleHeight,(n<10||2==this.YTextPosition[0])&&!0===this.IsShowYText[0]),o=(r<10||2==this.YTextPosition[1])&&!0===this.IsShowYText[1];if(s||o)for(var h=V(),l=null,u=this.HorizontalInfo.length-1;u>=0;--u){var C=this.HorizontalInfo[u],D=this.GetYFromData(C.Value);if(!(null!=D&&null!=l&&Math.abs(D-l)<this.MinYDistance)){if(null!=C.Message[0]&&s){null!=C.Font&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline=D>=a-2?"bottom":D<=i+2?"top":"middle";var c={X:t,Y:D,Text:{BaseLine:this.Canvas.textBaseline,TextAlign:this.Canvas.textAlign,Font:this.Canvas.font,Value:C.Message[0]}};this.IsOverlayMaxMin&&this.IsOverlayMaxMin(c)||this.Canvas.fillText(C.Message[0],t+1*h,D)}if(null!=C.Message[1]&&o){null!=C.Font&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="right",this.Canvas.textBaseline=D>=a-2?"bottom":D<=i+2?"top":"middle";var f=this.Canvas.measureText(C.Message[1]).width;c={X:e-f,Y:D,Text:{BaseLine:this.Canvas.textBaseline,TextAlign:this.Canvas.textAlign,Font:this.Canvas.font,Value:C.Message[1]}};this.IsOverlayMaxMin&&this.IsOverlayMaxMin(c)||this.Canvas.fillText(C.Message[1],e-1*h,D)}l=D}}}},this.GetXFromIndex=function(t){var e=this.XPointCount;if(1==e)return 0==t?this.ChartBorder.GetLeft():this.ChartBorder.GetRight();if(e<=0)return this.ChartBorder.GetLeft();if(t>=e)return this.ChartBorder.GetRight();var a=this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()*t/e;return a},this.DrawVertical=function(){var t=this.ChartBorder.GetTopTitle(),e=this.ChartBorder.GetBottom(),a=this.ChartBorder.GetRight(),i=(V(),null),r=null;for(var n in this.VerticalInfo){var s=this.GetXFromIndex(this.VerticalInfo[n].Value);if(s>a)break;if(!(null!=i&&Math.abs(s-i)<this.MinXDistance)){if(this.VerticalInfo[n].LineType>0&&(this.Canvas.strokeStyle=this.VerticalInfo[n].LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(W(s),t),this.Canvas.lineTo(W(s),e),this.Canvas.stroke()),null!=this.VerticalInfo[n].Message[0]){null!=this.VerticalInfo[n].Font&&(this.Canvas.font=this.VerticalInfo[n].Font);var o=0;this.Canvas.fillStyle=this.VerticalInfo[n].TextColor;var h=this.Canvas.measureText(this.VerticalInfo[n].Message[0]).width;s<h/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",o=s):s+h/2>=this.ChartBorder.GetChartWidth()?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top",o=s-h):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top",o=s-h/2),(null==r||o>r)&&(this.Canvas.fillText(this.VerticalInfo[n].Message[0],s,e+this.XBottomOffset),r=o+h)}i=s}}},this.GetYData=function(t){return this.Logarithmic&&this.GetYLogarithmicFromData?this.GetYLogarithmicData(t):1==this.CoordinateType?t<this.ChartBorder.GetTopEx()?this.HorizontalMin:t>this.ChartBorder.GetBottomEx()?this.HorizontalMax:(t-this.ChartBorder.GetTopEx())/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin:t<this.ChartBorder.GetTopEx()?this.HorizontalMax:t>this.ChartBorder.GetBottomEx()?this.HorizontalMin:(this.ChartBorder.GetBottomEx()-t)/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin},this.GetXData=function(t){return t<=this.ChartBorder.GetLeft()?0:t>=this.ChartBorder.GetRight()?this.XPointCount:(t-this.ChartBorder.GetLeft())*(1*this.XPointCount/this.ChartBorder.GetWidth())},this.DrawCustomItem=function(t){if((t.Message[1]||t.Message[0])&&!(t.Value>this.HorizontalMax||t.Value<this.HorizontalMin)){var e=this.ChartBorder.GetLeft(),a=this.ChartBorder.GetRight(),i=this.ChartBorder.GetBottom(),r=this.ChartBorder.GetTopTitle(),n=this.ChartBorder.Right,s=this.ChartBorder.Left;this.ChartBorder.TitleHeight;this.IsHScreen&&(s=this.ChartBorder.Top,n=this.ChartBorder.Bottom,r=this.ChartBorder.GetTop(),i=this.ChartBorder.GetBottom());var o=V(),h=18*o,l=this.GetYFromData(t.Value);if(t.Message[0])if(s<10){null!=t.Font&&(this.Canvas.font=t.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var u=this.Canvas.measureText(t.Message[0]).width+2*o,C=t.LineColor,D=this.RGBToStruct(t.LineColor);if(D&&(C="rgba("+D.R+", "+D.G+", "+D.B+", "+Ma.FrameLatestPrice.BGAlpha+")"),this.Canvas.fillStyle=C,this.IsHScreen){var c=r,f=l-h/2-1*o;this.Canvas.fillRect(f,c,h,u),this.DrawHScreenText({X:l,Y:c},{Text:t.Message[0],Color:t.TextColor,XOffset:1*o,YOffset:2*o}),-1!=t.LineType&&this.DrawDotLine(c+u,i,l,t.LineColor)}else{c=l-h/2-1*o,f=e+1*o;this.Canvas.fillRect(f,c,u,h),this.Canvas.fillStyle=t.TextColor,this.Canvas.fillText(t.Message[0],f+1*o,l),-1!=t.LineType&&this.DrawDotLine(f+u,a,l,t.LineColor)}}else{null!=t.Font&&(this.Canvas.font=t.Font),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle";u=this.Canvas.measureText(t.Message[0]).width+2*o;if(this.Canvas.fillStyle=t.LineColor,this.IsHScreen){c=r-u,f=l-h/2-1*o;this.Canvas.fillRect(f,c,h,u),this.DrawHScreenText({X:l,Y:c},{Text:t.Message[0],Color:t.TextColor,XOffset:1*o,YOffset:2*o}),-1!=t.LineType&&this.DrawDotLine(c+u,i,l,t.LineColor)}else{c=l-h/2-1*o;this.Canvas.fillRect(e-u,c,u,h),this.Canvas.fillStyle=t.TextColor,this.Canvas.fillText(t.Message[0],e-1*o,l),-1!=t.LineType&&this.DrawDotLine(e,a,l,t.LineColor)}}else if(t.Message[1])if(n<10){null!=t.Font&&(this.Canvas.font=t.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";u=this.Canvas.measureText(t.Message[1]).width+2*o,C=t.LineColor,D=this.RGBToStruct(t.LineColor);if(D&&(C="rgba("+D.R+", "+D.G+", "+D.B+", "+Ma.FrameLatestPrice.BGAlpha+")"),this.Canvas.fillStyle=C,this.IsHScreen){c=i-u,f=l-h/2-1*o;this.Canvas.fillRect(f,c,h,u),this.DrawHScreenText({X:l,Y:c},{Text:t.Message[1],Color:t.TextColor,XOffset:1*o,YOffset:2*o}),-1!=t.LineType&&this.DrawDotLine(r,c,l,t.LineColor)}else{c=l-h/2-1*o,f=a-u;this.Canvas.fillRect(f,c,u,h),this.Canvas.fillStyle=t.TextColor,this.Canvas.fillText(t.Message[1],f+1*o,l),-1!=t.LineType&&this.DrawDotLine(e,f,l,t.LineColor)}}else{null!=t.Font&&(this.Canvas.font=t.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";u=this.Canvas.measureText(t.Message[1]).width+2*o;if(this.Canvas.fillStyle=t.LineColor,this.IsHScreen){c=i,f=l-h/2-1*o;this.Canvas.fillRect(f,c,h,u),this.DrawHScreenText({X:l,Y:c},{Text:t.Message[1],Color:t.TextColor,XOffset:1*o,YOffset:2*o}),-1!=t.LineType&&this.DrawDotLine(r,c,l,t.LineColor)}else{c=l-h/2-1*o;this.Canvas.fillRect(a,c,u,h),this.Canvas.fillStyle=t.TextColor,this.Canvas.fillText(t.Message[1],a+1*o,l),-1!=t.LineType&&this.DrawDotLine(e,a,l,t.LineColor)}}}},this.DrawDotLine=function(t,e,a,i){var r=V();this.Canvas.save(),this.Canvas.strokeStyle=i,this.Canvas.setLineDash([5*r,5*r]),this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(W(a),t),this.Canvas.lineTo(W(a),e)):(this.Canvas.moveTo(t,W(a)),this.Canvas.lineTo(e,W(a))),this.Canvas.stroke(),this.Canvas.restore()},this.DrawHScreenText=function(t,e){this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=e.Color,this.Canvas.save(),this.Canvas.translate(t.X,t.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(e.Text,e.XOffset,e.YOffset),this.Canvas.restore()},this.RGBToStruct=function(t){if(/^(rgb|RGB)/.test(t)){var e=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),a={};return 3!=e.length?null:(a.R=Number(e[0]),a.G=Number(e[1]),a.B=Number(e[2]),a)}return null}}function tt(){this.newMethod=$,this.newMethod(),delete this.newMethod,this.MinuteCount=243,this.IsBeforeData=!1,this.BeforeBGColor=Ma.Minute.BeforeBGColor,this.CustomHorizontalInfo=[],this.RightFrame=null,this.ToolbarID=Y(),this.ModifyIndex=!0,this.ChangeIndex=!0,this.CloseIndex=!0,this.ModifyIndexEvent,this.ChangeIndexEvent,this.ToolbarRect=null,this.LastCalculateStatus={Width:0,XPointCount:0},this.DrawFrame=function(){this.SplitXYCoordinate(),this.IsBeforeData&&this.DrawBeforeDataBG(),this.DrawTitleBG(),this.DrawHorizontal(),this.DrawVertical(),1==this.SizeChange&&this.DrawToolbar()},this.DrawToolbar=function(){if(!(this.Identify<2)&&this.ChartBorder.UIElement){var t=document.getElementById(this.ToolbarID);if(!t||0!=this.SizeChange)if(t||(t=document.createElement("div"),t.className="klineframe-toolbar",t.id=this.ToolbarID,t.oncontextmenu=function(){return!1},t.setAttribute("identify",this.Identify.toString()),this.ChartBorder.UIElement.parentNode.appendChild(t)),this.ModifyIndex||this.ChangeIndex||this.OverlayIndex){var e=V(),a=parseInt(this.ChartBorder.UIElement.parentElement.style.width.replace("px","")),i=(parseInt(this.ChartBorder.UIElement.parentElement.style.height.replace("px","")),100),r=this.ChartBorder.GetTitleHeight(),n=a-this.ChartBorder.Right/e-i,s=this.ChartBorder.GetTop()/e;if(!this.ToolbarRect||this.ToolbarRect.Left!=n||this.ToolbarRect.Top!=s||this.ToolbarRect.Width!=i||this.ToolbarRect.Height!=r/e){this.ToolbarRect={Left:n,Top:s,Width:i,Height:r/e};var o="<span class='index_param icon iconfont icon-index_param' id='modifyindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='调整指标参数'></span>",h="<span class='index_change icon iconfont icon-change_index' id='changeindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='切换指标'></span>",l="<span class='index_close icon iconfont icon-close' id='closeindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='关闭指标窗口'></span>",u=o+h;this.CloseIndex&&(u+=l),t.style.left=n+"px",t.style.top=s+"px",t.style.width=i+"px",t.style.height=r/e+"px",t.innerHTML=u;this.ChartBorder.UIElement.JSChartContainer,this.Identify;this.ModifyIndex?"function"==typeof this.ModifyIndexEvent&&(0,E.default)("#"+t.id+" .index_param").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},this.ModifyIndexEvent):(0,E.default)("#"+t.id+" .index_param").hide(),this.ChangeIndex?"function"==typeof this.ChangeIndexEvent&&(0,E.default)("#"+t.id+" .index_change").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,IsOverlay:!1},this.ChangeIndexEvent):(0,E.default)("#"+t.id+" .index_change").hide(),(0,E.default)("#"+t.id+" .index_close").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},(function(t){var e=t.data.Chart,a=t.data.Identify;e.RemoveIndexWindow(a)})),t.style.display="block"}}else"none"!=t.style.display&&(t.style.display="none")}},this.ClearToolbar=function(){var t=document.getElementById(this.ToolbarID);t&&this.ChartBorder.UIElement.parentNode.removeChild(t)},this.DrawBeforeDataBG=function(){var t=W(this.ChartBorder.GetLeft()),e=W(this.ChartBorder.GetTopEx()),a=this.GetXFromIndex(14),i=W(this.ChartBorder.GetBottom()),r=a-t,n=i-e;this.Canvas.fillStyle=this.BeforeBGColor,this.Canvas.fillRect(t,e,r,n)},this.SplitXYCoordinate=function(){0!=this.XYSplit&&(null!=this.YSplitOperator&&this.YSplitOperator.Operator(),null!=this.XSplitOperator&&this.XSplitOperator.Operator())},this.GetXFromIndex=function(t){var e=this.XPointCount-1;if(1==e)return 0==t?this.ChartBorder.GetLeft():this.ChartBorder.GetRight();if(e<=0)return this.ChartBorder.GetLeft();if(t>=e)return this.ChartBorder.GetRight();var a=this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()*t/e;return a},this.GetXData=function(t){var e=this.XPointCount-1;return e<0&&(e=0),t<=this.ChartBorder.GetLeft()?0:t>=this.ChartBorder.GetRight()?e:(t-this.ChartBorder.GetLeft())*(1*e/this.ChartBorder.GetWidth())},this.DrawCustomHorizontal=function(){for(var t in this.CustomHorizontalInfo){var e=this.CustomHorizontalInfo[t];switch(e.Type){case 0:case 1:this.DrawCustomItem(e);break}}}}function et(){this.newMethod=tt,this.newMethod(),delete this.newMethod,this.IsShow=!0,this.Draw=function(){this.SplitXYCoordinate(),this.IsShow,this.SizeChange=!1,this.XYSplit=!1}}function at(){this.newMethod=tt,this.newMethod(),delete this.newMethod,this.IsHScreen=!0,this.DrawTitleBG=function(){if(!(this.ChartBorder.TitleHeight<=0)){var t=W(this.ChartBorder.GetRightEx()),e=W(this.ChartBorder.GetTop()),a=W(this.ChartBorder.GetBottom()),i=this.ChartBorder.TitleHeight,r=a-e;this.Canvas.fillStyle=this.TitleBGColor,this.Canvas.fillRect(t,e,i,r)}},this.DrawToolbar=function(){},this.DrawBeforeDataBG=function(){var t=W(this.ChartBorder.GetLeft()),e=W(this.ChartBorder.GetRightEx()),a=W(this.ChartBorder.GetTop()),i=this.GetXFromIndex(14),r=e-t,n=i-a;this.Canvas.fillStyle=this.BeforeBGColor,this.Canvas.fillRect(t,a,r,n)},this.GetYData=function(t){return t<this.ChartBorder.GetLeft()?this.HorizontalMin:t>this.ChartBorder.GetRightEx()?this.HorizontalMax:(t-this.ChartBorder.GetLeft())/this.ChartBorder.GetWidthEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin},this.GetXData=function(t){return t<=this.ChartBorder.GetTop()?0:t>=this.ChartBorder.GetBottom()?this.XPointCount:(t-this.ChartBorder.GetTop())*(1*this.XPointCount/this.ChartBorder.GetHeight())},this.GetXFromIndex=function(t){var e=this.XPointCount-1;if(1==e)return 0==t?this.ChartBorder.GetTop():this.ChartBorder.GetBottom();if(e<=0)return this.ChartBorder.GetTop();if(t>=e)return this.ChartBorder.GetBottom();var a=this.ChartBorder.GetTop()+this.ChartBorder.GetHeight()*t/e;return a},this.GetYFromData=function(t){if(t<=this.HorizontalMin)return this.ChartBorder.GetLeft();if(t>=this.HorizontalMax)return this.ChartBorder.GetRightEx();var e=this.ChartBorder.GetWidthEx()*(t-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetLeft()+e},this.DrawHorizontal=function(){for(var t=this.ChartBorder.GetTop(),e=this.ChartBorder.GetBottom(),a=this.ChartBorder.GetLeft(),i=this.ChartBorder.GetRight(),r=this.ChartBorder.Top,n=this.ChartBorder.Bottom,s=null,o=this.HorizontalInfo.length-1;o>=0;--o){var h=this.HorizontalInfo[o],l=this.GetYFromData(h.Value);if(!(null!=l&&Math.abs(l-s)<this.MinYDistance)){if(this.Canvas.strokeStyle=h.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(W(l),t),this.Canvas.lineTo(W(l),e),this.Canvas.stroke(),l>=i-2)this.Canvas.textBaseline="top",l=i;else if(l<=a+2){if(this.Canvas.textBaseline="bottom",l=a,null!=l&&Math.abs(l-s)<2*this.MinYDistance)continue}else this.Canvas.textBaseline="middle";if(null!=h.Message[0]&&r>10){null!=h.Font&&(this.Canvas.font=h.Font),this.Canvas.fillStyle=h.TextColor,this.Canvas.textAlign="right";var u=l,C=t;this.Canvas.save(),this.Canvas.translate(u,C),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(h.Message[0],-2,0),this.Canvas.restore()}if(null!=h.Message[1]&&n>10){null!=h.Font&&(this.Canvas.font=h.Font),this.Canvas.fillStyle=h.TextColor,this.Canvas.textAlign="left";u=l,C=e;this.Canvas.save(),this.Canvas.translate(u,C),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(h.Message[1],2,0),this.Canvas.restore()}s=l}}},this.DrawVertical=function(){var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRightEx(),a=this.ChartBorder.GetBottom(),i=null;for(var r in this.VerticalInfo){var n=this.GetXFromIndex(this.VerticalInfo[r].Value);if(n>a)break;if(!(null!=i&&Math.abs(n-i)<this.MinXDistance)){if(this.Canvas.strokeStyle=this.VerticalInfo[r].LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t,W(n)),this.Canvas.lineTo(e,W(n)),this.Canvas.stroke(),null!=this.VerticalInfo[r].Message[0]){null!=this.VerticalInfo[r].Font&&(this.Canvas.font=this.VerticalInfo[r].Font),this.Canvas.fillStyle=this.VerticalInfo[r].TextColor;var s=this.Canvas.measureText(this.VerticalInfo[r].Message[0]).width;n<s/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top"):n+s/2>=this.ChartBorder.GetChartHeight()?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top"):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top");var o=t,h=n;this.Canvas.save(),this.Canvas.translate(o,h),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.VerticalInfo[r].Message[0],0,0),this.Canvas.restore()}i=n}}},this.DrawInsideHorizontal=function(){if(!1!==this.IsShowYText[0]||!1!==this.IsShowYText[1]){var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRightEx(),a=this.ChartBorder.GetTop(),i=this.ChartBorder.GetBottom(),r=this.ChartBorder.Top,n=this.ChartBorder.Bottom,s=(this.ChartBorder.TitleHeight,V());if(r<10*s&&!0===this.IsShowYText[0]||n<10*s&&!0===this.IsShowYText[1]){s=V();for(var o=null,h=this.HorizontalInfo.length-1;h>=0;--h){var l=this.HorizontalInfo[h],u=this.GetYFromData(l.Value);if(!(null!=u&&null!=o&&Math.abs(u-o)<this.MinYDistance)){if(null!=l.Message[0]&&r<10*s&&!0===this.IsShowYText[0]){null!=l.Font&&(this.Canvas.font=l.Font),this.Canvas.fillStyle=l.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline=u>=e-2?"top":u<=t+2?"bottom":"middle";this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,l.Message[0];var C=u,D=a;this.Canvas.save(),this.Canvas.translate(C,D),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(l.Message[0],-2,0),this.Canvas.restore()}if(null!=l.Message[1]&&n<10*s&&!0===this.IsShowYText[1]){null!=l.Font&&(this.Canvas.font=l.Font),this.Canvas.fillStyle=l.TextColor,this.Canvas.textAlign="right",this.Canvas.textBaseline=u>=e-2?"top":u<=t+2?"bottom":"middle";var c=this.Canvas.measureText(l.Message[1]).width;this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,l.Message[1],C=u,D=i;this.Canvas.save(),this.Canvas.translate(C,D),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(l.Message[1],2,0),this.Canvas.restore()}o=u}}}}}}function it(){this.newMethod=$,this.newMethod(),delete this.newMethod,this.ClassName="KLineFrame",this.ToolbarID=Y(),this.ModifyIndex=!0,this.ChangeIndex=!0,this.CloseIndex=!0,this.OverlayIndex=!1,this.ModifyIndexEvent,this.ChangeIndexEvent,this.ToolbarRect=null,this.LastCalculateStatus={Width:0,XPointCount:0},this.CustomHorizontalInfo=[],this.IsDrawTitleBG=!1,this.CustomVerticalInfo=[],this.DrawCustomVerticalEvent,this.RightSpaceCount=0,this.Logarithmic=null,this.DrawToolbar=function(){if(this.ChartBorder.UIElement){var t=document.getElementById(this.ToolbarID);if(!t||0!=this.SizeChange)if(t||(t=document.createElement("div"),t.className="klineframe-toolbar",t.id=this.ToolbarID,t.oncontextmenu=function(){return!1},t.setAttribute("identify",this.Identify.toString()),this.ChartBorder.UIElement.parentNode.appendChild(t)),this.ModifyIndex||this.ChangeIndex||this.OverlayIndex||this.CloseIndex){var e=V(),a=parseInt(this.ChartBorder.UIElement.parentElement.style.width.replace("px","")),i=(parseInt(this.ChartBorder.UIElement.parentElement.style.height.replace("px","")),100),r=this.ChartBorder.GetTitleHeight(),n=a-this.ChartBorder.Right/e-i,s=this.ChartBorder.GetTop()/e;if(!this.ToolbarRect||this.ToolbarRect.Left!=n||this.ToolbarRect.Top!=s||this.ToolbarRect.Width!=i||this.ToolbarRect.Height!=r/e){this.ToolbarRect={Left:n,Top:s,Width:i,Height:r/e};var o="<span class='index_param icon iconfont icon-index_param' id='modifyindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='调整指标参数'></span>",h="<span class='index_change icon iconfont icon-change_index' id='changeindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='切换指标'></span>",l="<span class='index_overlay icon iconfont icon-overlay_index' id='overlayindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='叠加指标'></span>",u="<span class='index_close icon iconfont icon-close' id='closeindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='关闭指标窗口'></span>",C=o+h+l;0!==this.Identify&&this.CloseIndex&&(C+=u),t.style.left=n+"px",t.style.top=s+"px",t.style.width=i+"px",t.style.height=r/e+"px",t.innerHTML=C;this.ChartBorder.UIElement.JSChartContainer,this.Identify;this.ModifyIndex?"function"==typeof this.ModifyIndexEvent&&(0,E.default)("#"+t.id+" .index_param").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},this.ModifyIndexEvent):(0,E.default)("#"+t.id+" .index_param").hide(),this.ChangeIndex?"function"==typeof this.ChangeIndexEvent&&(0,E.default)("#"+t.id+" .index_change").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,IsOverlay:!1},this.ChangeIndexEvent):(0,E.default)("#"+t.id+" .index_change").hide(),this.OverlayIndex?(0,E.default)("#"+t.id+" .index_overlay").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,IsOverlay:!0},this.ChangeIndexEvent):(0,E.default)("#"+t.id+" .index_overlay").hide(),(0,E.default)("#"+t.id+" .index_close").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},(function(t){var e=t.data.Chart,a=t.data.Identify;e.RemoveIndexWindow(a)})),t.style.display="block"}}else"none"!=t.style.display&&(t.style.display="none")}},this.ClearToolbar=function(){var t=document.getElementById(this.ToolbarID);t&&this.ChartBorder.UIElement.parentNode.removeChild(t)},this.DrawFrame=function(){this.SplitXYCoordinate(),1==this.SizeChange&&(this.CalculateDataWidth(),this.Logarithmic&&this.SplitLogarithmicXYCoordinate()),this.DrawDepthMapCallback&&this.DrawDepthMapCallback(),this.DrawTitleBG(),this.DrawHorizontal(),this.DrawVertical(),1==this.SizeChange&&this.DrawToolbar()},this.GetXFromIndex=function(t,e){if(!1===e)if(t>=0)for(var a=this.ChartBorder.GetLeft()+2+this.DistanceWidth/2+this.DataWidth/2,i=1;i<=t;++i)a+=this.DistanceWidth+this.DataWidth;else{a=this.ChartBorder.GetLeft()+Ma.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2;var r=Math.abs(t);for(i=0;i<r;++i)a-=this.DistanceWidth+this.DataWidth}else{t<0&&(t=0),t>this.xPointCount-1&&(t=this.xPointCount-1);for(a=this.ChartBorder.GetLeft()+Ma.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2,i=1;i<=t;++i)a+=this.DistanceWidth+this.DataWidth}return a},this.GetXData=function(t){if(t<=this.ChartBorder.GetLeft())return 0;if(t>=this.ChartBorder.GetRight())return this.XPointCount-1;var e=this.ChartBorder.GetLeft()+Ma.FrameLeftMargin,a=this.ChartBorder.GetRight()-Ma.FrameRightMargin,i=this.DistanceWidth,r=this.DataWidth,n=0,s=e+i/2+r+i;while(s<a&&n<1e4&&n+1<this.XPointCount){if(s>t)break;s+=r+i,++n}return n},this.CalculateDataWidth=function(){if(!(this.XPointCount<2)){var t=this.GetFrameWidth()-Ma.FrameMargin;if(this.ZoomIndex>=0&&this.LastCalculateStatus.Width==t&&this.LastCalculateStatus.XPointCount==this.XPointCount){var e=this.DistanceWidth/2+Ma.FrameLeftMargin+(this.DataWidth+this.DistanceWidth)*(this.XPointCount-1);this.DataWidth,this.DistanceWidth,this.XPointCount;if(e<=t)return}this.LastCalculateStatus.Width=t,this.LastCalculateStatus.XPointCount=this.XPointCount;for(var a=0;a<Nt.length;++a)if((Nt[a][0]+Nt[a][1])*this.XPointCount<t)return this.ZoomIndex=a,this.DataWidth=Nt[a][0],this.DistanceWidth=Nt[a][1],this.TrimKLineDataWidth(t),void M.Chart.Log("[KLineFrame::CalculateDataWidth] ZOOM_SEED, DataWidth, DistanceWidth, XPointCount",Nt[this.ZoomIndex],this.DataWidth,this.DistanceWidth,this.XPointCount);this.ZoomIndex=Nt.length-1,this.DataWidth=t/this.XPointCount,this.DistanceWidth=0}},this.OnSize=function(t){for(var e=this.GetFrameWidth()-Ma.FrameMargin,a=0,i=this.DistanceWidth/2+Ma.FrameLeftMargin+(this.DataWidth+this.DistanceWidth);i<e;i+=this.DataWidth+this.DistanceWidth,++a);return t.CurCount=this.XPointCount,t.CalcCount=a,t.DataWidth=this.DataWidth,t.DistanceWidth=this.DistanceWidth,t.Changed=!1,this.LastCalculateStatus.Width=e,t.CurCount==t.CalcCount?t:(this.XPointCount=a,this.LastCalculateStatus.XPointCount=this.XPointCount,this.Data&&(this.Data.DataOffset+=t.CurCount-t.CalcCount,this.Data.DataOffset<0&&(this.Data.DataOffset=0),t.Changed=!0),t)},this.SetDataWidth=function(t){var e=Nt.length-1;for(var a in Nt){var i=Nt[a];if(i[0]<=t){e=parseInt(a)-1;break}}this.ZoomIndex=e,this.DataWidth=Nt[this.ZoomIndex][0],this.DistanceWidth=Nt[this.ZoomIndex][1];for(var r=this.GetFrameWidth()-Ma.FrameMargin,n=0,s=this.DistanceWidth/2+Ma.FrameLeftMargin+(this.DataWidth+this.DistanceWidth);s<=r;s+=this.DataWidth+this.DistanceWidth,++n);this.XPointCount=n,this.LastCalculateStatus.XPointCount=this.XPointCount,this.LastCalculateStatus.Width=r;var o={XPointCount:this.XPointCount,DataWidth:this.DataWidth,DistanceWidth:this.DistanceWidth};return o},this.TrimKLineDataWidth=function(t){var e=Nt[this.ZoomIndex][0],a=Nt[this.ZoomIndex][1];if(1!=e||0!=a)while(1){if((this.DistanceWidth+this.DataWidth)*this.XPointCount+this.DistanceWidth>t){this.DistanceWidth-=.01;break}this.DistanceWidth+=.01}else this.DataWidth=t/this.XPointCount},this.IsOverlayMaxMin=function(t){if(!this.ChartKLine)return!1;if(!this.ChartKLine.Max||!this.ChartKLine.Min)return!1;var e=this.Canvas.measureText(t.Text.Value).width+4;"right"===t.Text.TextAlign&&(t.X-=e);var a=this.ChartKLine.Max,i=this.ChartKLine.Min,r=!1,n=!1,s=20;if(a.X>=t.X&&a.X<=t.X+e){var o=a.Y+s,h=a.Y-s;(o>=t.Y-s&&o<=t.Y+s||h>=t.Y-s&&h<=t.Y+s)&&(r=!0)}if(1==r)return!0;if(i.X>=t.X&&i.X<=t.X+e){o=i.Y+s,h=i.Y-s;(o>=t.Y-s&&o<=t.Y+s||h>=t.Y-s&&h<=t.Y+s)&&(n=!0)}return r||n},this.SplitXYCoordinate=function(){0!=this.XYSplit&&(null!=this.YSplitOperator&&this.YSplitOperator.Operator(),null!=this.XSplitOperator&&this.XSplitOperator.Operator(),this.Logarithmic&&this.SplitLogarithmicXYCoordinate())},this.SplitLogarithmicXYCoordinate=function(){for(var t=this.Logarithmic.Up,e=this.Logarithmic.Down,a=0,i=0,r=Math.max(t.length,e.length),n=[],s=0;s<r;++s)n[s]=2*s;s=0;for(var o=n.length-1;s<t.length;++s,--o){var h=t[s];h.LogHeight=n[o],a+=h.LogHeight,++i}for(s=0,o=n.length-1;s<e.length;++s,--o){h=e[s];h.LogHeight=n[o],a+=h.LogHeight,++i}var l=2*V(),u=this.ChartBorder.GetTopEx(),C=this.ChartBorder.GetBottomEx(),D=C-u,c=(D-a*l)/i;if(1==this.CoordinateType){var f=u;for(s=e.length-1;s>=0;--s){h=e[s];h.Height=c+l*h.LogHeight,h.Top=f,h.Bottom=h.Top+h.Height,f=h.Bottom}var d=C;for(s=t.length-1;s>=0;--s){h=t[s];h.Height=c+l*h.LogHeight,h.Bottom=d,h.Top=d-h.Height,d=h.Top}}else{for(f=u,s=t.length-1;s>=0;--s){h=t[s];h.Height=c+l*h.LogHeight,h.Top=f,h.Bottom=h.Top+h.Height,f=h.Bottom}for(d=C,s=e.length-1;s>=0;--s){h=e[s];h.Height=c+l*h.LogHeight,h.Bottom=d,h.Top=d-h.Height,d=h.Top}}M.Chart.Log("[KLineFrame::SplitLogarithmicXYCoordinate]",this.Logarithmic)},this.GetYLogarithmicFromData=function(t,e){if(1==this.CoordinateType){if(t<=this.HorizontalMin)return this.ChartBorder.GetTopEx();if(t>=this.HorizontalMax)return this.ChartBorder.GetBottomEx();if(t>this.Logarithmic.OpenPrice){var a=this.Logarithmic.Up;for(var i in a){var r=a[i];if(t>=r.Start&&t<=r.End){var n=r.Bottom-r.Top,s=n*(t-r.Start)/(r.End-r.Start);return r.Top+s}}}else{var o=this.Logarithmic.Down;for(var i in o){r=o[i];if(t>=r.Start&&t<=r.End){n=r.Bottom-r.Top,s=n*(t-r.Start)/(r.End-r.Start);return r.Top+s}}}}else{if(t<=this.HorizontalMin)return this.ChartBorder.GetBottomEx();if(t>=this.HorizontalMax)return this.ChartBorder.GetTopEx();if(t>this.Logarithmic.OpenPrice){a=this.Logarithmic.Up;for(var i in a){r=a[i];if(t>=r.Start&&t<=r.End){n=r.Bottom-r.Top,s=n*(t-r.Start)/(r.End-r.Start);return r.Bottom-s}}}else{o=this.Logarithmic.Down;for(var i in o){r=o[i];if(t>=r.Start&&t<=r.End){n=r.Bottom-r.Top,s=n*(t-r.Start)/(r.End-r.Start);return r.Bottom-s}}}}},this.GetYLogarithmicData=function(t){if(1==this.CoordinateType){if(t<this.ChartBorder.GetTopEx())return this.HorizontalMin;if(t>this.ChartBorder.GetBottomEx())return this.HorizontalMax;var e=this.Logarithmic.Up;for(var a in e){var i=e[a];if(t>=i.Top&&t<=i.Bottom)return(t-i.Top)/i.Height*(i.End-i.Start)+i.Start}var r=this.Logarithmic.Down;for(var a in r){i=r[a];if(t>=i.Top&&t<=i.Bottom)return(t-i.Top)/i.Height*(i.End-i.Start)+i.Start}}else{if(t<this.ChartBorder.GetTopEx())return this.HorizontalMax;if(t>this.ChartBorder.GetBottomEx())return this.HorizontalMin;e=this.Logarithmic.Up;for(var a in e){i=e[a];if(t>=i.Top&&t<=i.Bottom)return(i.Bottom-t)/i.Height*(i.End-i.Start)+i.Start}r=this.Logarithmic.Down;for(var a in r){i=r[a];if(t>=i.Top&&t<=i.Bottom)return(i.Bottom-t)/i.Height*(i.End-i.Start)+i.Start}}},this.CalculateCount=function(t){var e=this.GetFrameWidth()-Ma.FrameMargin;return parseInt(e/(Nt[t][0]+Nt[t][1]))},this.ZoomUp=function(t){if(this.ZoomIndex<=0)return!1;if(this.Data.DataOffset<0)return!1;var e=this.Data.Data.length,a=e+this.RightSpaceCount,i=0,r=this.Data.DataOffset+this.XPointCount-1,n=this.Data.DataOffset+t.Index;r>=e&&(i=r-(this.Data.Data.length-1),r=this.Data.Data.length-1,i>this.RightSpaceCount&&(i=this.RightSpaceCount));var s=this.CalculateCount(this.ZoomIndex-1);M.Chart.Log("[KLineFrame::ZoomUp] old status. XPointCount="+s+" ZoomIndex="+this.ZoomIndex+" DataCount= "+this.Data.Data.length+" rightSpaceCount="+i);var o=!1;if(--this.ZoomIndex,1==t.IsLockRight){var h=this.Data.DataOffset+this.XPointCount;if(s>h)s=h,this.XPointCount=s,this.Data.DataOffset=0;else{var l=r-(s-i)+1;this.XPointCount=s,this.Data.DataOffset=l,this.Data.DataOffset<0&&(this.Data.DataOffset=0)}}else if(s>=a)this.Data.DataOffset=0,o=!0,M.Chart.Log("[KLineFrame::ZoomUp] Show all data. XPointCount="+s+" ZoomIndex="+this.ZoomIndex+" DataCount= "+e);else{l=r-(s-i)+1;if(1==t.ZoomType){var u=this.XPointCount-s+1,C=parseInt(t.Index/this.XPointCount*u);l=this.Data.DataOffset+C}this.XPointCount=s,this.Data.DataOffset=l,this.Data.DataOffset<0&&(this.Data.DataOffset=0),M.Chart.Log("[KLineFrame::ZoomUp] calculate. XPointCount="+s+" ZoomIndex="+this.ZoomIndex+" DataCount= "+e+" DataOffset="+this.Data.DataOffset)}if(this.DataWidth=Nt[this.ZoomIndex][0],this.DistanceWidth=Nt[this.ZoomIndex][1],!o){var D=this.GetFrameWidth()-Ma.FrameMargin;this.TrimKLineDataWidth(D)}return this.LastCalculateStatus.XPointCount=this.XPointCount,t.Index=n-this.Data.DataOffset,!0},this.ZoomDown=function(t){if(this.ZoomIndex+1>=Nt.length)return!1;if(this.Data.DataOffset<0)return!1;var e=this.Data.Data.length,a=e+this.RightSpaceCount,i=0,r=this.Data.DataOffset+this.XPointCount-1;r>=this.Data.Data.length&&(i=r-(this.Data.Data.length-1),r=this.Data.Data.length-1,i>this.RightSpaceCount&&(i=this.RightSpaceCount));var n=this.CalculateCount(this.ZoomIndex+1),s=this.Data.DataOffset+t.Index;M.Chart.Log("[KLineFrame::ZoomDown] old status. XPointCount="+n+" ZoomIndex="+this.ZoomIndex+" DataCount= "+this.Data.Data.length+" lastCursorIndex="+s+" rightSpaceCount="+i);var o=!1;if(++this.ZoomIndex,1==t.IsLockRight){var h=this.Data.DataOffset+this.XPointCount;if(n>h)n=h,this.XPointCount=n,this.Data.DataOffset=0;else{var l=r-(n-i)+1;this.XPointCount=n,this.Data.DataOffset=l,this.Data.DataOffset<0&&(this.Data.DataOffset=0)}}else if(n>=a)this.XPointCount=n,this.Data.DataOffset=0,o=!0,M.Chart.Log("[KLineFrame::ZoomDown] Show all data. XPointCount="+n+" ZoomIndex="+this.ZoomIndex+" DataCount= "+e);else{l=r-(n-i)+1;if(1==t.ZoomType){var u=n-this.XPointCount+1,C=parseInt(t.Index/this.XPointCount*u);l=this.Data.DataOffset-C;l+(n-this.RightSpaceCount)>=e&&(l=this.Data.DataOffset-u)}this.XPointCount=n,this.Data.DataOffset=l,this.Data.DataOffset<0&&(this.Data.DataOffset=0),M.Chart.Log("[KLineFrame::ZoomDown] calculate. XPointCount="+n+" ZoomIndex="+this.ZoomIndex+" DataCount= "+e+" DataOffset="+this.Data.DataOffset)}if(this.DataWidth=Nt[this.ZoomIndex][0],this.DistanceWidth=Nt[this.ZoomIndex][1],!o){var D=this.GetFrameWidth()-Ma.FrameMargin;this.TrimKLineDataWidth(D)}return this.LastCalculateStatus.XPointCount=this.XPointCount,t.Index=s-this.Data.DataOffset,!0},this.GetFrameWidth=function(){return this.IsHScreen?this.ChartBorder.GetHeight():this.ChartBorder.GetWidth()},this.DrawCustomHorizontal=function(){for(var t in this.CustomHorizontalInfo){var e=this.CustomHorizontalInfo[t];switch(e.Type){case 0:case 1:this.DrawCustomItem(e);break}}},this.DrawCustomVerticalItem=function(t){this.Canvas.save(),1==t.Data.Line.Type&&this.Canvas.setLineDash([5,5]),this.Canvas.strokeStyle=t.Data.Line.Color,this.Canvas.beginPath(),t.IsHScreen?(this.Canvas.moveTo(t.Top,W(t.X)),this.Canvas.lineTo(t.Bottom,W(t.X))):(this.Canvas.moveTo(W(t.X),t.Top),this.Canvas.lineTo(W(t.X),t.Bottom)),this.Canvas.stroke(),this.Canvas.restore()},this.DrawCustomVertical=function(){if(this.CustomVerticalInfo&&!(this.CustomVerticalInfo.length<=0)&&this.Data){var t=this.IsHScreen,e=this.ChartBorder.GetTopEx(),a=this.ChartBorder.GetBottomEx(),i=this.DataWidth,r=this.DistanceWidth,n=this.ChartBorder.GetLeft()+r/2+2;t&&(n=this.ChartBorder.GetTop()+r/2+2,e=this.ChartBorder.GetLeftEx(),a=this.ChartBorder.GetRightEx());for(var s=0,o=this.Data.DataOffset;o<this.Data.Data.length&&s<this.XPointCount;++o,++s,n+=i+r){var h=this.Data.Data[o];for(var l in this.CustomVerticalInfo){var u=this.CustomVerticalInfo[l];if(0==u.Type){if(Le.IsNumber(u.Time)){if(h.Date!=u.Date||h.Time!=u.Time)continue}else if(h.Date!=u.Date)continue;var C=n,D=n+i,c=C+(D-C)/2,f={X:c,Top:e,Bottom:a,Data:u,IsHScreen:t};this.DrawCustomVerticalItem(f),this.DrawCustomVerticalEvent&&this.DrawCustomVerticalEvent.Callback(this.DrawCustomVerticalEvent,f,this);break}}}for(o=1;s<this.XPointCount;++o,++s,n+=i+r)for(var l in this.CustomVerticalInfo){u=this.CustomVerticalInfo[l];if(1==u.Type&&u.Space==o){C=n,D=n+i,c=C+(D-C)/2,f={X:c,Top:e,Bottom:a,Data:u,IsHScreen:t};this.DrawCustomVerticalItem(f),this.DrawCustomVerticalEvent&&this.DrawCustomVerticalEvent.Callback(this.DrawCustomVerticalEvent,f,this);break}}}}}function rt(){this.newMethod=it,this.newMethod(),delete this.newMethod,this.ClassName="OverlayKLineFrame",this.MainFrame=null,this.RightOffset=50,this.PenBorder=Ma.OverlayFrame.BolderPen,this.IsShow=!0,this.Title=null,this.TitleColor=Ma.OverlayFrame.TitleColor,this.TitleFont=Ma.OverlayFrame.TitleFont,this.Draw=function(){this.SplitXYCoordinate(),this.IsShow&&(this.DrawVertical(),this.DrawHorizontal(),this.DrawTitle()),this.SizeChange=!1,this.XYSplit=!1},this.DrawTitle=function(){if(this.Title){var t=this.ChartBorder.GetTopTitle(),e=this.ChartBorder.GetBottom(),a=this.ChartBorder.GetRight();a+=this.RightOffset,this.Canvas.fillStyle=this.TitleColor,this.Canvas.font=this.TitleFont,this.Canvas.textAlign="center",this.Canvas.textBaseline="top";var i=a-2,r=t+(e-t)/2;this.Canvas.save(),this.Canvas.translate(i,r),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.Title,0,0),this.Canvas.restore()}},this.SplitXYCoordinate=function(){0!=this.XYSplit&&null!=this.YSplitOperator&&this.YSplitOperator.Operator()},this.DrawHorizontal=function(){this.ChartBorder.GetLeft();var t=this.ChartBorder.GetRight(),e=this.ChartBorder.GetBottom(),a=this.ChartBorder.GetTopTitle(),i=this.ChartBorder.Right;t+=this.RightOffset;for(var r=null,n=this.HorizontalInfo.length-1;n>=0;--n){var s=this.HorizontalInfo[n],o=this.GetYFromData(s.Value);null!=o&&Math.abs(o-r)<this.MinYDistance||(this.Canvas.textBaseline=o>=e-2?"bottom":o<=a+2?"top":"middle",this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(t-2,W(o)),this.Canvas.lineTo(t,W(o)),this.Canvas.stroke(),null!=s.Message[1]&&i>10&&(null!=s.Font&&(this.Canvas.font=s.Font),this.Canvas.fillStyle=s.TextColor,this.Canvas.textAlign="left",this.Canvas.fillText(s.Message[1],t+2,o)),r=o)}},this.DrawVertical=function(){var t=this.ChartBorder.GetTopEx(),e=this.ChartBorder.GetRight(),a=this.ChartBorder.GetBottomEx();e+=this.RightOffset,this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(W(e),W(t)),this.Canvas.lineTo(W(e),W(a)),this.Canvas.stroke()}}function nt(){this.newMethod=it,this.newMethod(),delete this.newMethod,this.ClassName="KLineHScreenFrame",this.IsHScreen=!0,this.DrawTitleBG=function(){if(!(this.ChartBorder.TitleHeight<=0)){var t=W(this.ChartBorder.GetRightTitle()),e=W(this.ChartBorder.GetTop()),a=W(this.ChartBorder.GetBottom()),i=this.ChartBorder.TitleHeight,r=a-e;this.Canvas.fillStyle=this.TitleBGColor,this.Canvas.fillRect(t,e,i,r)}},this.DrawToolbar=function(){},this.GetYFromData=function(t){if(t<=this.HorizontalMin)return this.ChartBorder.GetLeftEx();if(t>=this.HorizontalMax)return this.ChartBorder.GetRightEx();var e=this.ChartBorder.GetWidthEx()*(t-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetLeftEx()+e},this.DrawHorizontal=function(){for(var t=this.ChartBorder.GetTop(),e=this.ChartBorder.GetBottom(),a=this.ChartBorder.Top,i=this.ChartBorder.Bottom,r=this.ChartBorder.GetLeft(),n=(this.ChartBorder.GetRight(),null),s=V(),o=a>10*s&&!0===this.IsShowYText[0]&&2!=this.YTextPosition[0],h=i>10*s&&!0===this.IsShowYText[1]&&2!=this.YTextPosition[1],l=this.HorizontalInfo.length-1;l>=0;--l){var u=this.HorizontalInfo[l],C=this.GetYFromData(u.Value);if(!(null!=C&&Math.abs(C-n)<this.MinYDistance)){if(C!=r&&(this.Canvas.strokeStyle=u.LineColor,Ma.FrameYLineDash?(this.Canvas.save(),this.Canvas.setLineDash(Ma.FrameYLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(W(C),t),this.Canvas.lineTo(W(C),e),this.Canvas.stroke(),this.Canvas.restore()):(this.Canvas.beginPath(),this.Canvas.moveTo(W(C),t),this.Canvas.lineTo(W(C),e),this.Canvas.stroke())),null!=u.Message[0]&&o){null!=u.Font&&(this.Canvas.font=u.Font),this.Canvas.fillStyle=u.TextColor,this.Canvas.textAlign="right",this.Canvas.textBaseline="middle";var D=C,c=t;this.Canvas.save(),this.Canvas.translate(D,c),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(u.Message[0],-2,0),this.Canvas.restore()}if(null!=u.Message[1]&&h){null!=u.Font&&(this.Canvas.font=u.Font),this.Canvas.fillStyle=u.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";D=C,c=e;this.Canvas.save(),this.Canvas.translate(D,c),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(u.Message[1],2,0),this.Canvas.restore()}n=C}}},this.DrawInsideHorizontal=function(){if(!1!==this.IsShowYText[0]||!1!==this.IsShowYText[1]){var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRightEx(),a=this.ChartBorder.GetTop(),i=this.ChartBorder.GetBottom(),r=this.ChartBorder.Top,n=this.ChartBorder.Bottom,s=(this.ChartBorder.TitleHeight,V()),o=(r<10*s||2==this.YTextPosition[0])&&!0===this.IsShowYText[0],h=(n<10*s||2==this.YTextPosition[1])&&!0===this.IsShowYText[1];if(o||h){s=V();for(var l=null,u=this.HorizontalInfo.length-1;u>=0;--u){var C=this.HorizontalInfo[u],D=this.GetYFromData(C.Value);if(!(null!=D&&null!=l&&Math.abs(D-l)<this.MinYDistance)){if(null!=C.Message[0]&&o){null!=C.Font&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline=D>=e-2?"top":D<=t+2?"bottom":"middle";this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,C.Message[0];var c=D,f=a;this.Canvas.save(),this.Canvas.translate(c,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C.Message[0],-2,0),this.Canvas.restore()}if(null!=C.Message[1]&&h){null!=C.Font&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="right",this.Canvas.textBaseline=D>=e-2?"top":D<=t+2?"bottom":"middle";var d=this.Canvas.measureText(C.Message[1]).width;this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,C.Message[1],c=D,f=i;this.Canvas.save(),this.Canvas.translate(c,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C.Message[1],2,0),this.Canvas.restore()}l=D}}}}},this.GetXFromIndex=function(t){t<0&&(t=0),t>this.xPointCount-1&&(t=this.xPointCount-1);for(var e=this.ChartBorder.GetTop()+2+this.DistanceWidth/2+this.DataWidth/2,a=1;a<=t;++a)e+=this.DistanceWidth+this.DataWidth;return e},this.DrawVertical=function(){var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRightTitle(),a=this.ChartBorder.GetBottom(),i=null;for(var r in this.VerticalInfo){var n=this.GetXFromIndex(this.VerticalInfo[r].Value);if(n>=a)break;if(!(null!=i&&Math.abs(n-i)<80)){if(this.Canvas.strokeStyle=this.VerticalInfo[r].LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t,W(n)),this.Canvas.lineTo(e,W(n)),this.Canvas.stroke(),null!=this.VerticalInfo[r].Message[0]){null!=this.VerticalInfo[r].Font&&(this.Canvas.font=this.VerticalInfo[r].Font),this.Canvas.fillStyle=this.VerticalInfo[r].TextColor;var s=this.Canvas.measureText(this.VerticalInfo[r].Message[0]).width;n<s/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top"):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top");var o=t,h=n;this.Canvas.save(),this.Canvas.translate(o,h),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.VerticalInfo[r].Message[0],0,0),this.Canvas.restore()}i=n}}},this.GetYData=function(t){return t<this.ChartBorder.GetLeftEx()?this.HorizontalMin:t>this.ChartBorder.GetRightEx()?this.HorizontalMax:(t-this.ChartBorder.GetLeftEx())/this.ChartBorder.GetWidthEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin},this.GetXData=function(t){if(t<=this.ChartBorder.GetTop())return 0;if(t>=this.ChartBorder.GetBottom())return this.XPointCount-1;var e=this.ChartBorder.GetTop(),a=this.ChartBorder.GetBottom(),i=this.DistanceWidth,r=this.DataWidth,n=0,s=e+i/2+r+i;while(s<a&&n<1e4&&n+1<this.XPointCount){if(s>t)break;s+=r+i,++n}return n}}function st(){this.newMethod=nt,this.newMethod(),delete this.newMethod,this.ClassName="OverlayKLineHScreenFrame",this.MainFrame=null,this.RightOffset=50,this.PenBorder=Ma.OverlayFrame.BolderPen,this.IsShow=!0,this.Title=null,this.TitleColor=Ma.OverlayFrame.TitleColor,this.TitleFont=Ma.OverlayFrame.TitleFont,this.Draw=function(){this.SplitXYCoordinate(),this.IsShow&&(this.DrawVertical(),this.DrawHorizontal(),this.DrawTitle()),this.SizeChange=!1,this.XYSplit=!1},this.DrawTitle=function(){},this.SplitXYCoordinate=function(){0!=this.XYSplit&&null!=this.YSplitOperator&&this.YSplitOperator.Operator()},this.DrawHorizontal=function(){},this.DrawVertical=function(){}}function ot(){this.Frame,this.Height,this.OverlayIndex=[],this.Interval=60}function ht(){this.Frame,this.ChartPaint=[],this.Identify=Y(),this.Scprit,this.UpdateFrameMaxMin=function(){var t={Max:null,Min:null};if(this.Frame.YSpecificMaxMin)t.Max=this.Frame.YSpecificMaxMin.Max,t.Min=this.Frame.YSpecificMaxMin.Min;else for(var e in this.ChartPaint){var a=this.ChartPaint[e],i=a.GetMaxMin();Le.IsNumber(i.Max)&&(null==t.Max||t.Max<i.Max)&&(t.Max=i.Max),Le.IsNumber(i.Min)&&(null==t.Min||t.Min>i.Min)&&(t.Min=i.Min)}null!=t.Max&&null!=t.Min&&(this.Frame.HorizontalMax=t.Max,this.Frame.HorizontalMin=t.Min,this.Frame.XYSplit=!0)}}function lt(){this.SubFrame=new Array,this.SizeChange=!0,this.ChartBorder,this.Canvas,this.ScreenImageData,this.Data,this.Position,this.SizeChange=!0,this.CalculateChartBorder=function(){if(!(this.SubFrame.length<=0)){var t=this.ChartBorder.GetTop(),e=this.ChartBorder.GetHeight(),a=0;for(var i in this.SubFrame){var r=this.SubFrame[i];a+=r.Height}for(var i in this.SubFrame){r=this.SubFrame[i];r.Frame.ChartBorder.Top=t,r.Frame.ChartBorder.Left=this.ChartBorder.Left,r.Frame.ChartBorder.Right=this.ChartBorder.Right;var n=e*(r.Height/a)+t;r.Frame.ChartBorder.Bottom=this.ChartBorder.GetChartHeight()-n,t=n}}},this.CalculateChartBorder2=function(){if(!(this.SubFrame.length<=0)){var t=this.ChartBorder.Top,e=this.ChartBorder.Bottom,a=this.ChartBorder.GetHeight(),i=0;for(var r in this.SubFrame){var n=this.SubFrame[r];i+=n.Height}var s=0;for(var r in this.SubFrame){n=this.SubFrame[r];n.Frame.ChartBorder.Top=t,n.Frame.ChartBorder.Left=this.ChartBorder.Left,n.Frame.ChartBorder.Right=this.ChartBorder.Right,n.Frame.ChartBorder.X=this.ChartBorder.X,n.Frame.ChartBorder.Y=this.ChartBorder.Y,n.Frame.ChartBorder.Width=this.ChartBorder.Width,n.Frame.ChartBorder.Height=this.ChartBorder.Height;var o=a*(n.Height/i);s+=o,e=this.ChartBorder.Bottom+(a-s),n.Frame.ChartBorder.Bottom=e,t+=o}}},this.Draw=function(){for(var t in!0===this.SizeChange&&this.CalculateChartBorder(),this.SubFrame){var e=this.SubFrame[t];if(!(e.Height<=0)){e.Frame.Draw();var a=e.Interval;for(var i in e.OverlayIndex){var r=e.OverlayIndex[i];r.Frame.DataWidth=e.Frame.DataWidth,r.Frame.DistanceWidth=e.Frame.DistanceWidth,r.Frame.XPointCount=e.Frame.XPointCount,r.ChartPaint.length>0&&r.Frame.IsShow&&(r.Frame.RightOffset=a,r.Frame.Draw(),a+=e.Interval)}}}this.SizeChange=!1},this.DrawOveraly=function(){for(var t in this.SubFrame){var e=this.SubFrame[t];for(var a in e.OverlayIndex){var i=e.OverlayIndex[a];for(var r in i.ChartPaint)i.ChartPaint[r].IsShow&&i.ChartPaint[r].Draw()}}},this.DrawLock=function(){for(var t in this.SubFrame){var e=this.SubFrame[t];e.Frame.DrawLock()}},this.CalculateLock=function(){for(var t in this.SubFrame){var e=this.SubFrame[t];e.Frame.CalculateLock()}},this.DrawInsideHorizontal=function(){for(var t in this.SubFrame){var e=this.SubFrame[t];e.Frame.DrawInsideHorizontal&&e.Frame.DrawInsideHorizontal()}},this.DrawCustomHorizontal=function(){for(var t in this.SubFrame){var e=this.SubFrame[t];e.Frame.DrawCustomHorizontal&&e.Frame.DrawCustomHorizontal()}},this.DrawCustomVertical=function(t){for(var e in this.SubFrame){var a=this.SubFrame[e];a.Frame.DrawCustomVerticalEvent=t,a.Frame.DrawCustomVertical&&a.Frame.DrawCustomVertical()}},this.SetSizeChage=function(t){for(var e in this.SizeChange=t,this.SubFrame){var a=this.SubFrame[e];for(var i in a.Frame.SizeChange=t,a.OverlayIndex){var r=a.OverlayIndex[i];r.Frame&&(r.Frame.SizeChange=t)}}this.ChartBorder.UIElement&&(this.Position={X:this.ChartBorder.UIElement.offsetLeft,Y:this.ChartBorder.UIElement.offsetTop,W:this.ChartBorder.UIElement.clientWidth,H:this.ChartBorder.UIElement.clientHeight})},this.SetDrawDepthMap=function(t){for(var e in this.SubFrame){var a=this.SubFrame[e];a.Frame.DrawDepthMapCallback=t}},this.Snapshot=function(){this.ScreenImageData=this.Canvas.getImageData(0,0,this.ChartBorder.GetChartWidth(),this.ChartBorder.GetChartHeight())},this.GetXData=function(t){return this.SubFrame[0].Frame.GetXData(t)},this.GetYData=function(t,e){var a;for(var i in this.SubFrame){var r=this.SubFrame[i],n=r.Frame.ChartBorder.GetLeft(),s=r.Frame.ChartBorder.GetTopEx(),o=r.Frame.ChartBorder.GetWidth(),h=r.Frame.ChartBorder.GetHeightEx();if(r.Frame.Canvas.beginPath(),r.Frame.Canvas.rect(n,s,o,h),r.Frame.Canvas.isPointInPath(n,t)){a=r.Frame,e&&(e.FrameID=parseInt(i));break}}if(null!=a){a.RightFrame&&(e.RightYValue=a.RightFrame.GetYData(t));var l=a.GetYData(t);if(1==a.YSplitOperator.CoordinateType){var u=a.YSplitOperator.GetFirstOpenPrice();e.RightYValue=((l-u)/u*100).toFixed(2)+"%"}return l}},this.PtInFrame=function(t,e){for(var a in this.SubFrame){var i=this.SubFrame[a],r=i.Frame.ChartBorder.GetLeft(),n=i.Frame.ChartBorder.GetTop(),s=i.Frame.ChartBorder.GetWidth(),o=i.Frame.ChartBorder.GetHeight();if(i.Frame.Canvas.beginPath(),i.Frame.Canvas.rect(r,n,s,o),i.Frame.Canvas.isPointInPath(t,e))return parseInt(a)}return-1},this.GetXFromIndex=function(t){return this.SubFrame[0].Frame.GetXFromIndex(t)},this.GetYFromData=function(t){return this.SubFrame[0].Frame.GetYFromData(t)},this.ZoomUp=function(t){var e=this.SubFrame[0].Frame.ZoomUp(t);return this.UpdateAllFrame(),e},this.ZoomDown=function(t){var e=this.SubFrame[0].Frame.ZoomDown(t);return this.UpdateAllFrame(),e},this.ResetXYSplit=function(){for(var t in this.SubFrame)this.SubFrame[t].Frame.XYSplit=!0},this.SetLanguage=function(t){for(var e in this.SubFrame){var a=this.SubFrame[e];a&&a.Frame&&(a.Frame.YSplitOperator&&(a.Frame.YSplitOperator.LanguageID=t),a.Frame.XSplitOperator&&(a.Frame.XSplitOperator.LanguageID=t))}},this.GetCurrentPageSize=function(){if(this.SubFrame.length<=0)return null;var t=this.SubFrame[0];return t&&t.Frame?t.Frame.XPointCount:null},this.OnSize=function(){var t={};return this.SubFrame[0].Frame.OnSize(t),this.UpdateAllFrame(),t},this.SetDataWidth=function(t){var e=this.SubFrame[0].Frame.SetDataWidth(t);return this.UpdateAllFrame(),e},this.UpdateAllFrame=function(){for(var t=this.SubFrame[0].Frame,e=0;e<this.SubFrame.length;++e){var a=this.SubFrame[e];for(var i in e>0&&(a.Frame.XPointCount=t.XPointCount,a.Frame.ZoomIndex=t.ZoomIndex,a.Frame.DataWidth=t.DataWidth,a.Frame.DistanceWidth=t.DistanceWidth,a.Frame.LastCalculateStatus.Width=t.LastCalculateStatus.Width,a.Frame.LastCalculateStatus.XPointCount=t.LastCalculateStatus.XPointCount),a.OverlayIndex){var r=this.SubFrame[e].OverlayIndex[i];r.Frame.XPointCount=t.XPointCount,r.Frame.ZoomIndex=t.ZoomIndex,r.Frame.DataWidth=t.DataWidth,r.Frame.DistanceWidth=t.DistanceWidth,r.Frame.LastCalculateStatus.Width=t.LastCalculateStatus.Width,r.Frame.LastCalculateStatus.XPointCount=t.LastCalculateStatus.XPointCount}}}}function ut(){this.newMethod=lt,this.newMethod(),delete this.newMethod,this.IsHScreen=!0,this.CalculateChartBorder=function(){if(!(this.SubFrame.length<=0)){var t=this.ChartBorder.Right,e=this.ChartBorder.GetRight(),a=this.ChartBorder.GetWidth(),i=0;for(var r in this.SubFrame){var n=this.SubFrame[r];i+=n.Height}for(var r in this.SubFrame){n=this.SubFrame[r];n.Frame.ChartBorder.Top=this.ChartBorder.Top,n.Frame.ChartBorder.Bottom=this.ChartBorder.Bottom;var s=a*(n.Height/i);n.Frame.ChartBorder.Right=t,n.Frame.ChartBorder.Left=e-s,t+=s,e-=s}}},this.GetYData=function(t,e){var a;for(var i in this.SubFrame){var r=this.SubFrame[i],n=r.Frame.ChartBorder.GetLeftEx(),s=r.Frame.ChartBorder.GetTop(),o=r.Frame.ChartBorder.GetWidthEx(),h=r.Frame.ChartBorder.GetHeight();if(r.Frame.Canvas.beginPath(),r.Frame.Canvas.rect(n,s,o,h),r.Frame.Canvas.isPointInPath(t,s)){a=r.Frame,e&&(e.FrameID=i);break}}if(null!=a)return a.GetYData(t)}}function Ct(){this.newMethod=$,this.newMethod(),delete this.newMethod,this.ScreenImageData,this.Position,this.DrawFrame=function(){if(this.XPointCount>0){var t=this.ChartBorder.GetWidth()/(6*this.XPointCount);this.DistanceWidth=2*t,this.DataWidth=4*t}this.SplitXYCoordinate(),this.DrawHorizontal(),this.DrawVertical()},this.GetXFromIndex=function(t){t<0&&(t=0),t>this.xPointCount-1&&(t=this.xPointCount-1);for(var e=this.ChartBorder.GetLeft()+2+this.DistanceWidth/2+this.DataWidth/2,a=1;a<=t;++a)e+=this.DistanceWidth+this.DataWidth;return e},this.SplitXYCoordinate=function(){0!=this.XYSplit&&(null!=this.YSplitOperator&&this.YSplitOperator.Operator(),null!=this.XSplitOperator&&this.XSplitOperator.Operator())},this.Snapshot=function(){this.ScreenImageData=this.Canvas.getImageData(0,0,this.ChartBorder.GetChartWidth(),this.ChartBorder.GetChartHeight())},this.SetSizeChage=function(t){this.SizeChange=t,this.Position={X:this.ChartBorder.UIElement.offsetLeft,Y:this.ChartBorder.UIElement.offsetTop,W:this.ChartBorder.UIElement.clientWidth,H:this.ChartBorder.UIElement.clientHeight}}}function Dt(){this.Date,this.YClose,this.Open,this.Close,this.High,this.Low,this.Vol,this.Amount,this.Time,this.FlowCapital=0,this.Position=null,this.Stop,this.Up,this.Down,this.Unchanged}function ct(){this.Close,this.Open,this.High,this.Low,this.Vol,this.Amount,this.DateTime,this.Increase,this.Risefall,this.AvPrice,this.Lead=null,this.Time,this.Date,this.Position=null}function ft(){this.Date,this.Time,this.Value}Number.prototype.toFixed2=Number.prototype.toFixed,Number.prototype.toFixed=function(t){return k(this,t)},Dt.Copy=function(t){var e=new Dt;return e.Date=t.Date,e.YClose=t.YClose,e.Open=t.Open,e.Close=t.Close,e.High=t.High,e.Low=t.Low,e.Vol=t.Vol,e.Amount=t.Amount,e.Time=t.Time,e.FlowCapital=t.FlowCapital,e.Position=t.Position,e.Stop=t.Stop,e.Up=t.Up,e.Down=t.Down,e.Unchanged=t.Unchanged,e},Dt.CopyTo=function(t,e){t.Date=e.Date,t.YClose=e.YClose,t.Open=e.Open,t.Close=e.Close,t.High=e.High,t.Low=e.Low,t.Vol=e.Vol,t.Amount=e.Amount,t.Time=e.Time,t.FlowCapital=e.FlowCapital,t.Position=e.Position,t.Stop=e.Stop,t.Up=e.Up,t.Down=e.Down,t.Unchanged=e.Unchanged},Dt.CopyRight=function(t,e){var a=new Dt;return a.Date=t.Date,a.YClose=t.YClose*e,a.Open=t.Open*e,a.Close=t.Close*e,a.High=t.High*e,a.Low=t.Low*e,a.Vol=t.Vol,a.Amount=t.Amount,a.FlowCapital=t.FlowCapital,a.Position=t.Position,a};var dt={INVESTOR:1,ANNOUNCEMENT:2,PFORECAST:3,ANNOUNCEMENT_QUARTER_1:4,ANNOUNCEMENT_QUARTER_2:5,ANNOUNCEMENT_QUARTER_3:6,ANNOUNCEMENT_QUARTER_4:7,RESEARCH:8,BLOCKTRADING:9,TRADEDETAIL:10,ANNOUNCEMENT_EX_START:100,ANNOUNCEMENT_EX_END:200};function mt(){this.ID,this.Date,this.Title,this.InfoType,this.ExtendData}function vt(){this.PeriodCallback=new g.default,this.GetPeriodCallback=function(t){return this.PeriodCallback.has(t)?this.PeriodCallback.get(t):null},this.AddPeriodCallback=function(t){if(Le.IsNumber(t.Period)&&t.Callback){var e={Period:t.Period,Callback:t.Callback};this.PeriodCallback.set(t.Period,e)}},this.RemovePeriodCallback=function(t){this.PeriodCallback.has(t.ID)&&this.PeriodCallback.delete(t.ID)}}vt.GetMinutePeriodData=null;var St=new vt;function It(){this.Data=new Array,this.DataOffset=0,this.Period=0,this.Right=0,this.Symbol,this.Data2=new Array,this.GetCloseMA=function(t){for(var e=new Array,a=0,i=this.Data.length;a<i;a++)if(a<t)e[a]=null;else{for(var r=0,n=0;n<t;n++)r+=this.Data[a-n].Close;e[a]=r/t}return e},this.GetVolMA=function(t){for(var e=new Array,a=0,i=this.Data.length;a<i;a++)if(a<t)e[a]=null;else{for(var r=0,n=0;n<t;n++)r+=this.Data[a-n].Vol;e[a]=r/t}return e},this.GetAmountMA=function(t){for(var e=new Array,a=0,i=this.Data.length;a<i;a++)if(a<t)e[a]=null;else{for(var r=0,n=0;n<t;n++)r+=this.Data[a-n].Amount;e[a]=r/t}return e},this.GetClose=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Close;return t},this.GetYClose=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].YClose;return t},this.GetHigh=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].High;return t},this.GetLow=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Low;return t},this.GetOpen=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Open;return t},this.GetVol=function(t){var e=1;Le.IsNumber(t)>0&&(e=t);var a=new Array;for(var i in this.Data)a[i]=this.Data[i].Vol/e;return a},this.GetAmount=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Amount;return t},this.GetPosition=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Position;return t},this.GetLead=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Lead;return t},this.GetDate=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Date;return t},this.GetTime=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Time;return t},this.GetUp=function(){var t=[];for(var e in this.Data)t[e]=this.Data[e].Up;return t},this.GetDown=function(){var t=[];for(var e in this.Data)t[e]=this.Data[e].Down;return t},this.GetYear=function(){var t=new Array;for(var e in this.Data)t[e]=parseInt(this.Data[e].Date/1e4);return t},this.GetMonth=function(){var t=new Array;for(var e in this.Data)t[e]=parseInt(this.Data[e].Date%1e4/100);return t},this.GetDateRange=function(){if(!this.Data||this.Data.length<=0)return null;var t=this.Data[0],e=this.Data[this.Data.length-1],a={Start:{Date:t.Date},End:{Date:e.Date}};return Le.IsNumber(t.Time)&&(a.Start.Time=t.Time),Le.IsNumber(e.Time)&&(a.End.Time=e.Time),a},this.GetMinutePeriodData=function(t){if(vt.GetMinutePeriodData)return vt.GetMinutePeriodData(t,this.Data,this);var e=new Array,a=5;if(5==t)a=5;else if(6==t)a=15;else if(7==t)a=30;else if(8==t)a=60;else if(11==t)a=120;else{if(12!=t)return t>At&&t<=gt?(a=t-At,this.GetMinuteCustomPeriodData(a)):this.Data;a=240}for(var i=!1,r=null,n=null,s=0;s<this.Data.length;){i=!0;for(var o=0;o<a&&s<this.Data.length;++s){i&&(r=new Dt,e.push(r),i=!1);var h=this.Data[s];if(null!=h){if((925!=h.Time||null!=n&&924==n)&&(930!=h.Time||null!=n&&929==n)&&(1300!=h.Time||null!=n&&1259==n)&&++o,r.Date=h.Date,r.Time=h.Time,n=r.Time,null!=h.Open&&null!=h.Close&&(null==r.Open||null==r.Close?(r.Open=h.Open,r.High=h.High,r.Low=h.Low,r.YClose=h.YClose,r.Close=h.Close,r.Vol=h.Vol,r.Amount=h.Amount,r.FlowCapital=h.FlowCapital,r.Position=h.Position):(r.High<h.High&&(r.High=h.High),r.Low>h.Low&&(r.Low=h.Low),r.Close=h.Close,r.Vol+=h.Vol,null!=h.Amount&&(r.Amount+=h.Amount),r.Position=h.Position,r.FlowCapital=h.FlowCapital),s+1<this.Data.length)){var l=this.Data[s+1];if(l&&l.Date!=h.Date){++s;break}}}else++o}}return e},this.GetMinuteCustomPeriodData=function(t){for(var e=new Array,a=t,i=!1,r=null,n=0;n<this.Data.length;){i=!0;for(var s=0;s<a&&n<this.Data.length;++n,++s){i&&(r=new Dt,e.push(r),i=!1);var o=this.Data[n];null!=o&&(r.Date=o.Date,r.Time=o.Time,null!=o.Open&&null!=o.Close&&(null==r.Open||null==r.Close?(r.Open=o.Open,r.High=o.High,r.Low=o.Low,r.YClose=o.YClose,r.Close=o.Close,r.Vol=o.Vol,r.Amount=o.Amount,r.FlowCapital=o.FlowCapital,r.Position=o.Position):(r.High<o.High&&(r.High=o.High),r.Low>o.Low&&(r.Low=o.Low),r.Close=o.Close,r.Vol+=o.Vol,null!=o.Amount&&(r.Amount+=o.Amount),r.Position=o.Position,r.FlowCapital=o.FlowCapital)))}}return e},this.GetDayPeriodData=function(t){if(t>pt&&t<=Tt)return this.GetDayCustomPeriodData(t-pt);var e=Li.IsBIT(this.Symbol),a=new Array,i=0,r=2,n=null;for(var s in this.Data){var o=!1,h=this.Data[s];switch(t){case 1:if(e)var l=It.GetSunday(h.Date);else l=It.GetFirday(h.Date);l!=i&&(o=!0,i=l);break;case 21:if(e)l=It.GetSunday(h.Date);else l=It.GetFirday(h.Date);l!=i&&(++r,r>=2&&(o=!0,r=0),i=l);break;case 2:parseInt(h.Date/100)!=parseInt(i/100)&&(o=!0,i=h.Date);break;case 3:parseInt(h.Date/1e4)!=parseInt(i/1e4)&&(o=!0,i=h.Date);break;case 9:var u=It.GetQuarter(h.Date);u=10*parseInt(h.Date/1e4)+u;var C=It.GetQuarter(i);C=10*parseInt(i/1e4)+C,u!=C&&(o=!0,i=h.Date);break}if(o){if(n=new Dt,n.Date=h.Date,a.push(n),null==h.Open||null==h.Close)continue;n.Open=h.Open,n.High=h.High,n.Low=h.Low,n.YClose=h.YClose,n.Close=h.Close,n.Vol=h.Vol,n.Amount=h.Amount,n.FlowCapital=h.FlowCapital,n.Position=h.Position}else{if(null==n)continue;if(null==h.Open||null==h.Close)continue;null==n.Open||null==n.Close?(n.Open=h.Open,n.High=h.High,n.Low=h.Low,n.YClose=h.YClose,n.Close=h.Close,n.Vol=h.Vol,n.Amount=h.Amount,n.FlowCapital=h.FlowCapital,n.Position=h.Position):(n.High<h.High&&(n.High=h.High),n.Low>h.Low&&(n.Low=h.Low),n.Close=h.Close,n.Vol+=h.Vol,null!=h.Amount&&(n.Amount+=h.Amount),n.Position=h.Position,n.FlowCapital=h.FlowCapital,n.Date=h.Date)}}return a},this.GetDayCustomPeriodData=function(t){for(var e=[],a=t,i=!1,r=null,n=0;n<this.Data.length;){i=!0;for(var s=0;s<a&&n<this.Data.length;++n,++s){i&&(r=new Dt,e.push(r),i=!1);var o=this.Data[n];null!=o&&(r.Date=o.Date,null!=o.Open&&null!=o.Close&&(null==r.Open||null==r.Close?(r.Open=o.Open,r.High=o.High,r.Low=o.Low,r.YClose=o.YClose,r.Close=o.Close,r.Vol=o.Vol,r.Amount=o.Amount,r.FlowCapital=o.FlowCapital,r.Position=o.Position):(r.High<o.High&&(r.High=o.High),r.Low>o.Low&&(r.Low=o.Low),r.Close=o.Close,r.Vol+=o.Vol,null!=o.Amount&&(r.Amount+=o.Amount),r.Position=o.Position,r.FlowCapital=o.FlowCapital)))}}return e},this.GetPeriodData=function(t){var e=St.GetPeriodCallback(t);if(e)return e.Callback(t,this.Data,this);if(Li.IsBIT(this.Symbol)&&(5==t||6==t||7==t||8==t||t>At&&t<=gt)){var a=5;return 5==t?a=5:6==t?a=15:7==t?a=30:8==t?a=60:11==t?a=120:12==t?a=240:t>At&&t<=gt&&(a=t-At),this.GetMinuteCustomPeriodData(a)}return 1==t||2==t||3==t||9==t||21==t||t>pt&&t<=Tt?this.GetDayPeriodData(t):5==t||6==t||7==t||8==t||11==t||12==t||t>At&&t<=gt?this.GetMinutePeriodData(t):void 0},this.GetRightDate=function(t){var e=[];if(this.Data.length<=0)return e;if(1==t){var a=this.Data.length-1,i=1,r=this.Data[a].YClose;for(e[a]=Dt.Copy(this.Data[a]),--a;a>=0;--a){if(r!=this.Data[a].Close)break;e[a]=Dt.Copy(this.Data[a]),r=this.Data[a].YClose}for(;a>=0;--a)r!=this.Data[a].Close&&(i*=r/this.Data[a].Close),e[a]=Dt.CopyRight(this.Data[a],i),r=this.Data[a].YClose}else if(2==t){a=0,i=1;var n=this.Data[a].Close;for(e[a]=Dt.Copy(this.Data[a]),++a;a<this.Data.length;++a){if(n!=this.Data[a].YClose)break;e[a]=Dt.Copy(this.Data[a]),n=this.Data[a].Close}for(;a<this.Data.length;++a)n!=this.Data[a].YClose&&(i*=n/this.Data[a].YClose),e[a]=Dt.CopyRight(this.Data[a],i),n=this.Data[a].Close}return e},this.GetRightData=this.GetRightDate,this.GetOverlayData=function(t,e){for(var a=[],i=0,r=0;i<this.Data.length;){var n=this.Data[i].Date;if(r>=t.length)a[i]=new Dt,a[i].Date=n,++i;else{var s=t[r].Date;s==n?(a[i]=new Dt,a[i].Date=t[r].Date,a[i].YClose=t[r].YClose,a[i].Open=t[r].Open,a[i].High=t[r].High,a[i].Low=t[r].Low,a[i].Close=t[r].Close,a[i].Vol=t[r].Vol,a[i].Amount=t[r].Amount,a[i].Stop=t[r].Stop,a[i].Up=t[r].Up,a[i].Down=t[r].Down,a[i].Unchanged=t[r].Unchanged,++r,++i):s<n?++r:(a[i]=new Dt,a[i].Date=n,++i)}}return a},this.GetOverlayMinuteData=function(t,e){for(var a=[],i=0,r=0;i<this.Data.length;){var n=this.Data[i].Date,s=this.Data[i].Time;if(r>=t.length)a[i]=new Dt,a[i].Date=n,a[i].Time=s,++i;else{var o=t[r].Date,h=t[r].Time;o==n&&h==s?(a[i]=new Dt,a[i].Date=t[r].Date,a[i].Time=t[r].Time,a[i].YClose=t[r].YClose,a[i].Open=t[r].Open,a[i].High=t[r].High,a[i].Low=t[r].Low,a[i].Close=t[r].Close,a[i].Vol=t[r].Vol,a[i].Amount=t[r].Amount,a[i].Stop=t[r].Stop,a[i].Up=t[r].Up,a[i].Down=t[r].Down,a[i].Unchanged=t[r].Unchanged,++r,++i):o<n||o==n&&h<s?++r:(a[i]=new Dt,a[i].Date=n,a[i].Time=s,++i)}}return a},this.GetFittingData=function(t){for(var e=new Array,a=0,i=0;a<this.Data.length;){var r=this.Data[a].Date;if(i>=t.length)e[a]=null,++a;else{var n=t[i].Date;if(n==r){var s=new ft;s.Date=t[i].Date,s.Value=t[i].Value,e[a]=s,++i,++a}else n<r?++i:(e[a]=new ft,e[a].Date=r,++a)}}return e},this.GetFittingData2=function(t,e){for(var a=new Array,i=0,r=0;i<this.Data.length;){var n=this.Data[i].Date;if(r>=t.length)a[i]=new ft,a[i].Date=n,a[i].Value=e,++i;else{var s=t[r].Date;if(s==n){var o=new ft;o.Date=t[r].Date,o.Value=t[r].Value,a[i]=o,++r,++i}else s<n?++r:(a[i]=new ft,a[i].Date=n,a[i].Value=e,++i)}}return a},this.GetDateIndex=function(t){for(var e=0,a=0;e<this.Data.length;){var i=this.Data[e].Date;if(a>=t.length)break;var r=t[a];r.Date==i?(r.Index=e,++a):r.Date<i?++a:++e}},this.GetDateTimeIndex=function(t){for(var e=0,a=0;e<this.Data.length;){var i=this.Data[e].Date,r=this.Data[e].Time;if(a>=t.length)break;var n=t[a];n.Date==i&&n.Time==r?(n.Index=e,++a):n.Date<i||n.Date==i&&n.Time<r?++a:++e}},this.GetMinuteFittingData=function(t){for(var e=[],a=0,i=0;a<this.Data.length;){var r=this.Data[a].Date,n=this.Data[a].Time;if(i>=t.length)e[a]=null,++a;else{var s=t[i].Date,o=t[i].Time,h=t[i];if(s==r&&o==n){var l=new ft;l.Date=h.Date,l.Time=h.Time,l.Value=h.Value,e[a]=l,++i,++a}else if(s<r||s==r&&o<n)++i;else{l=new ft;l.Date=r,l.Time=n,e[a]=l,++a}}}return e},this.GetFittingFinanceData=function(t){for(var e=[],a=0,i=0;a<this.Data.length;){var r=this.Data[a].Date;if(i+1<t.length&&t[i].Date<r&&t[i+1].Date<=r)++i;else{var n=new ft;n.Date=r,i<t.length?(n.Value=t[i].Value,n.FinanceDate=t[i].Date):(n.Value=null,n.FinanceDate=null),e[a]=n,++a}}return e},this.GetMinuteFittingFinanceData=function(t){for(var e=[],a=0,i=0;a<this.Data.length;){var r=this.Data[a].Date,n=this.Data[a].Time;if(i+1<t.length&&t[i].Date<r&&t[i+1].Date<=r)++i;else{var s=new ft;s.Date=r,s.Time=n,i<t.length?(s.Value=t[i].Value,s.FinanceDate=t[i].Date):(s.Value=null,s.FinanceDate=null),e[a]=s,++a}}return e},this.GetFittingMarketValueData=function(t){for(var e=[],a=0,i=0;a<this.Data.length;){var r=this.Data[a].Date,n=this.Data[a].Close;if(i+1<t.length&&t[i].Date<r&&t[i+1].Date<=r)++i;else{var s=new ft;s.Date=r,s.Value=t[i].Value*n,s.FinanceDate=t[i].Date,e[a]=s,++a}}return e},this.GetFittingMonthData=function(t){for(var e=new Array,a=null,i=0,r=0;i<this.Data.length;){var n=this.Data[i].Date;if(r>=t.length)e[i]=null,++i;else{var s=t[r].Date;if(s==n){var o=new ft;o.Date=t[r].Date,o.Value=t[r].Value,o.Text=t[r].Text,e[i]=o,++r,++i}else if(null!=a&&a<s&&n>s){o=new ft;o.Date=n,o.OverlayDate=t[r].Date,o.Value=t[r].Value,o.Text=t[r].Text,e[i]=o,++r,++i}else s<n?++r:(e[i]=new ft,e[i].Date=n,++i);a=n}}return e},this.GetValue=function(){var t=[];for(var e in this.Data)if(this.Data[e]&&null!=this.Data[e].Value){var a=this.Data[e].Value;isNaN(a)?t[e]=a instanceof Array?a:null:t[e]=a}else t[e]=null;return t},this.GetObject=function(){var t=[];for(var e in this.Data)if(this.Data[e]&&this.Data[e].Value){var a=this.Data[e].Value;t[e]=a}else t[e]=null;return t},this.GetPeriodSingleData=function(t){var e=new Array,a=0,i=2,r=null;for(var n in this.Data){var s=!1,o=this.Data[n];if(null!=o&&null!=o.Date){switch(t){case 1:var h=It.GetFirday(o.Date);h!=a&&(s=!0,a=h);break;case 21:h=It.GetFirday(o.Date);h!=a&&(++i,i>=2&&(s=!0,i=0),a=h);break;case 2:parseInt(o.Date/100)!=parseInt(a/100)&&(s=!0,a=o.Date);break;case 3:parseInt(o.Date/1e4)!=parseInt(a/1e4)&&(s=!0,a=o.Date);break;case 9:var l=It.GetQuarter(o.Date);l=10*parseInt(o.Date/1e4)+l;var u=It.GetQuarter(a);u=10*parseInt(a/1e4)+u,l!=u&&(s=!0,a=o.Date);break}if(s)r=new ft,r.Date=o.Date,r.Value=o.Value,e.push(r);else{if(null==r)continue;if(null==o.Value||isNaN(o.Value))continue;(null==r.Value||isNaN(r.Value))&&(r.Value=o.Value)}}}return e},this.GetMinuteAvPrice=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].AvPrice;return t},this.MergeMinuteData=function(t){for(var e=this.Data[0],a=0,i=null,r=0;r<t.length;++r){var n=t[r];if(n.Date>e.Date){a=r,i=n;break}if(n.Date==e.Date&&n.Time>=e.Time){a=r,i=n;break}}if(null==i)return!1;var s=null,o=!1;for(r=this.Data.length-1;r>=0;--r){var h=this.Data[r].Date,l=this.Data[r].Time;if(i.Date>h||i.Date==h&&i.Time>=l){s=r,i.Date==h&&i.Time==l&&(o=!0);break}}if(null==s)return!1;var u=s;r=a;if(1==o){n=t[r];u-1>0&&!n.YClose&&(n.YClose=this.Data[u-1].Close);var C=Dt.Copy(n);this.Data[u]=C,++u,++r}else++u;for(;r<t.length;){n=t[r];if(u>=this.Data.length-1){u-1>0&&!n.YClose&&(n.YClose=this.Data[u-1].YClose);C=Dt.Copy(n);this.Data[u]=C,++u,++r}else{var D=this.Data[u];D.Date==n.Date&&D.Time==n.Time?(Dt.CopyTo(D,n),++u,++r):++u}}return!0},this.CoverTo=function(t,e,a){for(var i=[],r=null,n=It.IsMinutePeriod(e,!0),s=It.IsMinutePeriod(a,!0),o=n&&s,h=n&&!s,l=!n&&!s,u=0,C=0;u<this.Data.length;++u){for(var D=this.Data[u];C<t.length;++C){var c=t[C];if(o){if(c.Date==D.Date&&c.Time>=D.Time){r=c;break}}else if((h||l)&&c.Date>=D.Date){r=c;break}}var f=null;r?(f=Dt.Copy(r),f.PDate=r.Date,f.PTime=r.Time):f=new Dt,f.Date=D.Date,o&&h&&(f.Time=D.Time),i.push(f)}return M.Chart.Log("[ChartData::CoverTo] result",i),i},this.GetRef=function(t){for(var e=[],a=0;a<this.Data.length;++a){e[a]=null;var i=this.Data[a];if(a-t<0){var r=new Dt;r.Date=i.Date,r.Time=i.Time,e[a]=r}else{var n=this.Data[a-t];r=Dt.Copy(n);r.Date=i.Date,r.Time=i.Time,e[a]=r}}return e},this.FitKLineIndex=function(t,e,a,i){for(var r=this.Data.length,n=t.length,s=[It.IsMinutePeriod(a,!0),It.IsMinutePeriod(i,!0)],o=[It.IsDayPeriod(a,!0),It.IsDayPeriod(i,!0)],h=It.GetKLineDataTime(this.Data[0]),l=[],u=n,C=0;C<n;++C){var D=It.GetKLineDataTime(t[C]);if(o[0]&&o[1]||s[0]&&o[1]){if(D.Date>=h.Date){u=C;break}}else if(s[0]&&s[1]){if(D.Date>h.Date){u=C;break}if(D.Date==h.Date&&D.Time>=h.Time){u=C;break}}}C=0;for(var c=u;C<r;){D=It.GetKLineDataTime(this.Data[C]);if(c>=n){var f={Date:D.Date,Time:D.Time,Index:-1};l[C]=f,++C}else{var d=It.GetKLineDataTime(t[c]);if(o[0]&&o[1]||s[0]&&o[1])if(d.Date==D.Date){f={Date:D.Date,Time:D.Time,Index:c,Data2:d.Date,Time2:d.Time};l[C]=f,++C}else if(c+1<n){var m=It.GetKLineDataTime(t[c+1]);if(d.Date<=D.Date&&m.Date>D.Date){f={Date:D.Date,Time:D.Time,Index:c,Data2:d.Date,Time2:d.Time};l[C]=f,++C}else if(m.Date<=D.Date)++c;else{f={Date:D.Date,Time:D.Time,Index:-1};l[C]=f,++C}}else++c;else if(s[0]&&s[1])if(d.Date==D.Date&&d.Time==D.Time){f={Date:D.Date,Time:D.Time,Index:c,Data2:d.Date,Time2:d.Time};l[C]=f,++C}else if(c+1<n){m=It.GetKLineDataTime(t[c+1]);if(d.Date<D.Date&&m.Date>D.Date||d.Date==D.Date&&d.Time<D.Time&&m.Date==D.Date&&m.Time>D.Time||d.Date==D.Date&&d.Time<D.Time&&m.Date>D.Date||d.Date<D.Date&&m.Date==D.Date&&m.Time>D.Time){f={Date:D.Date,Time:D.Time,Index:c,Data2:d.Date,Time2:d.Time};l[C]=f,++C}else if(m.Date<D.Date||m.Date==D.Date&&m.Time<=D.Time)++c;else{f={Date:D.Date,Time:D.Time,Index:-1};l[C]=f,++C}}else++c}}var v=[];for(var C in e){D=e[C];if(Array.isArray(D.Data)){var S=[];v[C]={Data:S,Name:D.Name};for(c=0;c<l.length;++c){var I=l[c];S[c]=null,I&&I.Index>=0&&I.Index<D.Data.length&&(S[c]=D.Data[I.Index])}}else v[C]={Data:D.Data,Name:D.Name}}return v},this.FindDataIndexByDateTime=function(t){var e=0;for(var a in t)t[a].Index=-1;for(var a in this.Data){var i=this.Data[a];for(var r in t){var n=t[r];if(!(n.Index>=0)){if(Le.IsNumber(n.Time)){if(n.Date==i.Date&&n.Time==i.Time){n.Index=parseInt(a),++e;break}}else if(n.Date==i.Date){n.Index=parseInt(a),++e;break}if(e>=t.length)break}}}},this.CloneData=function(t){var e=[];if("HistoryData"==t)for(var a in this.Data){var i=this.Data[a],r=Dt.Copy(i);e.push(r)}return e}}It.GetKLineDataTime=function(t){var e={Date:t.Date,Time:0};return Le.IsNumber(t.Time)&&(e.Time=t.Time),e},It.GetFirday=function(t){var e=new Date(parseInt(t/1e4),t/100%100-1,t%100),a=e.getDay();if(5==a)return t;var i=e.getTime();if(a<5){var r=864e5*(5-a);i+=r}else{r=864e5*(a-5);i-=r}e.setTime(i);var n=1e4*e.getFullYear()+100*(e.getMonth()+1)+e.getDate();e.getDay();return n},It.GetSunday=function(t){var e=new Date(parseInt(t/1e4),t/100%100-1,t%100),a=e.getDay();if(0==a)return t;var i=e.getTime();if(a>0){var r=864e5*(7-a);i+=r}e.setTime(i);var n=1e4*e.getFullYear()+100*(e.getMonth()+1)+e.getDate();e.getDay();return n},It.GetQuarter=function(t){var e=parseInt(t%1e4/100);return 1==e||2==e||3==e?1:4==e||5==e||6==e?2:7==e||8==e||9==e?3:10==e||11==e||12==e?4:0};var pt=4e4,Tt=49999;It.IsDayPeriod=function(t,e){return 1==t||2==t||3==t||9==t||21==t||(t>pt&&t<=Tt||0==t&&1==e)};var At=2e4,gt=29999;It.IsMinutePeriod=function(t,e){return 5==t||6==t||7==t||8==t||11==t||12==t||(t>At&&t<=gt||4==t&&1==e)};var Ft=3e4,Et=32e3;function Lt(){this.ChartPaint,this.Data,this.Type=0}function Mt(t,e,a,i){this.X=t,this.Y=e,this.Width=a,this.Height=i}function xt(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="IChartPainting",this.Data=new It,this.NotSupportMessage=null,this.MessageFont=Ma.Index.NotSupport.Font,this.MessageColor=Ma.Index.NotSupport.TextColor,this.IsDrawFirst=!1,this.IsShow=!0,this.Draw=function(){},this.DrawNotSupportmessage=function(){this.Canvas.font=this.MessageFont,this.Canvas.fillStyle=this.MessageColor;var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetWidth(),a=this.ChartBorder.GetTopEx(),i=this.ChartBorder.GetHeightEx(),r=t+e/2,n=a+i/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.NotSupportMessage,r,n)},this.GetTooltipData=function(t,e,a){return!1},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Min:null,Max:null};if(!this.Data||!this.Data.Data)return e;for(var a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];null==r||isNaN(r)||(null==e.Max&&(e.Max=r),null==e.Min&&(e.Min=r),e.Max<r&&(e.Max=r),e.Min>r&&(e.Min=r))}return e},this.GetDynamicFont=function(t){var e,a=V();return e=t<5?4*a+"px Arial":t<7?6*a+"px Arial":t<9?8*a+"px Arial":t<11?10*a+"px Arial":t<13?12*a+"px Arial":t<15?14*a+"px Arial":16*a+"px Arial",e},this.GetLockRect=function(){return this.ChartFrame.GetLockRect()},this.SetFillStyle=function(t,e,a,i,r){if(Array.isArray(t)){var n=this.Canvas.createLinearGradient(e,a,i,r),s=1/t.length;for(var o in t)n.addColorStop(o*s,t[o]);this.Canvas.fillStyle=n}else this.Canvas.fillStyle=t}}It.IsSecondPeriod=function(t){return t>Ft&&t<=Et},It.IsTickPeriod=function(t){return 10==t},It.GetPeriodName=function(t){var e=new g.default([[0,"日线"],[1,"周线"],[2,"月线"],[3,"年线"],[9,"季线"],[21,"双周"],[4,"1分"],[5,"5分"],[6,"15分"],[7,"30分"],[8,"60分"],[11,"2小时"],[12,"4小时"],[10,"分笔"]]);return e.has(t)?e.get(t):""};var Nt=[[48,10],[44,10],[40,9],[36,9],[32,8],[28,8],[24,7],[20,7],[18,6],[16,6],[14,5],[12,5],[8,4],[6,4],[4,4],[3,3],[3,1],[2,1],[1,1],[1,0]];function Ot(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartKLine",this.Symbol,this.DrawType=0,this.CloseLineColor=Ma.CloseLineColor,this.CloseLineAreaColor=Ma.CloseLineAreaColor,this.UpColor=Ma.UpBarColor,this.DownColor=Ma.DownBarColor,this.UnchagneColor=Ma.UnchagneBarColor,this.ColorData,this.TradeData,this.TradeIcon=Ma.KLine.TradeIcon,this.TooltipRect=[],this.InfoTooltipRect=[],this.TradeIconTooltipRect=[],this.IsShowMaxMinPrice=!0,this.IsShowKTooltip=!0,this.TextFont=Ma.KLine.MaxMin.Font,this.TextColor=Ma.KLine.MaxMin.Color,this.InfoData,this.InfoPosition=0,this.PtMax,this.PtMin,this.TickSymbol="╳",this.TickFontName="arial",this.Period,this.ShowRange={},this.ReloadResource=function(t){this.TextFont=Ma.KLine.MaxMin.Font,this.TextColor=Ma.KLine.MaxMin.Color,this.CloseLineColor=Ma.CloseLineColor,this.CloseLineAreaColor=Ma.CloseLineAreaColor,this.UpColor=Ma.UpBarColor,this.DownColor=Ma.DownBarColor,this.UnchagneColor=Ma.UnchagneBarColor},this.DrawAKLine=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2;t&&(i=this.ChartBorder.GetTop()+a/2+2);var r=this.ChartBorder.GetRight();t&&(r=this.ChartBorder.GetBottom());for(var n=this.ChartFrame.XPointCount,s=(this.UpColor,this.DownColor,this.UnchagneColor,{X:null,Y:null,Value:null,Align:"left"}),o={X:null,Y:null,Value:null,Align:"left"},h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<n;++h,++l,i+=e+a){var u=this.Data.Data[h];if(null!=u.Open&&null!=u.High&&null!=u.Low&&null!=u.Close){var C=i,D=i+e;if(D>r)break;var c=C+(D-C)/2,f=this.ChartFrame.GetYFromData(u.Low),d=this.ChartFrame.GetYFromData(u.High),m=this.ChartFrame.GetYFromData(u.Open),v=this.ChartFrame.GetYFromData(u.Close);if((null==s.Value||s.Value<u.High)&&(s.X=c,s.Y=d,s.Value=u.High,s.Align=l<n/2?"left":"right"),(null==o.Value||o.Value>u.Low)&&(o.X=c,o.Y=f,o.Value=u.Low,o.Align=l<n/2?"left":"right"),u.Open<u.Close?this.Canvas.strokeStyle=this.UpColor:u.Open>u.Close?this.Canvas.strokeStyle=this.DownColor:this.Canvas.strokeStyle=this.UnchagneColor,this.ColorData&&(h<this.ColorData.length&&this.ColorData[h]>0?this.UpColor:this.DownColor),this.Canvas.beginPath(),t?(this.Canvas.moveTo(d,W(c)),this.Canvas.lineTo(f,W(c))):(this.Canvas.moveTo(W(c),d),this.Canvas.lineTo(W(c),f)),this.Canvas.stroke(),e>=4&&(this.Canvas.beginPath(),t?(this.Canvas.moveTo(W(m),C),this.Canvas.lineTo(W(m),c)):(this.Canvas.moveTo(C,W(m)),this.Canvas.lineTo(c,W(m))),this.Canvas.stroke(),this.Canvas.beginPath(),t?(this.Canvas.moveTo(W(v),D),this.Canvas.lineTo(W(v),c)):(this.Canvas.moveTo(D,W(v)),this.Canvas.lineTo(c,W(v))),this.Canvas.stroke()),0==this.Data.DataType){var S={Xleft:C,XRight:D,YMax:d,XCenter:c,YMin:f,DayData:u,Index:l};this.DrawInfo(S)}}}this.PtMax=s,this.PtMin=o},this.DrawCloseArea=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2;t&&(i=this.ChartBorder.GetTop()+a/2+2);var r=this.ChartBorder.GetRight();t&&(r=this.ChartBorder.GetBottom());var n=this.ChartFrame.XPointCount,s=!0,o=null;this.Canvas.beginPath(),this.Canvas.strokeStyle=this.CloseLineColor;for(var h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<n;++h,++l,i+=e+a){var u=this.Data.Data[h];if(null!=u.Open&&null!=u.High&&null!=u.Low&&null!=u.Close){var C=i,D=i+e;if(D>r)break;var c=C+(D-C)/2,f=this.ChartFrame.GetYFromData(u.Close);s?(t?(this.Canvas.moveTo(f,c),o={X:f,Y:c}):(this.Canvas.moveTo(c,f),o={X:c,Y:f}),s=!1):t?this.Canvas.lineTo(f,c):this.Canvas.lineTo(c,f)}}if(!s){if(this.Canvas.stroke(),t?(this.Canvas.lineTo(this.ChartBorder.GetLeft(),c),this.Canvas.lineTo(this.ChartBorder.GetLeft(),o.Y)):(this.Canvas.lineTo(c,this.ChartBorder.GetBottom()),this.Canvas.lineTo(o.X,this.ChartBorder.GetBottom())),this.Canvas.closePath(),Array.isArray(this.CloseLineAreaColor))if(t){var d=this.Canvas.createLinearGradient(this.ChartBorder.GetRightEx(),this.ChartBorder.GetTop(),this.ChartBorder.GetLeft(),this.ChartBorder.GetTop());d.addColorStop(0,this.CloseLineAreaColor[0]),d.addColorStop(1,this.CloseLineAreaColor[1]),this.Canvas.fillStyle=d}else{var m=this.Canvas.createLinearGradient(o.X,this.ChartBorder.GetTopEx(),o.X,this.ChartBorder.GetBottom());m.addColorStop(0,this.CloseLineAreaColor[0]),m.addColorStop(1,this.CloseLineAreaColor[1]),this.Canvas.fillStyle=m}else this.Canvas.fillStyle=this.CloseLineAreaColor;this.Canvas.fill()}},this.DrawCloseLine=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2;t&&(i=this.ChartBorder.GetTop()+a/2+2);var r=this.ChartBorder.GetRight();t&&(r=this.ChartBorder.GetBottom());var n=this.ChartFrame.XPointCount,s=!0;this.Canvas.beginPath(),this.Canvas.strokeStyle=this.CloseLineColor;for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<n;++o,++h,i+=e+a){var l=this.Data.Data[o];if(null!=l.Open&&null!=l.High&&null!=l.Low&&null!=l.Close){var u=i,C=i+e;if(C>r)break;var D=u+(C-u)/2,c=this.ChartFrame.GetYFromData(l.Close);s?(t?this.Canvas.moveTo(c,D):this.Canvas.moveTo(D,c),s=!1):t?this.Canvas.lineTo(c,D):this.Canvas.lineTo(D,c)}}0==s&&this.Canvas.stroke()},this.DrawKBar=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2,r=this.ChartBorder.GetRight(),n=this.ChartFrame.XPointCount;t&&(i=this.ChartBorder.GetTop()+a/2+2,r=this.ChartBorder.GetBottom());var s={X:null,Y:null,Value:null,Align:"left"},o={X:null,Y:null,Value:null,Align:"left"},h=this.UpColor,l=this.DownColor,u=this.UnchagneColor;this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=n;for(var C=this.Data.DataOffset,D=0;C<this.Data.Data.length&&D<n;++C,++D,i+=e+a,++this.ShowRange.DataCount){var c=this.Data.Data[C];if(this.ShowRange.End=C,null!=c.Open&&null!=c.High&&null!=c.Low&&null!=c.Close){var f=i,d=i+e;if(d>r)break;var m=f+(d-f)/2,v=this.ChartFrame.GetYFromData(c.Low),S=this.ChartFrame.GetYFromData(c.High),I=this.ChartFrame.GetYFromData(c.Open),p=this.ChartFrame.GetYFromData(c.Close),T=S;if((null==s.Value||s.Value<c.High)&&(s.X=m,s.Y=S,s.Value=c.High,s.Align=D<n/2?"left":"right"),(null==o.Value||o.Value>c.Low)&&(o.X=m,o.Y=v,o.Value=c.Low,o.Align=D<n/2?"left":"right"),this.ColorData&&(h=l=u=C<this.ColorData.length&&this.ColorData[C]>0?this.UpColor:this.DownColor),c.Open<c.Close?e>=4?(this.Canvas.strokeStyle=h,c.High>c.Close?(this.Canvas.beginPath(),t?(this.Canvas.moveTo(W(T),W(m)),this.Canvas.lineTo(W(3==this.DrawType?Math.max(p,I):p),W(m))):(this.Canvas.moveTo(W(m),W(T)),this.Canvas.lineTo(W(m),W(3==this.DrawType?Math.min(p,I):p))),this.Canvas.stroke(),T=p):T=p,this.Canvas.fillStyle=h,t?Math.abs(I-T)<1?this.Canvas.fillRect(X(T),X(f),1,X(e)):3==this.DrawType?(this.Canvas.beginPath(),this.Canvas.rect(W(T),W(f),X(I-T),X(e)),this.Canvas.stroke()):this.Canvas.fillRect(X(T),X(f),X(I-T),X(e)):Math.abs(I-T)<1?this.Canvas.fillRect(X(f),X(T),X(e),1):3==this.DrawType?(this.Canvas.beginPath(),this.Canvas.rect(W(f),W(T),X(e),X(I-T)),this.Canvas.stroke()):this.Canvas.fillRect(X(f),X(Math.min(T,I)),X(e),X(Math.abs(I-T))),c.Open>c.Low&&(this.Canvas.beginPath(),t?(this.Canvas.moveTo(W(3==this.DrawType?Math.min(p,I):T),W(m)),this.Canvas.lineTo(W(v),W(m))):(this.Canvas.moveTo(W(m),W(3==this.DrawType?Math.max(p,I):T)),this.Canvas.lineTo(W(m),W(v))),this.Canvas.stroke())):(this.Canvas.beginPath(),t?(this.Canvas.moveTo(S,W(m)),this.Canvas.lineTo(v,W(m))):(this.Canvas.moveTo(W(m),S),this.Canvas.lineTo(W(m),v)),this.Canvas.strokeStyle=h,this.Canvas.stroke()):c.Open>c.Close?e>=4?(this.Canvas.strokeStyle=l,c.High>c.Close?(this.Canvas.beginPath(),t?(this.Canvas.moveTo(W(T),W(m)),this.Canvas.lineTo(W(I),W(m))):(this.Canvas.moveTo(W(m),W(T)),this.Canvas.lineTo(W(m),W(I))),this.Canvas.stroke(),T=I):T=I,this.Canvas.fillStyle=l,t?Math.abs(p-T)<1?this.Canvas.fillRect(X(T),X(f),1,X(e)):this.Canvas.fillRect(X(T),X(f),X(p-T),X(e)):Math.abs(p-T)<1?this.Canvas.fillRect(X(f),X(T),X(e),1):this.Canvas.fillRect(X(f),X(Math.min(T,p)),X(e),X(Math.abs(p-T))),c.Open>c.Low&&(this.Canvas.beginPath(),t?(this.Canvas.moveTo(W(T),W(m)),this.Canvas.lineTo(W(v),W(m))):(this.Canvas.moveTo(W(m),W(T)),this.Canvas.lineTo(W(m),W(v))),this.Canvas.stroke())):(this.Canvas.beginPath(),t?(this.Canvas.moveTo(S,W(m)),this.Canvas.lineTo(v,W(m))):(this.Canvas.moveTo(W(m),S),this.Canvas.lineTo(W(m),v)),this.Canvas.strokeStyle=l,this.Canvas.stroke()):e>=4?(this.Canvas.strokeStyle=u,this.Canvas.beginPath(),c.High>c.Close?(t?(this.Canvas.moveTo(T,W(m)),this.Canvas.lineTo(I,W(m))):(this.Canvas.moveTo(W(m),T),this.Canvas.lineTo(W(m),I)),T=I):T=I,t?(this.Canvas.moveTo(W(T),W(f)),this.Canvas.lineTo(W(T),W(d))):(this.Canvas.moveTo(W(f),W(T)),this.Canvas.lineTo(W(d),W(T))),c.Open>c.Low&&(t?(this.Canvas.moveTo(W(T),W(m)),this.Canvas.lineTo(W(v),W(m))):(this.Canvas.moveTo(W(m),W(T)),this.Canvas.lineTo(W(m),W(v)))),this.Canvas.stroke()):(this.Canvas.beginPath(),t?(this.Canvas.moveTo(S,W(m)),this.Canvas.lineTo(v,W(m))):(this.Canvas.moveTo(W(m),S),this.Canvas.lineTo(W(m),v)),this.Canvas.strokeStyle=u,this.Canvas.stroke()),this.IsShowKTooltip&&!t){var A=Math.min(I,p),g=Math.max(I,p);Math.abs(I-p)<5&&(A=Math.min(S,A-5),g=Math.max(v,g+5));var F=new Mt(f,A,e,g-A);this.TooltipRect.push([C,F])}if(0==this.Data.DataType){var E={Xleft:f,XRight:d,XCenter:m,YMax:S,YMin:v,DayData:c,Index:D};this.DrawInfo(E)}}}this.PtMax=s,this.PtMin=o},this.DrawTrade=function(){if(this.TradeData){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2,r=this.ChartBorder.GetRight(),n=this.ChartFrame.XPointCount;t&&(i=this.ChartBorder.GetTop()+a/2+2,r=this.ChartBorder.GetBottom());var s=this.TradeData.Sell,o=this.TradeData.Buy,h=e;h>10&&(h=10);for(var l=this.Data.DataOffset,u=0;l<this.Data.Data.length&&u<n;++l,++u,i+=e+a){var C=this.Data.Data[l];if(null!=C.Open&&null!=C.High&&null!=C.Low&&null!=C.Close){var D=!1,c=!1;if(s&&l<s.length&&(c=s[l]>0),o&&l<o.length&&(D=o[l]>0),c||D){var f=i,d=i+e;if(d>r)break;var m=f+(d-f)/2,v=this.ChartFrame.GetYFromData(C.Low),S=this.ChartFrame.GetYFromData(C.High);this.ChartFrame.GetYFromData(C.Open),this.ChartFrame.GetYFromData(C.Close);D&&(this.Canvas.fillStyle=this.UpColor,this.Canvas.strokeStyle=this.UnchagneColor,this.Canvas.beginPath(),t?(this.Canvas.moveTo(v-1,m),this.Canvas.lineTo(v-h-1,m-h/2),this.Canvas.lineTo(v-h-1,m+h/2)):(this.Canvas.moveTo(m,v+1),this.Canvas.lineTo(m-h/2,v+h+1),this.Canvas.lineTo(m+h/2,v+h+1)),this.Canvas.closePath(),this.Canvas.fill(),this.Canvas.stroke()),c&&(this.Canvas.fillStyle=this.DownColor,this.Canvas.strokeStyle=this.UnchagneColor,this.Canvas.beginPath(),t?(this.Canvas.moveTo(S+1,m),this.Canvas.lineTo(S+h+1,m-h/2),this.Canvas.lineTo(S+h+1,m+h/2)):(this.Canvas.moveTo(m,S-1),this.Canvas.lineTo(m-h/2,S-h-1),this.Canvas.lineTo(m+h/2,S-h-1)),this.Canvas.closePath(),this.Canvas.fill(),this.Canvas.stroke())}}}}},this.DrawTick=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2;t&&(i=this.ChartBorder.GetTop()+a/2+2);var r=this.ChartBorder.GetRight();t&&(r=this.ChartBorder.GetBottom());var n=this.ChartFrame.XPointCount,s=parseInt(e);s<=1?s=2:s>=18&&(s=18);this.Canvas.beginPath(),this.Canvas.font=s*V()+"px "+this.TickFontName;for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<n;++o,++h,i+=e+a){var l=this.Data.Data[o];if(null!=l.Open&&null!=l.High&&null!=l.Low&&null!=l.Close){var u=i,C=i+e;if(C>r)break;var D=u+(C-u)/2,c=this.ChartFrame.GetYFromData(l.Close);0===l.Flag?this.Canvas.fillStyle=this.UpColor:1==l.Flag?this.Canvas.fillStyle=this.DownColor:this.Canvas.fillStyle=this.UnchagneColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",t?this.Canvas.fillText(this.TickSymbol,c,D):this.Canvas.fillText(this.TickSymbol,D,c)}}},this.Draw=function(){this.TooltipRect=[],this.InfoTooltipRect=[],this.TradeIconTooltipRect=[],this.PtMax={X:null,Y:null,Value:null,Align:"left"},this.PtMin={X:null,Y:null,Value:null,Align:"left"},this.ChartFrame.ChartKLine={Max:null,Min:null},this.IsShow&&(It.IsTickPeriod(this.Period)?this.DrawTick():1!=this.DrawType?(2==this.DrawType?this.DrawAKLine():4==this.DrawType?this.DrawCloseArea():this.DrawKBar(),this.TradeIcon?this.DrawTradeIcon():this.DrawTrade(),this.IsShowMaxMinPrice&&(!0===this.ChartFrame.IsHScreen?this.HScreenDrawMaxMinPrice(this.PtMax,this.PtMin):this.DrawMaxMinPrice(this.PtMax,this.PtMin))):this.DrawCloseLine())},this.DrawMaxMinPrice=function(t,e){if(null!=t.X&&null!=t.Y&&null!=t.Value&&null!=e.X&&null!=e.Y&&null!=e.Value){var a=Ui(this.Symbol);this.Canvas.font=this.TextFont,this.Canvas.fillStyle=this.TextColor;var i=t;1==this.ChartFrame.CoordinateType?(t.Y<e.Y&&(i=e),this.Canvas.textBaseline="top"):(t.Y>e.Y&&(i=e),this.Canvas.textBaseline="bottom"),this.Canvas.textAlign=i.Align;var r=(i.Align,i.X),n=i.Value.toFixed(a);"left"==i.Align?n="←"+n:n+="→",this.Canvas.fillText(n,r,i.Y),this.ChartFrame.ChartKLine.Max={X:r,Y:i.Y,Text:{BaseLine:"bottom"}};var s=e;1==this.ChartFrame.CoordinateType?(e.Y>t.Y&&(s=t),this.Canvas.textBaseline="bottom"):(t.Y>e.Y&&(i=e),this.Canvas.textBaseline="top"),this.Canvas.textAlign=s.Align;r=(s.Align,s.X),n=e.Value.toFixed(a);"left"==s.Align?n="←"+n:n+="→",this.Canvas.fillText(n,r,s.Y),this.ChartFrame.ChartKLine.Min={X:r,Y:s.Y,Text:{BaseLine:"top"}}}},this.HScreenDrawMaxMinPrice=function(t,e){if(null!=t.X&&null!=t.Y&&null!=t.Value&&null!=e.X&&null!=e.Y&&null!=e.Value){var a=Ui(this.Symbol),i=t.Y,r=t.X;this.Canvas.save(),this.Canvas.translate(i,r),this.Canvas.rotate(90*Math.PI/180),this.Canvas.font=this.TextFont,this.Canvas.fillStyle=this.TextColor,this.Canvas.textAlign=t.Align,this.Canvas.textBaseline="bottom";var n=t.Value.toFixed(a);"left"==t.Align?n="←"+n:n+="→",this.Canvas.fillText(n,0,0),this.Canvas.restore();i=e.Y,r=e.X;this.Canvas.save(),this.Canvas.translate(i,r),this.Canvas.rotate(90*Math.PI/180),this.Canvas.font=this.TextFont,this.Canvas.fillStyle=this.TextColor,this.Canvas.textAlign=e.Align,this.Canvas.textBaseline="top";n=e.Value.toFixed(a);"left"==e.Align?n="←"+n:n+="→",this.Canvas.fillText(n,0,0),this.Canvas.restore()}},this.DrawInfo=function(t){if(this.InfoData&&!(this.InfoData.length<=0)){var e=!0===this.ChartFrame.IsHScreen,a=this.ChartFrame.DataWidth,i=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetBottom(),n=this.InfoData.get(t.DayData.Date.toString());if(n&&!(n.Data.length<=0)){var s=V(),o=a+i,h=18*s,l=!0;o<=15&&(l=!1),o<h&&(o=h);var u,C="",D=new g.default,c=t.YMax+1*s,f=0;for(var d in n.Data){var m=n.Data[d],v=D.get(m.InfoType);if(v)v.Data.push(m);else{var S=ii.GetIconFont(m.InfoType);if(this.Canvas.fillStyle=S.Color,this.Canvas.font=o+"px "+S.Family,e){this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.fillText(S.HScreenText,c,t.XCenter,o);var I=new Mt(t.XCenter-o/2,c-o,o,o),p={Data:new Array(m),Rect:I,Type:m.InfoType,TextRect:{X:c,Y:t.XCenter}};D.set(m.InfoType,p),c+=o}else if(this.Canvas.textBaseline="bottom",this.Canvas.textAlign="center",1===this.InfoPosition){var A=r+f;this.Canvas.fillText(S.Text,t.XCenter,A,o);I=new Mt(t.XCenter-o/2,A-o,o,o),p={Data:new Array(m),Rect:I,Type:m.InfoType,TextRect:{X:t.XCenter,Y:A}};D.set(m.InfoType,p),f-=o}else{this.Canvas.fillText(S.Text,t.XCenter,c,o);I=new Mt(t.XCenter-o/2,c-o,o,o),p={Data:new Array(m),Rect:I,Type:m.InfoType,TextRect:{X:t.XCenter,Y:c}};D.set(m.InfoType,p),c-=o}}}Ma.KLine.NumIcon&&(u=e?Ma.KLine.NumIcon.HScreenText:Ma.KLine.NumIcon.Text);var F=!0,E=!1,L=void 0;try{for(var M,x=(0,T.default)(D);!(F=(M=x.next()).done);F=!0){t=M.value;var N=t[1];if(N.Data.length>=2&&u&&l){var O=N.Data.length;O>=u.length&&(O=0),this.Canvas.fillStyle=Ma.KLine.NumIcon.Color;C=u[O];this.Canvas.fillText(C,N.TextRect.X,N.TextRect.Y,o)}e||this.InfoTooltipRect.push(N)}}catch(y){E=!0,L=y}finally{try{!F&&x.return&&x.return()}finally{if(E)throw L}}}}},this.DrawTradeIcon=function(){if(this.TradeData){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2,r=this.ChartBorder.GetRight(),n=this.ChartFrame.XPointCount;t&&(i=this.ChartBorder.GetTop()+a/2+2,r=this.ChartBorder.GetBottom());var s=this.TradeData.Sell,o=this.TradeData.Buy,h=e+a,l=V(),u=24*l,C=12*l;h<C?h=C:h>u&&(h=u),this.Canvas.font=h+"px "+this.TradeIcon.Family;for(var D=this.Data.DataOffset,c=0;D<this.Data.Data.length&&c<n;++D,++c,i+=e+a){var f=this.Data.Data[D];if(null!=f.Open&&null!=f.High&&null!=f.Low&&null!=f.Close){var d=!1,m=!1;if(s&&D<s.length&&(m=s[D]>0),o&&D<o.length&&(d=o[D]>0),m||d){var v=i,S=i+e;if(S>r)break;var I=v+(S-v)/2,p=this.ChartFrame.GetYFromData(f.Low),T=this.ChartFrame.GetYFromData(f.High);this.ChartFrame.GetYFromData(f.Open),this.ChartFrame.GetYFromData(f.Close);if(d)if(this.Canvas.fillStyle=this.TradeIcon.Buy.Color,t)this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.TradeIcon.Buy.HScreenText,p,I);else{this.Canvas.textAlign="center",this.Canvas.textBaseline="top",this.Canvas.fillText(this.TradeIcon.Buy.Text,I,p);var A=new Mt(I-h/2,p,h,h),g={Data:{Type:1,KData:f,Name:this.TradeData.Name,Param:this.TradeData.Param},Rect:A,TextRect:{X:I,Y:p}};this.TradeIconTooltipRect.push(g)}if(m)if(this.Canvas.fillStyle=this.TradeIcon.Sell.Color,t)this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.TradeIcon.Sell.HScreenText,T,I);else{this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.Canvas.fillText(this.TradeIcon.Sell.Text,I,T);A=new Mt(I-h/2,T-h,h,h),g={Data:{Type:2,KData:f,Name:this.TradeData.Name,Param:this.TradeData.Param},Rect:A,TextRect:{X:I,Y:T}};this.TradeIconTooltipRect.push(g)}}}}}},this.GetTooltipData=function(t,e,a){for(var i in this.TradeIconTooltipRect){var r=this.TradeIconTooltipRect[i];if(r.Rect){var n=r.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(n.X,n.Y,n.Width,n.Height),this.Canvas.isPointInPath(t,e))return M.Chart.Log("[ChartKLine::GetTooltipData] trade icon ",r),a.Data=r,a.ChartPaint=this,a.Type=2,!0}}for(var i in this.InfoTooltipRect){r=this.InfoTooltipRect[i];if(r.Rect){n=r.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(n.X,n.Y,n.Width,n.Height),this.Canvas.isPointInPath(t,e))return a.Data=r,a.ChartPaint=this,a.Type=1,!0}}for(var i in this.TooltipRect){n=this.TooltipRect[i][1];if(this.Canvas.beginPath(),this.Canvas.rect(n.X,n.Y,n.Width,n.Height),this.Canvas.isPointInPath(t,e)){var s=this.TooltipRect[i][0];return a.Data=this.Data.Data[s],a.ChartPaint=this,a.Type=0,!0}}return!1},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Max:null,Min:null};if(1==this.DrawType||4==this.DrawType)for(var a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];Le.IsNumber(r.Close)&&(null==e.Max&&(e.Max=r.Close),null==e.Min&&(e.Min=r.Close),e.Max<r.Close&&(e.Max=r.Close),e.Min>r.Close&&(e.Min=r.Close))}else for(a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){r=this.Data.Data[a];null!=r.Open&&null!=r.High&&null!=r.Low&&null!=r.Close&&(null==e.Max&&(e.Max=r.High),null==e.Min&&(e.Min=r.Low),e.Max<r.High&&(e.Max=r.High),e.Min>r.Low&&(e.Min=r.Low))}return e},this.GetAllPrice=function(){for(var t=this.ChartFrame.XPointCount,e=new I.default,a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(null!=r.Open&&null!=r.High&&null!=r.Low&&null!=r.Close){var n=r.Close;e.add(n)}}var s=[],o=!0,h=!1,l=void 0;try{for(var u,C=(0,T.default)(e);!(o=(u=C.next()).done);o=!0){var D=u.value;s.push(D)}}catch(c){h=!0,l=c}finally{try{!o&&C.return&&C.return()}finally{if(h)throw l}}return s.sort((function(t,e){return t-e})),s}}function yt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartColorKline",this.Symbol,this.Color="rgb(0,255,44)",this.DrawType=0,this.KLineColor,this.Draw=function(){this.IsShow&&this.KLineColor&&this.DrawBar()},this.DrawUpBarItem=function(t,e,a,i){var r=!0===this.ChartFrame.IsHScreen,n=e,s=e+a,o=n+(s-n)/2,h=this.ChartFrame.GetYFromData(t.Low),l=this.ChartFrame.GetYFromData(t.High),u=this.ChartFrame.GetYFromData(t.Open),C=this.ChartFrame.GetYFromData(t.Close),D=l;a>=4?(t.High>t.Close?(this.Canvas.beginPath(),r?(this.Canvas.moveTo(W(D),W(o)),this.Canvas.lineTo(W(3==this.DrawType?Math.max(C,u):C),W(o))):(this.Canvas.moveTo(W(o),W(D)),this.Canvas.lineTo(W(o),W(3==this.DrawType?Math.min(C,u):C))),this.Canvas.stroke(),D=C):D=C,r?Math.abs(u-D)<1?this.Canvas.fillRect(X(D),X(n),1,X(a)):3==this.DrawType?(this.Canvas.beginPath(),this.Canvas.rect(W(D),W(n),X(u-D),X(a)),this.Canvas.stroke()):this.Canvas.fillRect(X(D),X(n),X(u-D),X(a)):Math.abs(u-D)<1?this.Canvas.fillRect(X(n),X(D),X(a),1):3==this.DrawType?(this.Canvas.beginPath(),this.Canvas.rect(W(n),W(D),X(a),X(u-D)),this.Canvas.stroke()):this.Canvas.fillRect(X(n),X(Math.min(D,u)),X(a),X(Math.abs(u-D))),t.Open>t.Low&&(this.Canvas.beginPath(),r?(this.Canvas.moveTo(W(3==this.DrawType?Math.min(C,u):D),W(o)),this.Canvas.lineTo(W(h),W(o))):(this.Canvas.moveTo(W(o),W(3==this.DrawType?Math.max(C,u):D)),this.Canvas.lineTo(W(o),W(h))),this.Canvas.stroke())):(this.Canvas.beginPath(),r?(this.Canvas.moveTo(l,W(o)),this.Canvas.lineTo(h,W(o))):(this.Canvas.moveTo(W(o),l),this.Canvas.lineTo(W(o),h)),this.Canvas.stroke())},this.DrawDownBarItem=function(t,e,a,i){var r=!0===this.ChartFrame.IsHScreen,n=e,s=e+a,o=n+(s-n)/2,h=this.ChartFrame.GetYFromData(t.Low),l=this.ChartFrame.GetYFromData(t.High),u=this.ChartFrame.GetYFromData(t.Open),C=this.ChartFrame.GetYFromData(t.Close),D=l;a>=4?(t.High>t.Close?(this.Canvas.beginPath(),r?(this.Canvas.moveTo(W(D),W(o)),this.Canvas.lineTo(W(u),W(o))):(this.Canvas.moveTo(W(o),W(D)),this.Canvas.lineTo(W(o),W(u))),this.Canvas.stroke(),D=u):D=u,r?Math.abs(C-D)<1?this.Canvas.fillRect(X(D),X(n),1,X(a)):this.Canvas.fillRect(X(D),X(n),X(C-D),X(a)):Math.abs(C-D)<1?this.Canvas.fillRect(X(n),X(D),X(a),1):this.Canvas.fillRect(X(n),X(Math.min(D,C)),X(a),X(Math.abs(C-D))),t.Open>t.Low&&(this.Canvas.beginPath(),r?(this.Canvas.moveTo(W(D),W(o)),this.Canvas.lineTo(W(h),W(o))):(this.Canvas.moveTo(W(o),W(D)),this.Canvas.lineTo(W(o),W(h))),this.Canvas.stroke())):(this.Canvas.beginPath(),r?(this.Canvas.moveTo(l,W(o)),this.Canvas.lineTo(h,W(o))):(this.Canvas.moveTo(W(o),l),this.Canvas.lineTo(W(o),h)),this.Canvas.stroke())},this.DrawUnChangeBarItem=function(t,e,a,i){var r=!0===this.ChartFrame.IsHScreen,n=e,s=e+a,o=n+(s-n)/2,h=this.ChartFrame.GetYFromData(t.Low),l=this.ChartFrame.GetYFromData(t.High),u=this.ChartFrame.GetYFromData(t.Open),C=(this.ChartFrame.GetYFromData(t.Close),l);a>=4?(this.Canvas.beginPath(),t.High>t.Close?(r?(this.Canvas.moveTo(C,W(o)),this.Canvas.lineTo(u,W(o))):(this.Canvas.moveTo(W(o),C),this.Canvas.lineTo(W(o),u)),C=u):C=u,r?(this.Canvas.moveTo(W(C),W(n)),this.Canvas.lineTo(W(C),W(s))):(this.Canvas.moveTo(W(n),W(C)),this.Canvas.lineTo(W(s),W(C))),t.Open>t.Low&&(r?(this.Canvas.moveTo(W(C),W(o)),this.Canvas.lineTo(W(h),W(o))):(this.Canvas.moveTo(W(o),W(C)),this.Canvas.lineTo(W(o),W(h)))),this.Canvas.stroke()):(this.Canvas.beginPath(),r?(this.Canvas.moveTo(l,W(o)),this.Canvas.lineTo(h,W(o))):(this.Canvas.moveTo(W(o),l),this.Canvas.lineTo(W(o),h)),this.Canvas.stroke())},this.DrawBar=function(){var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetLeft()+e/2+2,i=this.ChartBorder.GetRight(),r=this.ChartFrame.XPointCount;this.IsHScreen&&(a=this.ChartBorder.GetTop()+e/2+2,i=this.ChartBorder.GetBottom());for(var n=this.Data.DataOffset,s=0;n<this.Data.Data.length&&s<r;++n,++s,a+=t+e){var o=this.Data.Data[n];if(null!=o.Open&&null!=o.High&&null!=o.Low&&null!=o.Close&&this.KLineColor.has(n)){var h=this.KLineColor.get(n),l=a+t;if(l>i)break;h.Color?(this.Canvas.strokeStyle=h.Color,this.Canvas.fillStyle=h.Color):(this.Canvas.strokeStyle=this.Color,this.Canvas.fillStyle=this.Color),o.Open<o.Close?this.DrawUpBarItem(o,a,t,h):o.Open>o.Close?this.DrawDownBarItem(o,a,t,h):this.DrawUnChangeBarItem(o,a,t,h)}}},this.GetMaxMin=function(){var t={Max:null,Min:null};return t}}var Rt={STATUS_NONE_ID:0,STATUS_REQUESTDATA_ID:1,STATUS_RECVDATA_ID:2,STATUS_FINISHED_ID:3};function Pt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartOverlayKLine",this.Color="rgb(65,105,225)",this.MainData,this.SourceData,this.Title,this.DrawType=0,this.CustomDrawType=null,this.Status=Rt.STATUS_NONE_ID,this.IsDelete=!1,this.SetOption=function(t){t&&Le.IsNumber(t.DrawType)&&(this.CustomDrawType=t.DrawType)},this.DrawKBar=function(t){var e=!0===this.ChartFrame.IsHScreen,a=this.ChartFrame.DataWidth,i=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetLeft()+i/2+2;e&&(r=this.ChartBorder.GetTop()+i/2+2);var n=this.ChartBorder.GetRight();e&&(n=this.ChartBorder.GetBottom());var s=this.ChartFrame.XPointCount,o=this.DrawType;null!=this.CustomDrawType&&(o=this.CustomDrawType);for(var h=!0,l=null,u=this.Data.DataOffset,C=0;u<this.Data.Data.length&&C<s;++u,++C,r+=a+i){var D=this.Data.Data[u];if(D&&null!=D.Open&&null!=D.High&&null!=D.Low&&null!=D.Close){null==l&&(l=D.Open),h&&(this.Canvas.strokeStyle=this.Color,this.Canvas.fillStyle=this.Color,this.Canvas.beginPath(),h=!1);var c=r,f=r+a;if(f>n)break;var d=c+(f-c)/2,m=this.ChartFrame.GetYFromData(D.Low/l*t),v=this.ChartFrame.GetYFromData(D.High/l*t),S=this.ChartFrame.GetYFromData(D.Open/l*t),I=this.ChartFrame.GetYFromData(D.Close/l*t),p=v;D.Open<D.Close?a>=4?(D.High>D.Close?(e?(this.Canvas.moveTo(W(p),W(d)),this.Canvas.lineTo(W(3==this.DrawType?Math.max(I,S):I),W(d))):(this.Canvas.moveTo(W(d),W(p)),this.Canvas.lineTo(W(d),W(3==this.DrawType?Math.min(I,S):I))),p=I):p=I,e?Math.abs(S-p)<1?this.Canvas.fillRect(X(p),X(c),1,X(a)):3==o?this.Canvas.rect(W(p),W(c),X(S-p),X(a)):this.Canvas.fillRect(X(p),X(c),X(S-p),X(a)):Math.abs(S-p)<1?this.Canvas.fillRect(X(c),X(p),X(a),1):3==o?this.Canvas.rect(W(c),W(p),X(a),X(S-p)):this.Canvas.fillRect(X(c),X(p),X(a),X(S-p)),D.Open>D.Low&&(e?(this.Canvas.moveTo(W(3==this.DrawType?Math.min(I,S):p),W(d)),this.Canvas.lineTo(W(m),W(d))):(this.Canvas.moveTo(W(d),W(3==this.DrawType?Math.max(I,S):p)),this.Canvas.lineTo(W(d),W(m))))):e?(this.Canvas.moveTo(v,W(d)),this.Canvas.lineTo(m,W(d))):(this.Canvas.moveTo(W(d),v),this.Canvas.lineTo(W(d),m)):D.Open>D.Close?a>=4?(D.High>D.Close?(e?(this.Canvas.moveTo(W(p),W(d)),this.Canvas.lineTo(W(S),W(d))):(this.Canvas.moveTo(W(d),W(p)),this.Canvas.lineTo(W(d),W(S))),p=S):p=S,e?Math.abs(I-p)<1?this.Canvas.fillRect(X(p),X(c),1,X(a)):this.Canvas.fillRect(X(p),X(c),X(I-p),X(a)):Math.abs(I-p)<1?this.Canvas.fillRect(X(c),X(p),X(a),1):this.Canvas.fillRect(X(c),X(p),X(a),X(I-p)),D.Open>D.Low&&(e?(this.Canvas.moveTo(W(p),W(d)),this.Canvas.lineTo(W(m),W(d))):(this.Canvas.moveTo(W(d),W(p)),this.Canvas.lineTo(W(d),W(m))))):e?(this.Canvas.moveTo(v,W(d)),this.Canvas.lineTo(m,W(d))):(this.Canvas.moveTo(W(d),v),this.Canvas.lineTo(W(d),m)):a>=4?(D.High>D.Close?(e?(this.Canvas.moveTo(p,W(d)),this.Canvas.lineTo(S,W(d))):(this.Canvas.moveTo(W(d),p),this.Canvas.lineTo(W(d),S)),p=S):p=S,e?(this.Canvas.moveTo(W(p),W(c)),this.Canvas.lineTo(W(p),W(f))):(this.Canvas.moveTo(W(c),W(p)),this.Canvas.lineTo(W(f),W(p))),D.Open>D.Low&&(e?(this.Canvas.moveTo(W(p),W(d)),this.Canvas.lineTo(W(m),W(d))):(this.Canvas.moveTo(W(d),W(p)),this.Canvas.lineTo(W(d),W(m))))):e?(this.Canvas.moveTo(v,W(d)),this.Canvas.lineTo(m,W(d))):(this.Canvas.moveTo(W(d),v),this.Canvas.lineTo(W(d),m));var T=Math.min(m,v,S,I),A=Math.max(m,v,S,I),g=new Mt(c,T,a,A-T);this.TooltipRect.push([u,g])}}0==h&&this.Canvas.stroke()},this.DrawAKLine=function(t){var e=!0===this.ChartFrame.IsHScreen,a=this.ChartFrame.DataWidth,i=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetLeft()+i/2+2;e&&(r=this.ChartBorder.GetTop()+i/2+2);var n=this.ChartBorder.GetRight();e&&(n=this.ChartBorder.GetBottom());var s=this.ChartFrame.XPointCount,o=null;this.Canvas.strokeStyle=this.Color;for(var h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<s;++h,++l,r+=a+i){var u=this.Data.Data[h];if(null!=u.Open&&null!=u.High&&null!=u.Low&&null!=u.Close){null==o&&(o=u.Open);var C=r,D=r+a;if(D>n)break;var c=C+(D-C)/2,f=this.ChartFrame.GetYFromData(u.Low/o*t),d=this.ChartFrame.GetYFromData(u.High/o*t),m=this.ChartFrame.GetYFromData(u.Open/o*t),v=this.ChartFrame.GetYFromData(u.Close/o*t);this.Canvas.beginPath(),e?(this.Canvas.moveTo(d,W(c)),this.Canvas.lineTo(f,W(c))):(this.Canvas.moveTo(W(c),d),this.Canvas.lineTo(W(c),f)),this.Canvas.stroke(),a>=4&&(this.Canvas.beginPath(),e?(this.Canvas.moveTo(W(m),C),this.Canvas.lineTo(W(m),c)):(this.Canvas.moveTo(C,W(m)),this.Canvas.lineTo(c,W(m))),this.Canvas.stroke(),this.Canvas.beginPath(),e?(this.Canvas.moveTo(W(v),D),this.Canvas.lineTo(W(v),c)):(this.Canvas.moveTo(D,W(v)),this.Canvas.lineTo(c,W(v))),this.Canvas.stroke())}}},this.DrawCloseLine=function(t){var e=!0===this.ChartFrame.IsHScreen,a=this.ChartFrame.DataWidth,i=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetLeft()+i/2+2;e&&(r=this.ChartBorder.GetTop()+i/2+2);var n=this.ChartBorder.GetRight();e&&(n=this.ChartBorder.GetBottom());var s=this.ChartFrame.XPointCount,o=null,h=!0;this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath();for(var l=this.Data.DataOffset,u=0;l<this.Data.Data.length&&u<s;++l,++u,r+=a+i){var C=this.Data.Data[l];if(null!=C.Open&&null!=C.High&&null!=C.Low&&null!=C.Close){null==o&&(o=C.Open);var D=r,c=r+a;if(c>n)break;var f=D+(c-D)/2,d=this.ChartFrame.GetYFromData(C.Close/o*t);h?(e?this.Canvas.moveTo(d,f):this.Canvas.moveTo(f,d),h=!1):e?this.Canvas.lineTo(d,f):this.Canvas.lineTo(f,d)}}0==h&&this.Canvas.stroke()},this.Draw=function(){if(this.TooltipRect=[],this.InfoTooltipRect=[],this.MainData&&this.Data){for(var t=this.ChartFrame.XPointCount,e=null,a=this.Data.DataOffset,i=0;a<this.MainData.Data.length&&i<t;++a,++i){var r=this.MainData.Data[a];if(null!=r.Open&&null!=r.High&&null!=r.Low&&null!=r.Close){e=r.Open;break}}if(null!=e){var n=this.DrawType;null!=this.CustomDrawType&&(n=this.CustomDrawType),1==n?this.DrawCloseLine(e):2==n?this.DrawAKLine(e):this.DrawKBar(e)}}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Max:null,Min:null};if(!this.MainData||!this.Data)return e;for(var a=null,i=this.Data.DataOffset,r=0;i<this.MainData.Data.length&&r<t;++i,++r){var n=this.MainData.Data[i];if(null!=n.Open&&null!=n.High&&null!=n.Low&&null!=n.Close){a=n.Close;break}}if(null==a)return e;var s,o,h=null;for(i=this.Data.DataOffset,r=0;i<this.Data.Data.length&&r<t;++i,++r){n=this.Data.Data[i];n&&null!=n.Open&&null!=n.High&&null!=n.Low&&null!=n.Close&&(null==h&&(h=n.Open),s=n.High/h*a,o=n.Low/h*a,null==e.Max&&(e.Max=s),null==e.Min&&(e.Min=o),e.Max<s&&(e.Max=s),e.Min>o&&(e.Min=o))}return e},this.GetTooltipData=function(t,e,a){for(var i in this.TooltipRect){var r=this.TooltipRect[i][1];if(this.Canvas.beginPath(),this.Canvas.rect(r.X,r.Y,r.Width,r.Height),this.Canvas.isPointInPath(t,e)){var n=this.TooltipRect[i][0];return a.Data=this.Data.Data[n],a.ChartPaint=this,!0}}return!1}}function wt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinuteVolumBar",this.UpColor=Ma.UpBarColor,this.DownColor=Ma.DownBarColor,this.YClose,this.Draw=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartBorder.GetRight();t&&(e=this.ChartBorder.GetBottom());for(var a=this.ChartFrame.XPointCount,i=this.ChartFrame.GetYFromData(0),r=this.YClose,n=this.Data,s=n.DataOffset,o=0;s<n.Data.length&&o<a;++s,++o){var h=n.Data[s],l=null;if(h){var u=null;if(h.Before?(l=h.Before.Vol,u=h.Before.Close):(l=h.Vol,u=h.Close),l){var C=this.ChartFrame.GetYFromData(l),D=this.ChartFrame.GetXFromIndex(s);if(D>e)break;this.Canvas.strokeStyle=u>=r?this.UpColor:this.DownColor,this.Canvas.beginPath(),t?(this.Canvas.moveTo(C,W(D)),this.Canvas.lineTo(i,W(D))):(this.Canvas.moveTo(W(D),C),this.Canvas.lineTo(W(D),i)),this.Canvas.stroke(),u&&(r=u)}}}},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:0,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];r&&r.Vol&&(null==e.Max&&(e.Max=r.Vol),e.Max<r.Vol&&(e.Max=r.Vol))}return e}}function bt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartErrorMessage",this.Draw=function(){this.IsShow&&this.NotSupportMessage&&this.DrawNotSupportmessage()}}function Bt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartLine",this.Color="rgb(255,193,37)",this.LineWidth,this.DrawType=0,this.IsDotLine=!1,this.Draw=function(){if(this.IsShow)if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data)switch(this.DrawType){case 0:return this.DrawLine();case 1:return this.DrawStraightLine()}},this.DrawLine=function(){var t=!0===this.ChartFrame.IsHScreen,e=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount;this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V());for(var i=!0,r=0,n=this.Data.DataOffset,s=0;n<this.Data.Data.length&&s<a;++n,++s){var o=this.Data.Data[n];if(null!=o){var h=this.ChartFrame.GetXFromIndex(s),l=this.GetYFromData(o);if(h>e)break;i?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),t?this.Canvas.moveTo(l,h):this.Canvas.moveTo(h,l),i=!1):t?this.Canvas.lineTo(l,h):this.Canvas.lineTo(h,l),++r}}r>0&&this.Canvas.stroke(),this.Canvas.restore()},this.DrawStraightLine=function(){var t=!0===this.ChartFrame.IsHScreen,e=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount,i=this.GetLockRect();i&&(e=t?i.Top:i.Left),this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V()),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash([3,5]);for(var r=!0,n=0,s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<a;++s,++o){var h=this.Data.Data[s];if(null!=h){var l=this.ChartFrame.GetXFromIndex(o),u=this.GetYFromData(h);if(l>e)break;r?(this.Canvas.beginPath(),t?this.Canvas.moveTo(u,l):this.Canvas.moveTo(l,u),r=!1):t?this.Canvas.lineTo(u,l):this.Canvas.lineTo(l,u),++n}else n>0&&this.Canvas.stroke(),r=!0,n=0}n>0&&this.Canvas.stroke(),this.Canvas.restore()},this.GetYFromData=function(t){return this.ChartFrame.GetYFromData(t)}}function _t(){this.newMethod=Bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartSubLine",this.Color="rgb(255,193,37)",this.LineWidth,this.DrawType=0,this.IsDotLine=!1,this.SubFrame={Max:null,Min:null},this.Draw=function(){if(this.IsShow&&this.Data&&this.Data.Data)switch(this.CalculateDataMaxMin(),this.DrawType){case 0:return this.DrawLine();case 1:return this.DrawStraightLine()}},this.GetYFromData=function(t){var e=!0===this.ChartFrame.IsHScreen;if(e){if(t<=this.SubFrame.Min)return this.ChartBorder.GetLeftEx();if(t>=this.SubFrame.Max)return this.ChartBorder.GetRightEx();var a=this.ChartBorder.GetWidthEx()*(t-this.SubFrame.Min)/(this.SubFrame.Max-this.SubFrame.Min);return this.ChartBorder.GetLeftEx()+a}if(t<=this.SubFrame.Min)return this.ChartBorder.GetBottomEx();if(t>=this.SubFrame.Max)return this.ChartBorder.GetTopEx();var i=this.ChartBorder.GetHeightEx()*(t-this.SubFrame.Min)/(this.SubFrame.Max-this.SubFrame.Min);return this.ChartBorder.GetBottomEx()-i},this.CalculateDataMaxMin=function(){this.SubFrame={Max:null,Min:null};var t=!0===this.ChartFrame.IsHScreen,e=this.ChartBorder.GetRight();t&&(e=this.ChartBorder.GetBottom());for(var a=this.ChartFrame.XPointCount,i=this.Data.DataOffset,r=0;i<this.Data.Data.length&&r<a;++i,++r){var n=this.Data.Data[i];if(null!=n){var s=this.ChartFrame.GetXFromIndex(r);if(s>e)break;(null==this.SubFrame.Min||this.SubFrame.Min>n)&&(this.SubFrame.Min=n),(null==this.SubFrame.Max||this.SubFrame.Max<n)&&(this.SubFrame.Max=n)}}},this.GetMaxMin=function(){var t={Min:null,Max:null};return t}}function Ht(){this.newMethod=Bt,this.newMethod(),delete this.newMethod,this.MainData=new It,this.Draw=function(){if(this.Data&&this.Data.Data&&this.MainData&&this.MainData.Data)switch(this.DrawType){case 0:return this.DrawLine();case 1:return this.DrawStraightLine()}},this.GetFirstVaildIndex=function(){for(var t=this.Data.DataOffset,e=t,a=0;e<this.MainData.Data.length&&e<this.Data.Data.length;++e,++a){var i=this.MainData.Data[e],r=this.Data.Data[e];if(Le.IsNumber(i)&&Le.IsNumber(r))return{Index:a,DataOffset:e,OverlayValue:r,MainValue:i}}return null},this.DrawStraightLine=function(){var t=this.GetFirstVaildIndex();if(t){var e=!0===this.ChartFrame.IsHScreen,a=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());e&&(a=this.ChartBorder.GetBottom());var i=this.ChartFrame.XPointCount,r=this.GetLockRect();r&&(a=e?r.Top:r.Left),this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V()),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash([3,5]);for(var n=!0,s=0,o=0,h=t.DataOffset,l=t.Index;h<this.Data.Data.length&&l<i;++h,++l){var u=this.Data.Data[h];if(null!=u){var C=this.ChartFrame.GetXFromIndex(l),D=u-t.OverlayValue;o=0!=t.OverlayValue?1+D/Math.abs(t.OverlayValue):1+D;var c=t.MainValue*o,f=this.GetYFromData(c);if(C>a)break;n?(this.Canvas.beginPath(),e?this.Canvas.moveTo(f,C):this.Canvas.moveTo(C,f),n=!1):e?this.Canvas.lineTo(f,C):this.Canvas.lineTo(C,f),++s}else s>0&&this.Canvas.stroke(),n=!0,s=0}s>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Min:null,Max:null},a=this.GetFirstVaildIndex();if(!a)return e;for(var i=a.DataOffset,r=a.Index;i<this.Data.Data.length&&r<t;++i,++r){var n=this.Data.Data[i];if(Le.IsNumber(n)){var s=n-a.OverlayValue;0!=a.OverlayValue?rate=1+s/Math.abs(a.OverlayValue):rate=1+s;var o=a.MainValue*rate;null==e.Max&&(e.Max=o),null==e.Min&&(e.Min=o),e.Max<o&&(e.Max=o),e.Min>o&&(e.Min=o)}}return e}}function Vt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartPartLine",this.LineWidth,this.Draw=function(){this.IsShow&&(this.NotSupportMessage?this.DrawNotSupportmessage():this.Data&&this.Data.Data&&this.DrawLine())},this.DrawLine=function(){var t=!0===this.ChartFrame.IsHScreen,e=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount;this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V());for(var i,r=0,n={X:null,Y:null},s=!1,o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<a;++o,++h){var l=this.Data.Data[o];if(null!=l&&null!=l.Value){var u=l.Value,C=l.RGB,D=this.ChartFrame.GetXFromIndex(h),c=this.ChartFrame.GetYFromData(u);if(D>e)break;C!=i||1==s?(i&&r>0&&this.Canvas.stroke(),r=0,i=C,this.Canvas.strokeStyle=C,this.Canvas.beginPath(),null!=n.X&&null!=n.Y?(t?this.Canvas.moveTo(n.Y,n.X):this.Canvas.moveTo(n.X,n.Y),t?this.Canvas.lineTo(c,D):this.Canvas.lineTo(D,c),++r):t?this.Canvas.moveTo(c,D):this.Canvas.moveTo(D,c)):(t?this.Canvas.lineTo(c,D):this.Canvas.lineTo(D,c),++r),n.X=D,n.Y=c,s=!1}else n.X=null,n.Y=null,s=!0}r>0&&this.Canvas.stroke(),this.Canvas.restore()},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:null,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];r&&r.Value&&((null==e.Max||e.Max<r.Value)&&(e.Max=r.Value),(null==e.Min||e.Min>r.Value)&&(e.Min=r.Value))}return e}}function Gt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartPointDot",this.Color="rgb(255,193,37)",this.Radius=1,this.Draw=function(){if(this.IsShow)if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());!0===t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount;this.Canvas.save(),this.Canvas.fillStyle=this.Color;for(var i=this.Data.DataOffset,r=0;i<this.Data.Data.length&&r<a;++i,++r){var n=this.Data.Data[i];if(null!=n){var s=this.ChartFrame.GetXFromIndex(r),o=this.ChartFrame.GetYFromData(n);if(s>e)break;this.Canvas.beginPath(),t?this.Canvas.arc(o,s,this.Radius,0,2*Math.PI,!0):this.Canvas.arc(s,o,this.Radius,0,2*Math.PI,!0),this.Canvas.closePath(),this.Canvas.fill()}}this.Canvas.restore()}}}function kt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.Color="rgb(255,193,37)",this.LineWidth,this.ClassName="ChartStick",this.DrawLine=function(){if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());!0===t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount;this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V());for(var i=!0,r=0,n=this.Data.DataOffset,s=0;n<this.Data.Data.length&&s<a;++n,++s){var o=this.Data.Data[n];if(null!=o){var h=this.ChartFrame.GetXFromIndex(s),l=this.ChartFrame.GetYFromData(o);if(h>e)break;i?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),t?this.Canvas.moveTo(l,h):this.Canvas.moveTo(h,l),i=!1):t?this.Canvas.lineTo(l,h):this.Canvas.lineTo(h,l),++r}}r>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.DrawStick=function(){if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartBorder.GetRight();t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount,i=this.ChartBorder.GetBottom(),r=this.ChartBorder.GetLeft();this.Canvas.save(),this.Canvas.strokeStyle=this.Color,this.LineWidth&&(this.Canvas.lineWidth=this.LineWidth*V());for(var n=this.Data.DataOffset,s=0;n<this.Data.Data.length&&s<a;++n,++s){var o=this.Data.Data[n];if(null!=o){var h=this.ChartFrame.GetXFromIndex(s),l=this.ChartFrame.GetYFromData(o);if(h>e)break;if(this.Canvas.beginPath(),t)this.Canvas.moveTo(r,h),this.Canvas.lineTo(l,h),this.Canvas.stroke();else{var u=parseInt(h.toString())+.5;this.Canvas.moveTo(u,l),this.Canvas.lineTo(u,i)}this.Canvas.stroke()}}this.Canvas.restore()}},this.Draw=function(){this.IsShow&&(this.NotSupportMessage?this.DrawNotSupportmessage():this.Data&&this.Data.Data&&this.DrawStick())}}function Yt(){this.newMethod=kt,this.newMethod(),delete this.newMethod,this.ClassName="ChartLineStick",this.Draw=function(){this.IsShow&&(this.NotSupportMessage?this.DrawNotSupportmessage():(this.DrawStick(),this.DrawLine()))}}function Ut(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.UpColor=Ma.UpBarColor,this.DownColor=Ma.DownBarColor,this.HistoryData,this.KLineDrawType=0,this.ClassName="ChartVolStick",this.Draw=function(){if(!0!==this.ChartFrame.IsHScreen){var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetLeft()+e/2+2,i=this.ChartBorder.GetRight(),r=this.ChartFrame.XPointCount,n=this.GetLockRect();n&&(i=n.Left);var s=this.ChartFrame.GetYFromData(0);if(t>=4){s=X(s);for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<r;++o,++h,a+=t+e){var l=this.Data.Data[o],u=this.HistoryData.Data[o];if(null!=l&&null!=u){var C=a,D=a+t;if(D>i)break;var c=this.ChartFrame.GetYFromData(l),f=!1;u.Close>=u.Open?(this.Canvas.fillStyle=this.UpColor,f=!0):this.Canvas.fillStyle=this.DownColor;var d=X(s-c);c=s-d,!f||1!=this.KLineDrawType&&2!=this.KLineDrawType&&3!=this.KLineDrawType?this.Canvas.fillRect(X(C),c,X(t),d):(this.Canvas.strokeStyle=this.UpColor,this.Canvas.beginPath(),this.Canvas.rect(W(C),W(c),X(t),d),this.Canvas.stroke())}}}else for(o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<r;++o,++h,a+=t+e){l=this.Data.Data[o],u=this.HistoryData.Data[o];if(null!=l&&null!=u){c=this.ChartFrame.GetYFromData(l);var m=this.ChartFrame.GetXFromIndex(h);if(m>i)break;u.Close>=u.Open?this.Canvas.strokeStyle=this.UpColor:this.Canvas.strokeStyle=this.DownColor;m=this.ChartFrame.GetXFromIndex(h);this.Canvas.beginPath(),this.Canvas.moveTo(W(m),c),this.Canvas.lineTo(W(m),s),this.Canvas.stroke()}}}else this.HScreenDraw()},this.HScreenDraw=function(){var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetTop()+e/2+2,i=this.ChartBorder.GetBottom(),r=this.ChartFrame.XPointCount,n=this.GetLockRect();n&&(i=n.Top);var s=this.ChartFrame.GetYFromData(0);if(t>=4){s=X(s);for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<r;++o,++h,a+=t+e){var l=this.Data.Data[o],u=this.HistoryData.Data[o];if(null!=l&&null!=u){var C=a,D=a+t;if(D>i)break;var c=this.ChartFrame.GetYFromData(l),f=!1;u.Close>=u.Open?(f=!0,this.Canvas.fillStyle=this.UpColor):this.Canvas.fillStyle=this.DownColor;var d=X(c-s);!f||1!=this.KLineDrawType&&2!=this.KLineDrawType&&3!=this.KLineDrawType?this.Canvas.fillRect(s,X(C),d,X(t)):(this.Canvas.strokeStyle=this.UpColor,this.Canvas.beginPath(),this.Canvas.rect(W(s),W(C),d,X(t)),this.Canvas.stroke())}}}else for(o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<r;++o,++h,a+=t+e){l=this.Data.Data[o],u=this.HistoryData.Data[o];if(null!=l&&null!=u){c=this.ChartFrame.GetYFromData(l);var m=this.ChartFrame.GetXFromIndex(h);if(m>i)break;u.Close>u.Open?this.Canvas.strokeStyle=this.UpColor:this.Canvas.strokeStyle=this.DownColor;m=this.ChartFrame.GetXFromIndex(h);this.Canvas.beginPath(),this.Canvas.moveTo(c,W(m)),this.Canvas.lineTo(s,W(m)),this.Canvas.stroke()}}},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:0,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];null==e.Max&&(e.Max=r),e.Max<r&&(e.Max=r)}return e}}function Wt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartLineMultiData",this.Color="rgb(255,193,37)",this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());t&&(e=this.ChartBorder.GetBottom());for(var a=this.ChartFrame.XPointCount,i=!0,r=0,n=this.Data.DataOffset,s=0;n<this.Data.Data.length&&s<a;++n,++s){var o=this.Data.Data[n];if(null!=o){var h=this.ChartFrame.GetXFromIndex(s);if(h>e)break;for(var l in o){var u=o[l].Value,C=this.ChartFrame.GetYFromData(u);i?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),t?this.Canvas.moveTo(C,h):this.Canvas.moveTo(h,C),i=!1):t?this.Canvas.lineTo(C,h):this.Canvas.lineTo(h,C),++r}}}r>0&&this.Canvas.stroke()}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Min:null,Max:null};if(!this.Data||!this.Data.Data)return e;for(var a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(null!=r)for(var n in r){var s=r[n].Value;null==e.Max&&(e.Max=s),null==e.Min&&(e.Min=s),e.Max<s&&(e.Max=s),e.Min>s&&(e.Min=s)}}return e}}function Xt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartStickLine",this.Color="rgb(255,193,37)",this.LineWidth=2*V(),this.BarType=0,this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetRight();t&&(i=this.ChartBorder.GetBottom());var r=this.ChartFrame.XPointCount,n=this.ChartBorder.GetLeft()+a/2+2;t&&(n=this.ChartBorder.GetTop()+a/2+2),this.Canvas.save();var s=!1,o=!1;if(50==this.LineWidth)e>=4?(o=!0,this.Canvas.fillStyle=this.Color,this.Canvas.strokeStyle=this.Color):(this.Canvas.lineWidth=V(),this.Canvas.strokeStyle=this.Color);else if(this.LineWidth<100){var h=this.LineWidth;e<=4?h=V():e<h&&(h=parseInt(e)),this.Canvas.lineWidth=h,this.Canvas.strokeStyle=this.Color}else{s=!0,this.Canvas.fillStyle=this.Color;var l=2*V()}for(var u=this.Data.DataOffset,C=0;u<this.Data.Data.length&&C<r;++u,++C,n+=e+a){var D=this.Data.Data[u];if(null!=D){var c=D.Value,f=D.Value2;null==f&&(f=0);var d=this.ChartFrame.GetXFromIndex(C),m=this.ChartFrame.GetYFromData(c),v=this.ChartFrame.GetYFromData(f);if(d>i)break;if(s)if(t){var S=n-l;this.Canvas.fillRect(Math.min(m,v),S,Math.abs(m-v),e+a+2*l)}else{S=n-l;var I=e+a+2*l;S+I>i&&(I=i-S),this.Canvas.fillRect(X(S),X(Math.min(m,v)),X(I),X(Math.abs(m-v)))}else if(o)1==this.BarType?t?(this.Canvas.beginPath(),this.Canvas.fillRect(X(Math.min(m,v)),X(n),X(Math.abs(m-v)),X(e)),this.Canvas.stroke()):(this.Canvas.beginPath(),this.Canvas.rect(X(n),X(Math.min(m,v)),X(e),X(Math.abs(m-v))),this.Canvas.stroke()):t?this.Canvas.fillRect(X(Math.min(m,v)),X(n),X(Math.abs(m-v)),X(e)):this.Canvas.fillRect(X(n),X(Math.min(m,v)),X(e),X(Math.abs(m-v)));else if(t)this.Canvas.beginPath(),this.Canvas.moveTo(m,W(d)),this.Canvas.lineTo(v,W(d)),this.Canvas.stroke();else{var p=parseInt(d.toString())+.5;this.Canvas.beginPath(),this.Canvas.moveTo(p,m),this.Canvas.lineTo(p,v),this.Canvas.stroke()}}}this.Canvas.restore()}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Min:null,Max:null};if(!this.Data||!this.Data.Data)return e;for(var a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(null!=r){var n=r.Value2;if(null==n&&(n=0),null!=r&&!isNaN(r.Value)&&!isNaN(n)){var s=Math.max(r.Value,n),o=Math.min(r.Value,n);null==e.Max&&(e.Max=s),null==e.Min&&(e.Min=o),e.Max<s&&(e.Max=s),e.Min>o&&(e.Min=o)}}}return e}}function Kt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartText",this.TextFont="14px 微软雅黑",this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var t=this.ChartBorder.GetRight();this.ChartFrame.XPointCount;for(var e in this.Data.Data){var a=this.Data.Data[e];if(null!=a){var i=a.Value,r=a.Position;if("Left"==r){var n=this.ChartFrame.GetXFromIndex(0),s=this.ChartFrame.GetYFromData(i);if(n>t)continue;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=a.Color,this.Canvas.font=this.TextFont,this.Canvas.fillText(a.Message,n,s)}}}}},this.GetMaxMin=function(){this.ChartFrame.XPointCount;var t={Min:null,Max:null};if(!this.Data||!this.Data.Data)return t;for(var e in this.Data.Data){var a=this.Data.Data[e];if(null!=a&&!isNaN(a.Value)){var i=a.Value;null==t.Max&&(t.Max=i),null==t.Min&&(t.Min=i),t.Max<i&&(t.Max=i),t.Min>i&&(t.Min=i)}}return t}}function Jt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartSingleText",this.Color="rgb(255,193,37)",this.TextFont="14px 微软雅黑",this.Text,this.TextAlign="left",this.Direction=0,this.YOffset=0,this.Position,this.IconFont,this.Draw=function(){if(this.IsShow)if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Position)this.DrawPosition();else if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=(this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight()),i=this.ChartBorder.GetTopEx(),r=this.ChartBorder.GetBottomEx();t&&(a=this.ChartBorder.GetBottom(),i=this.ChartBorder.GetRightEx(),r=this.ChartBorder.GetLeftEx());var n=this.ChartFrame.XPointCount,s=Array.isArray(this.Text),o=V();if(1==this.Direction?this.Canvas.textBaseline="bottom":2==this.Direction?this.Canvas.textBaseline="top":this.Canvas.textBaseline="middle",this.IconFont){this.Color=this.IconFont.Color,this.Text=this.IconFont.Text;var h=e,l=12*o,u=24*o;h<l?h=l:h>u&&(h=u),this.Canvas.font=h+"px "+this.IconFont.Family}else this.TextFont=this.GetDynamicFont(2*e*o),this.Canvas.font=this.TextFont;for(var C=this.Data.DataOffset,D=0;C<this.Data.Data.length&&D<n;++C,++D){var c=this.Data.Data[C];if(null!=c){var f=this.ChartFrame.GetXFromIndex(D),d=this.ChartFrame.GetYFromData(c);if(f>a)break;if(this.Canvas.textAlign=this.TextAlign,this.Canvas.fillStyle=this.Color,this.YOffset>0&&this.Direction>0){var m=d;this.Canvas.save(),this.Canvas.setLineDash([5,10]),this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),t?(1==this.Direction?(d=i-this.YOffset*o,m+=5*o):(d=r+this.YOffset*o,m-=5*o),this.Canvas.moveTo(W(m),W(f)),this.Canvas.lineTo(W(d),W(f))):(1==this.Direction?(d=i+this.YOffset*o,m+=5*o):(d=r-this.YOffset*o,m-=5*o),this.Canvas.moveTo(W(f),W(m)),this.Canvas.lineTo(W(f),W(d))),this.Canvas.stroke(),this.Canvas.restore()}if(s){var v=this.Text[C];if(!v)continue;this.DrawText(v,f,d,t)}else this.DrawText(this.Text,f,d,t)}}}},this.DrawPosition=function(){if(this.Text){var t=!0===this.ChartFrame.IsHScreen;if(t)var e=this.ChartBorder.GetLeft()+this.ChartBorder.GetWidthEx()*this.Position.Y,a=this.ChartBorder.GetTop()+this.ChartBorder.GetHeight()*this.Position.X;else e=this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()*this.Position.X,a=this.ChartBorder.GetTopEx()+this.ChartBorder.GetHeight()*this.Position.Y;t&&(chartright=this.ChartBorder.GetBottom(),top=this.ChartBorder.GetRightEx(),bottom=this.ChartBorder.GetLeftEx()),this.Canvas.fillStyle=this.Color,0==this.Position.Type?this.Canvas.textAlign="left":2==this.Position.Type?this.Canvas.textAlign="center":this.Canvas.textAlign="right",this.DrawText(this.Text,e,a,t)}},this.DrawText=function(t,e,a,i){i?(this.Canvas.save(),this.Canvas.translate(a,e),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(t,0,0),this.Canvas.restore()):this.Canvas.fillText(t,e,a)}}function zt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartStraightLine",this.Color="rgb(255,193,37)",this.Draw=function(){if(this.Data&&this.Data.Data&&1==this.Data.Data.length){this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight();var t=this.ChartFrame.XPointCount,e=this.Data.Data[0],a=this.ChartFrame.GetYFromData(e),i=this.ChartFrame.GetXFromIndex(0),r=this.ChartFrame.GetXFromIndex(t-1),n=parseInt(a.toString())+.5;this.Canvas.beginPath(),this.Canvas.moveTo(i,n),this.Canvas.lineTo(r,n),this.Canvas.strokeStyle=this.Color,this.Canvas.stroke()}},this.GetMaxMin=function(){this.ChartFrame.XPointCount;var t={Min:null,Max:null};return this.Data&&this.Data.Data?1!=this.Data.Data.length?t:(t.Min=this.Data.Data[0],t.Max=this.Data.Data[0],t):t}}function qt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartStraightArea",this.Color="rgb(255,193,37)",this.Font="11px 微软雅黑",this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data)if(!0!==this.ChartFrame.IsHScreen){this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight(),this.ChartBorder.GetBottom();var t=this.ChartBorder.GetLeft(),e=this.ChartFrame.XPointCount,a=this.ChartFrame.GetXFromIndex(e-1);for(var i in this.Data.Data){var r=this.Data.Data[i];if(null!=r&&!isNaN(r.Value)&&!isNaN(r.Value2)&&null!=r.Color){var n=Math.max(r.Value,r.Value2),s=Math.min(r.Value,r.Value2),o=this.ChartFrame.GetYFromData(n),h=this.ChartFrame.GetYFromData(s);if(this.Canvas.fillStyle=r.Color,this.Canvas.fillRect(X(t),X(o),X(a-t),X(h-o)),r.Title&&r.TitleColor){this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=r.TitleColor,this.Canvas.font=this.Font;var l=o+(h-o)/2;this.Canvas.fillText(r.Title,a,l)}}}}else this.HScreenDraw()},this.HScreenDraw=function(){var t=this.ChartBorder.GetBottom(),e=this.ChartBorder.GetTop(),a=this.ChartBorder.GetHeight();for(var i in this.Data.Data){var r=this.Data.Data[i];if(null!=r&&!isNaN(r.Value)&&!isNaN(r.Value2)&&null!=r.Color){var n=Math.max(r.Value,r.Value2),s=Math.min(r.Value,r.Value2),o=this.ChartFrame.GetYFromData(n),h=this.ChartFrame.GetYFromData(s);if(this.Canvas.fillStyle=r.Color,this.Canvas.fillRect(X(h),X(e),X(o-h),X(a)),r.Title&&r.TitleColor){var l=o+(h-o)/2,u=t;this.Canvas.save(),this.Canvas.translate(l,u),this.Canvas.rotate(90*Math.PI/180),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=r.TitleColor,this.Canvas.font=this.Font,this.Canvas.fillText(r.Title,0,-2),this.Canvas.restore()}}}},this.GetMaxMin=function(){this.ChartFrame.XPointCount;var t={Min:null,Max:null};if(!this.Data||!this.Data.Data)return t;for(var e in this.Data.Data){var a=this.Data.Data[e];if(null!=a&&!isNaN(a.Value)&&!isNaN(a.Value2)){var i=Math.max(a.Value,a.Value2),r=Math.min(a.Value,a.Value2);null==t.Max&&(t.Max=i),null==t.Min&&(t.Min=r),t.Max<i&&(t.Max=i),t.Min>r&&(t.Min=r)}}return t}}function Zt(){this.newMethod=Bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinutePriceLine",this.YClose,this.IsDrawArea=!0,this.AreaColor="rgba(0,191,255,0.1)",this.SourceData,this.IsShowLead=!1,this.LeadData,this.UpColor=Ma.UpBarColor,this.DownColor=Ma.DownBarColor,this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.IsShow){var t=!0===this.ChartFrame.IsHScreen;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight();!0===t&&this.ChartBorder.GetBottom();var e=this.ChartFrame.XPointCount,a=this.ChartFrame.MinuteCount,i=this.ChartBorder.GetBottomEx(),r=this.ChartBorder.GetLeftEx(),n=this.Data,s=!1;if(this.SourceData&&(n=this.SourceData,s=!0),this.IsShowLead&&this.DrawLead(),n){for(var o=!0,h={},l=0,u=n.DataOffset,C=0;u<n.Data.length&&C<e;++u,++C){var D=null;if(s){var c=n.Data[u];D=c.Before?c.Before.Close:c.Close}else D=n.Data[u];if(null!=D){var f=this.ChartFrame.GetXFromIndex(C),d=this.ChartFrame.GetYFromData(D);o?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),t?this.Canvas.moveTo(d,f):this.Canvas.moveTo(f,d),o=!1,h={X:f,Y:d}):t?this.Canvas.lineTo(d,f):this.Canvas.lineTo(f,d),++l,l>=a&&(o=!0,this.Canvas.stroke(),this.IsDrawArea&&(t?(this.Canvas.lineTo(r,f),this.Canvas.lineTo(r,h.X),this.SetFillStyle(this.AreaColor,this.ChartBorder.GetRightEx(),i,this.ChartBorder.GetLeftEx(),i)):(this.Canvas.lineTo(f,i),this.Canvas.lineTo(h.X,i),this.SetFillStyle(this.AreaColor,r,this.ChartBorder.GetTopEx(),r,i)),this.Canvas.fill()),l=0)}}l>0&&(this.Canvas.stroke(),this.IsDrawArea&&(t?(this.Canvas.lineTo(r,f),this.Canvas.lineTo(r,h.X),this.SetFillStyle(this.AreaColor,this.ChartBorder.GetRightEx(),i,this.ChartBorder.GetLeftEx(),i)):(this.Canvas.lineTo(f,i),this.Canvas.lineTo(h.X,i),this.SetFillStyle(this.AreaColor,r,this.ChartBorder.GetTopEx(),r,i)),this.Canvas.fill()))}}},this.DrawLead=function(){if(this.LeadData){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.XPointCount,a=this.ChartFrame.MinuteCount,i=(this.ChartBorder.GetBottomEx(),this.ChartBorder.GetTopEx());if(!0===t&&(i=this.ChartBorder.GetRightEx()),!(e>a)){for(var r=[],n=null,s=null,o=this.ChartFrame.GetYFromData(this.YClose),h=(o-i)/3,l=this.LeadData,u=l.DataOffset,C=0;u<l.Data.length&&C<e;++u,++C){var D=l.Data[u];if(Le.IsNumber(D)&&0!=D){var c=this.ChartFrame.GetXFromIndex(C);(null==n||n<D)&&(n=D),(null==s||s>D)&&(s=D),r.push({X:c,Value:D})}}if(!(r.length<=0)){var f=Math.max(Math.abs(n),Math.abs(s));for(var u in r){var d=r[u];d.Value>0?this.Canvas.strokeStyle=this.UpColor:this.Canvas.strokeStyle=this.DownColor;var m=o-d.Value*h/f;c=W(d.X);this.Canvas.beginPath(),!0===t?(this.Canvas.moveTo(o,c),this.Canvas.lineTo(m,c)):(this.Canvas.moveTo(c,o),this.Canvas.lineTo(c,m)),this.Canvas.stroke()}}}}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={};if(null==this.YClose)return e;if(!this.IsShow)return e;e.Min=this.YClose,e.Max=this.YClose;var a=this.Data,i=!1;this.SourceData&&(a=this.SourceData,i=!0);for(var r=a.DataOffset,n=0;r<a.Data.length&&n<t;++r,++n){var s=null;if(i){var o=a.Data[r];s=o.Before?o.Before.Close:o.Close}else s=a.Data[r];null!=s&&(null==e.Max&&(e.Max=s),null==e.Min&&(e.Min=s),e.Max<s&&(e.Max=s),e.Min>s&&(e.Min=s))}if(e.Max==this.YClose&&e.Min==this.YClose)return e.Max=this.YClose+.1*this.YClose,e.Min=this.YClose-.1*this.YClose,e;var h=Math.max(Math.abs(this.YClose-e.Max),Math.abs(this.YClose-e.Min));return e.Max=this.YClose+h,e.Min=this.YClose-h,e}}function Qt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.Color="rgb(65,105,225)",this.MainData,this.MainYClose,this.SourceData,this.BeforeDataCount=0,this.IsBeforeData=!1,this.ClassName="ChartOverlayMinutePriceLine",this.Title,this.Symbol,this.YClose,this.Status=Rt.STATUS_NONE_ID,this.Draw=function(){if(this.Data)if(this.NotSupportMessage)this.DrawNotSupportmessage();else{var t=!0===this.ChartFrame.IsHScreen;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight();!0===t&&this.ChartBorder.GetBottom();var e=this.ChartFrame.XPointCount,a=this.ChartFrame.MinuteCount,i=!0,r=0,n=0;this.IsBeforeData&&(n=1);for(var s=this.Data.DataOffset+n,o=0;s<this.Data.Data.length&&o<e;++s,++o){var h=this.Data.Data[s].Close;if(null!=h){var l=h/this.YClose*this.MainYClose,u=this.ChartFrame.GetXFromIndex(o+this.BeforeDataCount),C=this.ChartFrame.GetYFromData(l);i?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),t?this.Canvas.moveTo(C,u):this.Canvas.moveTo(u,C),i=!1):t?this.Canvas.lineTo(C,u):this.Canvas.lineTo(u,C),++r,r>=a&&(i=!0,this.Canvas.stroke(),r=0)}}r>0&&this.Canvas.stroke()}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={};if(null==this.YClose)return e;e.Min=this.MainYClose,e.Max=this.MainYClose;for(var a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a].Close;if(null!=r){r=r/this.YClose*this.MainYClose;null==e.Max&&(e.Max=r),null==e.Min&&(e.Min=r),e.Max<r&&(e.Max=r),e.Min>r&&(e.Min=r)}}if(e.Max==this.MainYClose&&e.Min==this.MainYClose)return e.Max=this.MainYClose+.1*this.MainYClose,e.Min=this.MainYClose-.1*this.MainYClose,e;var n=Math.max(Math.abs(this.MainYClose-e.Max),Math.abs(this.MainYClose-e.Min));return e.Max=this.MainYClose+n,e.Min=this.MainYClose-n,e}}function jt(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinuteInfo",this.Data=new g.default,this.SourceData,this.ChartMinutePrice,this.YClose,this.HQChartBorder,this.TextColor=Ma.MinuteInfo.TextColor,this.Font=Ma.MinuteInfo.Font,this.PointColor=Ma.MinuteInfo.PointColor,this.LineColor=Ma.MinuteInfo.LineColor,this.TextBGColor=Ma.MinuteInfo.TextBGColor,this.PixelTatio=V(),this.TextHeight=20,this.TextRectCache=[],this.InfoDrawCache=[],this.FrameBottom,this.FrameTop,this.FrameLeft,this.FrameRight,this.YOffset=5,this.IsHScreen=!1,this.IsDrawFull=!1,this.TooltipRect=[],this.SetOption=function(t){t.TextColor&&(this.TextColor=t.TextColor),t.TextBGColor&&(this.TextBGColor=t.TextBGColor),t.Font&&(this.Font=t.Font),t.PointColor&&(this.PointColor=t.PointColor),t.LineColor&&(this.LineColor=t.LineColor),t.TextHeight>0&&(this.TextHeight=t.TextHeight),1==t.IsDrawFull&&(this.IsDrawFull=!0)},this.Draw=function(){if(this.TooltipRect=[],this.ChartMinutePrice&&this.Data&&!(this.Data.size<=0)){this.TextRectCache=[],this.InfoDrawCache=[],this.PixelTatio=V(),this.YOffset=5*this.PixelTatio,this.IsHScreen=!0===this.ChartFrame.IsHScreen;var t=this.ChartFrame.XPointCount;this.ChartFrame.MinuteCount;this.FrameBottom=this.ChartBorder.GetBottom(),this.IsDrawFull&&this.HQChartBorder&&(this.FrameBottom=this.HQChartBorder.GetBottom()),this.FrameTop=this.ChartBorder.GetTop(),this.FrameLeft=this.ChartBorder.GetLeft(),this.FrameRight=this.ChartBorder.GetRight(),this.IsHScreen&&(this.FrameRight=this.ChartBorder.GetBottom(),this.FrameLeft=this.ChartBorder.GetTop(),this.FrameBottom=this.ChartBorder.GetLeft(),this.FrameTop=this.ChartBorder.GetRight()),this.YClose=this.ChartMinutePrice.YClose;var e=this.ChartMinutePrice.Data,a=!1;this.ChartMinutePrice.SourceData&&(e=this.ChartMinutePrice.SourceData,a=!0);for(var i=e.DataOffset,r=0;i<e.Data.length&&r<t;++i,++r){var n=this.SourceData.Data[i];if((!a||!n.Before)&&n){var s=n.DateTime;this.Data.has(s)&&(this.IsHScreen?this.CalcuateInfoHScreenPosition(this.Data.get(s),r,n):this.CalcuateInfoPosition(this.Data.get(s),r,n))}}for(var i in this.InfoDrawCache){n=this.InfoDrawCache[i];this.DrawInfoLines(n)}for(var i in this.InfoDrawCache){n=this.InfoDrawCache[i];if(this.DrawInfoText(n),!this.IsHScreen){var o=n.Border,h=new Mt(o.X,o.Y,o.Width,o.Height),l={Data:{Item:n},Rect:h};this.TooltipRect.push(l)}}this.TextRectCache=[],this.InfoDrawCache=[]}},this.CalcuateInfoPosition=function(t,e,a){if(t&&t.Data&&!(t.Data.length<=0)){var i=t.Data[0];this.Canvas.font=this.Font;var r,n=this.Canvas.measureText(i.Title).width+4*this.PixelTatio,s=this.TextHeight*this.PixelTatio,o=this.ChartFrame.GetXFromIndex(e);r=Le.IsNumber(i.Price)?this.ChartFrame.GetYFromData(i.Price):this.ChartFrame.GetYFromData(a.Close),o=W(o);var h=o<this.FrameLeft+Math.abs(this.FrameLeft-this.FrameRight)/2,l=[2,4,6,8,3,5,7],u=s+l[e%l.length]*this.PixelTatio,C={Y:[{Value:r+(s+this.YOffset),Offset:u},{Value:r-(2*s+this.YOffset),Offset:-u}]};a.Close<this.YClose&&(C.Y=C.Y.reverse());var D={X:o,Y:null,Width:n,Height:s};h||(D.X-=D.Width),this.FixTextRect(D,C);var c={Border:D,Start:{X:o,Y:r},IsLeft:h,Title:i.Title,Date:i.Date,Time:i.Time};i.Content&&(c.Content=i.Content),i.Link&&(c.Link=i.Link),i.Color&&(c.Color=i.Color),i.BGColor&&(c.BGColor=i.BGColor),this.InfoDrawCache.push(c),this.TextRectCache.push(D)}},this.CalcuateInfoHScreenPosition=function(t,e,a){if(t&&t.Data&&!(t.Data.length<=0)){var i=t.Data[0];this.Canvas.font=this.Font;var r,n=this.Canvas.measureText(i.Title).width+4*this.PixelTatio,s=this.TextHeight*this.PixelTatio,o=this.ChartFrame.GetXFromIndex(e);r=Le.IsNumber(i.Price)?this.ChartFrame.GetYFromData(i.Price):this.ChartFrame.GetYFromData(a.Close),o=W(o);var h=o<this.FrameLeft+Math.abs(this.FrameLeft-this.FrameRight)/2,l=[2,4,6,8,3,5,7],u=s+l[e%l.length]*this.PixelTatio,C={X:[{Value:r+(s+this.YOffset),Offset:u},{Value:r-(2*s+this.YOffset),Offset:-u}]};a.Close>this.YClose&&(C.X=C.X.reverse());var D={X:null,Y:o,Width:s,Height:n};h||(D.Y-=D.Height),this.FixHScreenTextRect(D,C);var c={Border:D,Start:{X:r,Y:o},IsLeft:h,Title:i.Title};this.InfoDrawCache.push(c),this.TextRectCache.push(D)}},this.DrawInfoLines=function(t){var e=t.Border,a=t.IsLeft;this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(W(t.Start.X),t.Start.Y),a?this.Canvas.lineTo(W(t.Start.X),e.Y):this.IsHScreen?this.Canvas.lineTo(e.X,e.Y+e.Height):this.Canvas.lineTo(W(t.Start.X),e.Y),this.Canvas.stroke(),this.Canvas.fillStyle=this.PointColor,this.Canvas.beginPath(),this.Canvas.arc(t.Start.X,t.Start.Y,5,0,2*Math.PI),this.Canvas.closePath(),this.Canvas.fill()},this.DrawInfoText=function(t){var e=t.Border,a=e.X,i=e.Y;t.BGColor?this.Canvas.fillStyle=t.BGColor:this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(a,i,e.Width,e.Height),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.rect(a,i,e.Width,e.Height),this.Canvas.stroke(),this.IsHScreen&&(this.Canvas.save(),this.Canvas.translate(e.X,e.Y),this.Canvas.rotate(90*Math.PI/180),a=0,i=0),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",t.Color?this.Canvas.fillStyle=t.Color:this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.IsHScreen?this.Canvas.fillText(t.Title,a+2*this.PixelTatio,i-e.Width/2):this.Canvas.fillText(t.Title,a+2*this.PixelTatio,i+e.Height/2),this.IsHScreen&&this.Canvas.restore()},this.FixTextRect=function(t,e){for(var a in e.Y){var i,r=e.Y[a];t.Y=r.Value;for(var n=0;n<10;++n){var s=!1;for(var o in this.TextRectCache){var h=this.TextRectCache[o];if(this.IsOverlap(h,t)){s=!0;break}}if(0==s)return;if(i=t.Y,i+=r.Offset,i+t.Height>this.FrameBottom||i<this.FrameTop)break;t.Y=i}}},this.FixHScreenTextRect=function(t,e){for(var a in e.X){var i,r=e.X[a];t.X=r.Value;for(var n=0;n<10;++n){var s=!1;for(var o in this.TextRectCache){var h=this.TextRectCache[o];if(this.IsOverlap(h,t)){s=!0;break}}if(0==s)return;if(i=t.X,i+=r.Offset,i+t.Width<this.FrameBottom||i>this.FrameTop)break;t.X=i}}},this.IsOverlap=function(t,e){return t.X+t.Width>e.X&&e.X+e.Width>t.X&&t.Y+t.Height>e.Y&&e.Y+e.Height>t.Y},this.GetMaxMin=function(){var t={Min:null,Max:null};return t},this.GetTooltipData=function(t,e,a){for(var i in this.TooltipRect){var r=this.TooltipRect[i];if(r.Rect){var n=r.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(n.X,n.Y,n.Width,n.Height),this.Canvas.isPointInPath(t,e))return a.Data=r,a.ChartPaint=this,a.Type=3,!0}}return!1}}function $t(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMACD",this.UpColor=Ma.UpBarColor,this.DownColor=Ma.DownBarColor,this.LineWidth=1,this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(!0!==this.ChartFrame.IsHScreen){var t=this.ChartFrame.DataWidth,e=(this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight()),a=this.ChartFrame.XPointCount,i=this.GetLockRect();i&&(e=i.Left);var r=this.ChartFrame.GetYFromData(0),n=this.LineWidth*V();50==this.LineWidth?n=t:n>t&&(n=t);var s=this.Canvas.lineWidth;this.Canvas.lineWidth=n;for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<a;++o,++h){var l=this.Data.Data[o];if(null!=l){var u=this.ChartFrame.GetXFromIndex(h),C=this.ChartFrame.GetYFromData(l);if(u>e)break;var D=parseInt(u.toString())+.5;this.Canvas.beginPath(),this.Canvas.moveTo(D,r),this.Canvas.lineTo(D,C),this.Canvas.strokeStyle=l>=0?this.UpColor:this.DownColor,this.Canvas.stroke(),this.Canvas.closePath()}}this.Canvas.lineWidth=s}else this.HScreenDraw()},this.HScreenDraw=function(){var t=this.ChartFrame.DataWidth,e=(this.ChartFrame.DistanceWidth,this.ChartBorder.GetBottom()),a=this.ChartFrame.XPointCount,i=this.GetLockRect();i&&(e=i.Top);var r=this.ChartFrame.GetYFromData(0),n=this.LineWidth*V();50==this.LineWidth?n=t:n>t&&(n=t);var s=this.Canvas.lineWidth;this.Canvas.lineWidth=n;for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<a;++o,++h){var l=this.Data.Data[o];if(null!=l){var u=this.ChartFrame.GetXFromIndex(h),C=this.ChartFrame.GetYFromData(l);if(u>e)break;this.Canvas.beginPath(),this.Canvas.moveTo(r,W(u)),this.Canvas.lineTo(C,W(u)),this.Canvas.strokeStyle=l>=0?this.UpColor:this.DownColor,this.Canvas.stroke(),this.Canvas.closePath()}}this.Canvas.lineWidth=s}}function te(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartBar",this.UpBarColor=Ma.UpBarColor,this.DownBarColor=Ma.DownBarColor,this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else{var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetRight(),i=this.ChartFrame.XPointCount,r=this.ChartBorder.GetLeft()+e/2+2,n=this.ChartFrame.GetYFromData(0);if(t>=4){n=X(n);for(var s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<i;++s,++o,r+=t+e){var h=this.Data.Data[s];if(null!=h&&0!=h){var l=r,u=r+t;if(u>a)break;var C=this.ChartFrame.GetXFromIndex(o),D=this.ChartFrame.GetYFromData(h);this.Canvas.fillStyle=h>0?this.UpBarColor:this.DownBarColor;var c=X(Math.abs(n-D));D=n-D>0?n-c:n+c,this.Canvas.fillRect(X(l),D,X(t),c)}}}else for(s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<i;++s,++o,r+=t+e){h=this.Data.Data[s];if(null!=h&&0!=h){l=r,u=r+t;if(u>a)break;C=this.ChartFrame.GetXFromIndex(o),D=this.ChartFrame.GetYFromData(h);this.Canvas.strokeStyle=h>0?this.UpBarColor:this.DownBarColor,this.Canvas.beginPath(),this.Canvas.moveTo(W(C),D),this.Canvas.lineTo(W(C),n),this.Canvas.stroke()}}}},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:0,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];null==e.Max&&(e.Max=r),e.Max<r&&(e.Max=r)}return e}}function ee(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.ClassName="ChartBand",this.FirstColor=Ma.Index.LineColor[0],this.SecondColor=Ma.Index.LineColor[1],this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else{for(var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartFrame.XPointCount,i=this.ChartBorder.GetLeft()+e/2+2,r=0,n=0,s=0,o=[],h=[],l=0,u=this.Data.DataOffset,C=0;u<this.Data.Data.length&&C<a;++u,++C,i+=t+e){var D=this.Data.Data[u];null!=D&&null!=D.Value&&null!=D.Value2&&(r=this.ChartFrame.GetXFromIndex(C),n=this.ChartFrame.GetYFromData(D.Value),s=this.ChartFrame.GetYFromData(D.Value2),o[l]={x:r,y:n},h[l]={x:r,y:s},l++)}if(o.length>1){this.Canvas.save(),this.Canvas.beginPath();for(u=0;u<o.length;++u)0==u?this.Canvas.moveTo(o[u].x,o[u].y):this.Canvas.lineTo(o[u].x,o[u].y);for(C=h.length-1;C>=0;--C)this.Canvas.lineTo(h[C].x,h[C].y);this.Canvas.closePath(),this.Canvas.clip(),this.Canvas.beginPath(),this.Canvas.moveTo(o[0].x,this.ChartBorder.GetBottom());for(u=0;u<o.length;++u)this.Canvas.lineTo(o[u].x,o[u].y);this.Canvas.lineTo(o[o.length-1].x,this.ChartBorder.GetBottom()),this.Canvas.closePath(),this.Canvas.fillStyle=this.FirstColor,this.Canvas.fill(),this.Canvas.beginPath(),this.Canvas.moveTo(h[0].x,this.ChartBorder.GetBottom());for(u=0;u<h.length;++u)this.Canvas.lineTo(h[u].x,h[u].y);this.Canvas.lineTo(h[h.length-1].x,this.ChartBorder.GetBottom()),this.Canvas.closePath(),this.Canvas.fillStyle=this.SecondColor,this.Canvas.fill(),this.Canvas.restore()}}},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:null,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(null!=r&&null!=r.Value&&null!=r.Value2){var n=r.Value>r.Value2?r.Value:r.Value2,s=r.Value<r.Value2?r.Value:r.Value2;null==e.Max?e.Max=n:e.Max<n&&(e.Max=n),null==e.Min?e.Min=s:e.Min>s&&(e.Min=s)}}return e}}function ae(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.ClassName="ChartLineArea",this.Color="rgb(56,67,99)",this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){for(var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartFrame.XPointCount,i=this.ChartBorder.GetLeft()+e/2+Ma.FrameLeftMargin,r=0,n=0,s=0,o=[],h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<a;++h,++l,i+=t+e){var u=this.Data.Data[h];o[h]=null,null!=u&&null!=u.Value&&null!=u.Value2&&(r=this.ChartFrame.GetXFromIndex(l),n=this.ChartFrame.GetYFromData(u.Value),s=this.ChartFrame.GetYFromData(u.Value2),o[h]={Line:{X:r,Y:n},Line2:{X:r,Y:s}})}this.Canvas.fillStyle=this.Color;var C=!0,D=0,c=[];for(var h in o){var f=o[h];if(f)C?(this.Canvas.beginPath(),this.Canvas.moveTo(f.Line.X,f.Line.Y),C=!1):this.Canvas.lineTo(f.Line.X,f.Line.Y),c.push(f),++D;else{if(D>0){for(l=c.length-1;l>=0;--l){var d=c[l];this.Canvas.lineTo(d.Line2.X,d.Line2.Y)}this.Canvas.closePath(),this.Canvas.fill()}C=!0,D=0,c=[]}}if(D>0){for(l=c.length-1;l>=0;--l){d=c[l];this.Canvas.lineTo(d.Line2.X,d.Line2.Y)}this.Canvas.closePath(),this.Canvas.fill()}}},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:null,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(r&&null!=r.Value&&null!=r.Value2){var n=r.Value>r.Value2?r.Value:r.Value2,s=r.Value<r.Value2?r.Value:r.Value2;null==e.Max?e.Max=n:e.Max<n&&(e.Max=n),null==e.Min?e.Min=s:e.Min>s&&(e.Min=s)}}return e}}function ie(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.ClassName="ChartChannel",this.IsHScreen=!1,this.PointCount=0,this.DataWidth=0,this.DistanceWidth=0,this.ChartRight=0,this.LineColor="RGB(255,0,0)",this.LineDotted=[3,3],this.AreaColor="RGB(255,222,173)",this.LineWidth=1,this.CalculateData=function(){for(var t=[],e=[],a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<this.PointCount;++a,++i){var r=this.Data.Data[a];if(r&&Le.IsNumber(r.Value)&&Le.IsNumber(r.Value2)){var n=this.ChartFrame.GetXFromIndex(i);if(n>this.ChartRight)break;var s=this.ChartFrame.GetYFromData(r.Value),o=this.ChartFrame.GetYFromData(r.Value2);e.push({X:n,Y:s,Y2:o})}else e.length>0&&(t.push(e),e=[])}return e.length>0&&t.push(e),t},this.DrawArea=function(t){if(!(t.length<=0)){this.Canvas.beginPath();var e=t[0];this.IsHScreen?this.Canvas.moveTo(e.Y,e.X):this.Canvas.moveTo(e.X,e.Y);for(var a=1;a<t.length;++a){var i=t[a];this.IsHScreen?this.Canvas.lineTo(i.Y,i.X):this.Canvas.lineTo(i.X,i.Y)}for(a=t.length-1;a>=0;--a){i=t[a];this.IsHScreen?this.Canvas.lineTo(i.Y2,i.X):this.Canvas.lineTo(i.X,i.Y2)}this.Canvas.closePath(),this.Canvas.fillStyle=this.AreaColor,this.Canvas.fill()}},this.DrawLine=function(t){this.Canvas.strokeStyle=this.LineColor;for(var e=0;e<2;++e){for(var a=!0,i=0,r=0;r<t.length;++r){var n=t[r];a?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(0===e?n.Y:n.Y2,n.X):this.Canvas.moveTo(n.X,0===e?n.Y:n.Y2),a=!1):this.IsHScreen?this.Canvas.lineTo(0===e?n.Y:n.Y2,n.X):this.Canvas.lineTo(n.X,0===e?n.Y:n.Y2),++i}i>0&&this.Canvas.stroke()}},this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else{this.IsHScreen=!0===this.ChartFrame.IsHScreen,this.PointCount=this.ChartFrame.XPointCount,this.DataWidth=this.ChartFrame.DataWidth,this.DistanceWidth=this.ChartFrame.DistanceWidth,this.IsHScreen?this.ChartRight=this.ChartBorder.GetBottom():this.ChartRight=this.ChartBorder.GetRight();var t=this.CalculateData();if(t&&!(t.length<=0)){this.Canvas.save(),this.Canvas.lineWidth=this.LineWidth*V(),this.Canvas.setLineDash(this.LineDotted);for(var e=0;e<t.length;++e){var a=t[e];this.DrawArea(a),this.DrawLine(a)}this.Canvas.restore()}}},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:null,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(null!=r&&null!=r.Value&&null!=r.Value2){var n=r.Value>r.Value2?r.Value:r.Value2,s=r.Value<r.Value2?r.Value:r.Value2;null==e.Max?e.Max=n:e.Max<n&&(e.Max=n),null==e.Min?e.Min=s:e.Min>s&&(e.Min=s)}}return e}}function re(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartBackground",this.Color=null,this.ColorAngle=0,this.Draw=function(){if(this.IsShow&&this.Color&&!(this.Color.length<=0)){if(2==this.Color.length){if(0==this.ColorAngle)var t={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()},e={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetBottomEx()};else t={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()},e={X:this.ChartBorder.GetRight(),Y:this.ChartBorder.GetTopEx()};var a=this.Canvas.createLinearGradient(t.X,t.Y,e.X,e.Y);a.addColorStop(0,this.Color[0]),a.addColorStop(1,this.Color[1]),this.Canvas.fillStyle=a}else{if(1!=this.Color.length)return;this.Canvas.fillStyle=this.Color[0]}var i=this.ChartBorder.GetLeft(),r=this.ChartBorder.GetTopEx(),n=this.ChartBorder.GetWidth(),s=this.ChartBorder.GetHeightEx();this.Canvas.fillRect(i,r,n,s)}}}function ne(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartRectangle",this.Color=[],this.Rect,this.BorderColor=Ma.FrameBorderPen,this.Draw=function(){if(this.IsShow&&this.Color&&this.Rect&&!(this.Color.length<=0)){this.Canvas.strokeStyle=this.BorderColor;var t=!1;if(2==this.Color.length)this.Canvas.fillStyle=this.Color[0],t=!0;else{if(1!=this.Color.length)return;this.Color[0]&&(this.Canvas.fillStyle=this.Color[0],t=!0)}var e=this.ChartBorder.GetWidth(),a=this.ChartBorder.GetHeightEx(),i=this.Rect.Left/1e3*e,r=this.Rect.Top/1e3*a,n=this.Rect.Right/1e3*e,s=this.Rect.Bottom/1e3*a;i=this.ChartBorder.GetLeft()+i,r=this.ChartBorder.GetTopEx()+r,n=this.ChartBorder.GetLeft()+n,s=this.ChartBorder.GetTopEx()+s;var o=Math.abs(i-n),h=Math.abs(r-s);t&&this.Canvas.fillRect(i,r,o,h),this.Canvas.rect(W(i),W(r),X(o),X(h)),this.Canvas.stroke()}}}function se(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartTextLine",this.Text,this.Line,this.Price,this.Draw=function(){if(this.IsShow&&this.Text&&this.Line&&Le.IsNumber(this.Price)){this.IsHScreen=!0===this.ChartFrame.IsHScreen;var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRight(),a=this.ChartBorder.GetBottomEx(),i=this.ChartBorder.GetTopEx(),r=this.ChartFrame.GetYFromData(this.Price),n=0;if(this.Text.Title){var s=t+2*V(),o=r;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var h=8*V();r-h<i?(this.Canvas.textBaseline="top",o=i):r+h>a&&(this.Canvas.textBaseline="bottom",o=a),this.Canvas.fillStyle=this.Text.Color,this.Canvas.font=this.Text.Font,this.Canvas.fillText(this.Text.Title,s,o),n=this.Canvas.measureText(this.Text.Title).width+4*V()}if(this.Line.Type>0){2==this.Line.Type&&(this.Canvas.save(),this.Canvas.setLineDash([3,5]));s=t+n;this.Canvas.strokeStyle=this.Line.Color,this.Canvas.beginPath(),this.Canvas.moveTo(s,W(r)),this.Canvas.lineTo(e,W(r)),this.Canvas.stroke(),2==this.Line.Type&&this.Canvas.restore()}}},this.GetMaxMin=function(){var t={Min:null,Max:null};return Le.IsNumber(this.Price)&&(t.Min=this.Price,t.Max=this.Price),t}}function oe(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiBar",this.Bars=[],this.IsHScreen=!1,this.Draw=function(){if(this.IsShow&&this.Data&&!(this.Data.length<=0)){this.IsHScreen=!0===this.ChartFrame.IsHScreen;var t=this.ChartFrame.XPointCount,e=this.Data.DataOffset,a=this.ChartFrame.DataWidth,i=V(),r=[];for(var n in this.Bars){var s=this.Bars[n],o={Point:[],Color:s.Color,Width:a,Type:0};for(var h in s.Type>0&&(o.Type=s.Type),s.Width>0?(o.Width=s.Width*i,o.Width>a&&(o.Width=a)):o.Width<4&&(o.Width=1*i),s.Point){var l=s.Point[h];if(Le.IsNumber(l.Index)){var u=l.Index-e;if(u>=0&&u<t){var C=this.ChartFrame.GetXFromIndex(u),D=this.ChartFrame.GetYFromData(l.Value),c=this.ChartFrame.GetYFromData(l.Value2);o.Point.push({X:C,Y:D,Y2:c})}}}o.Point.length>0&&r.push(o)}for(var n in r){s=r[n];s.Width>=4?1==s.Type?this.DrawHollowBar(s):this.DrawFillBar(s):this.DrawLineBar(s)}}},this.DrawLineBar=function(t){this.Canvas.strokeStyle=t.Color;var e=this.Canvas.lineWidth;for(var a in this.Canvas.lineWidth=t.Width,t.Point){var i=t.Point[a];this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(W(i.Y),W(i.X)),this.Canvas.lineTo(W(i.Y2),W(i.X))):(this.Canvas.moveTo(W(i.X),W(i.Y)),this.Canvas.lineTo(W(i.X),W(i.Y2))),this.Canvas.stroke()}this.Canvas.lineWidth=e},this.DrawFillBar=function(t){for(var e in this.Canvas.fillStyle=t.Color,t.Point){var a=t.Point[e],i=a.X-t.Width/2,r=Math.min(a.Y,a.Y2),n=t.Width,s=Math.abs(a.Y-a.Y2);this.IsHScreen?this.Canvas.fillRect(X(r),X(i),X(s),X(n)):this.Canvas.fillRect(X(i),X(r),X(n),X(s))}},this.DrawHollowBar=function(t){this.Canvas.strokeStyle=t.Color;var e=1;for(var a in t.Point){var i=t.Point[a],r=i.X-t.Width/2,n=Math.min(i.Y,i.Y2),s=t.Width,o=Math.abs(i.Y-i.Y2);this.Canvas.beginPath(),this.IsHScreen?this.Canvas.rect(W(n),W(r),X(o),X(s)):this.Canvas.rect(W(r),W(n),X(s),X(o)),this.Canvas.stroke()}this.Canvas.lineWidth=e},this.GetMaxMin=function(){var t={Min:null,Max:null},e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,i=a+e;for(var r in this.Bars){var n=this.Bars[r];for(var s in n.Point){var o=n.Point[s];if(o.Index>=a&&o.Index<i){var h=Math.min(o.Value,o.Value2),l=Math.max(o.Value,o.Value2);null==t.Max?t.Max=l:t.Max<l&&(t.Max=l),null==t.Min?t.Min=h:t.Min>h&&(t.Min=h)}}}return t}}function he(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiLine",this.Lines=[],this.IsHScreen=!1,this.Draw=function(){if(this.IsShow&&this.Data&&!(this.Data.length<=0)){this.IsHScreen=!0===this.ChartFrame.IsHScreen;var t=this.ChartFrame.XPointCount,e=this.Data.DataOffset,a=[];for(var i in this.Lines){var r=this.Lines[i],n={Point:[],Color:r.Color};for(var s in r.BGColor&&(n.BGColor=r.BGColor),r.Point){var o=r.Point[s];if(Le.IsNumber(o.Index)){var h=o.Index-e;if(h>=0&&h<t){var l=this.ChartFrame.GetXFromIndex(h),u=this.ChartFrame.GetYFromData(o.Value);n.Point.push({X:l,Y:u,End:!1})}else n.Point.length>0&&(n.Point[n.Point.length-1].End=!0)}}n.Point.length>=2&&a.push(n)}for(var i in a){var C=a[i];this.DrawLine(C)}}},this.DrawLine=function(t){if(t.BGColor){for(var e in this.Canvas.fillStyle=t.BGColor,t.Point){var a=t.Point[e];0==e?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(a.Y,a.X):this.Canvas.moveTo(a.X,a.Y)):this.IsHScreen?this.Canvas.lineTo(a.Y,a.X):this.Canvas.lineTo(a.X,a.Y)}this.Canvas.closePath(),this.Canvas.fill()}this.Canvas.strokeStyle=t.Color;var i=0;for(var e in t.Point){a=t.Point[e];0==i?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(a.Y,a.X):this.Canvas.moveTo(a.X,a.Y),++i):(this.IsHScreen?this.Canvas.lineTo(a.Y,a.X):this.Canvas.lineTo(a.X,a.Y),++i),1==a.End&&(i>0&&this.Canvas.stroke(),i=0)}i>0&&this.Canvas.stroke()},this.GetMaxMin=function(){var t={Min:null,Max:null},e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,i=a+e;for(var r in this.Lines){var n=this.Lines[r];for(var s in n.Point){var o=n.Point[s];o.Index>=a&&o.Index<i&&(null==t.Max?t.Max=o.Value:t.Max<o.Value&&(t.Max=o.Value),null==t.Min?t.Min=o.Value:t.Min>o.Value&&(t.Min=o.Value))}}return t}}function le(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiText",this.Texts=[],this.Font=Ma.DefaultTextFont,this.Color=Ma.DefaultTextColor,this.IsHScreen=!1,this.Draw=function(){if(this.IsShow&&this.Data&&!(this.Data.length<=0)&&this.Texts){this.IsHScreen=!0===this.ChartFrame.IsHScreen;var t=this.ChartFrame.XPointCount,e=this.Data.DataOffset,a=this.ChartBorder.GetLeft(),i=this.ChartBorder.GetRight();for(var r in this.IsHScreen&&(a=this.ChartBorder.GetTop(),i=this.ChartBorder.GetBottom()),this.Texts){var n=this.Texts[r];if(n.Text&&Le.IsNumber(n.Index)){var s=n.Index-e;if(s>=0&&s<t){var o=this.ChartFrame.GetXFromIndex(s),h=this.ChartFrame.GetYFromData(n.Value);n.Color?this.Canvas.fillStyle=n.Color:this.Canvas.fillStyle=this.Color,n.Font?this.Canvas.font=n.Font:this.Canvas.font=this.Font;var l=this.Canvas.measureText(n.Text).width;this.Canvas.textAlign="center",o+l/2>=i?(this.Canvas.textAlign="right",o=i):o-l/2<a&&(this.Canvas.textAlign="left",o=a),1==n.Baseline?this.Canvas.textBaseline="top":2==n.Baseline?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",this.IsHScreen?(this.Canvas.save(),this.Canvas.translate(h,o),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(n.Text,0,0),this.Canvas.restore()):this.Canvas.fillText(n.Text,o,h)}}}}},this.GetMaxMin=function(){var t={Min:null,Max:null};if(!this.Texts)return t;var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,i=a+e;for(var r in this.Texts){var n=this.Texts[r];n.Index>=a&&n.Index<i&&(null==t.Max?t.Max=n.Value:t.Max<n.Value&&(t.Max=n.Value),null==t.Min?t.Min=n.Value:t.Min>n.Value&&(t.Min=n.Value))}return t}}function ue(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiSVGIcon",this.Icon,this.Family,this.Color=Ma.DefaultTextColor,this.IsHScreen=!1,this.Draw=function(){if(this.IsShow&&this.Data&&!(this.Data.length<=0)&&this.Family&&this.Icon){this.IsHScreen=!0===this.ChartFrame.IsHScreen;var t=this.ChartFrame.XPointCount,e=this.Data.DataOffset,a=this.ChartBorder.GetLeft(),i=this.ChartBorder.GetRight();this.DataWidth=this.ChartFrame.DataWidth,this.DistanceWidth=this.ChartFrame.DistanceWidth,this.IsHScreen&&(a=this.ChartBorder.GetTop(),i=this.ChartBorder.GetBottom());var r=this.DataWidth+this.DistanceWidth-2;for(var n in r<8&&(r=8),this.Canvas.font=r+"px "+this.Family,this.Icon){var s=this.Icon[n];if(Le.IsNumber(s.Index)){var o=s.Index-e;if(o>=0&&o<t){var h=this.ChartFrame.GetXFromIndex(o),l=this.ChartFrame.GetYFromData(s.Value);s.Color?this.Canvas.fillStyle=s.Color:this.Canvas.fillStyle=this.Color;var u=this.Canvas.measureText(s.Text).width;this.Canvas.textAlign="center",h+u/2>=i?(this.Canvas.textAlign="right",h+=this.DataWidth/2):h-u/2<a&&(this.Canvas.textAlign="left",h-=this.DataWidth/2),1==s.Baseline?this.Canvas.textBaseline="top":2==s.Baseline?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",this.IsHScreen?(this.Canvas.save(),this.Canvas.translate(l,h),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(s.Symbol,0,0),this.Canvas.restore()):this.Canvas.fillText(s.Symbol,h,l)}}}}},this.GetMaxMin=function(){var t={Min:null,Max:null},e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,i=a+e;for(var r in this.Icon){var n=this.Icon[r];n.Index>=a&&n.Index<i&&(null==t.Max?t.Max=n.Value:t.Max<n.Value&&(t.Max=n.Value),null==t.Min?t.Min=n.Value:t.Min>n.Value&&(t.Min=n.Value))}return t}}function Ce(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartLock",this.WidthDiv=.2,this.LockCount=20,this.BGColor=Ma.LockBGColor,this.TextColor=Ma.LockTextColor,this.Font=Ma.DefaultTextFont,this.Title="🔒开通权限",this.LockRect=null,this.LockID,this.Callback,this.IndexName,this.MinWidth=null,this.Draw=function(t){if(this.LockRect=null,this.NotSupportMessage)this.DrawNotSupportmessage();else if(!0!==this.ChartFrame.IsHScreen){var e=this.ChartBorder.GetRight(),a=0;if(null!=this.ChartFrame.Data){var i=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth;e=this.ChartBorder.GetLeft()+r/2+2;for(var n=this.ChartBorder.GetRight(),s=this.ChartFrame.XPointCount,o=this.ChartFrame.Data.DataOffset,h=0;o<this.ChartFrame.Data.Data.length&&h<s;++o,++h,e+=i+r){var l=this.ChartFrame.Data.Data[o];if(null!=l.Open&&null!=l.High&&null!=l.Low&&null!=l.Close){var u=e+i;if(u>n)break}}a=(i+r)*this.LockCount}0==a&&(a=(e-this.ChartBorder.GetLeft())*this.WidthDiv);var C=e-a;C<this.ChartBorder.GetLeft()&&(C=this.ChartBorder.GetLeft());var D=this.ChartBorder.GetBottom()-this.ChartBorder.GetTop(),c=this.ChartBorder.GetRight()-C;if(this.MinWidth>10&&c<this.MinWidth&&(c=this.MinWidth,C=this.ChartBorder.GetRight()-c,C<this.ChartBorder.GetLeft()&&(C=this.ChartBorder.GetLeft())),t){this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(C,this.ChartBorder.GetTop(),c,D);var f=C+c/2,d=this.ChartBorder.GetTop()+D/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.Title,f,d)}this.LockRect={Left:C,Top:this.ChartBorder.GetTop(),Width:c,Heigh:D}}else this.HScreenDraw(t)},this.HScreenDraw=function(t){var e=this.ChartBorder.GetBottom(),a=0;if(null!=this.ChartFrame.Data){var i=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth;e=this.ChartBorder.GetTop()+r/2+2;for(var n=this.ChartBorder.GetBottom(),s=this.ChartFrame.XPointCount,o=this.ChartFrame.Data.DataOffset,h=0;o<this.ChartFrame.Data.Data.length&&h<s;++o,++h,e+=i+r){var l=this.ChartFrame.Data.Data[o];if(null!=l.Open&&null!=l.High&&null!=l.Low&&null!=l.Close){var u=e+i;if(u>n)break}}a=(i+r)*this.LockCount}0==a&&(a=(e-this.ChartBorder.GetTop())*this.WidthDiv);var C=e-a;C<this.ChartBorder.GetTop()&&(C=this.ChartBorder.GetTop());var D=this.ChartBorder.GetRight()-this.ChartBorder.GetLeft(),c=this.ChartBorder.GetBottom()-C;this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(this.ChartBorder.GetLeft(),C,D,c);var f=this.ChartBorder.GetLeft()+D/2,d=C+c/2;this.Canvas.save(),this.Canvas.translate(f,d),this.Canvas.rotate(90*Math.PI/180),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.Title,0,0),this.Canvas.restore(),this.LockRect={Left:this.ChartBorder.GetLeft(),Top:C,Width:D,Heigh:c}},this.GetTooltipData=function(t,e,a){return null!=this.LockRect&&(this.Canvas.beginPath(),this.Canvas.rect(this.LockRect.Left,this.LockRect.Top,this.LockRect.Width,this.LockRect.Heigh),!!this.Canvas.isPointInPath(t,e)&&(a.Data={ID:this.LockID,Callback:this.Callback,IndexName:this.IndexName},a.ChartPaint=this,!0))}}function De(){this.newMethod=Jt,this.newMethod(),delete this.newMethod,this.ClassName="ChartBuySell",this.TextFont=Ma.KLineTrain.Font,this.LastDataIcon=Ma.KLineTrain.LastDataIcon,this.BuyIcon=Ma.KLineTrain.BuyIcon,this.SellIcon=Ma.KLineTrain.SellIcon,this.BuySellData=new g.default,this.IconFont=Ma.KLineTrain.IconFont,this.AddTradeItem=function(t){if(this.BuySellData.has(t.Key)){var e=this.BuySellData.get(t.Key);e.Data.push(t)}else this.BuySellData.set(t.Key,{Data:[t]})},this.ClearTradeData=function(){this.BuySellData=new g.default},this.Draw=function(){if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetRight();!0===t&&(i=this.ChartBorder.GetBottom());var r=this.ChartFrame.XPointCount;if(this.IconFont){var n=V(),s=e+a,o=18*n;s<o&&(s=o),this.Canvas.font=s+"px "+this.IconFont.Family}else this.Canvas.font=this.TextFont;for(var h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<r;++h,++l){var u=this.Data.Data[h];if(null!=u){var C=this.ChartFrame.GetXFromIndex(l);if(C>i)break;if(h==this.Data.Data.length-1){C=this.ChartFrame.GetXFromIndex(l);var D=this.ChartFrame.GetYFromData(u.High);this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.IconFont?(this.Canvas.fillStyle=this.IconFont.Last.Color,this.DrawText(this.IconFont.Last.Text,C,D,t)):(this.Canvas.fillStyle=this.LastDataIcon.Color,this.Canvas.font=this.TextFont,this.DrawText(this.LastDataIcon.Text,C,D,t))}var c=h;if(this.BuySellData.has(c)){var f=this.BuySellData.get(c),d=(D=this.ChartFrame.GetYFromData(u.High),this.ChartFrame.GetYFromData(u.Low)),m=[!1,!1];for(var v in f.Data){if(1==m[0]&&1==m[1])break;var S=f.Data[v];0==S.Op&&0==m[0]?(this.Canvas.textAlign="center",this.Canvas.textBaseline="top",this.IconFont?(this.Canvas.fillStyle=this.IconFont.Buy.Color,this.DrawText(this.IconFont.Buy.Text,C,d,t)):(this.Canvas.fillStyle=this.BuyIcon.Color,this.DrawText(this.BuyIcon.Text,C,d,t)),m[0]=!0):1==S.Op&&0==m[1]&&(this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.IconFont?(this.Canvas.fillStyle=this.IconFont.Sell.Color,this.DrawText(this.IconFont.Sell.Text,C,D,t)):(this.Canvas.fillStyle=this.SellIcon.Color,this.DrawText(this.SellIcon.Text,C,D,t)),m[1]=!0)}}}}}}}function ce(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.Radius=100,this.Distance=30,this.txtLine=20,this.paddingX=20/3,this.Draw=function(){if(!this.Data||!this.Data.Data||!(this.Data.Data.length>0))return this.DrawEmptyData();this.ChartBorder.GetLeft(),this.ChartBorder.GetRight(),this.ChartBorder.GetTop(),this.ChartBorder.GetBottom();var t=this.ChartBorder.GetWidth(),e=this.ChartBorder.GetHeight();if(isNaN(this.Radius)){var a=this.Radius.replace("%","");a/=100,t>=e&&(this.Radius=a*e),t<e&&(this.Radius=a*t)}this.Canvas.save(),this.Canvas.translate(t/2,e/2);var i=0;for(var r in this.Data.Data)i+=this.Data.Data[r].Value;var n=0,s=0;for(var o in this.Data.Data){var h=this.Data.Data[o],l=(h.Value/i).toFixed(2);this.Canvas.beginPath(),this.Canvas.moveTo(0,0),s+=2*l*Math.PI,this.Canvas.strokeStyle="white",this.Canvas.fillStyle=h.Color,this.Canvas.arc(0,0,this.Radius,n,s),this.Canvas.fill(),this.Canvas.closePath(),this.Canvas.stroke(),this.Canvas.beginPath(),this.Canvas.strokeStyle=h.Color,this.Canvas.moveTo(0,0);var u=(this.Radius+this.Distance)*Math.cos(s-(s-n)/2),C=(this.Radius+this.Distance)*Math.sin(s-(s-n)/2);this.Canvas.lineTo(u,C);var D=this.txtLine,c=this.paddingX;if(this.Canvas.textAlign="left",s-(s-n)/2<1.5*Math.PI&&s-(s-n)/2>.5*Math.PI&&(D=-this.txtLine,c=-this.paddingX,this.Canvas.textAlign="right"),this.Canvas.lineTo(u+D,C),this.Canvas.stroke(),h.Text)this.Canvas.fillText(h.Text,u+D+c,C);else{var f=h.Name+":"+h.Value;this.Canvas.fillText(f,u+D+c,C)}n+=2*l*Math.PI}this.Canvas.restore()},this.DrawEmptyData=function(){M.Chart.Log("[ChartPie::DrawEmptyData]")}}function fe(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.BorderPoint=[],this.DataPoint=[],this.CenterPoint={},this.StartAngle=0,this.Color="rgb(198,198,198)",this.AreaColor="rgba(242,154,118,0.4)",this.AreaLineColor="rgb(242,154,118)",this.TitleFont=24*V()+"px 微软雅黑",this.TitleColor="rgb(102,102,102)",this.BGColor=["rgb(255,255,255)","rgb(224,224,224)"],this.DrawBorder=function(){if(!(this.BorderPoint.length<=0)){this.Canvas.font=this.TitleFont,this.Canvas.strokeStyle=this.Color;var t=[1,.8,.6,.4,.2];for(var e in t){var a=t[e],i=!0;for(var r in this.BorderPoint){var n=this.BorderPoint[r];n.X=this.CenterPoint.X+n.Radius*Math.cos(n.Angle*Math.PI/180)*a,n.Y=this.CenterPoint.Y+n.Radius*Math.sin(n.Angle*Math.PI/180)*a,i?(this.Canvas.beginPath(),this.Canvas.moveTo(n.X,n.Y),i=!1):this.Canvas.lineTo(n.X,n.Y)}this.Canvas.closePath(),this.Canvas.stroke(),this.Canvas.fillStyle=this.BGColor[e%2==0?0:1],this.Canvas.fill()}for(var s in this.Canvas.beginPath(),this.BorderPoint){n=this.BorderPoint[s];n.X=this.CenterPoint.X+n.Radius*Math.cos(n.Angle*Math.PI/180),n.Y=this.CenterPoint.Y+n.Radius*Math.sin(n.Angle*Math.PI/180),this.Canvas.moveTo(this.CenterPoint.X,this.CenterPoint.Y),this.Canvas.lineTo(n.X,n.Y),this.DrawText(n)}this.Canvas.stroke()}},this.DrawArea=function(){if(this.DataPoint&&!(this.DataPoint.length<=0)){this.Canvas.fillStyle=this.AreaColor,this.Canvas.strokeStyle=this.AreaLineColor,this.Canvas.beginPath();var t=!0;for(var e in this.DataPoint){var a=this.DataPoint[e];t?(this.Canvas.beginPath(),this.Canvas.moveTo(a.X,a.Y),t=!1):this.Canvas.lineTo(a.X,a.Y)}this.Canvas.closePath(),this.Canvas.fill(),this.Canvas.stroke()}},this.DrawText=function(t){if(t.Text){this.Canvas.fillStyle=this.TitleColor;var e=t.X,a=t.Y;t.Angle>0&&t.Angle<45?(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",e+=2):t.Angle>=0&&t.Angle<90?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",e+=2):t.Angle>=90&&t.Angle<135?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top",e-=2):t.Angle>=135&&t.Angle<180?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top",e-=2):t.Angle>=180&&t.Angle<225?(this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",e-=2):t.Angle>=225&&t.Angle<=270?(this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom"):t.Angle>270&&t.Angle<315?(this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",e+=2):(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",e+=2),this.Canvas.fillText(t.Text,e,a)}},this.Draw=function(){this.BorderPoint=[],this.DataPoint=[],this.CenterPoint={},this.Data&&this.Data.Data&&this.Data.Data.length>0?this.CalculatePoints(this.Data.Data):this.CalculatePoints(null),this.DrawBorder(),this.DrawArea()},this.CalculatePoints=function(t){for(var e=this.ChartBorder.GetLeft(),a=(this.ChartBorder.GetRight(),this.ChartBorder.GetTop()),i=(this.ChartBorder.GetBottom(),this.ChartBorder.GetWidth()),r=this.ChartBorder.GetHeight(),n={X:e+i/2,Y:a+r/2},s=Math.min(i/2,r/2)-2,o=Math.max(5,t?t.length:0),h=360/o,l=0;l<o;++l){var u={Index:l,Radius:s,Angle:l*h+this.StartAngle},C=u.Angle;if(t&&l<t.length){var D=t[l],c={Index:l,Text:D.Text};if(u.Text=D.Name,D.Value){var f=D.Value;f>=1&&(f=1);var d=s*f;c.X=n.X+d*Math.cos(C*Math.PI/180),c.Y=n.Y+d*Math.sin(C*Math.PI/180)}else c.X=n.X,c.Y=n.Y;this.DataPoint.push(c)}this.BorderPoint.push(u)}this.CenterPoint=n},this.DrawEmptyData=function(){M.Chart.Log("[ChartPie::DrawEmptyData]")}}function de(){this.newMethod=xt,this.newMethod(),delete this.newMethod,this.ImageData=null,this.Left,this.Top,this.Width,this.Height,this.ImageWidth,this.ImageHeight,this.DefaultColor=[217,222,239],this.Color=[{Name:"海南",Color:"rgb(217,222,223)"},{Name:"内蒙古",Color:"rgb(217,222,225)"},{Name:"新疆",Color:"rgb(217,222,226)"},{Name:"青海",Color:"rgb(217,222,227)"},{Name:"西藏",Color:"rgb(217,222,228)"},{Name:"云南",Color:"rgb(217,222,229)"},{Name:"黑龙江",Color:"rgb(217,222,230)"},{Name:"吉林",Color:"rgb(217,222,231)"},{Name:"辽宁",Color:"rgb(217,222,232)"},{Name:"河北",Color:"rgb(217,222,233)"},{Name:"山东",Color:"rgb(217,222,234)"},{Name:"江苏",Color:"rgb(217,222,235)"},{Name:"浙江",Color:"rgb(217,222,236)"},{Name:"福建",Color:"rgb(217,222,237)"},{Name:"广东",Color:"rgb(217,222,238)"},{Name:"广西",Color:"rgb(217,222,239)"},{Name:"贵州",Color:"rgb(217,222,240)"},{Name:"湖南",Color:"rgb(217,222,241)"},{Name:"江西",Color:"rgb(217,222,242)"},{Name:"安徽",Color:"rgb(217,222,243)"},{Name:"湖北",Color:"rgb(217,222,244)"},{Name:"重庆",Color:"rgb(217,222,245)"},{Name:"四川",Color:"rgb(217,222,246)"},{Name:"甘肃",Color:"rgb(217,222,247)"},{Name:"陕西",Color:"rgb(217,222,248)"},{Name:"山西",Color:"rgb(217,222,249)"},{Name:"河南",Color:"rgb(217,222,250)"}],this.Draw=function(){var t=this.ChartBorder.GetLeft()+1,e=(this.ChartBorder.GetRight(),this.ChartBorder.GetTop()+1),a=(this.ChartBorder.GetBottom(),this.ChartBorder.GetWidth()-2),i=this.ChartBorder.GetHeight()-2,r=CHINA_MAP_IMAGE.width,n=CHINA_MAP_IMAGE.height,s=r,o=n;if(i<o||a<s)this.ImageData=null;else if(this.Left==t&&this.Top==e&&this.Width==a&&this.Height==i&&this.ImageWidth==r&&this.ImageHeight==n||(this.ImageData=null,this.ImageWidth=r,this.ImageHeight=n,this.Left=t,this.Top=e,this.Width=a,this.Height=i,M.Chart.Log(r,n)),null==this.ImageData){this.Canvas.drawImage(CHINA_MAP_IMAGE,0,0,r,n,t,e,s,o),this.ImageData=this.Canvas.getImageData(t,e,s,o);var h,l=new I.default,u=new g.default,C=new g.default;if(this.Data.length>0)for(var D in this.Data){var c=this.Data[D];C.set(c.Name,c.Color)}for(var f in M.Chart.Log(this.Data),this.Color){var d=this.Color[f];C.has(d.Name)?u.set(d.Color,C.get(d.Name)):l.add(d.Color)}for(var m=0;m<this.ImageData.data.length;m+=4)if(h="rgb("+this.ImageData.data[m]+","+this.ImageData.data[m+1]+","+this.ImageData.data[m+2]+")",l.has(h))this.ImageData.data[m]=this.DefaultColor[0],this.ImageData.data[m+1]=this.DefaultColor[1],this.ImageData.data[m+2]=this.DefaultColor[2];else if(u.has(h)){var v=u.get(h);this.ImageData.data[m]=v[0],this.ImageData.data[m+1]=v[1],this.ImageData.data[m+2]=v[2]}this.Canvas.clearRect(t,e,s,o),this.Canvas.putImageData(this.ImageData,t,e,0,0,s,o)}else this.Canvas.putImageData(this.ImageData,t,e,0,0,s,o)}}function me(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.Data,this.IsDynamic=!1,this.IsAnimation=!1,this.ClassName="IExtendChartPainting",this.SizeChange=!0,this.IsEraseBG=!1,this.DrawAfterTitle=!1,this.IsCallbackDraw=!1,this.Left=5,this.Right=5,this.Top=5,this.Bottom=5,this.Draw=function(){},this.SetOption=function(t){}}function ve(){this.newMethod=me,this.newMethod(),delete this.newMethod,this.IsDynamic=!0,this.IsEraseBG=!0,this.DrawAfterTitle=!0,this.ClassName="KLineTooltipPaint",this.BorderColor=Ma.TooltipPaint.BorderColor,this.BGColor=Ma.TooltipPaint.BGColor,this.TitleColor=Ma.TooltipPaint.TitleColor,this.Left=1*V(),this.Top=5*V(),this.Width=50,this.Height=100,this.LineHeight=15*V(),this.Font=[Ma.TooltipPaint.TitleFont],this.HQChart,this.KLineTitlePaint,this.IsHScreen=!1,this.LanguageID=xa.LANGUAGE_CHINESE_ID,this.GetLeft=function(){return this.IsHScreen?this.ChartBorder.GetRightEx()-this.Height-this.Top:this.ChartBorder.GetLeft()+this.Left},this.GetTop=function(){return this.IsHScreen?this.ChartBorder.GetTop():this.ChartBorder.GetTopEx()+this.Top},this.IsEnableDraw=function(){if(!this.HQChart||!this.HQChart.TitlePaint||!this.HQChart.TitlePaint[0])return!1;if(this.HQChart.DragMode==_.CLICK_TOUCH_MODE_ID){if(0==this.HQChart.TouchStatus.CorssCursorShow)return!1}else if(!this.HQChart.IsOnTouch)return!1;return!this.HQChart.CurrentChartDrawPicture},this.Draw=function(){if(this.IsEnableDraw()){this.KLineTitlePaint=this.HQChart.TitlePaint[0];var t=this.KLineTitlePaint.GetCurrentKLineData();if(t){var e,a=8;this.HQChart.Symbol&&(e=this.HQChart.Symbol.toUpperCase()),"MinuteTooltipPaint"===this.ClassName?(a=7,Li.IsFutures(e)&&++a):(Le.IsNumber(t.Time)&&++a,Li.IsSHSZStockA(this.HQChart.Symbol)&&t.FlowCapital>0&&++a,Li.IsFutures(e)&&Le.IsNumber(t.Position)&&++a),this.IsHScreen=!0===this.ChartFrame.IsHScreen,this.Canvas.font=this.Font[0];var i=Ui(this.HQChart.Symbol),r=" 擎: 9999.99亿 ";i>=5&&(r=" 擎: "+99.99.toFixed(i)+" "),this.Width=this.Canvas.measureText(r).width,this.Height=this.LineHeight*a+2*V()*2,this.DrawBG(),this.DrawTooltipData(t),this.DrawBorder()}}},this.DrawTooltipData=function(t){var e=Ui(this.HQChart.Symbol),a=this.GetLeft()+2*V(),i=this.GetTop()+3*V();if(this.IsHScreen){this.Canvas.save();var r=this.GetLeft()+this.Height,n=this.GetTop();this.Canvas.translate(r,n),this.Canvas.rotate(90*Math.PI/180),a=2*V(),i=3*V()}this.Canvas.textBaseline="top",this.Canvas.textAlign="left",this.Canvas.font=this.Font[0];var s=this.Canvas.measureText("擎: ").width,o=Le.FormatDateString(t.Date);this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(o,a,i);var h=this.HQChart.Period;It.IsMinutePeriod(h,!0)&&t.Time?(i+=this.LineHeight,o=Le.FormatTimeString(t.Time),this.Canvas.fillText(o,a,i)):It.IsSecondPeriod(h)&&t.Time&&(i+=this.LineHeight,o=Le.FormatTimeString(t.Time,"HH:MM:SS"),this.Canvas.fillText(o,a,i)),i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,o=Oa.GetText("Tooltip-Open",this.LanguageID),this.Canvas.fillText(o,a,i);var l=this.KLineTitlePaint.GetColor(t.Open,t.YClose);o=t.Open.toFixed(e),this.Canvas.fillStyle=l,this.Canvas.fillText(o,a+s,i),i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,o=Oa.GetText("Tooltip-High",this.LanguageID),this.Canvas.fillText(o,a,i);l=this.KLineTitlePaint.GetColor(t.High,t.YClose),o=t.High.toFixed(e);this.Canvas.fillStyle=l,this.Canvas.fillText(o,a+s,i),i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,o=Oa.GetText("Tooltip-Low",this.LanguageID),this.Canvas.fillText(o,a,i);l=this.KLineTitlePaint.GetColor(t.Low,t.YClose),o=t.Low.toFixed(e);this.Canvas.fillStyle=l,this.Canvas.fillText(o,a+s,i),i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,o=Oa.GetText("Tooltip-Close",this.LanguageID),this.Canvas.fillText(o,a,i);l=this.KLineTitlePaint.GetColor(t.Close,t.YClose),o=t.Close.toFixed(e);if(this.Canvas.fillStyle=l,this.Canvas.fillText(o,a+s,i),i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,o=Oa.GetText("Tooltip-Increase",this.LanguageID),this.Canvas.fillText(o,a,i),t.YClose>0){var u=(t.Close-t.YClose)/t.YClose*100;l=this.KLineTitlePaint.GetColor(u,0),o=u.toFixed(2)+"%"}else o="--.--",l=this.KLineTitlePaint.GetColor(0,0);this.Canvas.fillStyle=l,this.Canvas.fillText(o,a+s,i),this.Canvas.fillStyle=this.TitleColor,i+=this.LineHeight,o=Oa.GetText("Tooltip-Vol",this.LanguageID),this.Canvas.fillText(o,a,i);o=Le.FromatIntegerString(t.Vol,2,this.LanguageID);if(this.Canvas.fillText(o,a+s,i),Le.IsNumber(t.Amount)){i+=this.LineHeight,o=Oa.GetText("Tooltip-Amount",this.LanguageID),this.Canvas.fillText(o,a,i);o=Le.FormatValueString(t.Amount,2,this.LanguageID);this.Canvas.fillText(o,a+s,i)}if(Li.IsSHSZStockA(this.HQChart.Symbol)&&t.FlowCapital>0){i+=this.LineHeight,o=Oa.GetText("Tooltip-Exchange",this.LanguageID),this.Canvas.fillText(o,a,i);u=t.Vol/t.FlowCapital*100,o=u.toFixed(2)+"%";this.Canvas.fillText(o,a+s,i)}var C=this.HQChart.Symbol.toUpperCase();if(Li.IsFutures(C)&&Le.IsNumber(t.Position)){this.Canvas.fillStyle=this.TitleColor,i+=this.LineHeight,o=Oa.GetText("Tooltip-Position",this.LanguageID),this.Canvas.fillText(o,a,i);o=Le.FromatIntegerString(t.Position,2,this.LanguageID);this.Canvas.fillText(o,a+s,i)}this.IsHScreen&&this.Canvas.restore()},this.DrawBorder=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.GetLeft(),a=this.GetTop();this.Canvas.strokeStyle=this.BorderColor,t?this.Canvas.strokeRect(W(e),W(a),this.Height,this.Width):this.Canvas.strokeRect(W(e),W(a),this.Width,this.Height)},this.DrawBG=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.GetLeft(),a=this.GetTop();this.Canvas.fillStyle=this.BGColor,t?this.Canvas.fillRect(e,a,this.Height,this.Width):this.Canvas.fillRect(e,a,this.Width,this.Height)},this.SetOption=function(t){t.LineHeight>0&&(this.LineHeight=t.LineHeight*V()),t.BGColor&&(this.BGColor=t.BGColor),t.LanguageID>0&&(this.LanguageID=t.LanguageID)}}function Se(){this.newMethod=ve,this.newMethod(),delete this.newMethod,this.ClassName="MinuteTooltipPaint",this.Left=1*V(),this.Top=1*V(),this.YClose,this.GetTop=function(){return this.IsHScreen?this.ChartBorder.GetTop():this.ChartBorder.GetTop()+this.Top},this.DrawTooltipData=function(t){if(this.HQChart.Symbol){var e=Ui(this.HQChart.Symbol),a=this.GetLeft()+2*V(),i=this.GetTop()+3*V();this.YClose=this.KLineTitlePaint.YClose;var r=this.HQChart.Symbol.toUpperCase();if(this.IsHScreen){this.Canvas.save();var n=this.GetLeft()+this.Height,s=this.GetTop();this.Canvas.translate(n,s),this.Canvas.rotate(90*Math.PI/180),a=2*V(),i=3*V()}this.Canvas.textBaseline="top",this.Canvas.textAlign="left",this.Canvas.font=this.Font[0];var o=this.Canvas.measureText("擎: ").width,h=t.DateTime.split(" ");if(h&&2==h.length){var l=Le.FormatDateString(h[0]);this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(l,a,i),i+=this.LineHeight,l=Le.FormatTimeString(h[1]),this.Canvas.fillText(l,a,i)}var u=t.Close,C=(t.Increase,t.Vol),D=t.Amount;t.Before&&(u=t.Before.Close,t.Before.Increase,C=t.Before.Vol,D=t.Before.Amount),i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,l=Oa.GetText("Tooltip-Price",this.LanguageID),this.Canvas.fillText(l,a,i);var c=this.KLineTitlePaint.GetColor(u,this.YClose);l=u.toFixed(e);this.Canvas.fillStyle=c,this.Canvas.fillText(l,a+o,i);var f=!0;if(t.Before?f=!1:Li.IsForeignExchange(r)?f=!1:Li.IsET(r)&&!Li.IsETShowAvPrice(r)&&(f=!1),f&&Le.IsNumber(t.AvPrice)){i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,l=Oa.GetText("Tooltip-AvPrice",this.LanguageID),this.Canvas.fillText(l,a,i);c=this.KLineTitlePaint.GetColor(t.AvPrice,this.YClose),l=t.AvPrice.toFixed(e);this.Canvas.fillStyle=c,this.Canvas.fillText(l,a+o,i)}i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,l=Oa.GetText("Tooltip-Increase",this.LanguageID),this.Canvas.fillText(l,a,i);var d=(u-this.YClose)/this.YClose*100;c=this.KLineTitlePaint.GetColor(d,0),l=d.toFixed(2)+"%";if(this.Canvas.fillStyle=c,this.Canvas.fillText(l,a+o,i),Le.IsNumber(C)){this.Canvas.fillStyle=this.TitleColor,i+=this.LineHeight,l=Oa.GetText("Tooltip-Vol",this.LanguageID),this.Canvas.fillText(l,a,i);l=Le.FromatIntegerString(C,2,this.LanguageID);this.Canvas.fillText(l,a+o,i)}if(Le.IsNumber(D)){i+=this.LineHeight,l=Oa.GetText("Tooltip-Amount",this.LanguageID),this.Canvas.fillText(l,a,i);l=Le.FormatValueString(D,2,this.LanguageID);this.Canvas.fillText(l,a+o,i)}if(Le.IsNumber(t.Position)){i+=this.LineHeight,l=Oa.GetText("Tooltip-Position",this.LanguageID),this.Canvas.fillText(l,a,i);l=Le.FormatValueString(t.Position,2,this.LanguageID);this.Canvas.fillText(l,a+o,i)}this.IsHScreen&&this.Canvas.restore()}}}function Ie(){this.newMethod=me,this.newMethod(),delete this.newMethod,this.Left=80,this.Right=1,this.Top=1,this.Bottom=1,this.BorderColor=Ma.FrameBorderPen,this.Symbol,this.Name,this.TitleFont=["14px 微软雅黑"],this.Draw=function(){var t=this.ChartBorder.GetRight()+this.Left,e=this.ChartBorder.GetChartWidth()-this.Right,a=this.Top+18,i=t+(e-t)/2;this.Symbol&&this.Name&&(this.Canvas.font=this.TitleFont[0],this.Canvas.textAlign="right",this.Canvas.textBaseline="bottom",this.Canvas.fillText(this.Symbol,i-2,a),this.Canvas.textAlign="left",this.Canvas.fillText(this.Name,i+2,a)),this.Canvas.strokeStyle=this.BorderColor,this.Canvas.moveTo(t,a),this.Canvas.lineTo(e,a),this.Canvas.stroke(),a+=30,this.DrawBorder()},this.DrawBorder=function(){var t=this.ChartBorder.GetRight()+this.Left,e=this.ChartBorder.GetChartWidth()-this.Right,a=this.Top,i=this.ChartBorder.GetChartHeight()-this.Bottom;this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(t,a,e-t,i-a)}}function pe(){this.newMethod=me,this.newMethod(),delete this.newMethod,this.Name="筹码分布",this.ClassName="StockChip",this.HQChart,this.PenBorder=Ma.FrameBorderPen,this.ColorProfit="rgb(255,0,0)",this.ColorNoProfit="rgb(90,141,248)",this.ColorAveragePrice="rgb(0,139,0)",this.ColorBG="rgb(190,190,190)",this.PixelRatio=V(),this.ShowType=0,this.IsDynamic=!0,this.ClientRect={},this.Font=Ma.TitleFont,this.InfoColor="rgb(0,0,0)",this.DayInfoColor="rgb(255,255,255)",this.LineHeight=16,this.Left=50*this.PixelRatio,this.IsShowX=!1,this.ShowXCount=3,this.Width=150*this.PixelRatio,this.CalculateType=0,this.PriceZoom=100,this.ButtonID=Y(),this.DAY_COLOR=[["rgb(255,0,0)","rgb(255,128,128)","rgb(255,0,128)","rgb(255,100,0)","rgb(192,128,0)","rgb(255,192,0)"],["rgb(120,80,225)","rgb(160,160,225)","rgb(80,80,255)","rgb(120,120,255)","rgb(32,64,192)","rgb(0,64,128)"]],this.SetOption=function(t){t&&(t.ShowType>0&&(this.ShowType=t.ShowType),t.IsShowX&&(this.IsShowX=t.IsShowX),t.ShowXCount>0&&(this.ShowXCount=t.ShowXCount),t.Width>100&&(this.Width=t.Width*V()),t.CalculateType>0&&(this.CalculateType=t.CalculateType),Le.IsNumber(t.PriceZoom)&&(this.PriceZoom=t.PriceZoom))},this.Draw=function(){this.PixelRatio=V();var t=W(this.ChartBorder.GetRight()+this.Left),e=W(this.ChartBorder.GetTop()),a=W(t+this.Width-1*this.PixelRatio),i=W(this.ChartBorder.GetBottom()),r=a-t,n=i-e;this.ClientRect={Left:t,Top:e,Width:r,Height:n},this.CalculateChip()?(this.DrawFrame(),this.DrawAllChip(),1!=this.ShowType&&2!=this.ShowType||this.DrawDayChip(),this.CalculateCast(),this.DrawChipInfo()):M.Chart.Log("[StockChip::Draw] no data"),this.DrawBorder(),1==this.SizeChange&&this.DrawButton(),this.SizeChange=!1},this.DrawChipInfo=function(){var t=this.ClientRect.Top+this.ClientRect.Height-1,e=this.ClientRect.Left+2,a=this.ClientRect.Left+this.ClientRect.Width;this.Canvas.font=this.Font,this.Canvas.fillStyle=this.InfoColor,this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left";var i=this.LineHeight*V(),r="70%成本价"+this.Data.Cast[1].MinPrice.toFixed(2)+"-"+this.Data.Cast[1].MaxPrice.toFixed(2)+"集中"+this.Data.Cast[1].Rate.toFixed(2)+"%";this.Canvas.fillText(r,e,t),t-=i,r="90%成本价"+this.Data.Cast[0].MinPrice.toFixed(2)+"-"+this.Data.Cast[0].MaxPrice.toFixed(2)+"集中"+this.Data.Cast[0].Rate.toFixed(2)+"%",this.Canvas.fillText(r,e,t),t-=i,r="平均成本："+this.Data.ChipInfo.AveragePrice.toFixed(2)+"元",this.Canvas.fillText(r,e,t),t-=i,r=+this.Data.YPrice.toFixed(2)+"处获利盘："+this.Data.ChipInfo.YProfitRate.toFixed(2)+"%",this.Canvas.fillText(r,e,t),t-=i,r="获利比例：",this.Canvas.fillText(r,e,t);var n=this.Canvas.measureText(r).width+2,s=e+n,o=a-5-s;if(this.Canvas.strokeStyle=this.ColorNoProfit,this.Canvas.strokeRect(s,t-i,o,i),this.Canvas.strokeStyle=this.ColorProfit,this.Canvas.strokeRect(s,t-i,o*(this.Data.ChipInfo.ProfitRate/100),i),r=this.Data.ChipInfo.ProfitRate.toFixed(2)+"%",this.Canvas.textAlign="center",this.Canvas.fillText(r,s+o/2,t),t-=i,this.Canvas.textAlign="left",r="成本分布,日期："+Le.FormatDateString(this.Data.SelectData.Date),this.Data.SelectData.Time&&(r+=" "+Le.FormatTimeString(this.Data.SelectData.Time)),this.Canvas.fillText(r,e,t),t-=i,1==this.ShowType||2==this.ShowType){a=this.ClientRect.Left+this.ClientRect.Width-1;this.Canvas.textAlign="right";n=50;for(var h in this.Data.DayChip.sort((function(t,e){return e.Day-t.Day})),this.Data.DayChip){var l=this.Data.DayChip[h],u=0;this.Data.ChipInfo&&this.Data.ChipInfo.Vol>0&&(u=l.Vol/this.Data.ChipInfo.Vol*100),r=l.Day+"周期"+(1==this.ShowType?"前":"内")+"成本"+u.toFixed(2)+"%",0==h&&(n=this.Canvas.measureText(r).width+8),this.Canvas.fillStyle=l.Color,this.Canvas.fillRect(a-n,t-i,n,i),this.Canvas.fillStyle=this.DayInfoColor,this.Canvas.fillText(r,a,t),t-=i}}},this.DrawDayChip=function(){var t=this.HQChart.Frame.SubFrame[0].Frame;for(var e in this.Data.DayChip){var a=[],i=this.Data.DayChip[e].Chip;if(i){for(var r=0,n=0;n<i.length;++n){var s=i[n];if(s){r+=s;var o=(n+this.Data.MinPrice)/100,h=t.GetYFromData(o),l=s/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;a.push({X:l,Y:h})}}this.Data.DayChip[e].Vol=r,this.DrawArea(a,this.Data.DayChip[e].Color)}}},this.Clear=function(){var t=document.getElementById(this.ButtonID);t&&this.ChartBorder.UIElement.parentNode.removeChild(t)},this.DrawButton=function(){var t=document.getElementById(this.ButtonID);t||(t=document.createElement("div"),t.className="klineframe-button",t.id=this.ButtonID,this.ChartBorder.UIElement.parentNode.appendChild(t));var e=this.PixelRatio,a=(this.ClientRect.Left,this.ClientRect.Left+this.ClientRect.Width),i=this.ChartBorder.GetChartWidth(),r=this.ChartBorder.GetTitleHeight(),n=this.ChartBorder.GetTop()/e,s="<span class='{iconclass}' id='{iconid}' title='{icontitle}' style='cursor:pointer;display:inline-block;color:{iconcolor};font-size:{iconsize}px'></span>",o=[{Class:"chip_default icon iconfont icon-chip_default",ID:"chip_default",Color:["#808080","#FF0000"],Title:"默认筹码分布图"},{Class:"chip_long icon iconfont icon-chip_date",ID:"chip_long",Color:["#808080","#FF8000"],Title:"远期筹码分布图"},{Class:"chip_recent icon iconfont icon-chip_date",ID:"chip_recent",Color:["#808080","#0000CC"],Title:"近期筹码分布图"}],h="";for(var l in o){var u=o[l],C=s;C=C.replace("{iconclass}",u.Class),C=C.replace("{iconid}",u.ID),C=C.replace("{iconcolor}",u.Color[l==this.ShowType?1:0]),C=C.replace("{iconsize}",r),C=C.replace("{icontitle}",u.Title),h.length>0&&(h+="&nbsp;&nbsp;"),h+=C}t.style.right=Math.floor((i-a+2)/e)+"px",t.style.top=n+"px",t.style.height=r+"px",t.innerHTML=h;var D=this;for(var l in o){u=o[l];(0,E.default)("#"+this.ButtonID+" ."+u.ID).click({IconID:u.ID,ShowType:l},(function(t){t.data.IconID;var e=t.data.ShowType;for(var a in D.ShowType=e,D.HQChart&&D.HQChart.Draw(),o){var i=o[a],r=(0,E.default)("#"+D.ButtonID+" ."+i.ID)[0].style;r["color"]=i.Color[a==e?1:0]}}))}},this.DrawAllChip=function(){for(var t=this.HQChart.Frame.SubFrame[0].Frame,e=this.Data.SelectData.Close,a=[],i=[],r=0,n=0,s=0,o=0,h=this.Data.YPrice,l=t.HorizontalMax,u=t.HorizontalMin,C=1,D=0;D<this.Data.AllChip.length;++D){var c=this.Data.AllChip[D];if(c){var f=(D+this.Data.MinPrice)/this.PriceZoom;r+=c,n+=f*c,f<h&&(o+=c),f<e&&(s+=c),f<=l&&f>=u&&C<c&&(C=c)}}this.Data.MaxVol=C;for(D=0;D<this.Data.AllChip.length;++D){c=this.Data.AllChip[D];if(c){f=(D+this.Data.MinPrice)/this.PriceZoom;if(!(f>l||f<u)){var d=t.GetYFromData(f),m=c/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;f<e?a.push({X:m,Y:d}):i.push({X:m,Y:d})}}}if(this.Data.ChipInfo={Vol:r,AveragePrice:n/r,ProfitVol:s,ProfitRate:r>0?s/r*100:0,YProfitRate:r>0?o/r*100:0},0==this.ShowType){this.DrawLines(a,this.ColorProfit),this.DrawLines(i,this.ColorNoProfit);var v=this.Data.ChipInfo.AveragePrice;v>0&&v<=l&&v>=u&&(v=v.toFixed(2),this.DrawAveragePriceLine(a,i,t.GetYFromData(v),this.ColorAveragePrice))}else this.DrawLines(a,this.ColorBG),this.DrawLines(i,this.ColorBG)},this.CalculateCast=function(){if(this.Data.ChipInfo&&this.Data.ChipInfo.Vol){for(var t=[{Start:.05,End:.95,MaxPrice:0,MinPrice:0,Rate:0},{Start:.15,End:.85,MaxPrice:0,MinPrice:0,Rate:0}],e=(this.Data.ChipInfo.AveragePrice,this.Data.ChipInfo.ProfitVol),a=0,i=0,r=0;i<this.Data.AllChip.length;++i){if(4==r)break;var n=this.Data.AllChip[i];if(!(n<=0)){var s=(i+this.Data.MinPrice)/this.PriceZoom;a+=n;var o=a/e;for(var h in t){var l=t[h];l.MinPrice<=0&&o>l.Start&&(l.MinPrice=s,++r),l.MaxPrice<=0&&o>l.End&&(l.MaxPrice=s,++r)}}}for(var i in t){var u=t[i],C=u.MaxPrice+u.MinPrice;C&&(u.Rate=Math.abs(u.MaxPrice-u.MinPrice)/C*100)}this.Data.Cast=t}},this.DrawArea=function(t,e){if(!(t.length<=0)){for(var a in this.Canvas.fillStyle=e,this.Canvas.beginPath(),this.Canvas.moveTo(this.ClientRect.Left,t[0].Y),t){var i=t[a];this.Canvas.lineTo(i.X,i.Y)}this.Canvas.lineTo(this.ClientRect.Left,t[t.length-1].Y),this.Canvas.fill()}},this.DrawLines=function(t,e){if(!(t.length<=0)){for(var a in this.Canvas.strokeStyle=e,this.Canvas.beginPath(),t){var i=t[a];this.Canvas.moveTo(this.ClientRect.Left,i.Y),this.Canvas.lineTo(i.X,i.Y)}this.Canvas.stroke()}},this.DrawAveragePriceLine=function(t,e,a,i){for(var r in t){var n=t[r];if(n.Y==a)return this.Canvas.strokeStyle=i,this.Canvas.beginPath(),this.Canvas.moveTo(this.ClientRect.Left,n.Y),this.Canvas.lineTo(n.X,n.Y),void this.Canvas.stroke()}for(var r in e){n=e[r];if(n.Y==a)return this.Canvas.strokeStyle=i,this.Canvas.beginPath(),this.Canvas.moveTo(this.ClientRect.Left,n.Y),this.Canvas.lineTo(n.X,n.Y),void this.Canvas.stroke()}},this.DrawBorder=function(){this.Canvas.strokeStyle=this.PenBorder,this.Canvas.strokeRect(this.ClientRect.Left,this.ClientRect.Top,this.ClientRect.Width,this.ClientRect.Height)},this.EvenlyDistribute=function(t,e){var a=e.Low,i=e.High,r=e.MaxPrice,n=e.MinPrice,s=1;if(i-a!=0){for(var o=e.Vol/(i-a),h=a;h<=i&&h<=r;++h){var l=h-n;t[l]+=o,s<t[l]&&(s=t[l])}e.MaxVol=s}},this.TriangleDistribute=function(t,e){for(var a=e.Low,i=e.High,r=(e.MaxPrice,e.MinPrice),n=1,s=45,o=3.1415926535,h=(i-a)/2+a,l=0,u=[],C=a+1,D=1;C<=h;++C,++D){var c=Math.tan(s*o/180)*D;l+=c,u.push({Index:C-r,Value:c})}for(C=i-1,D=1;C>h;--C,++D){c=Math.tan(s*o/180)*D;l+=c,u.push({Index:C-r,Value:c})}if(l>0){for(C=0;C<u.length;++C){var f=u[C];t[f.Index]+=f.Value*e.Vol/l,n<t[f.Index]&&(n=t[f.Index])}e.MaxVol=n}},this.CalculateDistribute=function(t,e){1==this.CalculateType?this.TriangleDistribute(t,e):this.EvenlyDistribute(t,e)},this.CalculateChip=function(){if(!this.HQChart)return!1;if(!this.HQChart.FlowCapitalReady)return!1;var t=this.HQChart.Symbol;if(!t)return!1;if(Li.IsSHSZIndex(t))return!1;var e=this.HQChart.ChartPaint[0].Data,a=e.DataOffset+parseInt(this.HQChart.CursorIndex);a>=e.Data.length&&(a=e.Data.length-1);var i=e.Data[a],r=i.Close,n=this.HQChart.LastPoint.Y;n&&(r=this.HQChart.Frame.SubFrame[0].Frame.GetYData(n));for(var s,o,h,l=1,u=[],C=1,D=a;D>=0;--D){var c=e.Data[D],f=1;c.FlowCapital>0&&(f=c.Vol/c.FlowCapital),s=D==a?c.Vol*f:c.Vol*C;var d={Vol:s,High:c.High,Low:c.Low};u.push(d),C*=1-f*l,(!o||o<c.High)&&(o=c.High),(!h||h>c.Low)&&(h=c.Low)}if(!o||!h)return!0;var m=this.PriceZoom;o=parseInt(o*m),h=parseInt(h*m);for(var v=o-h,S=new Array,I=0;I<=v;++I)S.push(0);var p,T=[];if(2==this.ShowType){T=[{Day:100,Color:this.DAY_COLOR[1][5]},{Day:60,Color:this.DAY_COLOR[1][4]},{Day:30,Color:this.DAY_COLOR[1][3]},{Day:20,Color:this.DAY_COLOR[1][2]},{Day:10,Color:this.DAY_COLOR[1][1]},{Day:5,Color:this.DAY_COLOR[1][0]}];for(var A in u){c=u[A];var g=parseInt(c.High*m),F=parseInt(c.Low*m),E=c.Vol;if(g-F>0&&(E=c.Vol/(g-F)),!(E<=1e-9)){for(var L=0;L<T.length;++L)if(A==T[L].Day){T[L].Chip=S.slice(0);break}p={Low:F,High:g,Vol:c.Vol,MaxPrice:o,MinPrice:h},this.CalculateDistribute(S,p)}}}else if(1==this.ShowType){T=[{Day:5,Color:this.DAY_COLOR[0][0]},{Day:10,Color:this.DAY_COLOR[0][1]},{Day:20,Color:this.DAY_COLOR[0][2]},{Day:30,Color:this.DAY_COLOR[0][3]},{Day:60,Color:this.DAY_COLOR[0][4]},{Day:100,Color:this.DAY_COLOR[0][5]}];for(var M=u.length-1;M>=0;--M){c=u[M],g=parseInt(c.High*m),F=parseInt(c.Low*m),E=c.Vol;if(g-F>0&&(E=c.Vol/(g-F)),!(E<=1e-9)){for(L=0;L<T.length;++L)if(M==T[L].Day){T[L].Chip=S.slice(0);break}p={Low:F,High:g,Vol:c.Vol,MaxPrice:o,MinPrice:h},this.CalculateDistribute(S,p)}}}else for(var x in u){c=u[x],g=parseInt(c.High*m),F=parseInt(c.Low*m),E=c.Vol;g-F>0&&(E=c.Vol/(g-F)),E<=1e-9||(p={Low:F,High:g,Vol:c.Vol,MaxPrice:o,MinPrice:h},this.CalculateDistribute(S,p))}return this.Data={AllChip:S,MaxVol:p.MaxVol,MaxPrice:o,MinPrice:h,SelectData:i,DayChip:T,YPrice:r},!0},this.DrawFrame=function(){if(0!=this.IsShowX&&!(this.Data.MaxVol<=0)){var t=1!==this.HQChart.Frame.SubFrame.length,e=this.HQChart.Frame.SubFrame[0].Frame,a=e.ChartBorder,r=W(a.GetBottomEx()+1);t||(r=this.ClientRect.Top+this.ClientRect.Height);var n=this.ClientRect.Left,s=n+this.ClientRect.Width;this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),t&&(this.Canvas.moveTo(n,r),this.Canvas.lineTo(s,r));var o=this.ShowXCount,h=this.Data.MaxVol,l=Math.floor(h/o);this.Canvas.font=this.Font,this.Canvas.textBaseline="top",this.Canvas.fillStyle=this.InfoColor;V();for(i=1;i<=o;++i){var u=l*i,C=u/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;if(C=W(C),i==o){this.Canvas.textAlign="right";var D=Le.FormatValueString(h,1);this.Canvas.fillText(D,C,r+2)}else{this.Canvas.moveTo(C,this.ClientRect.Top),this.Canvas.lineTo(C,r),this.Canvas.textAlign="center";D=Le.FormatValueString(u,1);var c=this.Canvas.measureText(D).width;this.Canvas.fillText(D,Math.floor(C-.25*c),r+2)}}this.Canvas.stroke()}}}function Te(){this.newMethod=me,this.newMethod(),delete this.newMethod,this.ClassName="DrawToolsButton",this.HQChart,this.ID=Y(),this.ToolsDiv,this.Color="#696969",this.Top=5*V(),this.Width=45*V(),this.SetOption=function(t){var e=V();t&&t.Width>10&&(this.Width=t.Width*e)},this.Clear=function(){this.ToolsDiv&&this.ChartBorder.UIElement.parentNode.removeChild(this.ToolsDiv)},this.Draw=function(){var t=this;if(0!=this.SizeChange){var e=[[{HTML:{Title:"线段",IClass:"iconfont icon-draw_line",ID:"icon-segment"},Name:"线段"},{HTML:{Title:"射线",IClass:"iconfont icon-draw_rays",ID:"icon-beam"},Name:"射线"},{HTML:{Title:"趋势线",IClass:"iconfont icon-draw_trendline",ID:"icon-trendline"},Name:"趋势线"},{HTML:{Title:"水平线",IClass:"iconfont icon-draw_hline",ID:"icon-hline"},Name:"水平线"},{HTML:{Title:"平行线",IClass:"iconfont icon-draw_parallel_lines",ID:"icon-parallellines"},Name:"平行线"},{HTML:{Title:"平行通道",IClass:"iconfont icon-draw_parallelchannel",ID:"icon-parallelchannel"},Name:"平行通道"},{HTML:{Title:"价格通道线",IClass:"iconfont icon-draw_pricechannel",ID:"icon-pricechannel"},Name:"价格通道线"},{HTML:{Title:"M头W底",IClass:"iconfont icon-draw_wavemw",ID:"icon-wavemw"},Name:"M头W底"}],[{HTML:{Title:"圆弧",IClass:"iconfont icon-draw_arc",ID:"icon-arc"},Name:"圆弧线"},{HTML:{Title:"矩形",IClass:"iconfont icon-rectangle",ID:"icon-rect"},Name:"矩形"},{HTML:{Title:"平行四边形",IClass:"iconfont icon-draw_quadrangle",ID:"icon-quad"},Name:"平行四边形"},{HTML:{Title:"三角形",IClass:"iconfont icon-draw_triangle",ID:"icon-triangle"},Name:"三角形"},{HTML:{Title:"圆",IClass:"iconfont icon-draw_circle",ID:"icon-circle"},Name:"圆"},{HTML:{Title:"对称角度",IClass:"iconfont icon-draw_symangle",ID:"icon-symangle"},Name:"对称角度"}],[{HTML:{Title:"文本",IClass:"iconfont icon-draw_text",ID:"icon-text"},Name:"文本"},{HTML:{Title:"向上箭头",IClass:"iconfont icon-arrow_up",ID:"icon-arrowup"},Name:"icon-arrow_up"},{HTML:{Title:"向下箭头",IClass:"iconfont icon-arrow_down",ID:"icon-arrowdown"},Name:"icon-arrow_down"},{HTML:{Title:"向左箭头",IClass:"iconfont icon-arrow_left",ID:"icon-arrowleft"},Name:"icon-arrow_left"},{HTML:{Title:"向右箭头",IClass:"iconfont icon-arrow_right",ID:"icon-arrowright"},Name:"icon-arrow_right"}],[{HTML:{Title:"江恩角度线",IClass:"iconfont icon-draw_gannfan",ID:"icon-gannfan"},Name:"江恩角度线"},{HTML:{Title:"斐波那契周期线",IClass:"iconfont icon-draw_fibonacci",ID:"icon-fibonacci"},Name:"斐波那契周期线"},{HTML:{Title:"阻速线",IClass:"iconfont icon-draw_resline",ID:"icon-resline"},Name:"阻速线"},{HTML:{Title:"黄金分割",IClass:"iconfont icon-draw_goldensection",ID:"icon-goldensection"},Name:"黄金分割"},{HTML:{Title:"百分比线",IClass:"iconfont icon-draw_percentage",ID:"icon-percentage"},Name:"百分比线"},{HTML:{Title:"波段线",IClass:"iconfont icon-draw_waveband",ID:"icon-waveband"},Name:"波段线"}],[{HTML:{Title:"全部删除",IClass:"iconfont icon-recycle_bin",ID:"icon-delete"},Name:"全部删除"}]],a=this.HQChart;if(!this.ToolsDiv){var i=document.createElement("div");i.className="drawtools",i.id=this.ID;var r="",n="",s=new Array;e.forEach((function(t,e){s.push(t[0])}));for(var o=0;o<e.length;o++){for(var h=s[o],l=e[o],u="",C="",D=0;D<l.length;D++){var c=l[D],f=c.Name;f.indexOf("up")>-1?f="向上箭头":f.indexOf("down")>-1?f="向下箭头":f.indexOf("left")>-1?f="向左箭头":f.indexOf("right")>-1&&(f="向右箭头"),u+='<p class="menuTwoItem '+c.HTML.ID+'">'+f+'<i class="'+c.HTML.IClass+'" title="'+c.HTML.Title+'"></i></p>'}o!==e.length-1?(n='<div class="menuTwo">'+u+"</div>",C='<i class="contentArrow iconfont icon-menu_arraw_left"></i>'):(n="",C="");var d='<div class="icon-image first-'+h.HTML.ID+'"><i class="'+h.HTML.IClass+'" title="'+h.HTML.Title+'"></i>'+n+C+"</div>";r+=d}for(var o in this.ChartBorder.UIElement.parentNode.appendChild(i),i.innerHTML=r,this.ToolsDiv=i,e){var m=e[o][0];if((0,E.default)("#"+this.ID+" .first-"+m.HTML.ID).hover((function(){(0,E.default)(".drawtools").find(".contentArrow").hide(),(0,E.default)(this).find(".contentArrow").removeClass("trans").show()})),(0,E.default)("#"+this.ID+" .first-"+m.HTML.ID+" .contentArrow").click((function(t){t.stopPropagation(),(0,E.default)(".drawtools").find(".menuTwo").hide(),(0,E.default)(this).siblings(".menuTwo").show()})),(0,E.default)("#"+this.ID+" .first-"+m.HTML.ID+" .trans").click((function(){event.stopPropagation(),(0,E.default)(this).siblings(".menuTwo").hide()})),"全部删除"==m.Name)(0,E.default)("#"+this.ID+" .first-icon-delete").click((function(){(0,E.default)(".drawtools").find(".menuTwo").hide(),(0,E.default)(this).siblings().removeClass("active"),(0,E.default)(this).addClass("active"),a.ClearChartDrawPicture(),(0,E.default)(".subTolls").css("display","none")}));else{(0,E.default)("#"+this.ID+" .first-"+s[o].HTML.ID).click({CurrentIndex:o},(function(t){(0,E.default)(".drawtools").find(".menuTwo").hide(),(0,E.default)(this).siblings().removeClass("active"),(0,E.default)(this).addClass("active"),a.CreateChartDrawPicture(s[t.data.CurrentIndex].Name)}));var v=function(){S=e[o][D];var i=S.HTML.IClass;(0,E.default)("#"+t.ID+" ."+S.HTML.ID).hover((function(t){t.stopPropagation(),(0,E.default)(this).closest(".icon-image").find(".contentArrow").addClass("trans")})),(0,E.default)("#"+t.ID+" ."+S.HTML.ID).click({DrawName:S.Name,CurrentIndex:o,CurrentData:S},(function(t){t.stopPropagation(),(0,E.default)(this).closest(".icon-image").find(".contentArrow").hide(),(0,E.default)(this).siblings().removeClass("current"),(0,E.default)(this).addClass("current"),(0,E.default)(this).closest(".icon-image").children("i").eq(0).removeClass().addClass(i,"active").attr("title",t.data.CurrentData.HTML.Title),s.splice(t.data.CurrentIndex,1,t.data.CurrentData),(0,E.default)(this).parent().hide(),a.CreateChartDrawPicture(t.data.DrawName)}))};for(var D in e[o]){var S;v()}}}}var I=this.ID;(0,E.default)(document).click((function(t){(0,E.default)("#"+I).is(t.target)||0!==(0,E.default)("#"+I).has(t.target).length||((0,E.default)("#"+I+" .menuTwo").hide(),(0,E.default)("#"+I+" .contentArrow").hide())}));U();var p=V(),T=W(this.ChartBorder.GetRight()+this.Left),A=this.ChartBorder.GetTop();this.ToolsDiv.style.left=T/p+"px",this.ToolsDiv.style.top=A/p+"px",this.ToolsDiv.style.width=(this.Width-5)/p+"px",this.ToolsDiv.style.height="auto",this.ToolsDiv.style.position="absolute",this.ToolsDiv.style.display="block",this.SizeChange}}}function Ae(){this.newMethod=me,this.newMethod(),delete this.newMethod,this.ClassName="DepthMapPaint",this.LineColor="rgba(0,139,0,0.6)",this.AreaColor=["rgba(0,139,0,0.5)","rgba(0,139,0,0.4)","rgba(0,139,0,0.3)","rgba(0,139,0,0.2)"],this.TextColor="rgba(0,0,0)",this.TextBGColor="rgba(0,139,0)",this.Width=200*V(),this.FrameID=0,this.ID=Y(),this.IsDynamic=!1,this.IsCallbackDraw=!0,this.YRange,this.SetOption=function(t){t.FrameID>0&&(this.FrameID=t.FrameID),t.Width>0&&(this.Width=t.Width),Le.IsObjectExist(t.ID)&&(this.ID=t.ID),t.IsShowCorssCursor&&(this.IsShowCorssCursor=t.IsShowCorssCursor)},this.Draw=function(){if(this.Data&&this.ChartFrame&&this.ChartFrame.SubFrame&&!(this.ChartFrame.SubFrame.length<=this.FrameID)){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.SubFrame[this.FrameID].Frame,a=e.ChartBorder,i=a.GetHeightEx(),r=a.GetRight(),n=a.GetTopEx(),s=a.GetBottomEx(),o=this.Width;if(o>this.ChartBorder.Right&&(o=this.ChartBorder.Right),t){r=a.GetBottom(),n=a.GetRight(),s=a.GetLeft();o=this.Width;o>this.ChartBorder.Bottom&&(o=this.ChartBorder.Bottom)}var h={Left:r,Top:n,Right:r+o,Bottom:s,Height:i,Width:o};for(var l in this.YRange={Max:null,Min:0},this.Data){var u=this.Data[l];this.CalculateYRange(u,this.YRange)}for(var l in this.Data){u=this.Data[l];u.Height>0&&u.Height<=1?h.Height=i*u.Height:h.Height=i,1==u.Type?(h.Top=n,h.Bottom=n+h.Height,this.DrawUpArea(u,h)):2==u.Type?(h.Bottom=s,h.Top=h.Bottom-h.Height,this.DrawDownArea(u,h)):(h.Top=n,h.Bottom=s,this.DrawDefaultArea(u,h))}}},this.CalculateYRange=function(t,e){for(var a in t.Data){var i=t.Data[a];(null==e.Max||e.Max<i.Y)&&(e.Max=i.Y),(null==e.Min||e.Min>i.Y)&&(e.Min=i.Y)}},this.GetXFromData=function(t,e,a){var i=e.Width*(t-a.Min)/(a.Max-a.Min);return e.Left+i},this.GetYFromData=function(t,e,a,i){if(i){var r=e.Height*(t-a.Min)/(a.Max-a.Min);return e.Bottom-r}r=e.Height*(t-a.Min)/(a.Max-a.Min);return e.Top+r},this.DrawDefaultArea=function(t,e){var a=this.ChartFrame.SubFrame[this.FrameID].Frame,i=t.Range&&t.Range.Y?t.Range.Y:this.YRange,r=[];for(var n in t.Data){var s=t.Data[n],o=this.GetXFromData(s.Y,e,i);if(!(s.X>a.HorizontalMax||s.X<a.HorizontalMin)){var h=a.GetYFromData(s.X);r.push({X:o,Y:h})}}var l=t.LineColor?t.LineColor:this.LineColor,u=t.AreaColor?t.AreaColor:this.AreaColor;r.length>0&&this.DrawLine(r,l,u,e)},this.DrawUpArea=function(t,e){var a=[];for(var i in t.Data){var r=t.Data[i],n=this.GetXFromData(r.Y,e,t.Range.Y),s=this.GetYFromData(r.X,e,t.Range.X,t.IsASC);a.push({X:n,Y:s})}var o=t.LineColor?t.LineColor:this.LineColor,h=t.AreaColor?t.AreaColor:this.AreaColor;a.length>0&&this.DrawLine(a,o,h,e)},this.DrawDownArea=function(t,e){var a=[];for(var i in t.Data){var r=t.Data[i],n=this.GetXFromData(r.Y,e,t.Range.Y),s=this.GetYFromData(r.X,e,t.Range.X,t.IsASC);a.push({X:n,Y:s})}var o=t.LineColor?t.LineColor:this.LineColor,h=t.AreaColor?t.AreaColor:this.AreaColor;a.length>0&&this.DrawLine(a,o,h,e)},this.DrawLine=function(t,e,a,i){var r=!0===this.ChartFrame.IsHScreen,n=!0,s=0;for(var o in this.Canvas.strokeStyle=e,t){var h=t[o];n?(this.Canvas.beginPath(),r?this.Canvas.moveTo(h.Y,h.X):this.Canvas.moveTo(h.X,h.Y),n=!1):r?this.Canvas.lineTo(h.Y,h.X):this.Canvas.lineTo(h.X,h.Y),++s}s>0&&this.Canvas.stroke();var l=t[0],u=t[t.length-1];if(r?(this.Canvas.lineTo(u.Y,i.Left),this.Canvas.lineTo(l.Y,i.Left)):(this.Canvas.lineTo(i.Left,u.Y),this.Canvas.lineTo(i.Left,l.Y)),this.Canvas.closePath(),Array.isArray(a))if(r){var C=this.Canvas.createLinearGradient(this.ChartBorder.GetRightEx(),this.ChartBorder.GetTop(),this.ChartBorder.GetLeft(),this.ChartBorder.GetTop());C.addColorStop(0,a[0]),C.addColorStop(1,a[1]),this.Canvas.fillStyle=C}else{var D=this.Canvas.createLinearGradient(i.Right,i.Top,i.Left,i.Top),c=1/a.length;for(var o in a)D.addColorStop(o*c,a[o]);this.Canvas.fillStyle=D}else this.Canvas.fillStyle=a;this.Canvas.fill()},this.GetYValueByXValue=function(t,e){var a=[],i=0,r=Be[e];for(var n in this.Data){var s=this.Data[n];if(0==s.Type&&s.Data&&!(s.Data.length<0)&&0!=s.IsShowCorssCursor){var o=!1;for(var h in s.Data){var l=s.Data[h];if(i=parseInt(l.X*r),i==t){o=!0;var u={X:l.X,Y:l.Y,TextColor:s.TextColor?s.TextColor:this.TextColor,TextBGColor:s.TextBGColor?s.TextBGColor:this.TextBGColor};l.YText&&(u.YText=l.YText),a.push(u);break}}if(!o){var C=s.Data[0],D=s.Data[s.Data.length-1];t>C.X*r&&t<D.X*r&&a.push({X:null,Y:null,TextColor:s.TextColor?s.TextColor:this.TextColor,TextBGColor:s.TextBGColor?s.TextBGColor:this.TextBGColor})}}}return a}}function ge(){this.newMethod=me,this.newMethod(),delete this.newMethod,this.ClassName="BackgroundPaint",this.IsDynamic=!1,this.IsCallbackDraw=!0,this.FrameID=0,this.Data,this.ID=Y(),this.ChartSubFrame,this.ChartBorder,this.KData,this.Period,this.XPointCount=0,this.SetOption=function(t){t.FrameID>0&&(this.FrameID=t.FrameID),Le.IsObjectExist(t.ID)&&(this.ID=t.ID)},this.Draw=function(){if(this.Data&&this.HQChart&&this.ChartFrame&&this.ChartFrame.SubFrame&&!(this.ChartFrame.SubFrame.length<=this.FrameID)){var t=this.HQChart.ChartPaint[0];if(t&&t.Data&&(this.ChartSubFrame=this.ChartFrame.SubFrame[this.FrameID].Frame,this.ChartBorder=this.ChartSubFrame.ChartBorder,this.KData=t.Data,this.Period=this.HQChart.Period,this.KData&&!(this.KData.Data.length<=0))){var e=!0===this.ChartSubFrame.IsHScreen;this.XPointCount=this.ChartSubFrame.XPointCount;var a=this.ChartSubFrame.XPointCount,i=this.KData.Data[this.KData.DataOffset],r=this.KData.DataOffset+a-1;r>=this.KData.Data.length&&(r=this.KData.Data.length-1);var n=this.KData.Data[r],s=this.GetShowData(i,n);if(s&&!(s.length<=0)){var o=this.BuildKLineMap(),h=this.ChartBorder.GetBottomEx(),l=this.ChartBorder.GetTopEx(),u=this.ChartBorder.GetHeightEx();for(var C in e&&(l=this.ChartBorder.GetRightEx(),h=this.ChartBorder.GetLeftEx(),u=this.ChartBorder.GetWidthEx()),s){var D=s[C],c=this.GetBGCoordinate(D,o);if(c){if(Array.isArray(D.Color)){var f;f=e?this.Canvas.createLinearGradient(h,c.Left,l,c.Left):this.Canvas.createLinearGradient(c.Left,l,c.Left,h);var d=1/D.Color.length;for(var C in D.Color)f.addColorStop(C*d,D.Color[C]);this.Canvas.fillStyle=f}else this.Canvas.fillStyle=D.Color;e?this.Canvas.fillRect(X(h),X(c.Left),X(u),X(c.Width)):this.Canvas.fillRect(X(c.Left),X(l),X(c.Width),X(u))}}}}}},this.GetShowData=function(t,e){var a=[];for(var i in this.Data){var r=this.Data[i],n={};r.Start.Date>=t.Date&&r.Start.Date<=e.Date&&(n.Start=r.Start),r.End.Date>=t.Date&&r.End.Date<=e.Date&&(n.End=r.End),(n.Start||n.End)&&(n.Color=r.Color,a.push(n))}return a},this.BuildKLineMap=function(){var t=!0===this.ChartSubFrame.IsHScreen,e=this.ChartSubFrame.DataWidth,a=this.ChartSubFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+Ma.FrameLeftMargin;t&&(i=this.ChartBorder.GetTop()+a/2+Ma.FrameLeftMargin);var r=this.ChartBorder.GetRight();t&&(r=this.ChartBorder.GetBottom());for(var n={Data:new g.default,Start:null,End:null},s=this.KData.DataOffset,o=0;s<this.KData.Data.length&&o<this.XPointCount;++s,++o,i+=e+a){var h=this.KData.Data[s],l=i,u=i+e;if(u>r)break;var C=l+(u-l)/2;0==o&&(n.XLeft=l),n.XRight=u;var D={Index:s,ShowIndex:o,X:C,Right:u,Left:l,Date:h.Date};if(It.IsMinutePeriod(this.Period,!0)){var c="Date:"+h.Date+" Time:"+h.Time;D.Time=h.Time}else c="Date:"+h.Date;n.Data.set(c,D),0==o&&(n.Start=D),n.End=D}return n},this.GetBGCoordinate=function(t,e){var a=null,i=null,r=It.IsMinutePeriod(this.Period,!0),n=!1;if(r?t.Start&&t.End&&t.Start.Date==t.End.Date&&t.Start.Time==t.End.Time&&(n=!0):t.Start&&t.End&&t.Start.Date==t.End.Date&&(n=!0),n){if(r)var s="Date:"+t.Start.Date+" Time:"+t.Start.Time;else s="Date:"+t.Start.Date;if(!e.Data.has(s))return null;var o=e.Data.get(s);return a=o.Left,i=o.Right,{Left:a,Right:i,Width:i-a}}if(t.Start){if(r)s="Date:"+t.Start.Date+" Time:"+t.Start.Time;else s="Date:"+t.Start.Date;if(e.Data.has(s)){o=e.Data.get(s);a=o.Left}else if(r)if(t.Start.Date<e.Start.Date||t.Start.Date==e.Start.Date&&t.Start.Time<=e.Start.Time)a=e.Start.Left;else{var h=!0,l=!1,u=void 0;try{for(var C,D=(0,T.default)(e.Data);!(h=(C=D.next()).done);h=!0){var c=C.value,f=c[1];if(f.Date>t.Start.Date||f.Date==t.Start.Date&&f.Time>t.Start.Time){a=f.Left;break}}}catch(R){l=!0,u=R}finally{try{!h&&D.return&&D.return()}finally{if(l)throw u}}}else if(t.Start.Date<=e.Start.Date)a=e.Start.Left;else{var d=!0,m=!1,v=void 0;try{for(var S,I=(0,T.default)(e.Data);!(d=(S=I.next()).done);d=!0){c=S.value,f=c[1];if(f.Date>t.Start.Date){a=f.Left;break}}}catch(R){m=!0,v=R}finally{try{!d&&I.return&&I.return()}finally{if(m)throw v}}}}else a=e.XLeft;if(t.End){if(r)s="Date:"+t.End.Date+" Time:"+t.End.Time;else s="Date:"+t.End.Date;if(e.Data.has(s)){o=e.Data.get(s);i=o.Right}else if(r)if(t.End.Date<e.End.Date||t.End.Date==e.End.Date&&t.End.Time>=e.End.Time)i=e.End.Right;else{var p=null,A=!0,g=!1,F=void 0;try{for(var E,L=(0,T.default)(e.Data);!(A=(E=L.next()).done);A=!0){c=E.value,f=c[1];if(f.Date>t.End.Date||f.Date==t.End.Date&&f.Time>t.End.Time){i=p;break}p=f.Right}}catch(R){g=!0,F=R}finally{try{!A&&L.return&&L.return()}finally{if(g)throw F}}}else if(t.End.Date<=e.End.Date)i=e.End.Right;else{p=null;var M=!0,x=!1,N=void 0;try{for(var O,y=(0,T.default)(e.Data);!(M=(O=y.next()).done);M=!0){c=O.value,f=c[1];if(f.Date>t.End.Date){i=p;break}p=f.Right}}catch(R){x=!0,N=R}finally{try{!M&&y.return&&y.return()}finally{if(x)throw N}}}}else i=e.XRight;return null==a||null==i?null:{Left:a,Right:i,Width:i-a}}}function Fe(){this.PlayList=[],this.Cache=[],this.MinLineHeight=40*V(),this.Height,this.Step=1,this.GetPlayList=function(t){for(var e=t.Canves,a=t.Right,i=t.Left,r=a-i,n=t.IsMoveStep,s=[],o=0,h=0;h<this.PlayList.length;++h){var l=this.PlayList[h],u=this.MinLineHeight;l.Height>this.MinLineHeight&&(u=l.Height);for(var C=!0,D=!1,c=0;c<l.Data.length;++c){var f=l.Data[c],d={X:f.X,Y:o,Text:f.Text,Color:f.Color,Height:u,Font:f.Font,Info:f.Info};s.push(d),n&&(c==l.Data.length-1&&this.Cache.length>0?(C=!1,f.TextWidth||(f.Font&&f.Font.Name?e.font=f.Font.Name:e.font=t.Font,f.TextWidth=e.measureText(d.Text+"擎擎").width),f.X>=f.TextWidth&&(C=!0)):0==c&&(D=!1,f.TextWidth||(f.Font&&f.Font.Name?e.font=f.Font.Name:e.font=t.Font,f.TextWidth=e.measureText(d.Text+"擎擎").width),f.X>r+f.TextWidth&&(D=!0)),f.X+=this.Step)}if(n&&C&&this.Cache.length>0){var m=this.Cache.shift(),v={X:0,Text:m.Text,Color:m.Color,Font:m.Font,Info:m.Info};l.Data.push(v)}if(n&&D&&l.Data.length>0){var S=l.Data.shift();this.OnItemPlayEnd(t.HQChart,S)}o+=u}return s},this.CacluatePlayLine=function(t){this.Height=t;var e=parseInt(t/this.MinLineHeight);if(this.PlayList.length<e)for(var a=e-this.PlayList.length,i=0;i<a;++i)this.PlayList.push({Data:[]});else if(this.PlayList.length>e){var r=this.PlayList.length-e;for(i=0;i<r;++i)for(var n=this.PlayList.pop(),s=0;s<n.Data.length;++s){var o=n.Data[s],h={Text:o.Text,Color:o.Color,Font:o.Font,Info:o.Info};this.Cache.unshift(h)}}M.Chart.Log("[BarrageList::CacluatePlayLine] LineCount="+this.PlayList.length+" Height="+this.Height)},this.AddBarrage=function(t){for(var e in t){var a=t[e];this.Cache.push(a)}},this.OnItemPlayEnd=function(t,e){if(t.mapEvent.has(b.BARRAGE_PLAY_END)){var a=t.mapEvent.get(b.BARRAGE_PLAY_END);a.Callback&&a.Callback(a,e,this)}},this.Count=function(){return this.Cache.length}}function Ee(){this.newMethod=me,this.newMethod(),delete this.newMethod,this.ClassName="BarragePaint",this.IsAnimation=!0,this.IsEraseBG=!0,this.HQChart,this.Font=Ma.Barrage.Font,this.TextColor=Ma.Barrage.Color,this.FontHeight=Ma.Barrage.Height,this.BarrageList=new Fe,this.IsMoveStep=!1,this.SetOption=function(t){t&&(t.Step>0&&(this.BarrageList.Step=t.Step),t.MinLineHeight&&(this.Barrage.MinLineHeight=t.MinLineHeight))},this.DrawHScreen=function(){var t=this.ChartBorder.GetWidth(),e=this.ChartBorder.GetTop(),a=this.ChartBorder.GetBottom(),i=this.ChartBorder.GetRightEx();this.ChartBorder.GetChartWidth();t!=this.BarrageList.Height&&this.BarrageList.CacluatePlayLine(t),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left";var r=this.BarrageList.GetPlayList({Canves:this.Canvas,Right:a,Left:e,Font:this.Font,IsMoveStep:this.IsMoveStep,HQChart:this.HQChart});if(this.IsMoveStep=!1,r){this.Canvas.save(),this.Canvas.translate(this.ChartBorder.GetChartHeight(),0),this.Canvas.rotate(90*Math.PI/180);for(var n=0;n<r.length;++n){var s=r[n];s.Color?this.Canvas.fillStyle=s.Color:this.Canvas.fillStyle=this.TextColor,s.Font?this.Canvas.font=s.Font.Name:this.Canvas.font=this.Font;var o=this.FontHeight;s.Font&&s.Font.Height>0&&(o=s.Font.Height);var h=s.Y+parseInt((s.Height-o)/2);this.Canvas.fillText(s.Text,a-s.X,i+h)}this.Canvas.restore()}},this.Draw=function(){if(this.ChartFrame.IsHScreen)this.DrawHScreen();else{var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRight(),a=this.ChartBorder.GetTopEx(),i=this.ChartBorder.GetHeight();i!=this.BarrageList.Height&&this.BarrageList.CacluatePlayLine(i),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left";var r=this.BarrageList.GetPlayList({Canves:this.Canvas,Right:e,Left:t,Font:this.Font,IsMoveStep:this.IsMoveStep,HQChart:this.HQChart});if(this.IsMoveStep=!1,r)for(var n=0;n<r.length;++n){var s=r[n];s.Color?this.Canvas.fillStyle=s.Color:this.Canvas.fillStyle=this.TextColor,s.Font?this.Canvas.font=s.Font.Name:this.Canvas.font=this.Font;var o=this.FontHeight;s.Font&&s.Font.Height>0&&(o=s.Font.Height);var h=s.Y+parseInt((s.Height-o)/2);this.Canvas.fillText(s.Text,e-s.X,a+h)}}}}function Le(){this.ChartBorder,this.Frame,this.FrameSplitData,this.SplitCount=5,this.StringFormat=0,this.IsShowLeftText=!0,this.IsShowRightText=!0,this.LanguageID=xa.LANGUAGE_CHINESE_ID,this.IntegerCoordinateSplit=function(t){var e=this.FrameSplitData.Find(t.Interval);if(!e)return!1;if(t.Interval==e.FixInterval)return!0;var a=parseInt((t.Max/e.FixInterval+.5).toFixed(0))*e.FixInterval,i=parseInt((t.Min/e.FixInterval-.5).toFixed(0))*e.FixInterval;0==t.Min&&(i=0),i<0&&t.Min>0&&(i=0);for(var r=0,n=i;n-a<1e-8;n+=e.FixInterval)++r;return t.Interval=e.FixInterval,t.Max=a,t.Min=i,t.Count=r,!0},this.Filter=function(t,e){if(this.SplitCount<=0||t.length<=0||t.length<=this.SplitCount)return t;var a=parseInt(t.length/this.SplitCount);a<=1&&(a=2);for(var i=[],r=0;r<t.length;r+=a)r+a>=t.length&&r!=t.length-1?i.push(t[t.length-1]):i.push(t[r]);if(2==this.SplitCount&&i.length>2)for(r=1;r<i.length-1;++r){var n=i[r];n.Message[0]=null,n.Message[1]=null}if(e){var s=!1;for(r=0;r<i;++r){n=i[r];if(Math.abs(n.Value)<1e-8){s=!0;break}}if(0==s){var o=new z;o.Value=0,o.Message[0]=null,o.Message[1]=null,i.push(o)}}return i},this.RemoveZero=function(t){var e=[!0,!0];for(var a in t){var i=t[a],r=i.Message[0];this.IsDecimalZeroEnd(r)||(e[0]=!1);r=i.Message[1];this.IsDecimalZeroEnd(r)||(e[1]=!1)}if(0!=e[0]||0!=e[1])for(var a in t){i=t[a];if(e[0]){r=i.Message[0];null!=r&&("number"==typeof r&&(r=r.toString()),i.Message[0]=r.replace(/[.][0]+/g,""))}if(e[1]){r=i.Message[1];null!=r&&("number"==typeof r&&(r=r.toString()),i.Message[1]=r.replace(/[.][0]+/g,""))}}},this.IsDecimalZeroEnd=function(t){if(null==t)return!0;if("number"==typeof t&&(t=t.toString()),"0"==t)return!0;var e=t.search(/[.]/);if(e<0)return!1;for(var a=e+1;a<t.length;++a){var i=t.charAt(a);if(i>="1"&&i<="9")return!1}return!0}}function Me(){this.newMethod=Le,this.newMethod(),delete this.newMethod,this.CoordinateType=0,this.Symbol,this.Data,this.FrameSplitData2,this.FloatPrecision=null,this.Period,this.KLineChart,this.Custom=[],this.SplitType=0,this.Operator=function(){var t={};t.Max=this.Frame.HorizontalMax,t.Min=this.Frame.HorizontalMin,t.Count=this.SplitCount,t.Interval=(t.Max-t.Min)/(t.Count-1);var e=V(),a=this.Frame.ChartBorder.GetChartWidth(),i=a<450*e,r=Ui(this.Symbol);i&&Li.IsSHSZIndex(this.Symbol)&&(r=0),null!=this.FloatPrecision&&(r=this.FloatPrecision),M.Chart.Log("[FrameSplitKLinePriceY::Operator] Max="+t.Max+" Min="+t.Min+" Count="+t.Count+" isPhoneModel="+i+" defaultfloatPrecision="+r+" "),this.Frame.Logarithmic=null;var n=!0;if(It.IsTickPeriod(this.Period))this.SplitTickData(t,r);else switch(this.CoordinateType){case 1:this.SplitPercentage(t,r);break;case 2:this.SplitLogarithmic(t,r)?n=!1:this.SplitDefault(t,r);break;default:1==this.SplitType?(this.SplitFixed(t,r),n=!1):this.SplitDefault(t,r);break}this.CustomCoordinate(r),n&&(this.Frame.HorizontalInfo=this.Filter(this.Frame.HorizontalInfo,!1)),this.Frame.HorizontalMax=t.Max,this.Frame.HorizontalMin=t.Min,M.Chart.Log("[FrameSplitKLinePriceY::Operator] fixed . Max="+t.Max+" Min="+t.Min+" Count="+t.Count)},this.SplitTickData=function(t,e){var a=this.KLineChart.GetAllPrice();for(var i in this.Frame.HorizontalInfo=[],a){var r=a[i];this.Frame.HorizontalInfo[i]=new z,this.Frame.HorizontalInfo[i].Value=r,this.IsShowLeftText&&(this.Frame.HorizontalInfo[i].Message[0]=r.toFixed(e)),this.IsShowRightText&&(this.Frame.HorizontalInfo[i].Message[1]=r.toFixed(e))}},this.SplitPercentage=function(t,e){var a=this.GetFirstOpenPrice();t.Max=(t.Max-a)/a,t.Min=(t.Min-a)/a,t.Interval=(t.Max-t.Min)/(t.Count-1),this.IntegerCoordinateSplit2(t),this.Frame.HorizontalInfo=[];for(var i=0,r=t.Min;i<t.Count;++i,r+=t.Interval){var n=(r+1)*a;this.Frame.HorizontalInfo[i]=new z,this.Frame.HorizontalInfo[i].Value=n,this.IsShowLeftText&&(this.Frame.HorizontalInfo[i].Message[0]=n.toFixed(e)),this.IsShowRightText&&(this.Frame.HorizontalInfo[i].Message[1]=(100*r).toFixed(2)+"%")}t.Min=(1+t.Min)*a,t.Max=(1+t.Max)*a},this.SplitLogarithmic=function(t,e){var a=Ma.FromeLogarithmic.MinInterval,i=this.GetFirstOpenPrice();if(!Le.IsNumber(i))return!1;for(var r=this.ChartBorder.GetHeightEx(),n=[.01,.02,.04,.08,.1,.2],s=n[n.length-1],o=0;o<n.length;++o){var h=n[o],l=i*h*(r/(t.Max-t.Min));if(l>a){s=h;break}}var u=[],C=i;o=s;do{var D={Start:C};C=i*(1+o),D.End=C,u.push(D),o+=s}while(C<t.Max);var c=C,f=[];C=i,o=s;do{D={End:C};C=i*(1-o),D.Start=C,f.push(D),o+=s}while(C>t.Min);var d=C;t.Max=c,t.Min=d,M.Chart.Log("[FrameSplitKLinePriceY::SplitLogarithmic] up, down",u,f),this.Frame.HorizontalInfo=[];D=new z;D.Value=i,D.Font=Ma.FromeLogarithmic.OpenPriceFont;var m=D.Value.toFixed(e);for(var o in this.IsShowLeftText&&(D.Message[0]=m),this.IsShowRightText&&(D.Message[1]=m),this.Frame.HorizontalInfo.push(D),u){D=new z;D.Value=u[o].End;m=D.Value.toFixed(e);this.IsShowLeftText&&(D.Message[0]=m),this.IsShowRightText&&(D.Message[1]=m),this.Frame.HorizontalInfo.push(D)}for(var o in f){D=new z;D.Value=f[o].End;m=D.Value.toFixed(e);this.IsShowLeftText&&(D.Message[0]=m),this.IsShowRightText&&(D.Message[1]=m),this.Frame.HorizontalInfo.splice(0,0,D)}return this.Frame.Logarithmic={Up:u,Down:f,OpenPrice:i},!0},this.SplitDefault=function(t,e){this.IntegerCoordinateSplit(t),this.Frame.HorizontalInfo=[];for(var a=0,i=t.Min;a<t.Count;++a,i+=t.Interval)this.Frame.HorizontalInfo[a]=new z,this.Frame.HorizontalInfo[a].Value=i,this.IsShowLeftText&&(this.Frame.HorizontalInfo[a].Message[0]=i.toFixed(e)),this.IsShowRightText&&(this.Frame.HorizontalInfo[a].Message[1]=i.toFixed(e))},this.SplitFixed=function(t,e){this.Frame.HorizontalInfo=[];for(var a=0,i=t.Min;a<t.Count;++a,i+=t.Interval)this.Frame.HorizontalInfo[a]=new z,this.Frame.HorizontalInfo[a].Value=i,this.IsShowLeftText&&(this.Frame.HorizontalInfo[a].Message[0]=i.toFixed(e)),this.IsShowRightText&&(this.Frame.HorizontalInfo[a].Message[1]=i.toFixed(e))},this.CustomCoordinate=function(t){for(var e in this.Frame.CustomHorizontalInfo=[],this.Custom){var a=this.Custom[e];if(0==a.Type){var i=this.GetLatestPrice(t,a);i&&this.Frame.CustomHorizontalInfo.push(i)}else 1==a.Type&&this.CustomFixedCoordinate(a)}},this.GetLatestPrice=function(t,e){if(!this.Data||!this.Data.Data)return null;if(this.Data.Data.length<=0)return null;var a=this.Data.Data[this.Data.Data.length-1],i=new z;return i.Type=0,i.Value=a.Close,i.TextColor=Ma.FrameLatestPrice.TextColor,"left"==e.Position?i.Message[0]=a.Close.toFixed(t):i.Message[1]=a.Close.toFixed(t),a.Close>a.Open?i.LineColor=Ma.FrameLatestPrice.UpBarColor:a.Close<a.Open?i.LineColor=Ma.FrameLatestPrice.DownBarColor:i.LineColor=Ma.FrameLatestPrice.UnchagneBarColor,0==e.IsShowLine&&(i.LineType=-1),i},this.GetFirstOpenPrice=function(){if(!this.Data)return null;for(var t=this.Frame.XPointCount,e=this.Data.DataOffset,a=0;e<this.Data.Data.length&&a<t;++e,++a){var i=this.Data.Data[e];if(null!=i.Open&&null!=i.High&&null!=i.Low&&null!=i.Close)return i.Open}return null},this.CustomFixedCoordinate=function(t){var e=Ui(this.Symbol);for(var a in t.Data){var i,r=t.Data[a],n=new z;n.Type=1,n.TextColor=r.TextColor,n.LineColor=r.Color,n.LineType=2,0==t.IsShowLine&&(n.LineType=-1),n.Value=r.Value,i=r.Text?r.Text:n.Value.toFixed(e),"left"==t.Position?n.Message[0]=i:n.Message[1]=i,this.Frame.CustomHorizontalInfo.push(n)}},this.IntegerCoordinateSplit2=function(t){var e=this.FrameSplitData2.Find(t.Interval);if(!e)return!1;if(t.Interval==e.FixInterval)return!0;var a=parseInt((t.Max/e.FixInterval+.5).toFixed(0))*e.FixInterval,i=parseInt((t.Min/e.FixInterval-.5).toFixed(0))*e.FixInterval;0==t.Min&&(i=0),i<0&&t.Min>0&&(i=0);for(var r=0,n=i;n-a<1e-8;n+=e.FixInterval)++r;return t.Interval=e.FixInterval,t.Max=a,t.Min=i,t.Count=r,!0}}function xe(){this.newMethod=Le,this.newMethod(),delete this.newMethod,this.SplitCount=3,this.FloatPrecision=2,this.FLOATPRECISION_RANGE=[1,.1,.01,.001,1e-4],this.SplitType=0,this.Custom=[],this.GetFloatPrecision=function(t,e){if(t>this.FLOATPRECISION_RANGE[0])return e;if(e<0)return 2;for(;e<this.FLOATPRECISION_RANGE.length;++e)if(t>this.FLOATPRECISION_RANGE[e])break;return e},this.Operator=function(){var t={};if(t.Max=this.Frame.HorizontalMax,t.Min=this.Frame.HorizontalMin,this.Frame.YSpecificMaxMin?(t.Count=this.Frame.YSpecificMaxMin.Count,t.Interval=(t.Max-t.Min)/(t.Count-1)):1==this.SplitType?(t.Count=this.SplitCount,t.Interval=(t.Max-t.Min)/(t.Count-1)):(t.Count=this.SplitCount,t.Interval=(t.Max-t.Min)/(t.Count-1),this.IntegerCoordinateSplit(t)),this.Frame.HorizontalInfo=[],this.Frame.YSplitScale)for(var e in this.Frame.YSplitScale){var a=this.Frame.YSplitScale[e],i=new z;i.Value=a;var r=Math.abs(a);if(r<1e-10)i.Message[1]=0;else if(r<this.FLOATPRECISION_RANGE[this.FLOATPRECISION_RANGE.length-1])i.Message[1]=a.toExponential(2).toString();else{var n=this.GetFloatPrecision(r,this.FloatPrecision);i.Message[1]=Le.FormatValueString(a,n,this.LanguageID)}i.Message[0]=i.Message[1],0==this.IsShowLeftText&&(this.Frame.HorizontalInfo[e].Message[0]=null),0==this.IsShowRightText&&(this.Frame.HorizontalInfo[e].Message[1]=null),this.Frame.HorizontalInfo.push(i)}else for(e=0,a=t.Min;e<t.Count;++e,a+=t.Interval){if(this.Frame.HorizontalInfo[e]=new z,this.Frame.HorizontalInfo[e].Value=a,1==this.StringFormat){n=this.FloatPrecision;!isNaN(a)&&Math.abs(a)>1e3&&(n=0),this.Frame.HorizontalInfo[e].Message[1]=Le.FormatValueString(a,n,this.LanguageID)}else{r=Math.abs(a);if(r<1e-10)this.Frame.HorizontalInfo[e].Message[1]=0;else if(r<this.FLOATPRECISION_RANGE[this.FLOATPRECISION_RANGE.length-1])this.Frame.HorizontalInfo[e].Message[1]=a.toExponential(2).toString();else{n=this.GetFloatPrecision(r,this.FloatPrecision);this.Frame.HorizontalInfo[e].Message[1]=Le.FormatValueString(a,n,this.LanguageID)}}this.Frame.HorizontalInfo[e].Message[0]=this.Frame.HorizontalInfo[e].Message[1],0==this.IsShowLeftText&&(this.Frame.HorizontalInfo[e].Message[0]=null),0==this.IsShowRightText&&(this.Frame.HorizontalInfo[e].Message[1]=null)}this.CustomCoordinate(),1!=this.SplitType&&(this.Frame.HorizontalInfo=this.Filter(this.Frame.HorizontalInfo,t.Max>0&&t.Min<0)),this.RemoveZero(this.Frame.HorizontalInfo),this.Frame.HorizontalMax=t.Max,this.Frame.HorizontalMin=t.Min,this.RightFrameSplitY()},this.RightFrameSplitY=function(){if(this.Frame.RightFrame){var t=this.Frame.RightFrame;for(var e in this.Frame.HorizontalInfo){var a=this.Frame.HorizontalInfo[e],i=this.Frame.GetYFromData(a.Value),r=t.GetYData(i);a.Message[1]=Le.FormatValueString(r,this.FloatPrecision,this.LanguageID)}}},this.CustomCoordinate=function(){for(var t in this.Frame.CustomHorizontalInfo=[],this.Custom){var e=this.Custom[t];0==e.Type||1==e.Type&&this.CustomFixedCoordinate(e)}},this.CustomFixedCoordinate=function(t){var e=2;for(var a in t.Data){var i,r=t.Data[a],n=new z;n.Type=1,n.TextColor=r.TextColor,n.LineColor=r.Color,n.LineType=2,0==t.IsShowLine&&(n.LineType=-1),n.Value=r.Value,i=r.Text?r.Text:n.Value.toFixed(e),"left"==t.Position?n.Message[0]=i:n.Message[1]=i,this.Frame.CustomHorizontalInfo.push(n)}}}function Ne(){this.newMethod=Le,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.Period,this.Symbol,this.MinTextDistance=50*V(),this.MinBarDistance=5,this.SplitDateTime=function(){this.Frame.VerticalInfo=[];for(var t=this.Frame.DistanceWidth+this.Frame.DataWidth,e=this.Frame.Data.DataOffset,a=this.Frame.XPointCount,i=0,r=0,n=0,s=e;n<a&&s<this.Frame.Data.Data.length;++n,++s){i+=t,++r;var o=null;if(0==n){var h=Le.FormatDateString(this.Frame.Data.Data[s].Date,"MM-DD");o={Value:s-e,Text:h}}else if(i>this.MinTextDistance&&r>=this.MinBarDistance){var l=Le.FormatTimeString(this.Frame.Data.Data[s].Time);o={Value:s-e,Text:l}}if(o){var u=new z;u.Value=o.Value,this.ShowText&&(u.Message[0]=o.Text),this.Frame.VerticalInfo.push(u),i=0,r=0,0==n&&(i=-this.MinTextDistance/2)}}},this.SplitSecond=function(){this.Frame.VerticalInfo=[];for(var t=this.Frame.DistanceWidth+this.Frame.DataWidth,e=this.Frame.Data.DataOffset,a=this.Frame.XPointCount,i=0,r=0,n=0,s=e;n<a&&s<this.Frame.Data.Data.length;++n,++s){i+=t,++r;var o=null;if(0==n){var h=Le.FormatDateString(this.Frame.Data.Data[s].Date,"MM-DD");o={Value:s-e,Text:h}}else if(i>this.MinTextDistance&&r>=this.MinBarDistance){var l=Le.FormatTimeString(this.Frame.Data.Data[s].Time,"HH:MM:SS");o={Value:s-e,Text:l}}if(o){var u=new z;u.Value=o.Value,this.ShowText&&(u.Message[0]=o.Text),this.Frame.VerticalInfo.push(u),i=0,r=0,0==n&&(i=-this.MinTextDistance/2)}}},this.SplitDate=function(){this.Frame.VerticalInfo=[];for(var t=this.Frame.Data.DataOffset,e=this.Frame.XPointCount,a=null,i=null,r=12,n=0,s=0,o=t,h=r;s<e&&o<this.Frame.Data.Data.length;++s,++o){var l=parseInt(this.Frame.Data.Data[o].Date/1e4),u=parseInt(this.Frame.Data.Data[o].Date/100)%100;if(i!=u&&++n,h<r||null!=a&&a==l&&null!=i&&i==u)i=u,++h;else{var C,D=new z;D.Value=o-t,null==a||a!=l?C=l.toString():null!=i&&i==u||(C=u.toString()+"月",C=Oa.GetText(C,this.LanguageID)),a=l,i=u,this.ShowText&&(D.Message[0]=C),this.Frame.VerticalInfo.push(D),h=0}}0==this.Period&&n<=2&&this.SplitShortDate()},this.SplitShortDate=function(){this.Frame.VerticalInfo=[];for(var t=this.Frame.Data.DataOffset,e=this.Frame.XPointCount,a=12,i=!0,r=0,n=t,s=a;r<e&&n<this.Frame.Data.Data.length;++r,++n){var o=parseInt(this.Frame.Data.Data[n].Date/1e4);if(s<a)++s;else{var h,l=new z;l.Value=n-t,i?(h=o.toString(),i=!1):h=Le.FormatDateString(this.Frame.Data.Data[n].Date,"MM-DD"),this.ShowText&&(l.Message[0]=h),this.Frame.VerticalInfo.push(l),s=0}}},this.Operator=function(){null!=this.Frame.Data&&(Ne.SplitCustom?Ne.SplitCustom(this):It.IsMinutePeriod(this.Period,!0)?this.SplitDateTime():It.IsSecondPeriod(this.Period)?this.SplitSecond():this.SplitDate())},this.CreateCoordinateInfo=function(){return new z}}function Oe(){this.newMethod=Le,this.newMethod(),delete this.newMethod,this.High=null,this.Low=null,this.YClose,this.Data,this.AverageData,this.SourceData,this.OverlayChartPaint,this.SplitCount=7,this.Symbol,this.SplitType=0,this.LimitPrice,this.Custom,this.RightTextFormat=0,this.Operator=function(){if(this.Frame.HorizontalInfo=[],this.Frame.CustomHorizontalInfo=[],this.Data){var t=this.GetMaxMin();this.Symbol&&Li.IsUSA(this.Symbol.toUpperCase())?this.USASplit(t):this.DefaultSplit(t),this.CustomCoordinate()}},this.CustomCoordinate=function(){if(this.Custom){var t=Ui(this.Symbol);for(var e in this.Custom){var a=this.Custom[e];if(1==a.Type)this.CustomFixedCoordinate(a);else if(0==a.Type){var i=this.GetLatestPrice(t,a);i&&this.Frame.CustomHorizontalInfo.push(i)}}}},this.GetLatestPrice=function(t,e){if(!this.Data||!this.Data.Data)return null;if(this.Data.Data.length<=0)return null;var a=this.Data.Data[this.Data.Data.length-1];if(!Le.IsNumber(a)||!Le.IsNumber(this.YClose))return null;var i=new z;return i.Type=0,i.Value=a,i.TextColor=Ma.FrameLatestPrice.TextColor,"left"==e.Position?i.Message[0]=a.toFixed(t):i.Message[1]=a.toFixed(t),a>this.YClose?i.LineColor=Ma.FrameLatestPrice.UpBarColor:a<this.YClose?i.LineColor=Ma.FrameLatestPrice.DownBarColor:i.LineColor=Ma.FrameLatestPrice.UnchagneBarColor,0==e.IsShowLine&&(i.LineType=-1),i},this.CustomFixedCoordinate=function(t){var e=Ui(this.Symbol);for(var a in t.Data){var i,r=t.Data[a],n=new z;n.Type=1,n.TextColor=r.TextColor,n.LineColor=r.Color,n.LineType=2,0==t.IsShowLine&&(n.LineType=-1),Le.IsNumber(r.Increase)?(Le.IsNumber(this.YClose)||conintue,n.Value=this.YClose*(1+r.Increase)):n.Value=r.Value,i=r.Text?r.Text:n.Value.toFixed(e),"left"==t.Position?n.Message[0]=i:n.Message[1]=i,this.Frame.CustomHorizontalInfo.push(n)}},this.GetMaxMin=function(){var t=this.YClose,e=this.YClose,a=this.Data,i=!1;for(var r in this.SourceData&&(a=this.SourceData,i=!0),a.Data){var n=null;if(i){var s=a.Data[r];n=s.Before?s.Before.Close:s.Close}else n=a.Data[r];null!=n&&(t<n&&(t=n),e>n&&(e=n))}if(this.AverageData)for(var r in this.AverageData.Data)null!=this.AverageData.Data[r]&&(t<this.AverageData.Data[r]&&(t=this.AverageData.Data[r]),e>this.AverageData.Data[r]&&(e=this.AverageData.Data[r]));for(var r in this.OverlayChartPaint){s=this.OverlayChartPaint[r];var o=s.GetMaxMin();o.Max&&o.Max>t&&(t=o.Max),o.Min&&o.Min<e&&(e=o.Min)}return 1==this.SplitType&&this.LimitPrice&&(t<this.LimitPrice.Max&&(t=this.LimitPrice.Max),e>this.LimitPrice.Min&&(e=this.LimitPrice.Min)),Le.IsNumber(this.High)&&Le.IsNumber(this.Low)&&(t<this.High&&(t=this.High),e>this.Low&&(e=this.Low)),{Max:t,Min:e}},this.USASplit=function(t){var e=t.Max,a=t.Min;if(e==a)e+=.1*e,a-=.1*a;else{var i=V(),r=this.Frame.ChartBorder.GetHeight(),n=5*i*(e-a)/r;e+=n,a-=n}var s=this.SplitCount,o=(e-a)/(s-1),h=[1,.1,.01,.001,1e-4],l=Ui(this.Symbol);o<h[l]&&(o=h[l],e=a+o*s);for(var u=0;u<s;++u){var C=a+o*u,D=new z;D.Value=C;var c=C.toFixed(l);if(this.IsShowLeftText&&(D.Message[0]=c),this.YClose){var f=100*(C/this.YClose-1);f>0?D.TextColor=Ma.UpTextColor:f<0&&(D.TextColor=Ma.DownTextColor),this.IsShowRightText&&(1==this.RightTextFormat?D.Message[1]=c:D.Message[1]=Le.FormatValueString(f,2)+"%")}this.Frame.HorizontalInfo.push(D)}if(this.YClose>a&&this.YClose<e){D=new z;D.Value=this.YClose,this.Frame.HorizontalInfo.push(D)}this.Frame.HorizontalInfo.sort((function(t,e){return t.Value-e.Value})),this.Frame.HorizontalMax=e,this.Frame.HorizontalMin=a},this.DefaultSplit=function(t){var e=t.Max,a=t.Min;if(this.YClose==e&&this.YClose==a)e=this.YClose+.1*this.YClose,a=this.YClose-.1*this.YClose;else{var i=Math.max(Math.abs(this.YClose-e),Math.abs(this.YClose-a));e=this.YClose+i,a=this.YClose-i}var r=V(),n=this.Frame.ChartBorder.GetChartWidth(),s=n<450*r;M.Chart.Log("[FrameSplitMinutePriceY]max="+e+" min="+a+" isPhoneModel="+s);var o=this.SplitCount,h=(e-a)/(o-1),l=[1,.1,.01,.001,1e-4],u=Ui(this.Symbol);s&&Li.IsSHSZIndex(this.Symbol)&&(u=0),h<l[u]&&(h=l[u],e=this.YClose+h*(o-1)/2,a=this.YClose-h*(o-1)/2);for(var C=0;C<o;++C){var D=a+h*C,c=new z;this.Frame.HorizontalInfo[C]=c,c.Value=D;var f=D.toFixed(u);if(this.IsShowLeftText&&(c.Message[0]=f),D==this.YClose&&(c.LineType=2,Ma.FrameDotSplitPen&&(c.LineColor=Ma.FrameDotSplitPen)),this.YClose){var d=100*(D/this.YClose-1);d>0?c.TextColor=Ma.UpTextColor:d<0&&(c.TextColor=Ma.DownTextColor),this.IsShowRightText&&(1==this.RightTextFormat?c.Message[1]=f:c.Message[1]=Le.FormatValueString(d,2)+"%")}}this.Frame.HorizontalMax=e,this.Frame.HorizontalMin=a}}function ye(){this.newMethod=Le,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.Symbol=null,this.DayCount=1,this.ShowDateFormate=1,this.IsBeforeData=!1,this.Operator=function(){this.Frame.VerticalInfo=[];this.Frame.XPointCount;var t=this.Frame.ChartBorder.GetWidth(),e=!0===this.Frame.IsHScreen;e&&(t=this.Frame.ChartBorder.GetHeight()),t/=V();var a=Bi,i=a.GetCoordinateData(this.Symbol,t),r=i.Count,n=i.MiddleCount>0?i.MiddleCount:parseInt(r/2),s=i.Data;if(this.Frame.XPointCount=r*this.DayCount,this.Frame.MinuteCount=r,this.Frame.VerticalInfo=[],this.DayCount<=1){var o=14;for(var h in this.IsBeforeData&&(this.Frame.XPointCount=r+o,this.Frame.MinuteCount=r+o),s){var l=new z;l.Value=s[h][0],this.IsBeforeData&&(l.Value+=o),this.ShowText&&(l.Message[0]=s[h][3]),this.Frame.VerticalInfo[h]=l}}else{h=this.DayData.length-1;for(var u=0;h>=0;--h,++u){l=new z;l.Value=u*r+n,l.LineType=-1,this.ShowText&&(l.Message[0]=Le.FormatDateString(this.DayData[h].Date,0==this.ShowFormate?"YYYY-MM-DD":"MM-DD")),this.Frame.VerticalInfo.push(l);l=new z;l.Value=(u+1)*r,this.Frame.VerticalInfo.push(l)}}}}function Re(){this.newMethod=Le,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.Operator=function(){if(null!=this.Frame.Data&&null!=this.Frame.XData){this.Frame.VerticalInfo=[];for(var t=this.Frame.Data.DataOffset,e=this.Frame.XPointCount,a=0,i=t;a<e&&i<this.Frame.Data.Data.length;++a,++i){var r=new z;r.Value=i-t,this.ShowText&&(r.Message[0]=this.Frame.XData[a]),this.Frame.VerticalInfo.push(r),distance=0}}}}function Pe(){this.Frame,this.Canvas,this.HPenColor=Ma.CorssCursorHPenColor,this.HPenType=0,this.VPenColor=Ma.CorssCursorVPenColor,this.VPenType=0,this.Font=Ma.CorssCursorTextFont,this.TextColor=Ma.CorssCursorTextColor,this.TextBGColor=Ma.CorssCursorBGColor,this.TextHeight=20,this.LastPoint,this.CursorIndex,this.IsOnlyDrawKLine=!1,this.IsOnlyDrawMinute=!1,this.PointX,this.PointY,this.StringFormatX,this.StringFormatY,this.ShowTextMode={Left:1,Right:1,Bottom:1},this.TextFormat={Right:0},this.IsShowCorss=!0,this.IsShow=!0,this.IsShowClose=!1,this.Close=null,this.Status=0,this.ReloadResource=function(t){this.Font=Ma.CorssCursorTextFont,this.HPenColor=Ma.CorssCursorHPenColor,this.VPenColor=Ma.CorssCursorVPenColor,this.TextColor=Ma.CorssCursorTextColor,this.TextBGColor=Ma.CorssCursorBGColor},this.GetCloseYPoint=function(t){if(!this.StringFormatX.Data)return null;var e=this.StringFormatX.Data;if(!e.Data||e.Data.length<=0)return null;var a=e.DataOffset+t;if(a>=e.Data.length&&(a=e.Data.length-1),a<0)return null;var i=e.Data[a];if(!i)return null;this.Close=i.Close;var r=this.Frame.GetYFromData(this.Close);return r},this.GetMinuteCloseYPoint=function(t){if(!Le.IsNumber(t))return null;if(t=parseInt(t),!this.StringFormatX.Data)return null;var e=this.StringFormatX.Data;if(!e.Data||e.Data.length<=0)return null;var a=e.DataOffset+t;if(a>=e.Data.length&&(a=e.Data.length-1),a<0)return null;var i=e.Data[a];if(!Le.IsNumber(t))return null;this.Close=i;var r=this.Frame.GetYFromData(this.Close);return r},this.Draw=function(){if(this.Status=0,this.LastPoint){this.Close=null;var t=this.LastPoint.X,e=this.LastPoint.Y,a=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),a=this.Canvas.isPointInPath(t,e),this.PointY=null,this.PointY,a)if(!0!==this.Frame.IsHScreen){var i=this.Frame.ChartBorder.GetLeft(),r=this.Frame.ChartBorder.GetRight(),n=this.Frame.ChartBorder.GetTopTitle(),s=this.Frame.ChartBorder.GetBottom(),o=this.Frame.ChartBorder.Right,h=this.Frame.ChartBorder.GetChartWidth();if(this.IsOnlyDrawKLine){if(t=this.Frame.GetXFromIndex(this.CursorIndex),this.IsShowClose){var l=this.GetCloseYPoint(this.CursorIndex);null!=l&&(e=l)}}else if(this.IsOnlyDrawMinute){l=this.GetMinuteCloseYPoint(this.CursorIndex);null!=l&&(e=l)}if(this.PointY=[[i,e],[r,e]],this.PointX=[[t,n],[t,s]],this.IsShowCorss){var u=V();if(this.Canvas.save(),this.Canvas.strokeStyle=this.HPenColor,0==this.HPenType&&this.Canvas.setLineDash([3*u,2*u]),this.Canvas.beginPath(),this.Canvas.moveTo(i,W(e)),this.Canvas.lineTo(r,W(e)),this.Canvas.stroke(),this.Canvas.restore(),this.Canvas.save(),this.Canvas.strokeStyle=this.VPenColor,0==this.VPenType)this.Canvas.setLineDash([3*u,2*u]);else if(2==this.VPenType){var C=this.Frame.SubFrame[0].Frame.DataWidth;C>2*u&&(this.Canvas.lineWidth=C)}if(this.Canvas.beginPath(),this.Frame.SubFrame.length>0)for(var D in this.Frame.SubFrame){var c=this.Frame.SubFrame[D].Frame;n=c.ChartBorder.GetTopTitle(),s=c.ChartBorder.GetBottom(),this.Canvas.moveTo(W(t),n),this.Canvas.lineTo(W(t),s)}else this.Canvas.moveTo(W(t),n),this.Canvas.lineTo(W(t),s);this.Canvas.stroke(),this.Canvas.restore()}this.Frame.GetXData(t);var f={},d=this.Frame.GetYData(e,f);if((this.IsOnlyDrawMinute||this.IsShowClose)&&null!=this.Close&&(d=this.Close),this.StringFormatX.Value=this.CursorIndex,this.StringFormatY.Value=d,this.StringFormatY.RValue=f.RightYValue,this.StringFormatY.FrameID=f.FrameID,(1==this.ShowTextMode.Left&&this.Frame.ChartBorder.Left>=30||2==this.ShowTextMode.Left||1==this.ShowTextMode.Right&&this.Frame.ChartBorder.Right>=30||2==this.ShowTextMode.Right)&&this.StringFormatY.Operator()){var m=this.StringFormatY.Text;this.Canvas.font=this.Font;var v=this.Canvas.measureText(m).width+4;if(this.Frame.ChartBorder.Left>=30&&1==this.ShowTextMode.Left?(this.Canvas.fillStyle=this.TextBGColor,i<v?(this.Canvas.fillRect(2,e-this.TextHeight/2,v,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(m,4,e,v)):(this.Canvas.fillRect(i-2,e-this.TextHeight/2,-v,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(m,i-4,e,v))):2==this.ShowTextMode.Left&&(this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(i,e-this.TextHeight/2,v,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(m,i+2,e,v)),this.StringFormatY.PercentageText&&0==this.TextFormat.Right&&(m=this.StringFormatY.PercentageText+"%",v=this.Canvas.measureText(m).width+4),this.StringFormatY.RText){m=this.StringFormatY.RText;v=this.Canvas.measureText(m).width+4}if(this.Frame.ChartBorder.Right>=30&&1==this.ShowTextMode.Right){var S=!1,I=null;if(f.FrameID>=0){c=this.Frame.SubFrame[f.FrameID];S=c.OverlayIndex.length>0,I=c.Interval}if(this.Canvas.fillStyle=this.TextBGColor,S&&v>I){var p=r+I;p>h&&(p=h),this.Canvas.fillRect(p-2-v,e-this.TextHeight/2,v,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(m,p-4,e,v)}else o<v?(this.Canvas.fillRect(h-2-v,e-this.TextHeight/2,v,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(m,h-4,e,v)):(this.Canvas.fillRect(r+2,e-this.TextHeight/2,v,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(m,r+4,e,v));if(this.StringFormatY.RExtendText&&this.StringFormatY.RExtendText.length>0){var T=0;for(var D in this.StringFormatY.RExtendText){var A=this.StringFormatY.RExtendText[D],g="--.--";A.YText?g=A.YText:Le.IsNumber(A.Y)&&(g=A.Y.toFixed(0));var F=this.Canvas.measureText(g).width+4;this.Canvas.fillStyle=A.TextBGColor,o<F?(this.Canvas.fillRect(h-2-F,e+T+this.TextHeight/2,F,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=A.TextColor,this.Canvas.fillText(g,h-4,e+T+this.TextHeight,F)):(this.Canvas.fillRect(r+2,e+T+this.TextHeight/2,F,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=A.TextColor,this.Canvas.fillText(g,r+4,e+T+this.TextHeight,F)),T+=this.TextHeight}}}else if(2==this.ShowTextMode.Right){this.Canvas.fillStyle=this.TextBGColor;var E=r-v;this.Canvas.fillRect(E,e-this.TextHeight/2,v,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(m,E+2,e,v)}}if(1==this.ShowTextMode.Bottom&&this.StringFormatX.Operator()){m=this.StringFormatX.Text;this.Canvas.font=this.Font,this.Canvas.fillStyle=this.TextBGColor;v=this.Canvas.measureText(m).width+4;var L=s+2+this.TextHeight/2;t-v/2<3?(this.Canvas.fillRect(t-1,s+2,v,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(m,t+1,L,v)):t+v/2>=r?(this.Canvas.fillRect(r-v,s+2,v,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(m,r-2,L,v)):(this.Canvas.fillRect(t-v/2,s+2,v,this.TextHeight),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(m,t,L,v))}if(f.FrameID>=0){c=this.Frame.SubFrame[f.FrameID];var M=r;for(var D in this.Canvas.font=this.Font,c.OverlayIndex){A=c.OverlayIndex[D];if(!1!==A.Frame.IsShow){if(M+=c.Interval,M+30>h)break;for(d=A.Frame.GetYData(e),D=2;D>=0;--D){m=Le.FormatValueString(d,D),v=this.Canvas.measureText(m).width+4;if(v<c.Interval)break}this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(M+2,e-this.TextHeight/2,v,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(m,M+4,e,v)}}}this.Status=1}else this.HScreenDraw()}},this.HScreenDraw=function(){var t=this.LastPoint.X,e=this.LastPoint.Y;this.IsOnlyDrawKLine&&(e=this.Frame.GetXFromIndex(this.CursorIndex));var a=this.Frame.ChartBorder.GetLeft(),i=this.Frame.ChartBorder.GetRightEx(),r=this.Frame.ChartBorder.GetTop(),n=this.Frame.ChartBorder.GetBottom(),s=this.Frame.ChartBorder.Bottom;if(this.PointY=[[a,e],[i,e]],this.PointX=[[t,r],[t,n]],this.IsShowCorss){var o=V();if(this.Canvas.save(),this.Canvas.strokeStyle=this.HPenColor,0==this.HPenType&&this.Canvas.setLineDash([3*o,2*o]),this.Canvas.beginPath(),this.Canvas.moveTo(W(t),r),this.Canvas.lineTo(W(t),n),this.Canvas.stroke(),this.Canvas.restore(),this.Canvas.save(),this.Canvas.strokeStyle=this.VPenColor,0==this.VPenType)this.Canvas.setLineDash([3*o,2*o]);else if(2==this.VPenType){var h=this.Frame.SubFrame[0].Frame.DataWidth;h>2*o&&(this.Canvas.lineWidth=h)}if(this.Canvas.beginPath(),this.Frame.SubFrame.length>0)for(var l in this.Frame.SubFrame){var u=this.Frame.SubFrame[l].Frame;this.Canvas.moveTo(u.ChartBorder.GetLeft(),W(e)),this.Canvas.lineTo(u.ChartBorder.GetRightTitle(),W(e))}else this.Canvas.moveTo(a,W(e)),this.Canvas.lineTo(i,W(e));this.Canvas.stroke(),this.Canvas.restore()}var C=this.Frame.GetXData(e),D={},c=this.Frame.GetYData(t,D);if(this.StringFormatX.Value=C,this.StringFormatY.Value=c,this.StringFormatY.FrameID=D.FrameID,(1==this.ShowTextMode.Left&&this.Frame.ChartBorder.Top>=30||2==this.ShowTextMode.Left||1==this.ShowTextMode.Right&&this.Frame.ChartBorder.Bottom>=30||2==this.ShowTextMode.Right)&&this.StringFormatY.Operator()){var f=this.StringFormatY.Text;this.Canvas.font=this.Font;var d=this.Canvas.measureText(f).width+4;if(this.Frame.ChartBorder.Top>=30&&1==this.ShowTextMode.Left){var m=t,v=r;this.Canvas.save(),this.Canvas.translate(m,v),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,r>=d?(this.Canvas.fillRect(0,-this.TextHeight/2,-d,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(f,-2,0,d)):(this.Canvas.fillRect(d-r,-this.TextHeight/2,-d,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(f,d-r-2,0,d)),this.Canvas.restore()}else if(2==this.ShowTextMode.Left){m=t,v=r;this.Canvas.save(),this.Canvas.translate(m,v),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(0,-this.TextHeight/2,d,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(f,2,0,d),this.Canvas.restore()}if(this.Frame.ChartBorder.Bottom>=30&&1==this.ShowTextMode.Right){m=t,v=n;if(this.Canvas.save(),this.Canvas.translate(m,v),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,s>d?(this.Canvas.fillRect(0,-this.TextHeight/2,d,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(f,2,0,d)):(this.Canvas.fillRect(s-d,-this.TextHeight/2,d,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(f,s-d+2,0,d)),this.StringFormatY.RExtendText&&this.StringFormatY.RExtendText.length>0){var S=0;for(var l in this.StringFormatY.RExtendText){var I=this.StringFormatY.RExtendText[l],p="--.--";I.YText?p=I.YText:Le.IsNumber(I.Y)&&(p=I.Y.toFixed(0));var T=this.Canvas.measureText(p).width+4;if(this.Canvas.fillStyle=I.TextBGColor,s>T)this.Canvas.fillRect(0,S+this.TextHeight/2,T,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=I.TextColor,this.Canvas.fillText(p,2,S+this.TextHeight,T);else{var A=s-T;this.Canvas.fillRect(A,S+this.TextHeight/2,T,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=I.TextColor,this.Canvas.fillText(p,A+2,S+this.TextHeight,T)}S+=this.TextHeight}}this.Canvas.restore()}else if(2==this.ShowTextMode.Right){m=t,v=n;this.Canvas.save(),this.Canvas.translate(m,v),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(0,-this.TextHeight/2,-d,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(f,-2,0,d),this.Canvas.restore()}}if(1===this.ShowTextMode.Bottom&&this.StringFormatX.Operator()){f=this.StringFormatX.Text;this.Canvas.font=this.Font,this.Canvas.fillStyle=this.TextBGColor;d=this.Canvas.measureText(f).width+4;if(e-d/2<3){m=a,v=e;this.Canvas.save(),this.Canvas.translate(m,v),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillRect(0,0,d,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(f,0,this.TextHeight/2,d),this.Canvas.restore()}else{m=a,v=e;this.Canvas.save(),this.Canvas.translate(m,v),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillRect(-d/2,0,d,this.TextHeight),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(f,0,this.TextHeight/2,d),this.Canvas.restore()}}this.Status=1}}function we(){this.Frame,this.Canvas,this.Font=Ma.DefaultTextFont,this.TextColor=Ma.DefaultTextColor,this.IsEnableSplash=!1,this.SplashTitle="数据加载中",this.Draw=function(){if(this.IsEnableSplash)if(!0!==this.Frame.IsHScreen){var t=(this.Frame.ChartBorder.GetLeft()+this.Frame.ChartBorder.GetRight())/2,e=(this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.GetBottom())/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.SplashTitle,t,e)}else this.HScreenDraw()},this.HScreenDraw=function(){var t=(this.Frame.ChartBorder.GetLeft()+this.Frame.ChartBorder.GetRight())/2,e=(this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.GetBottom())/2;this.Canvas.save(),this.Canvas.translate(t,e),this.Canvas.rotate(90*Math.PI/180),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.SplashTitle,0,0),this.Canvas.restore()}}function be(){this.Data,this.Value,this.Text,this.Operator=function(){return!1}}Le.FormatValueThousandsString=function(t,e){if(null==t||isNaN(t)){if(e>0){for(var a="-.",i=0;i<e;++i)a+="-";return a}return"--"}var r="",n=t.toFixed(e);if(e>0){var s=n.split(".")[1],o=n.split(".")[0];while(o.length>3)r=","+o.slice(-3)+r,o=o.slice(0,o.length-3);o&&(r=o+r+"."+s)}else{while(n.length>3)r=","+n.slice(-3)+r,n=n.slice(0,n.length-3);n&&(r=n+r)}return r},Le.FormatValueString=function(t,e,a){if(null==t||isNaN(t)){if(e>0){for(var i="-.",r=0;r<e;++r)i+="-";return i}return"--"}if(t<1e-11&&t>-1e-11)return"0";var n=Math.abs(t);return a===xa.LANGUAGE_ENGLISH_ID?n<1e4?t.toFixed(e):n<1e6?(t/1e3).toFixed(e)+"K":n<1e9?(t/1e6).toFixed(e)+"M":n<1e12?(t/1e9).toFixed(e)+"B":(t/1e12).toFixed(e)+"T":n<1e4?t.toFixed(e):n<1e8?(t/1e4).toFixed(e)+"万":n<1e12?(t/1e8).toFixed(e)+"亿":(t/1e12).toFixed(e)+"万亿"},Le.FromatIntegerString=function(t,e,a){return t<1e4&&Le.IsInteger(t)&&(e=0),Le.FormatValueString(t,e,a)},Le.NumberToString=function(t){return t<10?"0"+t.toString():t.toString()},Le.FormatDateString=function(t,e){var a=parseInt(t/1e4),i=parseInt(t/100)%100,r=t%100;switch(e){case"MM-DD":return Le.NumberToString(i)+"-"+Le.NumberToString(r);default:return a.toString()+"-"+Le.NumberToString(i)+"-"+Le.NumberToString(r)}},Le.FormatTimeString=function(t,e){if("HH:MM:SS"==e){var a=parseInt(t/1e4),i=parseInt(t%1e4/100),r=t%100;return Le.NumberToString(a)+":"+Le.NumberToString(i)+":"+Le.NumberToString(r)}if("HH:MM"==e){a=parseInt(t/100),i=t%100;return Le.NumberToString(a)+":"+Le.NumberToString(i)}if(t<1e4){a=parseInt(t/100),i=t%100;return Le.NumberToString(a)+":"+Le.NumberToString(i)}a=parseInt(t/1e4),i=parseInt(t%1e4/100),r=t%100;return Le.NumberToString(a)+":"+Le.NumberToString(i)+":"+Le.NumberToString(r)},Le.FormatReportDateString=function(t){var e,a=parseInt(t/1e4),i=parseInt(t/100)%100;switch(i){case 3:e="一季度报";break;case 6:e="半年报";break;case 9:e="三季度报";break;case 12:e="年报";break}return a.toString()+e},Le.FormatDateTimeString=function(t,e){var a=t.split(" ");if(a.length<2)return"";var i=parseInt(a[1]),r=i%100,n=parseInt(i/100),s=(n<10?"0"+n.toString():n.toString())+":"+(r<10?"0"+r.toString():r.toString());if(1==e){var o=parseInt(a[0]),h=parseInt(o/1e4),l=parseInt(o%1e4/100),u=o%100;s=h.toString()+"-"+(l<10?"0"+l.toString():l.toString())+"-"+(u<10?"0"+u.toString():u.toString())+" "+s}return s},Le.FormatValueColor=function(t,e){return null!=t&&null==e?0==t?"PriceNull":t>0?"PriceUp":"PriceDown":null==t||null==e?"PriceNull":t==e?"PriceNull":t>e?"PriceUp":"PriceDown"},Le.IsNumber=function(t){return null!=t&&!isNaN(t)},Le.IsPlusNumber=function(t){return null!=t&&(!isNaN(t)&&t>0)},Le.IsInteger=function(t){return"number"===typeof t&&t%1===0},Le.IsObjectExist=function(t){return void 0!==t&&null!=t},Le.IsBool=function(t){return!0===t||!1===t},Le.IsString=function(t){return!(!t||"string"!=typeof t)};var Be=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10];function _e(){this.newMethod=be,this.newMethod(),delete this.newMethod,this.Symbol,this.FrameID,this.LanguageID=xa.LANGUAGE_CHINESE_ID,this.YClose,this.PercentageText,this.RValue,this.RText,this.ExtendChartPaint,this.RExtendText=[],this.Operator=function(){if(this.RText=null,this.RExtendText=[],Le.IsString(this.RValue)&&(this.RText=this.RValue),!this.Value)return!1;this.PercentageText=null;var t=2;if(0==this.FrameID){t=Ui(this.Symbol);this.Text=this.Value.toFixed(t),this.YClose>0&&(this.PercentageText=(100*(this.Value-this.YClose)/this.YClose).toFixed(2)),this.GetExtendPaintData(t)}else 1==this.FrameID?(this.Text=Le.FormatValueString(this.Value,t,this.LanguageID),Le.IsNumber(this.RValue)&&(this.RText=Le.FormatValueString(this.RValue,t,this.LanguageID))):this.Text=Le.FormatValueString(this.Value,t,this.LanguageID);return!0},this.GetExtendPaintData=function(t){var e=parseInt(this.Value*Be[t]);for(var a in this.ExtendChartPaint){var i=this.ExtendChartPaint[a];if("DepthMapPaint"==i.ClassName&&i.FrameID==this.FrameID){var r=i.GetYValueByXValue(e,t);for(var n in r)this.RExtendText.push(r[n])}}}}function He(){this.newMethod=be,this.newMethod(),delete this.newMethod,this.Operator=function(){if(!Le.IsNumber(this.Value))return!1;if(!this.Data)return!1;var t=this.Value;if(t=parseInt(t.toFixed(0)),this.Data.DataOffset+t>=this.Data.Data.length)return!1;var e=this.Data.Data[this.Data.DataOffset+t];if(this.Text=Le.FormatDateString(e.Date),It.IsMinutePeriod(this.Data.Period,!0)){var a=Le.FormatTimeString(e.Time);this.Text=this.Text+"  "+a}else if(It.IsSecondPeriod(this.Data.Period)){a=Le.FormatTimeString(e.Time,"HH:MM:SS");this.Text=this.Text+"  "+a}else if(It.IsTickPeriod(this.Data.Period)){a=Le.FormatTimeString(e.Time);this.Text=this.Text+"  "+a}return!0}}function Ve(){this.newMethod=be,this.newMethod(),delete this.newMethod,this.Frame,this.Symbol,this.IsBeforeData=!1,this.Operator=function(){if(null==this.Value||isNaN(this.Value))return!1;var t=Math.abs(this.Value);t=parseInt(t.toFixed(0));var e=t;this.Frame&&this.Frame.MinuteCount&&(e=t%this.Frame.MinuteCount);var a=bi,i=a.GetTimeData(this.Symbol);if(!i)return!1;if(this.IsBeforeData){var r=[915,916,917,918,919,920,921,922,923,924,925,926,927,928,929];for(var n in i)925!=i[n]&&r.push(i[n]);i=r}e<0?e=0:e>i.length&&(e=i.length-1),this.Frame&&t>=this.Frame.XPointCount&&(e=i.length-1);var s=i[e];return this.Text=Le.FormatTimeString(s),!0}}var Ge=["日","一","二","三","四","五","六"];function ke(){this.newMethod=be,this.newMethod(),delete this.newMethod,this.Symbol,this.UpColor=Ma.UpTextColor,this.DownColor=Ma.DownTextColor,this.UnchagneColor=Ma.UnchagneTextColor,this.VolColor=Ma.DefaultTextColor,this.AmountColor=Ma.DefaultTextColor,this.LanguageID=xa.LANGUAGE_CHINESE_ID,this.LineCount=0,this.Width=157,this.Height=125,this.Operator=function(){var t=this.Value.Data;if(!t)return!1;this.Width=157,this.LanguageID==xa.LANGUAGE_ENGLISH_ID&&(this.Width=180);var e=new Date(parseInt(t.Date/1e4),t.Date/100%100-1,t.Date%100),a=Le.FormatDateString(t.Date),i=Oa.GetText(Ge[e.getDay()],this.LanguageID);It.IsMinutePeriod(this.Value.ChartPaint.Data.Period,!0)?i=Le.FormatTimeString(t.Time):It.IsSecondPeriod(this.Value.ChartPaint.Data.Period)&&(i=Le.FormatTimeString(t.Time,"HH:MM:SS"));var r=this.Symbol.toUpperCase(),n=Ui(this.Symbol),s=null;t.YClose>0&&(s=(t.Close-t.YClose)/t.YClose*100);var o="<span class='tooltip-title'>"+a+"&nbsp&nbsp"+i+"</span><span class='tooltip-con'>"+Oa.GetText("DivTooltip-Open",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.GetColor(t.Open,t.YClose)+";'>"+t.Open.toFixed(n)+"</span><br/><span class='tooltip-con'>"+Oa.GetText("DivTooltip-High",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.GetColor(t.High,t.YClose)+";'>"+t.High.toFixed(n)+"</span><br/><span class='tooltip-con'>"+Oa.GetText("DivTooltip-Low",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.GetColor(t.Low,t.YClose)+";'>"+t.Low.toFixed(n)+"</span><br/><span class='tooltip-con'>"+Oa.GetText("DivTooltip-Close",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.GetColor(t.Close,t.YClose)+";'>"+t.Close.toFixed(n)+"</span><br/><span class='tooltip-con'>"+Oa.GetText("DivTooltip-Vol",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.VolColor+";'>"+Le.FormatValueString(t.Vol,2,this.LanguageID)+"</span><br/><span class='tooltip-con'>"+Oa.GetText("DivTooltip-Amount",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.AmountColor+";'>"+Le.FormatValueString(t.Amount,2,this.LanguageID)+"</span><br/><span class='tooltip-con'>"+Oa.GetText("DivTooltip-Increase",this.LanguageID)+"</span>"+(null==s?"<span class='tooltip-num' style='color:"+this.GetColor(0,0)+";'>--</span><br/>":"<span class='tooltip-num' style='color:"+this.GetColor(s,0)+";'>"+s.toFixed(2)+"%</span><br/>");if(this.LineCount=8,Li.IsSHSZStockA(this.Symbol)&&t.FlowCapital>0){var h=t.Vol/t.FlowCapital*100;o+="<span class='tooltip-con'>"+Oa.GetText("DivTooltip-Exchange",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.AmountColor+";'>"+h.toFixed(2)+"%</span><br/>",++this.LineCount}if(Li.IsFutures(r)&&Le.IsNumber(t.Position)&&(o+="<span class='tooltip-con'>"+Oa.GetText("DivTooltip-Position",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.VolColor+";'>"+t.Position+"</span><br/>",++this.LineCount),"Overlay-KLine"==this.Value.ChartPaint.Name){var l="<span style='color:rgb(0,0,0);font:微软雅黑;font-size:12px;text-align:center;display: block;'>"+this.Value.ChartPaint.Title+"</span>";o=l+o,++this.LineCount}return this.Text=o,this.Height=25*this.LineCount,!0},this.GetColor=function(t,e){return t>e?this.UpColor:t<e?this.DownColor:this.UnchagneColor}}function Ye(){this.newMethod=be,this.newMethod(),delete this.newMethod,this.UpColor=Ma.UpTextColor,this.DownColor=Ma.DownTextColor,this.UnchagneColor=Ma.UnchagneTextColor,this.Width=500,this.Operator=function(){if(!this.Value)return!1;var t=this.Value.Data.Data,e=this.Value.Data.Type,a="";for(var i in t){var r=t[i],n="";switch(e){case dt.BLOCKTRADING:n=this.BlockTradingFormat(r);break;case dt.TRADEDETAIL:n=this.TradeDetailFormat(r);break;case dt.RESEARCH:n=this.ResearchFormat(r);break;case dt.PFORECAST:n=this.PerformanceForecastFormat(r);break;default:n=this.DefaultFormat(r);break}a+=n}var s="<div class='title-length'>"+a+"</div>";if(t.length>8){var o="<div class='total-list'>共"+t.length+"条</div>";s+=o}return this.Text=s,!0},this.DefaultFormat=function(t){var e=Le.FormatDateString(t.Date),a="<span>"+e+"&nbsp;&nbsp;&nbsp;"+t.Title+"</span>";return a},this.BlockTradingFormat=function(t){var e=t.ExtendData,a=Le.FormatDateString(t.Date),i="<span><i class='date-tipbox'>"+a+"</i>&nbsp;&nbsp;<i class='tipBoxTitle'>成交价:&nbsp;"+e.Price.toFixed(2)+"</i><i class='tipBoxTitle'>收盘价:&nbsp;"+e.ClosePrice.toFixed(2)+"</i><br/><i class='rate-discount tipBoxTitle'>溢折价率:&nbsp;<strong style='color:"+this.GetColor(e.Premium.toFixed(2))+"'>"+e.Premium.toFixed(2)+"%</strong></i><i class='tipBoxTitle'>成交量(万股):&nbsp;"+e.Vol.toFixed(2)+"</i></span>";return i},this.TradeDetailFormat=function(t){var e=t.ExtendData.Detail,a=Le.FormatDateString(t.Date),i=[];for(var r in e)i+="<i>"+e[r].TypeExplain+"</i><br/>";var n="<span><i class='trade-time'>"+a+"&nbsp;&nbsp;&nbsp;上榜原因:&nbsp;&nbsp;</i><i class='reason-list'>"+i+"</i><br/><i class='trade-detall'>一周后涨幅:&nbsp;<strong style='color:"+this.GetColor(t.ExtendData.FWeek.Week1.toFixed(2))+"'>"+t.ExtendData.FWeek.Week1.toFixed(2)+"%</strong>&nbsp;&nbsp;&nbsp;四周后涨幅:&nbsp;<strong style='color:"+this.GetColor(t.ExtendData.FWeek.Week4.toFixed(2))+";'>"+t.ExtendData.FWeek.Week4.toFixed(2)+"%</strong></i></span>";return n},this.ResearchFormat=function(t){var e=t.ExtendData.Level,a="";if(0==e.length)a="<i>一般调研</i>";else{for(var i in e)0==e[i]?a+="<i style='color:#00a0e9'>证券代表&nbsp;&nbsp;&nbsp;</i>":1==e[i]?a+="<i>董秘&nbsp;&nbsp;&nbsp;</i>":2==e[i]?a+="<i style='color:#00a0e9'>总经理&nbsp;&nbsp;&nbsp;</i>":3==e[i]&&(a+="<i style='color:#00a0e9'>董事长&nbsp;&nbsp;&nbsp;</i>");a="接待:&nbsp;&nbsp;&nbsp;"+a}var r="";t.ExtendData.Type&&"其他"!=t.ExtendData.Type&&(r="&nbsp;&nbsp;&nbsp;<i>"+t.ExtendData.Type+"</i>",0==e.length&&(a=""));var n=Le.FormatDateString(t.Date),s="<span>"+n+"&nbsp;&nbsp;&nbsp;"+r+a+"</span>";return s},this.PerformanceForecastFormat=function(t){var e,a=t.ExtendData.ReportDate,i=parseInt(a/1e4),r=a%1e4;1231==r?e="年报":331==r?e="一季度报":630==r?e="半年度报":930==r&&(e="三季度报");var n="";t.ExtendData.FWeek&&(null!=t.ExtendData.FWeek.Week1&&(n+="一周后涨幅:<i class='increase' style='color:"+this.GetColor(t.ExtendData.FWeek.Week1.toFixed(2))+"'>"+t.ExtendData.FWeek.Week1.toFixed(2)+"%</i>"),null!=t.ExtendData.FWeek.Week4&&(n+="&nbsp;四周后涨幅:<i class='increase' style='color:"+this.GetColor(t.ExtendData.FWeek.Week4.toFixed(2))+"'>"+t.ExtendData.FWeek.Week4.toFixed(2)+"%</i>"),n.length>0&&(n="<br/>&nbsp;&nbsp;<i class='prorecast-week'>"+n+"</i>"));var s=Le.FormatDateString(t.Date),o="<span>"+s+"&nbsp;&nbsp;"+i+e+t.Title+"&nbsp;"+n+"</span>";return o},this.GetColor=function(t){return t>0?this.UpColor:t<0?this.DownColor:this.UnchagneColor}}function Ue(){this.newMethod=be,this.newMethod(),delete this.newMethod,this.Width=100,this.Operator=function(){var t=this.Value.Data;if(!t)return!1;var e,a=t.Data,i="<span class='tooltip-index-name'>"+a.Name+a.Param+":</span>";return e=1==a.Type?"<span class='tooltip-index-buy'>买入</span>":"<span class='tooltip-index-sell'>卖出</span>",this.Text=i+e,!0}}function We(){this.newMethod=be,this.newMethod(),delete this.newMethod,this.Width=200,this.Operator=function(){var t=this.Value.Data;if(!t)return!1;var e=t.Data.Item,a=Le.FormatTimeString(e.Time),i="<span class='tooltip-minuteinfo-time'>"+a+" </span>",r="<span class='tooltip-minuteinfo-content'>"+e.Title+"</span>";return e.Content&&(r="<span class='tooltip-minuteinfo-content'>"+e.Content+"</span>"),this.Text=i+r,!0}}function Xe(){this.DataMap=new g.default([["KLineTradeDataStringFormat",{Create:function(){return new Ue}}],["MinuteInfoDataStringFormat",{Create:function(){return new We}}],["HistoryDataStringFormat",{Create:function(){return new ke}}],["KLineInfoDataStringFormat",{Create:function(){return new Ye}}],["CorssCursor_XStringFormat",{Create:function(){return new He}}],["CorssCursor_YStringFormat",{Create:function(){return new _e}}]]),this.Create=function(t){if(!this.DataMap.has(t))return null;var e=this.DataMap.get(t);return e.Create()}}var Ke=new Xe;function Je(){this.Frame,this.Data=new Array,this.Canvas,this.IsDynamic=!1,this.Position=0,this.CursorIndex,this.Font=Ma.TitleFont,this.Title,this.TitleColor=Ma.DefaultTextColor,this.ClassName="IChartTitlePainting",this.ReloadResource=function(){this.Font=Ma.TitleFont,this.TitleColor=Ma.DefaultTextColor}}var ze=["不复权","前复权","后复权"];function qe(){this.newMethod=Je,this.newMethod(),delete this.newMethod,this.ClassName="DynamicKLineTitlePainting",this.IsDynamic=!0,this.IsShow=!0,this.Period,this.UpColor=Ma.UpTextColor,this.DownColor=Ma.DownTextColor,this.UnchagneColor=Ma.UnchagneTextColor,this.VolColor=Ma.DefaultTextColor,this.AmountColor=Ma.DefaultTextColor,this.DateTimeColor=Ma.DefaultTextColor,this.NameColor=Ma.DefaultTextColor,this.Symbol,this.Name,this.SpaceWidth=2*V(),this.OverlayChartPaint,this.IsShowName=!0,this.IsShowSettingInfo=!0,this.IsShowDateTime=!0,this.LanguageID=xa.LANGUAGE_CHINESE_ID,this.OnDrawEvent,this.ReloadResource=function(){this.Font=Ma.TitleFont,this.TitleColor=Ma.DefaultTextColor,this.UpColor=Ma.UpTextColor,this.DownColor=Ma.DownTextColor,this.UnchagneColor=Ma.UnchagneTextColor,this.VolColor=Ma.DefaultTextColor,this.AmountColor=Ma.DefaultTextColor,this.DateTimeColor=Ma.DefaultTextColor,this.NameColor=Ma.DefaultTextColor},this.GetCurrentKLineData=function(){if(null==this.CursorIndex||!this.Data)return null;if(this.Data.length<=0)return null;var t=this.CursorIndex;t=parseInt(t.toFixed(0));var e=this.Data.DataOffset+t;if(e>=this.Data.Data.length&&(e=this.Data.Data.length-1),e<0)return null;var a=this.Data.Data[e];return a},this.DrawItem=function(t){var e=!0===this.Frame.IsHScreen,a=this.Frame.ChartBorder.GetLeft(),i=this.Frame.ChartBorder.GetTop()-this.Frame.ChartBorder.Top/2,r=(this.Frame.ChartBorder.GetRight(),Ui(this.Symbol)),n=this.Symbol.toUpperCase();if(e){if(this.Frame.ChartBorder.Right<5)return;a=2,i=this.Frame.ChartBorder.Right/2,this.Frame.ChartBorder.GetHeight();var s=this.Frame.ChartBorder.GetChartWidth(),o=this.Frame.ChartBorder.GetTop();this.Canvas.translate(s,o),this.Canvas.rotate(90*Math.PI/180)}else if(this.Frame.ChartBorder.Top<5*V())return;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font;var h={Left:a,Bottom:i,IsHScreen:e};if(!this.IsShowName||this.DrawText(this.Name,this.UnchagneColor,h)){if(this.IsShowSettingInfo){this.Canvas.fillStyle=this.NameColor;var l="";l=this.Data.Period>At&&this.Data.Period<=gt?this.Data.Period-At+Oa.GetText("自定义分钟",this.LanguageID):this.Data.Period>pt&&this.Data.Period<=Tt?this.Data.Period-pt+Oa.GetText("自定义日线",this.LanguageID):this.Data.Period>Ft&&this.Data.Period<=Et?this.Data.Period-Ft+Oa.GetText("自定义秒",this.LanguageID):Oa.GetText(It.GetPeriodName(this.Data.Period),this.LanguageID);var u=Oa.GetText(ze[this.Data.Right],this.LanguageID),C="("+l+" "+u+")",D=Li.IsSHSZStockA(this.Symbol);if(null==t.Time&&D||(C="("+l+")"),!this.DrawText(C,this.NameColor,h))return}if(this.IsShowDateTime){this.Canvas.fillStyle=this.DateTimeColor;C=Le.FormatDateString(t.Date);if(!this.DrawText(C,this.DateTimeColor,h))return}if(It.IsMinutePeriod(this.Period,!0)&&t.Time){C=Le.FormatTimeString(t.Time);if(!this.DrawText(C,this.DateTimeColor,h))return}else if(It.IsSecondPeriod(this.Period)&&t.Time){C=Le.FormatTimeString(t.Time,"HH:MM:SS");if(!this.DrawText(C,this.DateTimeColor,h))return}var c=this.GetColor(t.Open,t.YClose);C=Oa.GetText("KTitle-Open",this.LanguageID)+t.Open.toFixed(r);if(this.DrawText(C,c,h)){c=this.GetColor(t.High,t.YClose),C=Oa.GetText("KTitle-High",this.LanguageID)+t.High.toFixed(r);if(this.DrawText(C,c,h)){c=this.GetColor(t.Low,t.YClose),C=Oa.GetText("KTitle-Low",this.LanguageID)+t.Low.toFixed(r);if(this.DrawText(C,c,h)){c=this.GetColor(t.Close,t.YClose),C=Oa.GetText("KTitle-Close",this.LanguageID)+t.Close.toFixed(r);if(this.DrawText(C,c,h)){if(t.YClose>0){var f=(t.Close-t.YClose)/t.YClose*100;c=this.GetColor(f,0),C=Oa.GetText("KTitle-Increase",this.LanguageID)+f.toFixed(2)+"%";if(!this.DrawText(C,c,h))return}C=Oa.GetText("KTitle-Vol",this.LanguageID)+Le.FromatIntegerString(t.Vol,2,this.LanguageID);if(this.DrawText(C,this.VolColor,h)){if(Le.IsNumber(t.Amount)){C=Oa.GetText("KTitle-Amount",this.LanguageID)+Le.FormatValueString(t.Amount,2,this.LanguageID);if(!this.DrawText(C,this.AmountColor,h))return}if(Li.IsSHSZStockA(this.Symbol)&&t.FlowCapital>0){f=t.Vol/t.FlowCapital*100,C=Oa.GetText("KTitle-Exchange",this.LanguageID)+Le.FormatValueString(f,2,this.LanguageID)+"%";if(!this.DrawText(C,this.AmountColor,h))return}if(Li.IsFutures(n)&&Le.IsNumber(t.Position)){C=Oa.GetText("KTitle-Position",this.LanguageID)+t.Position;if(!this.DrawText(C,this.AmountColor,h))return}for(var d in this.OverlayChartPaint){t=this.OverlayChartPaint[d];if(t.Symbol&&t.Title){var m=t.Title,v=t.Color;C="["+m+"]";if(!this.DrawText(C,v,h))return}}}}}}}}},this.Draw=function(){if(this.IsShow)if(null==this.CursorIndex||!this.Data||this.Data.length<=0)this.OnDrawEventCallback(null);else{this.Canvas.font=this.Font,this.SpaceWidth=this.Canvas.measureText("0").width;var t=this.CursorIndex;t=parseInt(t.toFixed(0));var e=this.Data.DataOffset+t;if(e>=this.Data.Data.length&&(e=this.Data.Data.length-1),e<0)this.OnDrawEventCallback(null);else{var a=this.Data.Data[e];this.OnDrawEventCallback(a),this.Canvas.save(),this.DrawItem(a),this.Canvas.restore()}}},this.OnDrawEventCallback=function(t){if(this.OnDrawEvent&&this.OnDrawEvent.Callback){var e={Draw:t,Name:this.ClassName};this.OnDrawEvent.Callback(this.OnDrawEvent,e,this)}},this.GetColor=function(t,e){return t>e?this.UpColor:t<e?this.DownColor:this.UnchagneColor},this.DrawText=function(t,e,a){if(!t)return!0;var i=!0===this.Frame.IsHScreen,r=this.Frame.ChartBorder.GetRight();i&&(r=this.Frame.ChartBorder.GetHeight()),this.Canvas.fillStyle=e;var n=this.Canvas.measureText(t).width;return!(a.Left+n>r)&&(this.Canvas.fillText(t,a.Left,a.Bottom,n),a.Left+=n+this.SpaceWidth,!0)}}function Ze(){this.newMethod=qe,this.newMethod(),delete this.newMethod,this.ClassName="DynamicMinuteTitlePainting",this.SpaceWidth=1*V(),this.YClose,this.IsShowDate=!1,this.IsShowName=!0,this.OverlayChartPaint,this.LanguageID=xa.LANGUAGE_CHINESE_ID,this.LastShowData,this.OnDrawEvent,this.GetCurrentKLineData=function(){if(this.LastShowData)return this.LastShowData;if(null==this.CursorIndex||!this.Data)return null;if(this.Data.length<=0)return null;var t=Math.abs(this.CursorIndex);t=parseInt(t.toFixed(0));var e=this.Data.DataOffset+t;if(e>=this.Data.Data.length&&(e=this.Data.Data.length-1),e<0)return null;var a=this.Data.Data[e];return a},this.DrawItem=function(t){var e=!0===this.Frame.IsHScreen,a=this.Frame.ChartBorder.GetLeft(),i=this.Frame.ChartBorder.GetTop()-this.Frame.ChartBorder.Top/2,r=(this.Frame.ChartBorder.GetRight(),Ui(this.Symbol));if(e){if(this.Frame.ChartBorder.Right<5)return;a=2,i=this.Frame.ChartBorder.Right/2,this.Frame.ChartBorder.GetHeight();var n=this.Frame.ChartBorder.GetChartWidth(),s=this.Frame.ChartBorder.GetTop();this.Canvas.translate(n,s),this.Canvas.rotate(90*Math.PI/180)}else if(this.Frame.ChartBorder.Top<5)return;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font;var o={Left:a,Bottom:i,IsHScreen:e};if(!this.IsShowName||this.DrawText(this.Name,this.NameColor,o)){var h=Le.FormatDateTimeString(t.DateTime,this.IsShowDate);if(this.DrawText(h,this.DateTimeColor,o)){var l=t.Close,u=t.Increase,C=t.Vol,D=t.Amount;if(t.Before&&(l=t.Before.Close,u=t.Before.Increase,C=t.Before.Vol,D=t.Before.Amount),l){var c=this.GetColor(l,this.YClose);h=Oa.GetText("MTitle-Close",this.LanguageID)+l.toFixed(r);if(!this.DrawText(h,c,o))return}if(null!=u){c=this.GetColor(u,0),h=Oa.GetText("MTitle-Increase",this.LanguageID)+u.toFixed(2)+"%";if(!this.DrawText(h,c,o))return}var f=!0,d=this.Symbol.toUpperCase();if(Li.IsET(d)&&!Li.IsETShowAvPrice(d)&&(f=!1),t.AvPrice&&f){c=this.GetColor(t.AvPrice,this.YClose),h=Oa.GetText("MTitle-AvPrice",this.LanguageID)+t.AvPrice.toFixed(r);if(!this.DrawText(h,c,o))return}h=Oa.GetText("MTitle-Vol",this.LanguageID)+Le.FromatIntegerString(C,2);if(this.DrawText(h,this.VolColor,o)){if(Le.IsNumber(D)){h=Oa.GetText("MTitle-Amount",this.LanguageID)+Le.FormatValueString(D,2);if(!this.DrawText(h,this.AmountColor,o))return}if(Le.IsNumber(t.Position)){h=Oa.GetText("MTitle-Position",this.LanguageID)+Le.FromatIntegerString(t.Position,2);if(!this.DrawText(h,this.VolColor,o))return}for(var m in this.OverlayChartPaint){t=this.OverlayChartPaint[m];if(t.Symbol&&t.Title){var v=t.Title,S=t.Color;h="["+v+"]";if(!this.DrawText(h,S,o))return}}}}}},this.Draw=function(){if(this.LastShowData=null,this.IsShow)if(null==this.CursorIndex||!this.Data||!this.Data.Data||this.Data.Data.length<=0)this.OnDrawEventCallback(null);else{this.Canvas.font=this.Font,this.SpaceWidth=this.Canvas.measureText("0").width;var t=this.CursorIndex;t=parseInt(t.toFixed(0));var e=t+this.Data.DataOffset;e>=this.Data.Data.length&&(e=this.Data.Data.length-1);var a=this.Data.Data[e];this.LastShowData=a,this.Canvas.save(),this.OnDrawEventCallback(a),this.DrawItem(a),this.Canvas.restore()}}}var Qe={DEFAULT:1,ORIGINAL:2,INTEGER:3,THOUSANDS:21};function je(t,e,a){this.Data=t,this.Name=e,this.Color=a,this.DataType,this.StringFormat=Qe.DEFAULT,this.FloatPrecision=2}function $e(){this.newMethod=Je,this.newMethod(),delete this.newMethod,this.ClassName="DynamicChartTitlePainting",this.IsDynamic=!0,this.Data=new Array,this.Explain,this.ColorIndex,this.IsShowColorIndexTitle=!0,this.IsShowUpDownArrow=!0,this.IsShowIndexName=!0,this.TradeIndex,this.IsShowTradeIndexTitle=!0,this.OverlayIndex=new g.default,this.LanguageID=xa.LANGUAGE_CHINESE_ID,this.TitleRect,this.IsDrawTitleBG=!1,this.BGColor=Ma.IndexTitleBGColor,this.OnDrawEvent,this.ParamSpace=2,this.IsKLineFrame=!1,this.IsClickTitle=function(t,e){return!!this.TitleRect&&(t>this.TitleRect.Left&&t<this.TitleRect.Left+this.TitleRect.Width&&e>this.TitleRect.Top&&e<this.TitleRect.Top+this.TitleRect.Height)},this.FormatValue=function(t,e){return e.StringFormat==Qe.DEFAULT?Le.FormatValueString(t,e.FloatPrecision,this.LanguageID):e.StringFormat==Qe.THOUSANDS?Le.FormatValueThousandsString(t,e.FloatPrecision):e.StringFormat==Qe.ORIGINAL?t.toFixed(e.FloatPrecision).toString():e.StringFormat==Qe.INTEGER?Le.FromatIntegerString(t,e.FloatPrecision,this.LanguageID):void 0},this.FormatMultiReport=function(t,e){var a="";for(var i in t){var r=t[i],n=r.Quarter,s=r.Year,o=r.Value;switch(a.length>0&&(a+=","),a+=s.toString(),n){case 1:a+="一季报 ";break;case 2:a+="半年报 ";break;case 3:a+="三季报 ";break;case 4:a+="年报 ";break}a+=this.FormatValue(o,e)}return a},this.Draw=function(){if(this.IsKLineFrame="KLineFrame"==this.Frame.ClassName||"KLineHScreenFrame"==this.Frame.ClassName,this.IsDrawTitleBG=this.Frame.IsDrawTitleBG,this.IsShowUpDownArrow=this.Frame.IsShowTitleArraw,this.IsShowIndexName=this.Frame.IsShowIndexName,this.ParamSpace=this.Frame.IndexParamSpace,this.TitleRect=null,null!=this.CursorIndex&&this.Data&&!(this.Frame.ChartBorder.TitleHeight<5)){if(!0===this.Frame.IsHScreen)return this.Canvas.save(),this.HScreenDraw(),void this.Canvas.restore();var t=this.Frame.ChartBorder.GetLeft()+1,e=this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.TitleHeight/2,a=this.Frame.ChartBorder.GetRight();if(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font,this.Title&&this.IsShowIndexName){var i=this.Canvas.measureText(this.Title).width+2;if(this.IsDrawTitleBG){var r=2*V();this.Canvas.fillStyle=this.BGColor,this.TitleRect={Left:t,Top:this.Frame.ChartBorder.GetTop()+r,Width:i,Height:this.Frame.ChartBorder.TitleHeight-2*r},this.Canvas.fillRect(this.TitleRect.Left,this.TitleRect.Top,this.TitleRect.Width,this.TitleRect.Height)}this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(this.Title,t,e,i),t+=i}var n=this.Frame.GetLockRect();if(n){var s=Math.abs(this.CursorIndex-.5);this.IsKLineFrame&&(s=this.CursorIndex);var o=this.Frame.GetXFromIndex(s.toFixed(0));if(o>=n.Left)return}for(var h in this.Data){var l=this.Data[h];if(l&&l.Data&&l.Data.Data&&l.Name&&!(l.Data.Data.length<=0)){var u=null,C=null;if("StraightLine"==l.DataType)u=l.Data.Data[0],C=this.FormatValue(u,l);else{s=Math.abs(this.CursorIndex-.5);s=parseInt(s.toFixed(0)),this.IsKLineFrame&&(s=this.CursorIndex);var D=l.Data.DataOffset+s;if(D>=l.Data.Data.length&&(D=l.Data.Data.length-1),D<0)continue;if(u=l.Data.Data[D],null==u)continue;if("HistoryData-Vol"==l.DataType)u=u.Vol,C=this.FormatValue(u,l);else if("MultiReport"==l.DataType)C=this.FormatMultiReport(u,l);else{var c=null;if(this.IsShowUpDownArrow){var f=null;D-1>=0&&(f=l.Data.Data[D-1]),Le.IsNumber(f)&&(c=f>u?"↓":f<u?"↑":"→")}C=this.FormatValue(u,l),c&&(C+=c)}}this.Canvas.fillStyle=l.Color;var d=l.Name+":"+C,m=this.ParamSpace*V();i=this.Canvas.measureText(d).width+m;this.Canvas.fillText(d,t,e,i),t+=i}}if(this.Explain){this.Canvas.fillStyle=this.TitleColor;d="说明:"+this.Explain,i=this.Canvas.measureText(d).width+2;t+i<a&&(this.Canvas.fillText(d,t,e,i),t+=i)}if(this.ColorIndex&&this.IsShowColorIndexTitle){this.Canvas.fillStyle=Ma.Title.ColorIndexColor;var v=this.ColorIndex.Name+this.ColorIndex.Param;i=this.Canvas.measureText(v).width+2;this.Canvas.fillText(v,t,e,i),t+=i}if(this.TradeIndex&&this.IsShowTradeIndexTitle){this.Canvas.fillStyle=Ma.Title.TradeIndexColor;v=this.TradeIndex.Name+this.TradeIndex.Param,i=this.Canvas.measureText(v).width+2;this.Canvas.fillText(v,t,e,i),t+=i}this.DrawOverlayIndex(t+10*V())}},this.DrawOverlayIndex=function(t){var e=this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.TitleHeight/2,a=this.Frame.ChartBorder.GetRight();if(!0===this.Frame.IsHScreen&&(e=-this.Frame.ChartBorder.TitleHeight/2,a=this.Frame.ChartBorder.GetHeight()),!(t>a)){var i=5*V(),r=t,n=!0,s=!1,o=void 0;try{for(var h,l=(0,T.default)(this.OverlayIndex);!(n=(h=l.next()).done);n=!0){c=h.value,t+=i;var u=c[1];if(u.Title){this.Canvas.fillStyle=this.TitleColor;var C=this.Canvas.measureText(u.Title).width+2;if(r=t,t+=C,t>a)break;this.Canvas.fillText(u.Title,r,e,C)}for(var D in u.Data){var c=u.Data[D];if(c&&c.Data&&c.Data.Data&&c.Name&&!(c.Data.Data.length<=0)){var f=null,d=null;if("StraightLine"==c.DataType)f=c.Data.Data[0],d=this.FormatValue(f,c);else{var m=Math.abs(this.CursorIndex-.5);m=parseInt(m.toFixed(0)),this.IsKLineFrame&&(m=this.CursorIndex);var v=c.Data.DataOffset+m;if(v>=c.Data.Data.length&&(v=c.Data.Data.length-1),v<0)continue;if(f=c.Data.Data[v],null==f)continue;"HistoryData-Vol"==c.DataType?(f=f.Vol,d=this.FormatValue(f,c)):d="MultiReport"==c.DataType?this.FormatMultiReport(f,c):this.FormatValue(f,c)}this.Canvas.fillStyle=c.Color;var S=c.Name+":"+d;C=this.Canvas.measureText(S).width+2;if(r=t,t+=C,t>a)break;this.Canvas.fillText(S,r,e,C)}}if(t>a)break}}catch(I){s=!0,o=I}finally{try{!n&&l.return&&l.return()}finally{if(s)throw o}}}},this.HScreenDraw=function(){var t=this.Frame.ChartBorder.GetRightTitle(),e=this.Frame.ChartBorder.GetTop();this.Canvas.translate(t,e),this.Canvas.rotate(90*Math.PI/180);var a=1,i=-this.Frame.ChartBorder.TitleHeight/2,r=this.Frame.ChartBorder.GetHeight();if(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font,this.Title&&this.IsShowIndexName){var n=this.Canvas.measureText(this.Title).width+2;if(this.IsDrawTitleBG){var s=2*V();this.Canvas.fillStyle=this.BGColor,this.TitleRect={Left:this.Frame.ChartBorder.GetRightTitle(),Top:this.Frame.ChartBorder.GetTop(),Width:this.Frame.ChartBorder.TitleHeight,Height:n};var o={Left:a,Top:-this.Frame.ChartBorder.TitleHeight+s,Width:n,Height:this.Frame.ChartBorder.TitleHeight-2*s};this.Canvas.fillRect(o.Left,o.Top,o.Width,o.Height)}this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(this.Title,a,i,n),a+=n}var h=this.Frame.GetLockRect();if(h){var l=Math.abs(this.CursorIndex-.5);this.IsKLineFrame&&(l=this.CursorIndex);var u=this.Frame.GetXFromIndex(l.toFixed(0));if(u>=h.Top)return}for(var C in this.Data){var D=this.Data[C];if(D&&D.Data&&D.Data.Data&&D.Name&&!(D.Data.Data.length<=0)){var c=null,f=null;if("StraightLine"==D.DataType)c=D.Data.Data[0],f=this.FormatValue(c,D);else{l=Math.abs(this.CursorIndex-.5);l=parseInt(l.toFixed(0)),this.IsKLineFrame&&(l=this.CursorIndex);var d=D.Data.DataOffset+l;if(d>=D.Data.Data.length&&(d=D.Data.Data.length-1),d<0)continue;if(c=D.Data.Data[d],null==c)continue;"HistoryData-Vol"==D.DataType?(c=c.Vol,f=this.FormatValue(c,D)):f="MultiReport"==D.DataType?this.FormatMultiReport(c,D):this.FormatValue(c,D)}this.Canvas.fillStyle=D.Color;var m=D.Name+":"+f;n=this.Canvas.measureText(m).width+2;this.Canvas.fillText(m,a,i,n),a+=n}}if(this.Explain){this.Canvas.fillStyle=this.TitleColor;m="说明:"+this.Explain,n=this.Canvas.measureText(m).width+2;a+n<r&&(this.Canvas.fillText(m,a,i,n),a+=n)}this.DrawOverlayIndex(a+5*V())},this.OnDrawEventCallback=function(t){if(this.OnDrawEvent&&this.OnDrawEvent.Callback){var e={Draw:t,Name:"DynamicChartTitlePainting"};this.OnDrawEvent.Callback(this.OnDrawEvent,e,this)}}}function ta(){this.Frame,this.Canvas,this.Point=new Array,this.Value=new Array,this.LinePoint=[],this.PointCount=2,this.Status=0,this.PointStatus=0,this.MovePointIndex=null,this.ClassName="IChartDrawPicture",this.FinishedCallback,this.Guid=Y(),this.Symbol,this.Period,this.IsSelected=!1,this.Option,this.LineColor="#1e90ff",this.LineWidth=2,this.BackupLineWidth=null,this.AreaColor="rgba(25,25,25,0.4)",this.PointColor=Ma.DrawPicture.PointColor[0],this.SetLastPoint=null,this.Update=null,this.Draw=function(){},this.SetOption=function(t){t&&(t.LineColor&&(this.LineColor=t.LineColor),t.LineWidth>0&&(this.LineWidth=t.LineWidth),t.AreaColor&&(this.AreaColor=t.AreaColor),t.PointColor&&(this.PointColor=t.PointColor))},this.SetLineWidth=function(){this.BackupLineWidth=null,this.LineWidth>0&&(this.BackupLineWidth=this.Canvas.lineWidth,this.Canvas.lineWidth=this.LineWidth*V())},this.RestoreLineWidth=function(){null!=this.BackupLineWidth&&(this.Canvas.lineWidth=this.BackupLineWidth)},this.PointToValue=function(){if(!this.Frame)return!1;var t=this.Frame.Data;if(!t)return!1;var e=this.Frame.IsHScreen;if(e)for(var a in this.Point){var i=this.Point[a],r=parseInt(this.Frame.GetXData(i.Y))+t.DataOffset,n=this.Frame.GetYData(i.X),s={XValue:r,YValue:n},o=t.Data[r];s.DateTime={Date:o.Date},Le.IsNumber(o.Time)&&(s.DateTime.Time=o.Time),this.Value[a]=s}else for(var a in this.Point){i=this.Point[a],r=parseInt(this.Frame.GetXData(i.X))+t.DataOffset,n=this.Frame.GetYData(i.Y),s={XValue:r,YValue:n},o=t.Data[r];s.DateTime={Date:o.Date},Le.IsNumber(o.Time)&&(s.DateTime.Time=o.Time),this.Value[a]=s}return!0},this.IsPointIn=function(t,e){return!1},this.ValueToPoint=function(){if(!this.Frame)return!1;var t=this.Frame.Data;if(!t)return!1;var e=this.Frame.IsHScreen;for(var a in this.Point=[],this.Value){var i=this.Value[a],r=new K;e?(r.Y=this.Frame.GetXFromIndex(i.XValue-t.DataOffset),r.X=this.Frame.GetYFromData(i.YValue)):(r.X=this.Frame.GetXFromIndex(i.XValue-t.DataOffset),r.Y=this.Frame.GetYFromData(i.YValue)),this.Point[a]=r}},this.UpdateXValue=function(){if(!this.Frame)return!1;var t=this.Frame.Data;if(!t)return!1;var e=[];for(var a in this.Value){var i=this.Value[a],r={Date:i.DateTime.Date};Le.IsNumber(i.DateTime.Time)&&(r.Time=i.DateTime.Time),e[a]=r}for(var a in t.FindDataIndexByDateTime(e),e){var n=e[a],s=this.Value[a];n.Index>=0&&(s.XValue=n.Index)}},this.Move=function(t,e){if(20!=this.Status)return fasle;if(!this.Frame)return!1;var a=this.Frame.Data;if(!a)return!1;if(null==this.MovePointIndex)return!1;var i=parseInt(this.MovePointIndex);if(100===i)for(var r in this.Point)this.Point[r].X+=t,this.Point[r].Y+=e;else{if(0!==i&&1!==i&&2!==i&&3!==i&&4!==i&&5!==i)return!1;i<this.Point.length&&(this.Point[i].X+=t,this.Point[i].Y+=e)}},this.ClipFrame=function(){if(this.Frame.IsHScreen)var t=this.Frame.ChartBorder.GetLeftEx(),e=this.Frame.ChartBorder.GetTop(),a=this.Frame.ChartBorder.GetWidthEx(),i=this.Frame.ChartBorder.GetHeight();else t=this.Frame.ChartBorder.GetLeft(),e=this.Frame.ChartBorder.GetTopEx(),a=this.Frame.ChartBorder.GetWidth(),i=this.Frame.ChartBorder.GetHeightEx();this.Canvas.save(),this.Canvas.beginPath(),this.Canvas.rect(t,e,a,i),this.Canvas.clip()},this.CalculateDrawPoint=function(t){if(this.Status<2)return null;if(!this.Point.length||!this.Frame)return null;var e=new Array;if(10==this.Status){var a=this.Frame.Data;if(!a)return null;var i=this.Frame.XPointCount,r=0,n=this.Frame.IsHScreen;for(var s in this.Value){var o=this.Value[s],h=o.XValue-a.DataOffset;(h<0||h>=i)&&++r;var l=new K;n?(l.Y=this.Frame.GetXFromIndex(o.XValue-a.DataOffset,!1),l.X=this.Frame.GetYFromData(o.YValue,!1)):(l.X=this.Frame.GetXFromIndex(o.XValue-a.DataOffset,!1),l.Y=this.Frame.GetYFromData(o.YValue,!1)),e.push(l)}if(t&&!0===t.IsCheckX&&r==this.Value.length)return null}else e=this.Point;return e},this.IsYValueInFrame=function(t){return!!this.Frame&&!(t>this.Frame.HorizontalMax||t<this.Frame.HorizontalMin)},this.DrawPoint=function(t){if(t&&!(t.length<=0)){this.ClipFrame();var e=V();for(var a in t){var i=t[a];this.Canvas.beginPath(),this.Canvas.arc(i.X,i.Y,5*e,0,360,!1),this.Canvas.fillStyle=this.PointColor,this.Canvas.fill(),this.Canvas.closePath()}this.Canvas.restore()}},this.CalculateExtendLinePoint=function(t,e){var a={},i=(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetRight(),this.Frame.ChartBorder.GetTopEx()),r=this.Frame.ChartBorder.GetBottom(),n=e.X-t.X,s=e.Y-t.Y;if(n>0){var o=r-t.Y,h=n*o/s,l=new K;l.X=t.X+h,l.Y=r,a.End=l;o=e.Y-i,h=n*o/s;var u=new K;u.Y=i,u.X=e.X-h,a.Start=u}else{o=r-t.Y,h=Math.abs(n)*o/s,l=new K;l.X=t.X-h,l.Y=r,a.End=l;o=e.Y-i,h=Math.abs(n)*o/s,u=new K;u.Y=i,u.X=e.X+h,a.Start=u}return a},this.IsPointInXYValue=function(t,e){if(!this.Frame)return-1;var a=this.Frame.Data;if(!a)return-1;if(!this.Value)return-1;var i=5;this.Option&&(i+=this.Option.Zoom);var r=this.Frame.IsHScreen;i*=V();for(var n=0;n<this.Value.length;++n){var s=this.Value[n],o=new K;if(r?(o.Y=this.Frame.GetXFromIndex(s.XValue-a.DataOffset),o.X=this.Frame.GetYFromData(s.YValue)):(o.X=this.Frame.GetXFromIndex(s.XValue-a.DataOffset),o.Y=this.Frame.GetYFromData(s.YValue)),this.Canvas.beginPath(),this.Canvas.arc(o.X,o.Y,i,0,360),this.Canvas.isPointInPath(t,e))return n}return-1},this.IsPointInLine=function(t,e){if(!this.LinePoint)return-1;var a=5;this.Option&&(a+=this.Option.Zoom);var i=V();for(var r in a*=i,this.LinePoint){var n=this.LinePoint[r],s=n.Start,o=n.End;if(this.Canvas.beginPath(),s.X==o.X?(this.Canvas.moveTo(s.X-a,s.Y),this.Canvas.lineTo(s.X+a,s.Y),this.Canvas.lineTo(o.X+a,o.Y),this.Canvas.lineTo(o.X-a,o.Y)):(this.Canvas.moveTo(s.X,s.Y+a),this.Canvas.lineTo(s.X,s.Y-a),this.Canvas.lineTo(o.X,o.Y-a),this.Canvas.lineTo(o.X,o.Y+a)),this.Canvas.closePath(),this.Canvas.isPointInPath(t,e))return r}return-1},this.IsPointIn_XYValue_Line=function(t,e){if(10!=this.Status)return-1;var a=this.IsPointInXYValue(t,e);return a>=0?a:(a=this.IsPointInLine(t,e),a>=0?100:-1)},this.DrawLine=function(t,e,a){a&&this.Canvas.setLineDash([5,10]),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.X,t.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke(),a&&this.Canvas.setLineDash([])},this.CreateLineData=function(t,e){var a={Start:new K,End:new K};return a.Start.Y=t.Y,a.Start.X=t.X,a.End.Y=e.Y,a.End.X=e.X,a},this.ExportStorageData=function(){var t={ClassName:this.ClassName,Symbol:this.Symbol,Guid:this.Guid,Period:this.Period,Value:[],FrameID:this.Frame.Identify,LineColor:this.LineColor,AreaColor:this.AreaColor};for(var e in this.Value){var a=this.Value[e];t.Value.push({XValue:a.XValue,YValue:a.YValue,DateTime:a.DateTime})}return this.Text&&(t.Text=this.Text),this.FontOption&&(t.FontOption=this.FontOption),t}}function ea(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t&&2==t.length){this.ClipFrame();var e=t[0],a=t[1];this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(e.X,e.Y),this.Canvas.lineTo(a.X,a.Y),this.Canvas.stroke(),this.RestoreLineWidth();var i={Start:e,End:a};this.LinePoint.push(i),this.DrawPoint(t),this.Canvas.restore()}}}function aa(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureHaflLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t&&2==t.length){var e=t[0],a=t[1];this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y),this.Canvas.lineTo(t[1].X,t[1].Y);var i=this.CalculateEndPoint(t);this.Canvas.lineTo(i.X,i.Y),this.Canvas.stroke(),this.RestoreLineWidth();var r={Start:e,End:a};this.LinePoint.push(r),this.DrawPoint(t),this.Canvas.restore()}},this.CalculateEndPoint=function(t){var e=this.Frame.ChartBorder.GetLeft(),a=this.Frame.ChartBorder.GetRight(),i=t[1].X-t[0].X,r=t[1].Y-t[0].Y;if(i>0){var n=a-t[0].X,s=n*r/i,o=s+t[0].Y,h=new K;return h.X=a,h.Y=o,h}n=t[0].X-e,s=n*r/Math.abs(i),o=s+t[0].Y,h=new K;return h.X=e,h.Y=o,h}}function ia(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.PointCount=1,this.ClassName="ChartDrawPictureHorizontalLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Font=16*V()+"px 微软雅黑",this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint();if(t&&1==t.length&&this.Frame&&1==this.Value.length){if(!this.IsYValueInFrame(this.Value[0].YValue))return null;var e=this.Frame.IsHScreen,a=this.Frame.ChartBorder.GetLeft(),i=this.Frame.ChartBorder.GetRight();e&&(a=this.Frame.ChartBorder.GetTop(),i=this.Frame.ChartBorder.GetBottom()),this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),e?(this.Canvas.moveTo(t[0].X,a),this.Canvas.lineTo(t[0].X,i)):(this.Canvas.moveTo(a,t[0].Y),this.Canvas.lineTo(i,t[0].Y)),this.Canvas.stroke(),this.RestoreLineWidth();var r={Start:new K,End:new K};if(e?(r.Start.X=t[0].X,r.Start.Y=a,r.End.X=t[0].X,r.End.Y=i):(r.Start.X=a,r.Start.Y=t[0].Y,r.End.X=i,r.End.Y=t[0].Y),this.LinePoint.push(r),this.DrawPoint(t),this.Canvas.fillStyle=this.LineColor,this.Canvas.font=this.Font,e){this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var n=t[0].X,s=a;this.Canvas.translate(n,s),this.Canvas.rotate(90*Math.PI/180);var o=this.Frame.GetYData(t[0].X);this.Canvas.fillText(o.toFixed(2),0,0)}else{this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";o=this.Frame.GetYData(t[0].Y);this.Canvas.fillText(o.toFixed(2),a,t[0].Y)}this.Canvas.restore()}}}function ra(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureTrendLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t&&2==t.length){var e=t[0],a=t[1],i=this.CalculateExtendLinePoint(e,a);this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),this.Canvas.moveTo(i.Start.X,i.Start.Y),this.Canvas.lineTo(i.End.X,i.End.Y),this.Canvas.stroke(),this.RestoreLineWidth();var r={Start:e,End:a};this.LinePoint.push(r),this.DrawPoint(t),this.Canvas.restore()}}}function na(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureRect",this.Draw=function(){var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});t&&2==t.length&&(this.AreaColor=ta.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),this.Canvas.rect(t[0].X,t[0].Y,t[1].X-t[0].X,t[1].Y-t[0].Y),this.Canvas.stroke(),this.RestoreLineWidth(),this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.fillRect(t[0].X,t[0].Y,t[1].X-t[0].X,t[1].Y-t[0].Y),this.Canvas.restore(),this.DrawPoint(t))},this.IsPointIn=function(t,e){if(!this.Frame||10!=this.Status)return-1;var a=this.Frame.Data;if(!a)return-1;var i=this.IsPointInXYValue(t,e);if(i>=0)return i;var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!r||2!=r.length)return-1;var n=[{X:r[0].X,Y:r[0].Y},{X:r[1].X,Y:r[0].Y}];return this.IsPointInLine(n,t,e)?100:(n=[{X:r[1].X,Y:r[0].Y},{X:r[1].X,Y:r[1].Y}],this.IsPointInLine2(n,t,e)?100:(n=[{X:r[1].X,Y:r[1].Y},{X:r[0].X,Y:r[1].Y}],this.IsPointInLine(n,t,e)?100:(n=[{X:r[0].X,Y:r[1].Y},{X:r[0].X,Y:r[0].Y}],this.IsPointInLine2(n,t,e)?100:-1)))},this.IsPointInLine=function(t,e,a){var i=5;this.Option&&(i+=this.Option.Zoom);var r=V();if(i*=r,this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y+i),this.Canvas.lineTo(t[0].X,t[0].Y-i),this.Canvas.lineTo(t[1].X,t[1].Y-i),this.Canvas.lineTo(t[1].X,t[1].Y+i),this.Canvas.closePath(),this.Canvas.isPointInPath(e,a))return!0},this.IsPointInLine2=function(t,e,a){var i=5;this.Option&&(i+=this.Option.Zoom);var r=V();if(i*=r,this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X-i,t[0].Y),this.Canvas.lineTo(t[0].X+i,t[0].Y),this.Canvas.lineTo(t[1].X+i,t[1].Y),this.Canvas.lineTo(t[1].X-i,t[1].Y),this.Canvas.closePath(),this.Canvas.isPointInPath(e,a))return!0}}function sa(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureArc",this.Draw=function(){var t=this.CalculateDrawPoint();if(t&&2==t.length){if(this.ClipFrame(),this.SetLineWidth(),t[0].X<t[1].X&&t[0].Y>t[1].Y){var e=t[1].X-t[0].X,a=t[0].Y-t[1].Y,i=e>a?1/e:1/a,r=t[0].X,n=t[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(var s=1.5*Math.PI;s<2*Math.PI;s+=i)this.Canvas.lineTo(r+e*Math.cos(s),n+a*Math.sin(s)*-1);for(var o=0;o<=.5*Math.PI;o+=i)this.Canvas.lineTo(r+e*Math.cos(o),n+a*Math.sin(o)*-1)}else if(t[0].X>t[1].X&&t[0].Y>t[1].Y){e=t[0].X-t[1].X,a=t[0].Y-t[1].Y,i=e>a?1/e:1/a,r=t[1].X,n=t[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(s=0;s<=Math.PI;s+=i)this.Canvas.lineTo(r+e*Math.cos(s),n+a*Math.sin(s)*-1)}else if(t[0].X>t[1].X&&t[0].Y<t[1].Y){e=t[0].X-t[1].X,a=t[1].Y-t[0].Y,i=e>a?1/e:1/a,r=t[0].X,n=t[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(s=.5*Math.PI;s<=1.5*Math.PI;s+=i)this.Canvas.lineTo(r+e*Math.cos(s),n+a*Math.sin(s)*-1)}else if(t[0].X<t[1].X&&t[0].Y<t[1].Y){e=t[1].X-t[0].X,a=t[1].Y-t[0].Y,i=e>a?1/e:1/a,r=t[1].X,n=t[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(s=Math.PI;s<=2*Math.PI;s+=i)this.Canvas.lineTo(r+e*Math.cos(s),n+a*Math.sin(s)*-1)}this.Canvas.strokeStyle=this.LineColor,this.Canvas.stroke(),this.RestoreLineWidth(),this.Canvas.restore(),this.DrawPoint(t)}},this.IsPointIn=function(t,e){if(!this.Frame||10!=this.Status)return-1;var a=this.Frame.Data;if(!a)return-1;var i=this.IsPointInXYValue(t,e);if(i>=0)return i;var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!r||2!=r.length)return-1;var n=[{X:r[0].X,Y:r[0].Y},{X:r[1].X,Y:r[1].Y}];return this.IsPointInArc(n,t,e)?100:-1},this.IsPointInArc=function(t,e,a){if(2!=t.length)return!1;if(t[0].X<t[1].X&&t[0].Y>t[1].Y){var i=t[1].X-t[0].X,r=t[0].Y-t[1].Y,n=i>r?1/i:1/r,s=.8*i,o=.8*r,h=s>o?1/s:1/o,l=t[0].X,u=t[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(var C=1.5*Math.PI;C<2*Math.PI;C+=n)this.Canvas.lineTo(l+i*Math.cos(C),u+r*Math.sin(C)*-1);for(var D=0;D<=.5*Math.PI;D+=n)this.Canvas.lineTo(l+i*Math.cos(D),u+r*Math.sin(D)*-1);for(var c=.5*Math.PI;c>=0;c-=h)this.Canvas.lineTo(l+s*Math.cos(c),u+o*Math.sin(D)*-1);for(var f=2*Math.PI;f>=1.5*Math.PI;f-=h)this.Canvas.lineTo(l+s*Math.cos(f),u+o*Math.sin(f)*-1);this.Canvas.closePath()}else if(t[0].X>t[1].X&&t[0].Y>t[1].Y){i=t[0].X-t[1].X,r=t[0].Y-t[1].Y,n=i>r?1/i:1/r,s=.8*i,o=.8*r,h=s>o?1/s:1/o,l=t[1].X,u=t[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(C=0;C<=Math.PI;C+=n)this.Canvas.lineTo(l+i*Math.cos(C),u+r*Math.sin(C)*-1);for(D=Math.PI;D>=0;D-=h)this.Canvas.lineTo(l+s*Math.cos(D),u+o*Math.sin(D)*-1);this.Canvas.closePath()}else if(t[0].X>t[1].X&&t[0].Y<t[1].Y){i=t[0].X-t[1].X,r=t[1].Y-t[0].Y,n=i>r?1/i:1/r,s=.8*i,o=.8*r,h=s>o?1/s:1/o,l=t[0].X,u=t[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(C=.5*Math.PI;C<=1.5*Math.PI;C+=n)this.Canvas.lineTo(l+i*Math.cos(C),u+r*Math.sin(C)*-1);for(D=1.5*Math.PI;D>=.5*Math.PI;D-=h)this.Canvas.lineTo(l+s*Math.cos(D),u+o*Math.sin(D)*-1);this.Canvas.closePath()}else if(t[0].X<t[1].X&&t[0].Y<t[1].Y){i=t[1].X-t[0].X,r=t[1].Y-t[0].Y,n=i>r?1/i:1/r,s=.8*i,o=.8*r,h=s>o?1/s:1/o,l=t[1].X,u=t[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(C=Math.PI;C<=2*Math.PI;C+=n)this.Canvas.lineTo(l+i*Math.cos(C),u+r*Math.sin(C)*-1);for(D=2*Math.PI;D>=Math.PI;D-=h)this.Canvas.lineTo(l+s*Math.cos(D),u+o*Math.sin(D)*-1);this.Canvas.closePath()}return!!this.Canvas.isPointInPath(e,a)}}function oa(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureWaveMW",this.PointCount=2,this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t){for(var e in this.AreaColor=ta.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.CalculateLines(t),this.SetLineWidth(),this.LinePoint){var a=this.LinePoint[e];this.DrawLine(a.Start,a.End)}this.RestoreLineWidth(),this.DrawPoint(t),this.Canvas.restore()}},this.CalculateLines=function(t){if(this.Frame&&!(t.length<2))if(2==this.Status){var e={Start:new K,End:new K};e.Start.Y=t[0].Y,e.Start.X=t[0].X,e.End.Y=t[1].Y,e.End.X=t[1].X,this.LinePoint.push(e);var a=t[1].X-t[0].X;e={Start:new K,End:new K},e.Start.Y=t[1].Y,e.Start.X=t[1].X,e.End.Y=t[0].Y,e.End.X=t[1].X+a,this.LinePoint.push(e);var i=e.End,r=new K;r.X=i.X,r.Y=i.Y,this.Point[2]=r,e={Start:new K,End:new K},e.Start.Y=i.Y,e.Start.X=i.X,e.End.Y=t[1].Y,e.End.X=i.X+a,this.LinePoint.push(e);i=e.End,r=new K;r.X=i.X,r.Y=i.Y,this.Point[3]=r,e={Start:new K,End:new K},e.Start.Y=i.Y,e.Start.X=i.X,e.End.Y=t[0].Y,e.End.X=i.X+a,this.LinePoint.push(e);i=e.End,r=new K;r.X=i.X,r.Y=i.Y,this.Point[4]=r,this.PointCount=this.Point.length}else if(5==t.length){e={Start:new K,End:new K};e.Start.Y=t[0].Y,e.Start.X=t[0].X,e.End.Y=t[1].Y,e.End.X=t[1].X,this.LinePoint.push(e);e={Start:new K,End:new K};e.Start.Y=t[1].Y,e.Start.X=t[1].X,e.End.Y=t[2].Y,e.End.X=t[2].X,this.LinePoint.push(e);e={Start:new K,End:new K};e.Start.Y=t[2].Y,e.Start.X=t[2].X,e.End.Y=t[3].Y,e.End.X=t[3].X,this.LinePoint.push(e);e={Start:new K,End:new K};e.Start.Y=t[3].Y,e.Start.X=t[3].X,e.End.Y=t[4].Y,e.End.X=t[4].X,this.LinePoint.push(e)}}}function ha(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureParallelLines",this.IsPointIn=this.IsPointIn_XYValue_Line,this.PointCount=3,this.LastPoint,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t){this.AreaColor=ta.ColorToRGBA(this.LineColor,.3);var e=t.slice(0);for(var a in this.CalculateLines(e),this.ClipFrame(),this.LinePoint){var i=this.LinePoint[a];this.DrawLine(i.Start,i.End)}this.DrawArea(),this.DrawPoint(e),this.Canvas.restore()}},this.SetLastPoint=function(t){this.LastPoint={X:t.X,Y:t.Y}},this.DrawArea=function(){2==this.LinePoint.length&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[1].Start.X,this.LinePoint[1].Start.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(t){if(2==this.PointStatus&&this.LastPoint){var e=new K;e.X=this.LastPoint.X,e.Y=this.LastPoint.Y,t[2]=e}if(2==t.length){var a=this.CalculateExtendLinePoint(t[0],t[1]);this.LinePoint.push(a)}else if(3==t.length){a=this.CalculateExtendLinePoint(t[0],t[1]);this.LinePoint.push(a);var i=t[2].X-t[1].X,r=t[2].Y-t[1].Y,n=new K,s=new K;n.X=t[0].X+i,n.Y=t[0].Y+r,s.X=t[1].X+i,s.Y=t[1].Y+r,a=this.CalculateExtendLinePoint(n,s),this.LinePoint.push(a)}}}function la(){this.newMethod=ha,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPicturePriceChannel",this.CalculateLines=function(t){if(2==this.PointStatus&&this.LastPoint){var e=new K;e.X=this.LastPoint.X,e.Y=this.LastPoint.Y,t[2]=e}if(2==t.length){var a=this.CalculateExtendLinePoint(t[0],t[1]);this.LinePoint.push(a)}else if(3==t.length){a=this.CalculateExtendLinePoint(t[0],t[1]);this.LinePoint.push(a);var i=t[2].X-t[1].X,r=t[2].Y-t[1].Y,n=new K,s=new K;n.X=t[0].X+i,n.Y=t[0].Y+r,s.X=t[1].X+i,s.Y=t[1].Y+r,a=this.CalculateExtendLinePoint(n,s),this.LinePoint.push(a);n=new K,s=new K;n.X=t[0].X-i,n.Y=t[0].Y-r,s.X=t[1].X-i,s.Y=t[1].Y-r,a=this.CalculateExtendLinePoint(n,s),this.LinePoint.push(a)}},this.DrawArea=function(){3==this.LinePoint.length&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[1].Start.X,this.LinePoint[1].Start.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[2].End.X,this.LinePoint[2].End.Y),this.Canvas.lineTo(this.LinePoint[2].Start.X,this.LinePoint[2].Start.Y),this.Canvas.closePath(),this.Canvas.fill())}}function ua(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureParallelChannel",this.ChannelWidth=50,this.AreaColor="rgba(25,25,25,0.4)",this.LinePoint=[],this.CalculateDrawPoint=function(){if(this.Status<2)return null;if(!this.Point.length||!this.Frame)return null;var t=this.Frame.Data;if(!t)return null;var e=[];if(10==this.Status)for(var a=0;a<2;++a){var i=this.Value[a],r=new K;r.X=this.Frame.GetXFromIndex(i.XValue-t.DataOffset),r.Y=this.Frame.GetYFromData(i.YValue),e.push(r)}else for(a=0;a<this.Point.length;++a){i=this.Point[a],r=new K;r.X=i.X,r.Y=i.Y,e.push(r)}if(e.length>=2){var n={Start:new K,End:new K};if(n.Start.X=e[0].X,n.Start.Y=e[0].Y,n.End.X=e[1].X,n.End.Y=e[1].Y,this.LinePoint.push(n),3==e.length||10==this.Status){var s=n.End.X-n.Start.X,o=n.End.Y-n.Start.Y,h=Math.atan(Math.abs(s/o)),l=this.ChannelWidth/Math.sin(h);n={Start:new K,End:new K},n.Start.X=e[0].X,n.Start.Y=e[0].Y-l,n.End.X=e[1].X,n.End.Y=e[1].Y-l,this.LinePoint.push(n);var u=new K;u.X=n.Start.X+(n.End.X-n.Start.X)/2,u.Y=n.Start.Y+(n.End.Y-n.Start.Y)/2,e[3]=u,this.Point[2]=u;var C=parseInt(this.Frame.GetXData(u.X))+t.DataOffset,D=this.Frame.GetYData(u.Y);this.Value[2]={XValue:C,YValue:D},this.PointCount=this.Point.length}}return e},this.DrawLine=function(t,e){this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.X,t.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke()},this.DrawArea=function(t,e,a,i){this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.X,t.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.lineTo(a.X,a.Y),this.Canvas.lineTo(i.X,i.Y),this.Canvas.closePath(),this.Canvas.fill()},this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint();if(t){for(var e in this.AreaColor=ta.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.LinePoint){var a=this.LinePoint[e];this.DrawLine(a.Start,a.End)}2==this.LinePoint.length&&this.DrawArea(this.LinePoint[0].Start,this.LinePoint[0].End,this.LinePoint[1].End,this.LinePoint[1].Start),this.Canvas.restore(),this.DrawPoint(t)}},this.Move=function(t,e){if(20!=this.Status)return fasle;if(!this.Frame)return!1;var a=this.Frame.Data;if(!a)return!1;if(100==this.MovePointIndex)for(var i in this.Point)this.Point[i].X+=t,this.Point[i].Y+=e;else if(0==this.MovePointIndex||1==this.MovePointIndex)this.MovePointIndex<this.Point.length&&(this.Point[this.MovePointIndex].X+=t,this.Point[this.MovePointIndex].Y+=e);else if(2==this.MovePointIndex){this.Point[this.MovePointIndex].X+=t,this.Point[this.MovePointIndex].Y+=e;var r=this.Point[1].X-this.Point[0].X,n=this.Point[1].Y-this.Point[0].Y,s=Math.atan(Math.abs(r/n)),o=this.ChannelWidth/Math.sin(s)-e;this.ChannelWidth=Math.sin(s)*o}},this.IsPointIn=function(t,e){if(!this.Frame||10!=this.Status)return-1;var a=this.Frame.Data;if(!a)return-1;for(var i=0;i<this.Value.length;++i){var r=this.Value[i],n=new K;if(i<2)n.X=this.Frame.GetXFromIndex(r.XValue-a.DataOffset),n.Y=this.Frame.GetYFromData(r.YValue);else{if(i>=this.Point.length)continue;n.X=this.Point[i].X,n.Y=this.Point[i].Y}if(this.Canvas.beginPath(),this.Canvas.arc(n.X,n.Y,5,0,360),this.Canvas.isPointInPath(t,e))return i}for(var i in this.LinePoint){r=this.LinePoint[i];var s=r.Start,o=r.End;if(this.Canvas.beginPath(),this.Canvas.moveTo(s.X,s.Y+5),this.Canvas.lineTo(s.X,s.Y-5),this.Canvas.lineTo(o.X,o.Y-5),this.Canvas.lineTo(o.X,o.Y+5),this.Canvas.closePath(),this.Canvas.isPointInPath(t,e))return 100}return-1}}function Ca(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureText",this.Text="文本",this.PointCount=1,this.FontOption={Family:"微软雅黑",Size:20,Weight:null,Style:null},this.TextRect=null,this.IsInitialized=!1,this.SettingMenu,this.HQChart,this.Draw=function(t){this.TextRect=null;var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e&&1==e.length){this.ClipFrame(),this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.Canvas.font=this.GetTextFont(),this.Canvas.fillText(this.Text,e[0].X,e[0].Y);var a=this.Canvas.measureText(this.Text).width,i=this.FontOption.Size*V();this.TextRect={},this.TextRect.Left=e[0].X-a/2,this.TextRect.Top=e[0].Y-i,this.TextRect.Width=a,this.TextRect.Height=i,this.Canvas.restore(),!1===this.IsInitialized&&(this.SetTextOption(),this.IsInitialized=!0)}},this.GetTextFont=function(){var t=16*V()+"px 微软雅黑";if(!this.FontOption||!this.FontOption.Family||this.FontOption.Size<=0)return t;var e="";return this.FontOption.Color&&(e+=this.FontOption.Color+" "),this.FontOption.Style&&(e+=this.FontOption.Style+" "),this.FontOption.Weight&&(e+=this.FontOption.Weight+" "),this.FontOption.Size>=0&&(e+=this.FontOption.Size*V()+"px "),e+=this.FontOption.Family,e},this.SetTextOption=function(){M.Chart.Log("[ChartDrawPictureText::SetTextOption]"),this.SettingMenu||(this.SettingMenu=new Ei(this.Frame.ChartBorder.UIElement.parentNode)),this.SettingMenu.ChartPicture=this,this.SettingMenu.HQChart=this.HQChart,this.SettingMenu.Position={Left:this.TextRect.Left+this.TextRect.Width,Top:this.TextRect.Top},this.SettingMenu.DoModal()},this.IsPointIn=function(t,e){if(!this.Frame||10!=this.Status)return-1;var a=this.Frame.Data;return a&&this.TextRect?(this.Canvas.beginPath(),this.Canvas.rect(this.TextRect.Left,this.TextRect.Top,this.TextRect.Width,this.TextRect.Height),this.Canvas.isPointInPath(t,e)?100:-1):-1}}function Da(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureIconFont",this.PointCount=1,this.Text="",this.FontOption={Family:"iconfont",Size:24},this.TextRect=null,this.SettingMenu,this.Draw=function(){this.TextRect=null;var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t&&1==t.length){var e=this.GetTextFont();if(e){this.ClipFrame();var a=this.Frame.IsHScreen,i=V();this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.Canvas.font=e,a?(this.Canvas.translate(t[0].X,t[0].Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.Text,0,0)):this.Canvas.fillText(this.Text,t[0].X,t[0].Y);var r=this.Canvas.measureText(this.Text).width;this.TextRect={},this.TextRect.Left=t[0].X-r/2,this.TextRect.Top=t[0].Y-this.FontOption.Size*i,this.TextRect.Width=r,this.TextRect.Height=this.FontOption.Size*i,this.Canvas.restore()}}},this.GetTextFont=function(){if(!this.FontOption||!this.FontOption.Family||this.FontOption.Size<=0)return null;var t="";return this.FontOption.Size>=0&&(t+=this.FontOption.Size*V()+"px "),t+=this.FontOption.Family,t},this.IsPointIn=function(t,e){if(!this.Frame||10!=this.Status)return-1;var a=this.Frame.Data;if(!a)return-1;if(!this.TextRect)return-1;var i=0;return this.Option&&this.Option.Zoom>=1&&(i=this.Option.Zoom*V()),this.Canvas.beginPath(),this.Canvas.rect(this.TextRect.Left-i,this.TextRect.Top-i,this.TextRect.Width+2*i,this.TextRect.Height+2*i),this.Canvas.isPointInPath(t,e)?100:-1}}function ca(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureGannFan",this.IsPointIn=this.IsPointIn_XYValue_Line,this.LinePoint=[],this.Font=16*V()+"px 微软雅黑",this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t&&2==t.length){this.AreaColor=ta.ColorToRGBA(this.LineColor,.3),this.ClipFrame();var e=this.GetQuadrant(t[0],t[1]);if(this.SetLineWidth(),1===e||4===e){for(var a in this.CalculateLines(t[0],t[1],e),this.DrawArea(),this.LinePoint){var i=this.LinePoint[a];this.DrawLine(i.Start,i.End,i.IsDottedLine)}for(var a in this.LinePoint){i=this.LinePoint[a];i.Text&&i.PtEnd&&this.DrawTitle(i.PtEnd,i.Text)}}else this.DrawLine(t[0],t[1],!1);this.RestoreLineWidth(),this.Canvas.restore(),this.DrawPoint(t)}},this.GetQuadrant=function(t,e){return t.X<e.X&&t.Y>e.Y?1:t.X<e.X&&t.Y>e.Y?2:t.X<e.X&&t.Y<e.Y?4:3},this.DrawLine=function(t,e,a){a&&this.Canvas.setLineDash([5,10]),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.X,t.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke(),a&&this.Canvas.setLineDash([])},this.DrawTitle=function(t,e){this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.font=this.Font,this.Canvas.fillText(e,t.X,t.Y)},this.DrawArea=function(){var t=null,e=null;for(var a in this.LinePoint){var i=this.LinePoint[a];"1:8"==i.Text?t=this.LinePoint[a]:"8:1"==i.Text&&(e=this.LinePoint[a])}t&&e&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.End.X,t.End.Y),this.Canvas.lineTo(t.Start.X,t.Start.Y),this.Canvas.lineTo(e.End.X,e.End.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(t,e,a){if(!this.Frame)return!1;this.Frame.ChartBorder.GetTopEx(),this.Frame.ChartBorder.GetRight(),this.Frame.ChartBorder.GetBottom();var i=[.5,1/3,.25,.125,2/3],r=["1:2","1:3","1:4","1:8","2:3"],n=["2:1","3:1","4:1","8:1","3:2"],s=new K,o=new K;s.X=t.X,s.Y=t.Y,o.X=e.X,o.Y=e.Y;var h=Math.abs(t.X-e.X),l=Math.abs(t.Y-e.Y);if(1===a){var u=this.CalculateExtendLinePoint(t,e),C={Start:s,End:u.Start,IsDottedLine:!1,PtEnd:o,Text:"1:1"};for(var D in this.LinePoint.push(C),i){if(h>5){C={Start:s,End:null,IsDottedLine:!1,PtEnd:new K,Text:r[D]},C.PtEnd.Y=e.Y,C.PtEnd.X=t.X+h*i[D];u=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=u.Start,this.LinePoint.push(C)}if(l>5){C={Start:s,End:null,IsDottedLine:!1,PtEnd:new K,Text:n[D]},C.PtEnd.Y=t.Y-l*i[D],C.PtEnd.X=e.X;u=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=u.Start,this.LinePoint.push(C)}}}else{if(4!=a)return!1;u=this.CalculateExtendLinePoint(t,e),C={Start:s,End:u.End,IsDottedLine:!1,PtEnd:o,Text:"1:1"};for(var D in this.LinePoint.push(C),i){if(h>5){C={Start:s,End:null,IsDottedLine:!1,PtEnd:new K,Text:r[D]},C.PtEnd.Y=e.Y,C.PtEnd.X=t.X+h*i[D];u=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=u.End,this.LinePoint.push(C)}if(l>5){C={Start:s,End:null,IsDottedLine:!1,PtEnd:new K,Text:n[D]},C.PtEnd.Y=t.Y+l*i[D],C.PtEnd.X=e.X;u=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=u.End,this.LinePoint.push(C)}}}return!0}}function fa(){this.newMethod=ca,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureResistanceLine",this.CalculateLines=function(t,e,a){if(!this.Frame)return!1;this.Frame.ChartBorder.GetTopEx(),this.Frame.ChartBorder.GetRight(),this.Frame.ChartBorder.GetBottom();var i=[1/3,2/3],r=["3:1","3:2"],n=new K,s=new K;n.X=t.X,n.Y=t.Y,s.X=e.X,s.Y=e.Y;Math.abs(t.X-e.X);var o=Math.abs(t.Y-e.Y);if(1===a){var h=this.CalculateExtendLinePoint(t,e),l={Start:n,End:h.Start,IsDottedLine:!1,PtEnd:s,Text:"1:1"};for(var u in this.LinePoint.push(l),i)if(o>5){l={Start:n,End:null,IsDottedLine:!1,PtEnd:new K,Text:r[u]},l.PtEnd.Y=t.Y-o*i[u],l.PtEnd.X=e.X;h=this.CalculateExtendLinePoint(l.Start,l.PtEnd);l.End=h.Start,this.LinePoint.push(l)}}else{if(4!=a)return!1;h=this.CalculateExtendLinePoint(t,e),l={Start:n,End:h.End,IsDottedLine:!1,PtEnd:s,Text:"1:1"};for(var u in this.LinePoint.push(l),i)if(o>5){l={Start:n,End:null,IsDottedLine:!1,PtEnd:new K,Text:r[u]},l.PtEnd.Y=t.Y+o*i[u],l.PtEnd.X=e.X;h=this.CalculateExtendLinePoint(l.Start,l.PtEnd);l.End=h.End,this.LinePoint.push(l)}}return!0},this.DrawArea=function(){var t=null,e=null;for(var a in this.LinePoint){var i=this.LinePoint[a];"1:1"==i.Text?t=this.LinePoint[a]:"3:1"==i.Text&&(e=this.LinePoint[a])}t&&e&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.End.X,t.End.Y),this.Canvas.lineTo(t.Start.X,t.Start.Y),this.Canvas.lineTo(e.End.X,e.End.Y),this.Canvas.closePath(),this.Canvas.fill())}}function da(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureGoldenSectionLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Font=14*V()+"px 微软雅黑",this.GetSectionData=function(){var t=[0,.236,.382,.5,.618,.8,1,1.236,1.382,1.5,1.618,1.8,2];return t},this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint();if(t&&2==t.length){for(var e in this.AreaColor=ta.ColorToRGBA(this.LineColor,.3),this.CalculateLines(t[0],t[1]),this.ClipFrame(),this.SetLineWidth(),this.LinePoint){var a=this.LinePoint[e];this.DrawLine(a.Start,a.End,a.IsDottedLine)}for(var e in this.RestoreLineWidth(),this.LinePoint){a=this.LinePoint[e];a.Text&&this.DrawTitle(a.Start,a.Text)}this.DrawPoint(t),this.Canvas.restore()}},this.CalculateHSCreenLines=function(t,e){for(var a=this.GetSectionData(),i=this.Frame.ChartBorder.GetTop(),r=this.Frame.ChartBorder.GetBottom(),n=t.X-e.X,s=0;s<a.length;++s){var o=n*a[s],h={Start:new K,End:new K};h.Start.X=t.X-o,h.Start.Y=i,h.End.X=t.X-o,h.End.Y=r;var l="";l=0==s?"Base ":(100*a[s]).toFixed(2)+"% ";var u=this.Frame.GetYData(h.Start.Y);l+=u.toFixed(2),h.Text=l,this.LinePoint.push(h)}},this.CalculateLines=function(t,e){if(this.Frame.IsHScreen)this.CalculateHSCreenLines(t,e);else for(var a=this.GetSectionData(),i=this.Frame.ChartBorder.GetLeft(),r=this.Frame.ChartBorder.GetRight(),n=t.Y-e.Y,s=0;s<a.length;++s){var o=n*a[s],h={Start:new K,End:new K};h.Start.Y=t.Y-o,h.Start.X=i,h.End.Y=t.Y-o,h.End.X=r;var l="";l=0==s?"Base ":(100*a[s]).toFixed(2)+"% ";var u=this.Frame.GetYData(h.Start.Y);l+=u.toFixed(2),h.Text=l,this.LinePoint.push(h)}},this.DrawLine=function(t,e){this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.X,t.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke()},this.DrawTitle=function(t,e){this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.font=this.Font,this.Frame.IsHScreen?(this.Canvas.save(),this.Canvas.translate(t.X,t.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(e,0,0),this.Canvas.restore()):this.Canvas.fillText(e,t.X,t.Y)}}function ma(){this.newMethod=da,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPicturePercentage",this.GetSectionData=function(){var t=[0,.25,.333,.5,1];return t}}function va(){this.newMethod=da,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureWaveBand",this.GetSectionData=function(){var t=[0,.125,.25,.375,.5,.625,.75,.875,1];return t}}function Sa(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureTriangle",this.PointCount=3,this.Font=16*V()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.LastPoint,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t){var e=t.slice(0);for(var a in this.AreaColor=ta.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.CalculateLines(e),this.LinePoint){var i=this.LinePoint[a];this.DrawLine(i.Start,i.End)}this.DrawArea(e),this.DrawPoint(e),this.DrawTitle(e),this.Canvas.restore()}},this.DrawArea=function(t){3==t.length&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y),this.Canvas.lineTo(t[1].X,t[1].Y),this.Canvas.lineTo(t[2].X,t[2].Y),this.Canvas.lineTo(t[0].X,t[0].Y),this.Canvas.closePath(),this.Canvas.fill())},this.DrawTitle=function(t){this.Status},this.SetLastPoint=function(t){this.LastPoint={X:t.X,Y:t.Y}},this.CalculateLines=function(t){if(2==this.PointStatus&&this.LastPoint){var e=new K;e.X=this.LastPoint.X,e.Y=this.LastPoint.Y,t[2]=e}if(2===t.length){var a={Start:new K,End:new K};a.Start.Y=t[0].Y,a.Start.X=t[0].X,a.End.Y=t[1].Y,a.End.X=t[1].X,this.LinePoint.push(a)}else if(3===t.length){a={Start:new K,End:new K};a.Start.Y=t[0].Y,a.Start.X=t[0].X,a.End.Y=t[1].Y,a.End.X=t[1].X,this.LinePoint.push(a),a={Start:new K,End:new K},a.Start.Y=t[1].Y,a.Start.X=t[1].X,a.End.Y=t[2].Y,a.End.X=t[2].X,this.LinePoint.push(a),a={Start:new K,End:new K},a.Start.Y=t[2].Y,a.Start.X=t[2].X,a.End.Y=t[0].Y,a.End.X=t[0].X,this.LinePoint.push(a)}}}function Ia(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureSymmetryAngle",this.PointCount=2,this.Font=16*V()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t){for(var e in this.AreaColor=ta.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.CalculateLines(t),this.LinePoint){var a=this.LinePoint[e];this.DrawLine(a.Start,a.End)}this.DrawArea(),this.DrawPoint(t),this.DrawTitle(t),this.Canvas.restore()}},this.CalculateLines=function(t){if(2==t.length&&this.Frame){var e={Start:new K,End:new K};e.Start.Y=t[0].Y,e.Start.X=t[0].X,e.End.Y=t[1].Y,e.End.X=t[1].X,this.LinePoint.push(e),e={Start:new K,End:new K},e.Start.Y=t[0].Y,e.Start.X=t[0].X,e.End.Y=t[1].Y,e.End.X=t[0].X,this.LinePoint.push(e);var a=t[0].X-t[1].X;e={Start:new K,End:new K},e.Start.Y=t[0].Y,e.Start.X=t[0].X,e.End.Y=t[1].Y,e.End.X=t[0].X+a,this.LinePoint.push(e)}},this.DrawArea=function(){3==this.LinePoint.length&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[2].End.X,this.LinePoint[2].End.Y),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.closePath(),this.Canvas.fill())},this.DrawTitle=function(t){this.Status}}function pa(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureCircle",this.PointCount=2,this.CircleData,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t&&2==t.length){this.AreaColor=ta.ColorToRGBA(this.LineColor,.3),this.ClipFrame();var e=t[0].X-t[1].X,a=t[0].Y-t[1].Y,i=Math.sqrt(e*e+a*a);this.Canvas.fillStyle=this.AreaColor,this.Canvas.strokeStyle=this.LineColor,this.DrawLine(t[0],t[1]),this.Canvas.beginPath(),this.Canvas.arc(t[0].X,t[0].Y,i,0,2*Math.PI),this.Canvas.stroke(),this.Canvas.fill(),this.CircleData={X:t[0].X,Y:t[0].Y,R:i},this.DrawPoint(t),this.Canvas.restore()}},this.IsPointIn=function(t,e){if(10!=this.Status)return-1;var a=this.IsPointInXYValue(t,e);if(a>=0)return a;if(this.CircleData&&this.CircleData.R>8){var i=this.CircleData.X-t,r=this.CircleData.Y-e,n=Math.sqrt(i*i+r*r);if(n<this.CircleData.R&&n>this.CircleData.R-8)return 100}return-1}}function Ta(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureQuadrangle",this.IsPointIn=this.IsPointIn_XYValue_Line,this.PointCount=3,this.LastPoint,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t){this.AreaColor=ta.ColorToRGBA(this.LineColor,.3);var e=t.slice(0);for(var a in this.CalculateLines(e),this.ClipFrame(),this.LinePoint){var i=this.LinePoint[a];this.DrawLine(i.Start,i.End)}this.DrawArea(),this.DrawPoint(e),this.Canvas.restore()}},this.SetLastPoint=function(t){this.LastPoint={X:t.X,Y:t.Y}},this.DrawArea=function(){4==this.LinePoint.length&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[2].End.X,this.LinePoint[2].End.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(t){if(2==this.PointStatus&&this.LastPoint){var e=new K;e.X=this.LastPoint.X,e.Y=this.LastPoint.Y,t[2]=e}if(2==t.length){var a=this.CreateLineData(t[0],t[1]);this.LinePoint.push(a)}else if(3==t.length){a=this.CreateLineData(t[0],t[1]);this.LinePoint.push(a);a=this.CreateLineData(t[1],t[2]);this.LinePoint.push(a);var i=t[2].X-t[1].X,r=t[2].Y-t[1].Y,n=new K;n.X=t[0].X+i,n.Y=t[0].Y+r;a=this.CreateLineData(t[2],n);this.LinePoint.push(a);a=this.CreateLineData(n,t[0]);this.LinePoint.push(a)}}}function Aa(){this.newMethod=ta,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureFibonacci",this.PointCount=1,this.Font=14*V()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint();if(t&&(this.CalculateLines(),!(this.LinePoint.length<=0))){for(var e in this.ClipFrame(),this.SetLineWidth(),this.LinePoint){var a=this.LinePoint[e];this.DrawLine(a.Start,a.End),this.DrawTitle(a.Start,a.Title)}this.RestoreLineWidth(),this.DrawPoint(t),this.Canvas.restore()}},this.DrawTitle=function(t,e){this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.font=this.Font,this.Frame.IsHScreen?(this.Canvas.save(),this.Canvas.translate(t.X,t.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(e,2,10),this.Canvas.restore()):this.Canvas.fillText(e,t.X+2,t.Y+10)},this.CalculateHSCreenLines=function(){var t=this.Frame.Data;if(t){var e=null;if(10==this.Status){if(1!=this.Value.length)return;e=this.Value[0].XValue}else{if(1!=this.Point.length)return;e=parseInt(this.Frame.GetXData(this.Point[0].Y))+t.DataOffset}for(var a=this.Frame.ChartBorder.GetRightEx(),i=this.Frame.ChartBorder.GetLeftEx(),r=this.Frame.XPointCount,n=[1,2,3,5,8,13,21,34,55,89,144,233],s=0;s<n.length;++s){var o=e+n[s],h=o-t.DataOffset;if(!(h<0||h>=r)){var l=this.Frame.GetXFromIndex(o-t.DataOffset,!1),u={Start:new K,End:new K,Title:n[s]};u.Start.X=a,u.Start.Y=l,u.End.X=i,u.End.Y=l,this.LinePoint.push(u)}}}},this.CalculateLines=function(){if(!(this.Status<2)&&this.Frame){var t=this.Frame.Data;if(t)if(this.Frame.IsHScreen)this.CalculateHSCreenLines();else{var e=null;if(10==this.Status){if(1!=this.Value.length)return;e=this.Value[0].XValue}else{if(1!=this.Point.length)return;e=parseInt(this.Frame.GetXData(this.Point[0].X))+t.DataOffset}for(var a=this.Frame.ChartBorder.GetTopEx(),i=this.Frame.ChartBorder.GetBottom(),r=this.Frame.XPointCount,n=[1,2,3,5,8,13,21,34,55,89,144,233],s=0;s<n.length;++s){var o=e+n[s],h=o-t.DataOffset;if(!(h<0||h>=r)){var l=this.Frame.GetXFromIndex(o-t.DataOffset,!1),u={Start:new K,End:new K,Title:n[s]};u.Start.Y=a,u.Start.X=l,u.End.Y=i,u.End.X=l,this.LinePoint.push(u)}}}}}}function ga(){this.DrawData=new g.default,this.StorageKey,this.Load=function(t){if(t){this.StorageKey=t;var e=localStorage[this.StorageKey];if(M.Chart.Log("[ChartDrawStorage::Save] Load to localStorage, key="+this.StorageKey+", cache="+e),e&&"string"==typeof e){var a=JSON.parse(e);for(var i in a){var r=a[i],n=new g.default;for(var s in r.Value){var o=r.Value[s];n.set(o.Key,o.Value)}this.DrawData.set(r.Key,n)}}}},this.Save=function(){if(this.StorageKey){var t=[],e=!0,a=!1,i=void 0;try{for(var r,n=(0,T.default)(this.DrawData);!(e=(r=n.next()).done);e=!0){var s=r.value,o=s[0],h=s[1],l={Key:o,Value:[]},u=!0,C=!1,D=void 0;try{for(var c,f=(0,T.default)(h);!(u=(c=f.next()).done);u=!0){var d=c.value;l.Value.push({Key:d[0],Value:d[1]})}}catch(S){C=!0,D=S}finally{try{!u&&f.return&&f.return()}finally{if(C)throw D}}t.push(l)}}catch(S){a=!0,i=S}finally{try{!e&&n.return&&n.return()}finally{if(a)throw i}}M.Chart.Log("[ChartDrawStorage::Save] save to localStorage, key="+this.StorageKey);var m=(0,v.default)(t);localStorage[this.StorageKey]=m}},this.SaveDrawData=function(t){var e=t.Symbol+"-"+t.Period,a=t.ExportStorageData();if(a){if(this.DrawData.has(e))M.Chart.Log("[ChartDrawStorage::SaveDrawData] Upate: key, drawPicture, data",e,t,a),this.DrawData.get(e).set(a.Guid,a);else{M.Chart.Log("[ChartDrawStorage::SaveDrawData] Insert: key, drawPicture, data",e,t,a);var i=new g.default;i.set(a.Guid,a),this.DrawData.set(e,i)}M.Chart.Log("[ChartDrawStorage::SaveDrawData] All draw data： ",this.DrawData),this.Save()}},this.DeleteDrawData=function(t){var e=t.Symbol+"-"+t.Period;this.DrawData.has(e)&&(this.DrawData.delete(e),this.Save())},this.Clear=function(){this.DrawData=new g.default,this.Save()},this.GetDrawData=function(t){var e=[],a=t.Symbol+"-"+t.Period;if(!this.DrawData.has(a))return e;var i=this.DrawData.get(a),r=!0,n=!1,s=void 0;try{for(var o,h=(0,T.default)(i);!(r=(o=h.next()).done);r=!0){var l=o.value;e.push(l[1])}}catch(u){n=!0,s=u}finally{try{!r&&h.return&&h.return()}finally{if(n)throw s}}return e}}function Fa(){this.Data=[[1e-6,2e-6,1e-6,1e-7],[2e-6,4e-6,2e-6,2e-7],[4e-6,5e-6,4e-6,1e-7],[5e-6,1e-5,5e-6,5e-7],[1e-5,2e-5,1e-5,1e-6],[2e-5,4e-5,2e-5,2e-6],[4e-5,5e-5,4e-5,1e-6],[5e-5,1e-4,5e-5,5e-6],[1e-4,2e-4,1e-4,1e-5],[2e-4,4e-4,2e-4,2e-5],[4e-4,5e-4,4e-4,1e-5],[5e-4,.001,5e-4,5e-5],[.001,.002,.001,1e-4],[.002,.004,.002,2e-4],[.004,.005,.004,1e-4],[.005,.01,.005,5e-4],[.01,.02,.01,.001],[.02,.04,.02,.002],[.04,.05,.04,.001],[.05,.1,.05,.005],[.1,.2,.1,.01],[.2,.4,.2,.02],[.4,.5,.4,.01],[.5,1,.5,.05],[1,2,.5,.05],[2,4,.5,.05],[4,5,.5,.05],[5,10,.5,.05],[10,12,10,2],[20,40,20,5],[40,50,40,2],[50,100,50,10],[100,200,100,10],[200,400,200,20],[400,500,400,10],[500,1e3,500,50],[1e3,2e3,1e3,50],[2e3,4e3,2e3,50],[4e3,5e3,4e3,50],[5e3,1e4,5e3,100],[1e4,2e4,1e4,1e3],[2e4,4e4,1e4,1e3],[4e4,5e4,1e4,1e3],[5e4,1e5,1e4,1e3],[1e5,2e5,1e5,1e4],[2e5,4e5,1e5,1e4],[4e5,5e5,1e5,1e4],[5e5,1e6,1e5,1e4],[1e6,2e6,1e6,1e5],[2e6,4e6,1e6,1e5],[4e6,5e6,1e6,1e5],[5e6,1e7,1e6,1e5],[1e7,2e7,1e7,1e6],[2e7,4e7,1e7,1e6],[4e7,5e7,1e7,1e6],[5e7,1e8,1e7,1e6],[1e8,2e8,1e8,1e7],[2e8,4e8,1e8,1e7],[4e8,5e8,1e8,1e7],[5e8,1e9,1e8,1e7],[1e9,2e9,1e9,1e8],[2e9,4e9,1e9,1e8],[4e9,5e9,1e9,1e8],[5e9,1e10,1e9,1e8]],this.Find=function(t){for(var e in this.Data){var a=this.Data[e];if(t>a[0]&&t<=a[1]){var i={};return i.FixInterval=a[2],i.Increase=a[3],i}}return null}}function Ea(){this.newMethod=Fa,this.newMethod(),delete this.newMethod,this.Data=[[1e-6,2e-6,1e-6,1e-7],[2e-6,4e-6,2e-6,2e-7],[4e-6,5e-6,4e-6,1e-7],[5e-6,1e-5,5e-6,5e-7],[1e-5,2e-5,1e-5,1e-6],[2e-5,4e-5,2e-5,2e-6],[4e-5,5e-5,4e-5,1e-6],[5e-5,1e-4,5e-5,5e-6],[1e-4,2e-4,1e-4,1e-5],[2e-4,4e-4,2e-4,2e-5],[4e-4,5e-4,4e-4,1e-5],[5e-4,.001,5e-4,5e-5],[.001,.002,.001,1e-4],[.002,.004,.002,1e-4],[.004,.005,.004,1e-4],[.005,.01,.005,5e-4],[.01,.02,.01,.001],[.02,.04,.02,.001],[.04,.05,.04,.001],[.05,.1,.05,.001],[.1,.2,.1,.01],[.2,.4,.2,.01],[.4,.5,.2,.01],[.5,.8,.2,.01],[.8,1,.5,.01],[1,2,.5,.05],[2,4,.5,.05],[4,5,.5,.05],[5,10,.5,.05],[10,12,10,2],[20,40,20,5],[40,50,40,2],[50,100,50,10],[100,200,100,10],[200,400,200,20],[400,500,400,10],[500,1e3,500,50],[1e3,2e3,1e3,50],[2e3,4e3,2e3,50],[4e3,5e3,4e3,50],[5e3,1e4,5e3,100],[1e4,2e4,1e4,1e3],[2e4,4e4,2e4,2e3],[4e4,5e4,4e4,1e3],[5e4,1e5,5e4,5e3],[1e5,2e5,1e5,1e4],[2e5,4e5,2e5,2e4],[4e5,5e5,4e5,1e4],[5e5,1e6,5e5,5e4],[1e6,2e6,1e6,1e5],[2e6,4e6,2e6,2e5],[4e6,5e6,4e6,1e5],[5e6,1e7,5e6,5e5],[1e7,2e7,1e7,1e6],[2e7,4e7,2e7,2e6],[4e7,5e7,4e7,1e6],[5e7,1e8,5e7,5e6],[1e8,2e8,1e8,1e7],[2e8,4e8,2e8,2e7],[4e8,5e8,4e8,1e7],[5e8,1e9,5e8,5e7],[1e9,2e9,1e9,1e8],[2e9,4e9,2e9,2e8],[4e9,5e9,4e9,1e8],[5e9,1e10,5e9,5e8]]}function La(){this.TooltipBGColor="rgb(255, 255, 255)",this.TooltipAlpha=.92,this.SelectRectBGColor="rgba(1,130,212,0.06)",this.UpBarColor="rgb(238,21,21)",this.DownBarColor="rgb(25,158,0)",this.UnchagneBarColor="rgb(0,0,0)",this.Minute={},this.Minute.VolBarColor="rgb(238,127,9)",this.Minute.PriceColor="rgb(50,171,205)",this.Minute.AreaPriceColor="rgba(50,171,205,0.1)",this.Minute.AvPriceColor="rgb(238,127,9)",this.Minute.BeforeBGColor="rgba(240,240,240,0.7)",this.Minute.PositionColor="rgb(218,165,32)",this.DefaultTextColor="rgb(43,54,69)",this.DefaultTextFont=14*V()+"px 微软雅黑",this.TitleFont=13*V()+"px 微软雅黑",this.IndexTitleBGColor="rgb(217,219,220)",this.Title={TradeIndexColor:"rgb(105,105,105)",ColorIndexColor:"rgb(112,128,144)"},this.UpTextColor="rgb(238,21,21)",this.DownTextColor="rgb(25,158,0)",this.UnchagneTextColor="rgb(0,0,0)",this.CloseLineColor="rgb(0,191,255)",this.CloseLineAreaColor=["rgba(0,191,255,0.8)","rgba(0,191,255,0.2)"],this.FrameBorderPen="rgb(225,236,242)",this.FrameSplitPen="rgb(225,236,242)",this.FrameDotSplitPen="rgb(105,105,105)",this.FrameYLineDash=null,this.FrameSplitTextColor="rgb(117,125,129)",this.FrameSplitTextFont=14*V()+"px 微软雅黑",this.FrameTitleBGColor="rgb(246,251,253)",this.Frame={XBottomOffset:1*V()},this.FromeLogarithmic={OpenPriceFont:"bold "+14*V()+"px 微软雅黑",MinInterval:45*V()},this.FrameLatestPrice={TextColor:"rgb(255,255,255)",UpBarColor:"rgb(238,21,21)",DownBarColor:"rgb(25,158,0)",UnchagneBarColor:"rgb(0,0,0)",BGAlpha:.6},this.FrameMargin=4,this.FrameLeftMargin=2,this.FrameRightMargin=2,this.OverlayFrame={BolderPen:"rgb(190,190,190)",TitleColor:"rgb(105,105,105)",TitleFont:11*V()+"px arial"},this.CorssCursorBGColor="rgb(43,54,69)",this.CorssCursorTextColor="rgb(255,255,255)",this.CorssCursorTextFont=14*V()+"px 微软雅黑",this.CorssCursorHPenColor="rgb(130,130,130)",this.CorssCursorVPenColor="rgb(130,130,130)",this.LockBGColor="rgb(220, 220, 220)",this.LockTextColor="rgb(210, 34, 34)",this.Domain="https://opensource.zealink.com",this.CacheDomain="https://opensourcecache.zealink.com",this.PyIndexDomain="https://py.zealink.com",this.KLine={MaxMin:{Font:12*V()+"px 微软雅黑",Color:"rgb(43,54,69)"},Info:{Investor:{ApiUrl:"https://opensource.zealink.com/API/NewsInteract",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#1c65db"}},Announcement:{ApiUrl:"https://opensource.zealink.com/API/ReportList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f5a521"},IconFont2:{Family:"iconfont",Text:"",HScreenText:"",Color:"#ed7520"}},Pforecast:{ApiUrl:"https://opensource.zealink.com/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#986cad"}},Research:{ApiUrl:"https://opensource.zealink.com/API/InvestorRelationsList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#19b1b7"}},BlockTrading:{ApiUrl:"https://opensource.zealink.com/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f39f7c"}},TradeDetail:{ApiUrl:"https://opensource.zealink.com/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#b22626"}},IconLibrary:{Family:"iconfont",Icon:[{Text:"",HScreenText:"",Color:"#f39f7c"},{Text:"",HScreenText:"",Color:"#19b1b7"},{Text:"",HScreenText:"",Color:"#b22626"},{Text:"",HScreenText:"",Color:"#ed7520"}]}},NumIcon:{Color:"rgb(251,80,80)",Family:"iconfont",Text:["","","","","","","","","","","","","","","","","","","","",""]},TradeIcon:{Family:"iconfont",Buy:{Color:"rgb(255,15,4)",Text:"",HScreenText:""},Sell:{Color:"rgb(64,122,22)",Text:"",HScreenText:""}}},this.Index={},this.Index.LineColor=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],this.OverlaySymbol={Random:0},this.OverlaySymbol.Color=["rgb(38,198,218)","rgb(103,58,183)","rgb(0,191,165)","rgb(130,177,255)"],this.Index.StockHistoryDayApiUrl="https://opensource.zealink.com/API/StockHistoryDay",this.Index.MarketLongShortApiUrl="https://opensource.zealink.com/API/FactorTiming",this.Index.MarketAttentionApiUrl="https://opensource.zealink.com/API/MarketAttention",this.Index.MarketHeatApiUrl="https://opensource.zealink.com/API/MarketHeat",this.Index.CustomIndexHeatApiUrl="https://opensource.zealink.com/API/QuadrantCalculate",this.Index.NotSupport={Font:"14px 微软雅黑",TextColor:"rgb(52,52,52)"},this.DrawPicture={},this.DrawPicture.LineColor=["rgb(30,144,255)"],this.DrawPicture.PointColor=["rgb(105,105,105)"],this.KLineTrain={Font:"bold 14px arial",LastDataIcon:{Color:"rgb(0,0,205)",Text:"⬇"},BuyIcon:{Color:"rgb(0,205,102 )",Text:"B"},SellIcon:{Color:"rgb(255,127,36 )",Text:"S"},IconFont:{Family:"iconfont",Buy:{Text:"",HScreenText:"",Color:"rgb(255,140,0)"},Sell:{Text:"",HScreenText:"",Color:"rgb(6,79,18)"},Last:{Text:"",HScreenText:"",Color:"rgb(55,0,255)"}}},this.TooltipPaint={BGColor:"rgba(250,250,250,0.8)",BorderColor:"rgb(120,120,120)",TitleColor:"rgb(120,120,120)",TitleFont:13*V()+"px 微软雅黑"},this.Barrage={Font:16*V()+"px 微软雅黑",Height:20,Color:"RGB(109,109,109)"},this.MinuteInfo={TextColor:"rgb(84,143,255)",Font:14*V()+"px 微软雅黑",PointColor:"rgb(38,113,254)",LineColor:"rgb(120,167,255)",TextBGColor:"rgba(255,255,255,0.8)"},this.SetStyle=function(t){t.TooltipBGColor&&(this.TooltipBGColor=t.TooltipBGColor),t.TooltipAlpha&&(this.TooltipAlpha=t.TooltipAlpha),t.SelectRectBGColor&&(this.SelectRectBGColor=t.SelectRectBGColor),t.UpBarColor&&(this.UpBarColor=t.UpBarColor),t.DownBarColor&&(this.DownBarColor=t.DownBarColor),t.UnchagneBarColor&&(this.UnchagneBarColor=t.UnchagneBarColor),t.Minute&&(t.Minute.VolBarColor&&(this.Minute.VolBarColor=t.Minute.VolBarColor),t.Minute.PriceColor&&(this.Minute.PriceColor=t.Minute.PriceColor),t.Minute.AvPriceColor&&(this.Minute.AvPriceColor=t.Minute.AvPriceColor),t.Minute.AreaPriceColor&&(this.Minute.AreaPriceColor=t.Minute.AreaPriceColor),t.Minute.PositionColor&&(this.Minute.PositionColor=t.Minute.PositionColor)),t.DefaultTextColor&&(this.DefaultTextColor=t.DefaultTextColor),t.DefaultTextFont&&(this.DefaultTextFont=t.DefaultTextFont),t.TitleFont&&(this.TitleFont=t.TitleFont),t.UpTextColor&&(this.UpTextColor=t.UpTextColor),t.DownTextColor&&(this.DownTextColor=t.DownTextColor),t.UnchagneTextColor&&(this.UnchagneTextColor=t.UnchagneTextColor),t.CloseLineColor&&(this.CloseLineColor=t.CloseLineColor),t.CloseLineAreaColor&&(this.CloseLineAreaColor=t.CloseLineAreaColor),t.FrameBorderPen&&(this.FrameBorderPen=t.FrameBorderPen),t.FrameSplitPen&&(this.FrameSplitPen=t.FrameSplitPen),t.FrameDotSplitPen&&(this.FrameDotSplitPen=t.FrameDotSplitPen),t.FrameSplitTextColor&&(this.FrameSplitTextColor=t.FrameSplitTextColor),t.FrameSplitTextFont&&(this.FrameSplitTextFont=t.FrameSplitTextFont),t.FrameTitleBGColor&&(this.FrameTitleBGColor=t.FrameTitleBGColor),t.Frame&&t.Frame.XBottomOffset&&(this.Frame.XBottomOffset=t.Frame.XBottomOffset),t.FrameLatestPrice&&(t.FrameLatestPrice.TextColor&&(this.FrameLatestPrice.TextColor=t.FrameLatestPrice.TextColor),t.FrameLatestPrice.UpBarColor&&(this.FrameLatestPrice.UpBarColor=t.FrameLatestPrice.UpBarColor),t.FrameLatestPrice.DownBarColor&&(this.FrameLatestPrice.DownBarColor=t.FrameLatestPrice.DownBarColor),t.FrameLatestPrice.UnchagneBarColor&&(this.FrameLatestPrice.UnchagneBarColor=t.FrameLatestPrice.UnchagneBarColor),t.FrameLatestPrice.BGAlpha&&(this.FrameLatestPrice.BGAlpha=t.FrameLatestPrice.BGAlpha)),t.CorssCursorBGColor&&(this.CorssCursorBGColor=t.CorssCursorBGColor),t.CorssCursorTextColor&&(this.CorssCursorTextColor=t.CorssCursorTextColor),t.CorssCursorTextFont&&(this.CorssCursorTextFont=t.CorssCursorTextFont),t.CorssCursorVPenColor&&(this.CorssCursorVPenColor=t.CorssCursorVPenColor),t.CorssCursorHPenColor&&(this.CorssCursorHPenColor=t.CorssCursorHPenColor),t.KLine&&(this.KLine=t.KLine),t.Index&&(t.Index.LineColor&&(this.Index.LineColor=t.Index.LineColor),t.Index.NotSupport&&(this.Index.NotSupport=t.Index.NotSupport)),t.ColorArray&&(this.ColorArray=t.ColorArray),t.DrawPicture&&(this.DrawPicture.LineColor=t.DrawPicture.LineColor,this.DrawPicture.PointColor=t.DrawPicture.PointColor),t.TooltipPaint&&(t.TooltipPaint.BGColor&&(this.TooltipPaint.BGColor=t.TooltipPaint.BGColor),t.TooltipPaint.BorderColor&&(this.TooltipPaint.BorderColor=t.TooltipPaint.BorderColor),t.TooltipPaint.TitleColor&&(this.TooltipPaint.TitleColor=t.TooltipPaint.TitleColor),t.TooltipPaint.TitleFont&&(this.TooltipPaint.TitleFont=t.TooltipPaint.TitleFont)),t.MinuteInfo&&(t.MinuteInfo.TextColor&&(this.MinuteInfo.TextColor=t.MinuteInfo.TextColor),t.MinuteInfo.Font&&(this.MinuteInfo.Font=t.MinuteInfo.Font),t.MinuteInfo.PointColor&&(this.MinuteInfo.PointColor=t.MinuteInfo.PointColor),t.MinuteInfo.LineColor&&(this.MinuteInfo.LineColor=t.MinuteInfo.LineColor),t.MinuteInfo.TextBGColor&&(this.MinuteInfo.TextBGColor=t.MinuteInfo.TextBGColor)),t.Title&&(t.Title.TradeIndexColor&&(this.Title.TradeIndexColor=t.Title.TradeIndexColor),t.Title.ColorIndexColor&&(this.Title.ColorIndexColor=t.Title.ColorIndexColor))}}ta.ColorToRGBA=function(t,e){return"rgba("+parseInt("0x"+t.slice(1,3))+","+parseInt("0x"+t.slice(3,5))+","+parseInt("0x"+t.slice(5,7))+","+e+")"},ta.CreateChartDrawPrictrue=function(t){var e=new g.default([["ChartDrawPictureLine",{Create:function(){return new ea}}],["ChartDrawPictureHaflLine",{Create:function(){return new aa}}],["ChartDrawPictureHorizontalLine",{Create:function(){return new ia}}],["ChartDrawPictureTrendLine",{Create:function(){return new ra}}],["ChartDrawPictureRect",{Create:function(){return new na}}],["ChartDrawPictureArc",{Create:function(){return new sa}}],["ChartDrawPictureWaveMW",{Create:function(){return new oa}}],["ChartDrawPictureParallelLines",{Create:function(){return new ha}}],["ChartDrawPictureParallelChannel",{Create:function(){return new ua}}],["ChartDrawPicturePriceChannel",{Create:function(){return new la}}],["ChartDrawPictureText",{Create:function(){return new Ca}}],["ChartDrawPictureGannFan",{Create:function(){return new ca}}],["ChartDrawPictureResistanceLine",{Create:function(){return new fa}}],["ChartDrawPictureGoldenSection",{Create:function(){return new da}}],["ChartDrawPicturePercentage",{Create:function(){return new ma}}],["ChartDrawPictureWaveBand",{Create:function(){return new va}}],["ChartDrawPictureTriangle",{Create:function(){return new Sa}}],["ChartDrawPictureSymmetryAngle",{Create:function(){return new Ia}}],["ChartDrawPictureCircle",{Create:function(){return new pa}}],["ChartDrawPictureQuadrangle",{Create:function(){return new Ta}}],["ChartDrawPictureFibonacci",{Create:function(){return new Aa}}],["ChartDrawPictureIconFont",{Create:function(){return new Da}}]]);if(!e.has(t.ClassName))return null;var a=e.get(t.ClassName),i=a.Create();return t.Period>=0&&(i.Period=t.Period),t.Guid&&(i.Guid=t.Guid),t.Symbol&&(i.Symbol=t.Symbol),t.Value&&(i.Value=t.Value),t.Text&&(i.Text=t.Text),t.LineColor&&(i.LineColor=t.LineColor),t.AreaColor&&(i.AreaColor=t.AreaColor),t.FontOption&&(i.FontOption=t.FontOption),i};var Ma=new La,xa={LANGUAGE_CHINESE_ID:0,LANGUAGE_ENGLISH_ID:1};function Na(){this.TextResource=new g.default([["Tooltip-Open",{CN:"开:",EN:"O:"}],["Tooltip-High",{CN:"高:",EN:"H:"}],["Tooltip-Low",{CN:"低:",EN:"L:"}],["Tooltip-Close",{CN:"收:",EN:"C:"}],["Tooltip-Increase",{CN:"幅:",EN:"I:"}],["Tooltip-Vol",{CN:"量:",EN:"V:"}],["Tooltip-Amount",{CN:"额:",EN:"A:"}],["Tooltip-AvPrice",{CN:"均:",EN:"AP:"}],["Tooltip-Price",{CN:"价:",EN:"P:"}],["Tooltip-Exchange",{CN:"换:",EN:"E:"}],["Tooltip-Position",{CN:"持:",EN:"P:"}],["DivTooltip-Open",{CN:"开盘:",EN:"Open:"}],["DivTooltip-High",{CN:"最高:",EN:"High:"}],["DivTooltip-Low",{CN:"最低:",EN:"Low:"}],["DivTooltip-Close",{CN:"收盘:",EN:"Close:"}],["DivTooltip-Increase",{CN:"涨幅:",EN:"Increase:"}],["DivTooltip-Vol",{CN:"数量:",EN:"Volume:"}],["DivTooltip-Amount",{CN:"金额:",EN:"Amount:"}],["DivTooltip-Exchange",{CN:"换手:",EN:"Exchange:"}],["DivTooltip-Position",{CN:"持仓:",EN:"Position:"}],["KTitle-Open",{CN:"开:",EN:"O:"}],["KTitle-High",{CN:"高:",EN:"H:"}],["KTitle-Low",{CN:"低:",EN:"L:"}],["KTitle-Close",{CN:"收:",EN:"C:"}],["KTitle-Increase",{CN:"幅:",EN:"I:"}],["KTitle-Vol",{CN:"量:",EN:"V:"}],["KTitle-Amount",{CN:"额:",EN:"A:"}],["KTitle-Exchange",{CN:"换:",EN:"E:"}],["KTitle-Position",{CN:"持:",EN:"P:"}],["MTitle-Close",{CN:"价:",EN:"C:"}],["MTitle-AvPrice",{CN:"均:",EN:"AC:"}],["MTitle-Increase",{CN:"幅:",EN:"I:"}],["MTitle-Vol",{CN:"量:",EN:"V:"}],["MTitle-Amount",{CN:"额:",EN:"A:"}],["MTitle-Position",{CN:"持:",EN:"P:"}],["日线",{CN:"日线",EN:"1D"}],["周线",{CN:"周线",EN:"1W"}],["双周",{CN:"双周",EN:"2W"}],["月线",{CN:"月线",EN:"1M"}],["年线",{CN:"年线",EN:"1Y"}],["1分",{CN:"1分",EN:"1Min"}],["5分",{CN:"5分",EN:"5Min"}],["15分",{CN:"15分",EN:"15Min"}],["30分",{CN:"30分",EN:"30Min"}],["60分",{CN:"60分",EN:"60Min"}],["季线",{CN:"季线",EN:"1Q"}],["分笔",{CN:"分笔",EN:"Tick"}],["2小时",{CN:"2小时",EN:"2H"}],["4小时",{CN:"4小时",EN:"4H"}],["不复权",{CN:"不复权",EN:"No Right"}],["前复权",{CN:"前复权",EN:"Pro Right"}],["后复权",{CN:"后复权",EN:"Post Right"}],["日",{CN:"日",EN:"Sun."}],["一",{CN:"一",EN:"Mon."}],["二",{CN:"二",EN:"Tues."}],["三",{CN:"三",EN:"Wed."}],["四",{CN:"四",EN:"Thur."}],["五",{CN:"五",EN:"Fri."}],["六",{CN:"六",EN:"Sat."}],["1月",{CN:"1月",EN:"Jan"}],["2月",{CN:"2月",EN:"Feb"}],["3月",{CN:"3月",EN:"Mar"}],["4月",{CN:"4月",EN:"Apr"}],["5月",{CN:"5月",EN:"May"}],["6月",{CN:"6月",EN:"Jun"}],["7月",{CN:"7月",EN:"Jul"}],["8月",{CN:"8月",EN:"Aug"}],["9月",{CN:"9月",EN:"Sept"}],["10月",{CN:"10月",EN:"Oct"}],["11月",{CN:"11月",EN:"Nov"}],["12月",{CN:"12月",EN:"Dec"}],["自定义分钟",{CN:"分",EN:"Min"}],["自定义日线",{CN:"日",EN:"D"}],["自定义秒",{CN:"秒",EN:"S"}]]),this.GetText=function(t,e){var a=this.TextResource.get(t);if(!a)return"";switch(e){case xa.LANGUAGE_CHINESE_ID:return a.CN;case xa.LANGUAGE_ENGLISH_ID:return a.EN;default:return a.CN}},this.SetTextResource=function(t,e){this.TextResource.set(t,e)}}var Oa=new Na;function ya(){}function Ra(){}function Pa(t){this.newMethod=H,this.newMethod(t),delete this.newMethod,this.ClassName="KLineChartContainer",this.WindowIndex=new Array,this.ColorIndex,this.TradeIndex,this.Symbol,this.Name,this.Period=0,this.IsApiPeriod=!1,this.Right=0,this.SourceData,this.MaxReqeustDataCount=3e3,this.MaxRequestMinuteDayCount=5,this.PageSize=200,this.KLineDrawType=0,this.ScriptErrorCallback,this.FlowCapitalReady=!1,this.EnableFlowCapital={},this.ChartDrawStorage=new ga,this.ChartDrawStorageCache=null,this.RightSpaceCount=0,this.SourceDataLimit=new g.default,this.CustomShow=null,this.OverlayIndexFrameWidth=60,this.ZoomType=0,this.KLineSize=null,this.Page={Day:{Enable:!1,Index:0,Finish:!1},Minute:{Enable:!1,Index:0,Finish:!1}},this.DragDownload={Day:{Enable:!1,IsEnd:!1,Status:0},Minute:{Enable:!1,IsEnd:!1,status:0}},this.IsAutoUpdate=!1,this.AutoUpdateFrequency=3e4,this.AutoUpdateTimer,this.KLineApiUrl=Ma.Domain+"/API/KLine2",this.MinuteKLineApiUrl=Ma.Domain+"/API/KLine3",this.DragMinuteKLineApiUrl=Ma.Domain+"/API/KLine4",this.DragKLineApiUrl=Ma.Domain+"/API/KLine5",this.RealtimeApiUrl=Ma.Domain+"/API/Stock",this.KLineMatchUrl=Ma.Domain+"/API/KLineMatch",this.StockHistoryDayApiUrl=Ma.Domain+"/API/StockHistoryDay",this.TickApiUrl=Ma.Domain+"/API/StockDetail",this.MinuteDialog,this.RightMenu,this.ChartPictureMenu,this.BeforeBindMainData=null,this.AfterBindMainData=null,this.ResetDragDownload=function(){this.DragDownload.Day.Status=0,this.DragDownload.Day.IsEnd=!1,this.DragDownload.Minute.Status=0,this.DragDownload.Minute.IsEnd=!1},this.ResetPage=function(){this.Page.Day.Finish=!1,this.Page.Day.Index=0,this.Page.Minute.Finish=!1,this.Page.Minute.Index=0},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::StopAutoUpdate"),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.SandTableOperator=function(t){switch(t.ID){case 1:this.StopAutoUpdate(),t.Data&&this.ManualUpdateKData(t);break;case 2:this.ManualUpdateKData(t);break;case 3:t.IsAutoUpdate&&(this.IsAutoUpdate=t.IsAutoUpdate),this.ChangeSymbol(this.Symbol);break}},this.ManualUpdateKData=function(t){var e=t.Data,a=e.length,i=new It;i.Data=e,i.Period=this.Period,i.Right=this.Right,i.Symbol=this.Symbol,this.UpdateMainData(i,a),this.BindInstructionIndexData(i);for(var r=0;r<this.Frame.SubFrame.length;++r)this.BindIndexData(r,i);if(Le.IsNumber(t.DataOffset)&&t.DataOffset>=0){var n=null;n=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data,n&&(n.DataOffset=t.DataOffset)}this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendManualKLineUpdateEvent(i)},this.GetKDataInfo=function(){if(!this.ChartPaint[0])return null;var t=this.ChartPaint[0],e={};return t.Data&&t.Data.Data&&(e.Data=t.Data.CloneData("HistoryData")),e.ShowRange=t.ShowRange,e.Period=this.Period,e.RightSpaceCount=this.RightSpaceCount,e},this.ChartOperator=function(t){var e=t.ID;if(e===B.OP_SCROLL_LEFT||e===B.OP_SCROLL_RIGHT){var a=e===B.OP_SCROLL_LEFT,i=1;t.Step>0&&(i=t.Step),this.DataMove(i*this.StepPixel,a)&&(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw())}else if(e===B.OP_ZOOM_IN||e===B.OP_ZOOM_OUT){var r={};if(r.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),e===B.OP_ZOOM_IN){if(!this.Frame.ZoomUp(r))return}else if(!this.Frame.ZoomDown(r))return;this.CursorIndex=r.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw()}else if(e===B.OP_GOTO_HOME){var n=null;if(n=this.Frame.Data?this.Frame.SubFrame[0].Frame.Data:this.Frame.Data,!n)return;var s=this.PageSize,o=this.GetMaxMinPageSize();for(var h in o.Max<s?s=o.Max:o.Min>s&&(s=o.Min),this.Frame.SubFrame){var l=this.Frame.SubFrame[h].Frame;l.XPointCount=s}var u=n.Data.length-s;n.DataOffset=u,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,M.Chart.Log("[KLineChartContainer::ChartOperator] OP_GOTO_HOME, dataOffset="+n.DataOffset+" CursorIndex="+this.CursorIndex+" PageSize="+s),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex()}},this.OnWheel=function(t){M.Chart.Log("[KLineChartContainer::OnWheel]",t);var e=t.clientX-this.UIElement.getBoundingClientRect().left,a=t.clientY-this.UIElement.getBoundingClientRect().top,i=!1;this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),i=this.Canvas.isPointInPath(e,a);var r=t.wheelDelta;if(Le.IsObjectExist(t.wheelDelta)||(r=-.01*t.deltaY),this.SourceData&&this.SourceData.Data)if(i&&r<0){var n={ZoomType:this.ZoomType};n.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),this.Frame.ZoomDown(n)&&(this.CursorIndex=n.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw())}else if(i&&r>0){n={ZoomType:this.ZoomType};n.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),this.Frame.ZoomUp(n)&&(this.CursorIndex=n.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw())}t.preventDefault?t.preventDefault():t.returnValue=!1},this.Create=function(t,e){var a=this;for(var i in this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new Pe,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=Ke.Create("CorssCursor_XStringFormat"),this.ChartCorssCursor.StringFormatY=Ke.Create("CorssCursor_YStringFormat"),this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY.ExtendChartPaint=this.ExtendChartPaint,this.ChartSplashPaint=new we,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new lt,this.Frame.ChartBorder=new q,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(t),this.CreateMainKLine(),this.Frame.SubFrame){var r=new $e;r.Frame=this.Frame.SubFrame[i].Frame,r.Canvas=this.Canvas,r.LanguageID=this.LanguageID,this.TitlePaint.push(r)}var n=!0,s=!0;e&&(!1===e.KeyDown&&(n=!1,M.Chart.Log("[KLineChartContainer::Create] not register keydown event.")),!1===e.Wheel&&(s=!1,M.Chart.Log("[KLineChartContainer::Create] not register wheel event."))),n&&this.UIElement.addEventListener("keydown",(function(t){a.OnKeyDown(t)}),!0),s&&this.UIElement.addEventListener("wheel",(function(t){a.OnWheel(t)}),!0)},this.CreateChildWindow=function(t){for(var e=0;e<t;++e){var a=new q;a.UIElement=this.UIElement;var i=new it;if(i.Canvas=this.Canvas,i.ChartBorder=a,i.Identify=e,i.RightSpaceCount=this.RightSpaceCount,this.ModifyIndexDialog&&(i.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(i.ChangeIndexEvent=this.ChangeIndexDialog.DoModal),i.HorizontalMax=20,i.HorizontalMin=10,0==e){i.YSplitOperator=new Me,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price"),i.YSplitOperator.FrameSplitData2=this.FrameSplitData.get("double");var r=V();a.BottomSpace=12*r,a.TopSpace=12*r}else i.YSplitOperator=new xe,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),i.YSplitOperator.LanguageID=this.LanguageID;i.YSplitOperator.Frame=i,i.YSplitOperator.ChartBorder=a,i.XSplitOperator=new Ne,i.XSplitOperator.Frame=i,i.XSplitOperator.ChartBorder=a,i.XSplitOperator.LanguageID=this.LanguageID,e!=t-1&&(i.XSplitOperator.ShowText=!1);for(var n=i.HorizontalMin;n<=i.HorizontalMax;n+=1)i.HorizontalInfo[n]=new z,i.HorizontalInfo[n].Value=n,0==e&&n==i.HorizontalMin||(i.HorizontalInfo[n].Message[1]=n.toString(),i.HorizontalInfo[n].Font="14px 微软雅黑");var s=new ot;s.Frame=i,s.Height=0==e?20:10,this.Frame.SubFrame[e]=s}},this.CreateSubFrameItem=function(t){var e=new q;e.UIElement=this.UIElement;var a=new it;a.Canvas=this.Canvas,a.ChartBorder=e,a.Identify=t,this.ModifyIndexDialog&&(a.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(a.ChangeIndexEvent=this.ChangeIndexDialog.DoModal),a.HorizontalMax=20,a.HorizontalMin=10,a.YSplitOperator=new xe,a.YSplitOperator.LanguageID=this.LanguageID,a.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),a.YSplitOperator.Frame=a,a.YSplitOperator.ChartBorder=e,a.XSplitOperator=new Ne,a.XSplitOperator.Frame=a,a.XSplitOperator.ChartBorder=e,a.XSplitOperator.ShowText=!1;var i=this.Frame.SubFrame[0].Frame.XPointCount;a.XPointCount=i,a.Data=this.ChartPaint[0].Data;for(var r=a.HorizontalMin;r<=a.HorizontalMax;r+=1)a.HorizontalInfo[r]=new z,a.HorizontalInfo[r].Value=r,a.HorizontalInfo[r].Message[1]=r.toString(),a.HorizontalInfo[r].Font="14px 微软雅黑";var n=new ot;return n.Frame=a,n.Height=10,n},this.CreateMainKLine=function(){var t=new Ot;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,t.ChartFrame=this.Frame.SubFrame[0].Frame,t.Name="Main-KLine",t.DrawType=this.KLineDrawType,this.ChartPaint[0]=t,this.TitlePaint[0]=new qe,this.TitlePaint[0].Frame=this.Frame.SubFrame[0].Frame,this.TitlePaint[0].Canvas=this.Canvas,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].LanguageID=this.LanguageID},this.BindMainData=function(t,e){if(this.ChartPaint[0].Data=t,this.ChartPaint[0].Symbol=this.Symbol,this.KLineSize)if(null==this.KLineSize.DataWidth)e=this.Frame.SubFrame[0].Frame.XPointCount-this.RightSpaceCount;else{var a=this.Frame.SetDataWidth(this.KLineSize.DataWidth);e=a.XPointCount-this.RightSpaceCount,this.KLineSize.DataWidth=null}for(var i in this.Frame.SubFrame){var r=this.Frame.SubFrame[i].Frame;r.XPointCount=e+this.RightSpaceCount,r.Data=this.ChartPaint[0].Data,r.XSplitOperator.Symbol=this.Symbol,r.XSplitOperator.Period=this.Period}for(var i in this.TitlePaint[0].Data=this.ChartPaint[0].Data,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=this.Name,this.TitlePaint[0].Period=this.Period,this.ChartCorssCursor.StringFormatX.Data=this.ChartPaint[0].Data,this.Frame.Data=this.ChartPaint[0].Data,this.OverlayChartPaint){r=this.OverlayChartPaint[i];r.MainData=this.ChartPaint[0].Data}var n=t.Data.length-e;n<0&&(n=0),this.ChartPaint[0].Data.DataOffset=n,this.ChartPaint[0].Period=this.Period,this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.CursorIndex=e,this.CursorIndex+n>=t.Data.length&&(this.CursorIndex=t.Data.length-1-n),this.CursorIndex<0&&(this.CursorIndex=0),this.CustomShow&&(this.SetCustomShow(this.CustomShow,t),this.CustomShow=null)},this.UpdateMainData=function(t,e){var a=null;if(this.Frame.Data?this.Frame.SubFrame&&this.Frame.SubFrame[0]&&(a=this.Frame.SubFrame[0].Frame.Data):a=this.Frame.Data,a){var i=0;for(var r in e>0&&t.Data.length>e&&(i=t.Data.length-e,M.Chart.Log("[KLineChartContainer::UpdateMainData]  [count="+e+"->"+t.Data.length+"], [newDataCount="+i+"]")),this.ChartPaint[0].Data=t,this.ChartPaint[0].Symbol=this.Symbol,this.ChartPaint[0].Data.DataOffset=a.DataOffset+i,this.Frame.SubFrame){var n=this.Frame.SubFrame[r].Frame;n.Data=this.ChartPaint[0].Data,0==r&&(n.YSplitOperator.Symbol=this.Symbol,n.YSplitOperator.Data=this.ChartPaint[0].Data,n.YSplitOperator.Period=this.Period)}for(var r in this.TitlePaint[0].Data=this.ChartPaint[0].Data,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=this.Name,this.ChartCorssCursor.StringFormatX.Data=this.ChartPaint[0].Data,this.Frame.Data=this.ChartPaint[0].Data,this.OverlayChartPaint){n=this.OverlayChartPaint[r];n.MainData=this.ChartPaint[0].Data}this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol}},this.SetCustomShow=function(t,e){if(t&&t.Date&&!(t.Date<19910101)){for(var a=t.Date,i=null,r=0;r<e.Data.length;++r){var n=e.Data[r];if(n.Date>=a){i=r;break}}if(null!==i){var s=e.Data.length-i;t.PageSize>0&&(s=t.PageSize);var o=s,h=this.GetMaxMinPageSize();for(var r in s>h.Max?o=h.Max:s<h.Min&&(o=h.Min),this.Frame.SubFrame){n=this.Frame.SubFrame[r].Frame;n.XPointCount=o}this.ChartPaint[0].Data.DataOffset=i,this.CursorIndex=0}else M.Chart.Log("[KLineChartContainer::SetCustomShow] Can't find first date="+a)}},this.ShowSelectData=function(t){this.HideSelectRect(),this.SelectRectRightMenu&&this.SelectRectRightMenu.Hide(),M.Chart.Log("[KLineChartContainer::ShowSelectData] selectData",t);var e=t.Start,a=t.End-t.Start+1;for(var i in M.Chart.Log("[KLineChartContainer::ShowSelectData] DataOffset="+e+", ShowCount="+a),this.Frame.SubFrame){var r=this.Frame.SubFrame[i].Frame;r.XPointCount=a}this.ChartPaint[0].Data.DataOffset=e,this.CursorIndex=0,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex()},this.CreateWindowIndex=function(t){this.WindowIndex[t].Create(this,t)},this.BindIndexData=function(t,e){this.WindowIndex[t]&&("function"!=typeof this.WindowIndex[t].RequestData?"function"!=typeof this.WindowIndex[t].ExecuteScript?this.WindowIndex[t].BindData(this,t,e):this.WindowIndex[t].ExecuteScript(this,t,e):this.WindowIndex[t].RequestData(this,t,e))},this.BindOverlayIndexData=function(t,e,a){t.Script&&("function"!=typeof t.Script.RequestData?"function"!=typeof t.Script.ExecuteScript?t.Script.BindData(this,e,a):t.Script.ExecuteScript(this,e,a):t.Script.RequestData(this,e,a))},this.BindInstructionIndexData=function(t){this.ColorIndex&&"function"==typeof this.ColorIndex.ExecuteScript&&this.ColorIndex.ExecuteScript(this,0,t),this.TradeIndex&&"function"==typeof this.TradeIndex.ExecuteScript&&this.TradeIndex.ExecuteScript(this,0,t)},this.GetChartPaint=function(t){var e=new Array;for(var a in this.ChartPaint)if(0!=a){var i=this.ChartPaint[a];i.ChartFrame==this.Frame.SubFrame[t].Frame&&e.push(i)}return e},this.AutoUpdateEvent=function(t,e){var a=t?b.RECV_START_AUTOUPDATE:b.RECV_STOP_AUTOUPDATE;if(this.mapEvent.has(a)){var i=this,r=this.mapEvent.get(a),n={Stock:{Symbol:this.Symbol,Name:this.Name,Right:this.Right,Period:this.Period},Explain:e};t&&(n.Callback=function(t){It.IsDayPeriod(i.Period,!0)?i.RecvRealtimeData(t):It.IsMinutePeriod(i.Period,!0)?i.RecvMinuteRealtimeData(t):It.IsSecondPeriod(i.Period)&&i.RecvMinuteRealtimeData(t)}),r.Callback(r,n,this)}},this.SendKLineUpdateEvent=function(t){var e=this.GetEventCallback(b.RECV_KLINE_UPDATE_DATA);if(e&&e.Callback){var a={HistoryData:t,Stock:{Symbol:this.Symbol,Name:this.Name}};return e.Callback(e,a,this),!0}return!1},this.SendManualKLineUpdateEvent=function(t){var e=this.GetEventCallback(b.RECV_KLINE_MANUAL_UPDATE_DATA);if(e&&e.Callback){var a={HistoryData:t,Stock:{Symbol:this.Symbol,Name:this.Name}};return e.Callback(e,a,this),!0}return!1},this.RequestHistoryData=function(){var t=this;if(this.ChartSplashPaint.IsEnableSplash=!0,this.FlowCapitalReady=!1,this.ResetPage(),this.ResetDragDownload(),this.Draw(),this.NetworkFilter){var e={Name:"KLineChartContainer::RequestHistoryData",Explain:"日K数据",Request:{Url:t.KLineApiUrl,Type:"POST",Data:{symbol:t.Symbol,count:t.MaxReqeustDataCount,field:["name","symbol","yclose","open","price","high","low","vol"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(e,(function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvHistoryData(e);var a=t.Page.Day;1==a.Enable&&0==a.Finish?t.RequestHistoryPageData():(t.AutoUpdateEvent(!0,"KLineChartContainer::RequestHistoryData"),t.AutoUpdate())})),1==e.PreventDefault)return}x.HttpRequest({url:this.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxReqeustDataCount},type:"post",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvHistoryData(e);var a=t.Page.Day;1==a.Enable&&0==a.Finish?t.RequestHistoryPageData():(t.AutoUpdateEvent(!0,"KLineChartContainer::RequestHistoryData"),t.AutoUpdate())}})},this.RecvHistoryData=function(t){var e=Pa.JsonDataToHistoryData(t),a=new It;a.Data=e,a.DataType=0,a.Symbol=t.symbol,this.SourceData=a,this.BeforeBindMainData&&this.BeforeBindMainData("RecvHistoryData");var i,r=new It;if(r.Data=e,r.Right=this.Right,r.Period=this.Period,r.DataType=0,r.Symbol=t.symbol,r.Right>0&&!this.IsApiPeriod){var n=r.GetRightDate(r.Right);r.Data=n}if(It.IsDayPeriod(r.Period,!1)&&!this.IsApiPeriod){var s=r.GetPeriodData(r.Period);r.Data=s}this.Symbol=t.symbol,this.Name=t.name,this.BindMainData(r,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("RecvHistoryData"),this.Frame.SetSizeChage(!0),this.BindInstructionIndexData(r);for(var o=0;o<this.Frame.SubFrame.length;++o)0==o&&(i=this.Frame.SubFrame[o].Frame),this.BindIndexData(o,r);i&&i.YSplitOperator&&(i.YSplitOperator.Symbol=this.Symbol,i.YSplitOperator.Data=this.ChartPaint[0].Data,i.YSplitOperator.Period=this.Period);var h=this.Page.Day;(0==h.Enable||1==h.Enable&&1==h.Finish)&&(this.RequestFlowCapitalData(),this.RequestOverlayHistoryData(),this.CreateChartDrawPictureByStorage()),h.Enable&&(h.Index=1),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdatePointByCursorIndex(2),this.Draw();for(o=0;o<this.Frame.SubFrame.length;++o){var l=this.Frame.SubFrame[o];for(var u in l.OverlayIndex){var C=l.OverlayIndex[u];this.BindOverlayIndexData(C,o,r)}}if(this.mapEvent.has(b.RECV_HISTROY_DATA)){var D=this.mapEvent.get(b.RECV_HISTROY_DATA);t={HistoryData:r,Stock:{Symbol:this.Symbol,Name:this.Name}};D.Callback(D,t,this)}},this.RequestHistoryPageData=function(){var t=this;if(this.NetworkFilter){var e=this.SourceData.Data[0],a={Name:"KLineChartContainer::RequestHistoryPageData",Explain:"日K数据分页",Request:{Url:"none",Type:"POST",Data:{symbol:t.Symbol,index:t.Page.Day.Index,field:["name","symbol","yclose","open","price","high","low","vol"],firstDate:e.Date,first:{date:e.Date}}},Page:t.Page.Day,Self:this,PreventDefault:!1};if(this.NetworkFilter(a,(function(e){t.RecvHistoryPageData(e);var a=t.Page.Day;1==a.Enable&&0==a.Finish?t.RequestHistoryPageData():t.AutoUpdate()})),1==a.PreventDefault)return}setTimeout((function(){var e=t.Page.Day;e.Finish=!0;var a={data:[[20150218,12.54,12.5,12.74,11.95,12.27,117632441,1459671045],[20150219,12.27,12.1,12.23,11.9,12.23,95889423,1157078548],[20150220,12.23,12.17,12.17,11.9,12.05,67763439,815652761]],symbol:t.Symbol,name:t.Name};t.RecvHistoryPageData(a),1==e.Enable&&0==e.Finish?t.RequestHistoryPageData():t.AutoUpdate()}),500)},this.RecvHistoryPageData=function(t){var e=Pa.JsonDataToHistoryData(t),a=this.GetHistoryDataCount();for(var i in e){var r=e[i];this.SourceData.Data.splice(i,0,r)}var n=new It;if(n.Data=this.SourceData.Data,n.Period=this.Period,n.Right=this.Right,n.DataType=this.SourceData.DataType,n.Right>0&&n.Period<=3){var s=n.GetRightDate(n.Right);n.Data=s}if(It.IsDayPeriod(n.Period,!1)||It.IsMinutePeriod(n.Period,!1)){var o=n.GetPeriodData(n.Period);n.Data=o}this.UpdateMainData(n,a),this.BindInstructionIndexData(n);for(i=0;i<this.Frame.SubFrame.length;++i)this.BindIndexData(i,n);var h=this.Page.Day;++h.Index,1==h.Enable&&1==h.Finish&&(this.RequestFlowCapitalData(),this.RequestOverlayHistoryData(),this.CreateChartDrawPictureByStorage()),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()},this.ReqeustHistoryMinuteData=function(){var t=this;if(this.ChartSplashPaint.IsEnableSplash=!0,this.FlowCapitalReady=!1,this.ResetPage(),this.ResetDragDownload(),this.Draw(),this.NetworkFilter){var e={Name:"KLineChartContainer::ReqeustHistoryMinuteData",Explain:"1分钟K线数据",Request:{Url:t.MinuteKLineApiUrl,Type:"POST",Data:{symbol:t.Symbol,count:t.MaxRequestMinuteDayCount,field:["name","symbol","yclose","open","price","high","low","vol"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(e,(function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvMinuteHistoryData(e);var a=t.Page.Minute;1==a.Enable&&0==a.Finish?t.ReqeustHistoryMinutePageData():(t.AutoUpdateEvent(!0,"KLineChartContainer::ReqeustHistoryMinuteData"),t.AutoUpdate())})),1==e.PreventDefault)return}x.HttpRequest({url:this.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvMinuteHistoryData(e);var a=t.Page.Minute;1==a.Enable&&0==a.Finish?t.ReqeustHistoryMinutePageData():(t.AutoUpdateEvent(!0,"KLineChartContainer::ReqeustHistoryMinuteData"),t.AutoUpdate())}})},this.RecvMinuteHistoryData=function(t){var e=Pa.JsonDataToMinuteHistoryData(t),a=new It;a.Data=e,a.DataType=1,a.Symbol=t.symbol,this.SourceData=a,this.BeforeBindMainData&&this.BeforeBindMainData("RecvMinuteHistoryData");var i,r=new It;if(r.Data=e,r.Right=this.Right,r.Period=this.Period,r.DataType=1,r.Symbol=t.symbol,It.IsMinutePeriod(r.Period,!1)&&!this.IsApiPeriod){var n=a.GetPeriodData(r.Period);r.Data=n}this.Symbol=t.symbol,this.Name=t.name,this.BindMainData(r,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("RecvMinuteHistoryData"),this.Frame.SetSizeChage(!0),this.BindInstructionIndexData(r);for(var s=0;s<this.Frame.SubFrame.length;++s)0==s&&(i=this.Frame.SubFrame[s].Frame),this.BindIndexData(s,r);for(var s in i&&i.YSplitOperator&&(i.YSplitOperator.Symbol=this.Symbol,i.YSplitOperator.Data=this.ChartPaint[0].Data,i.YSplitOperator.Period=this.Period),this.OverlayChartPaint){var o=this.OverlayChartPaint[s];o.Data=null}var h=this.Page.Minute;(0==h.Enable||1==h.Enable&&1==h.Finish)&&(this.RequestFlowCapitalData(),this.RequestOverlayHistoryMinuteData(),this.CreateChartDrawPictureByStorage()),h.Enable&&++h.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(2),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw();for(s=0;s<this.Frame.SubFrame.length;++s){o=this.Frame.SubFrame[s];for(var l in o.OverlayIndex){var u=o.OverlayIndex[l];this.BindOverlayIndexData(u,s,r)}}if(this.mapEvent.has(b.RECV_HISTROY_DATA)){var C=this.mapEvent.get(b.RECV_HISTROY_DATA);t={HistoryData:r,Stock:{Symbol:this.Symbol,Name:this.Name}};C.Callback(C,t,this)}},this.ReqeustHistoryMinutePageData=function(){var t=this;if(this.NetworkFilter){var e=this.SourceData.Data[0],a={Name:"KLineChartContainer::RecvHistoryMinutePageData",Explain:"1分钟K线数据分页",Request:{Url:"none",Type:"POST",Data:{symbol:t.Symbol,index:t.Page.Minute.Index,field:["name","symbol","yclose","open","price","high","low","vol"],firstDate:e.Date,first:{date:e.Date,time:e.Time}}},Page:t.Page.Minute,Self:this,PreventDefault:!1};if(this.NetworkFilter(a,(function(e){t.RecvHistoryMinutePageData(e);var a=t.Page.Minute;1==a.Enable&&0==a.Finish?t.ReqeustHistoryMinutePageData():t.AutoUpdate()})),1==a.PreventDefault)return}setTimeout((function(){var e=t.Page.Minute;e.Finish=!0;var a={data:[[20190906,14.58,14.71,14.71,14.71,14.71,1096425,16128411,925],[20190906,14.71,14.73,14.74,14.71,14.71,2154859,31731820,930],[20190906,14.71,14.71,14.71,14.68,14.69,1427516,20989208,931],[20190906,14.69,14.69,14.71,14.68,14.7,1680503,24694143,932],[20190906,14.7,14.69,14.7,14.65,14.65,1315900,19310964,933],[20190906,14.65,14.66,14.69,14.65,14.68,702955,10313842,934],[20190906,14.68,14.7,14.71,14.67,14.67,1735266,25495875,935],[20190906,14.67,14.68,14.7,14.67,14.67,739e3,10845398,936],[20190906,14.67,14.67,14.68,14.67,14.68,389800,5721266,937],[20190906,14.68,14.68,14.7,14.68,14.69,648477,9527859,938],[20190906,14.69,14.7,14.71,14.69,14.7,1128400,16589794,939],[20190906,14.7,14.7,14.71,14.69,14.71,714858,10509708,940],[20190906,14.71,14.71,14.71,14.69,14.69,401500,5900477,941],[20190906,14.69,14.69,14.71,14.69,14.69,1165684,17131034,942],[20190906,14.69,14.69,14.7,14.67,14.67,498516,7321024,943],[20190906,14.67,14.68,14.68,14.67,14.67,350126,5139012,944],[20190906,14.67,14.67,14.69,14.67,14.69,561600,8246789,945]]};t.RecvHistoryMinutePageData(a),1==e.Enable&&0==e.Finish?t.ReqeustHistoryMinutePageData():t.AutoUpdate()}),500)},this.RecvHistoryMinutePageData=function(t){var e=Pa.JsonDataToMinuteHistoryData(t),a=this.GetHistoryDataCount();for(var i in e){var r=e[i];this.SourceData.Data.splice(i,0,r)}var n=new It;if(n.Data=this.SourceData.Data,n.Period=this.Period,n.Right=this.Right,n.DataType=this.SourceData.DataType,n.Right>0&&It.IsDayPeriod(n.Period,!1)){var s=n.GetRightDate(n.Right);n.Data=s}if(It.IsDayPeriod(n.Period,!1)||It.IsMinutePeriod(n.Period,!1)){var o=n.GetPeriodData(n.Period);n.Data=o}this.UpdateMainData(n,a),this.BindInstructionIndexData(n);for(i=0;i<this.Frame.SubFrame.length;++i)this.BindIndexData(i,n);var h=this.Page.Minute;(0==h.Enable||1==h.Enable&&1==h.Finish)&&(this.RequestFlowCapitalData(),this.CreateChartDrawPictureByStorage()),h.Enable&&++h.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()},this.RequestRealtimeData=function(){var t=this,e=[t.Symbol];for(var a in this.OverlayChartPaint){var i=this.OverlayChartPaint[a];i.Symbol&&(i.MainData&&i.Status==Rt.STATUS_FINISHED_ID&&e.push(i.Symbol))}if(this.NetworkFilter){var r={Name:"KLineChartContainer::RequestRealtimeData",Explain:"当天最新日线数据",Request:{Url:t.RealtimeApiUrl,Data:{symbol:e,field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time"]},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(r,(function(e){t.RecvRealtimeData(e),t.AutoUpdate()})),1==r.PreventDefault)return}x.HttpRequest({url:this.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time"],symbol:e,start:-1},type:"post",dataType:"json",async:!0,success:function(e){t.RecvRealtimeData(e),t.AutoUpdate()}})},this.RecvRealtimeData=function(t){if(1!=this.IsOnTouch){var e=Pa.JsonDataToRealtimeData(t,this.Symbol);if(e){var a=this.SourceData.Data[this.SourceData.Data.length-1],i=this.GetHistoryDataCount();if(a.Date==e.Date)M.Chart.Log("[KLineChartContainer::RecvRealtimeData] update kline by minute data",e),a.Close=e.Close,a.High=e.High,a.Low=e.Low,a.Vol=e.Vol,a.Amount=e.Amount,a.Position=e.Position;else{if(!(a.Date<e.Date))return;M.Chart.Log("[KLineChartContainer::RecvRealtimeData] insert kline by minute data",e);var r=new Dt;r.YClose=e.YClose,r.Open=e.Open,r.Close=e.Close,r.High=e.High,r.Low=e.Low,r.Vol=e.Vol,r.Amount=e.Amount,r.Date=e.Date,r.Position=e.Position,this.SourceData.Data.push(r)}var n=new It;if(n.Data=this.SourceData.Data,n.Period=this.Period,n.Right=this.Right,n.DataType=this.SourceData.DataType,n.Symbol=this.Symbol,n.Right>0&&It.IsDayPeriod(n.Period,!0)&&Li.IsSHSZStockA(this.Symbol)&&!this.IsApiPeriod){var s=n.GetRightDate(n.Right);n.Data=s}if(!this.IsApiPeriod&&(It.IsDayPeriod(n.Period,!1)||It.IsMinutePeriod(n.Period,!1))){var o=n.GetPeriodData(n.Period);n.Data=o}this.UpdateMainData(n,i),this.UpdateOverlayRealtimeData(t),this.BindInstructionIndexData(n);for(var h=0;h<this.Frame.SubFrame.length;++h)this.BindIndexData(h,n);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendKLineUpdateEvent(n)}}},this.UpdateOverlayRealtimeData=function(t){for(var e in this.OverlayChartPaint){var a=this.OverlayChartPaint[e];if(a.Symbol&&(a.MainData&&a.Status==Rt.STATUS_FINISHED_ID)){var i=Pa.JsonDataToRealtimeData(t,a.Symbol);if(i){var r=a.SourceData,n=r.Data[r.Data.length-1];if(n.Date==i.Date)M.Chart.Log("[KLineChartContainer::UpdateOverlayRealtimeData] update kline by minute data",i),n.Close=i.Close,n.High=i.High,n.Low=i.Low,n.Vol=i.Vol,n.Amount=i.Amount;else{if(!(a.Date<i.Date))continue;M.Chart.Log("[KLineChartContainer::UpdateOverlayRealtimeData] insert kline by minute data",i);var s=new Dt;s.YClose=i.YClose,s.Open=i.Open,s.Close=i.Close,s.High=i.High,s.Low=i.Low,s.Vol=i.Vol,s.Amount=i.Amount,s.Date=i.Date,r.Data.push(s)}var o=new It;if(o.Data=r.Data,o.Period=this.Period,o.Right=this.Right,o.DataType=0,o.Right>0&&Li.IsSHSZStockA(t.symbol)&&!this.IsApiPeriod){var h=o.GetRightDate(o.Right);o.Data=h}var l=this.SourceData.GetOverlayData(o.Data,this.IsApiPeriod);if(o.Data=l,It.IsDayPeriod(o.Period,!1)&&!this.IsApiPeriod){var u=o.GetPeriodData(o.Period);o.Data=u}a.Data=o}}}},this.RequestMinuteRealtimeData=function(){var t=this,e=[t.Symbol];for(var a in this.OverlayChartPaint){var i=this.OverlayChartPaint[a];i.Symbol&&(i.MainData&&i.Status==Rt.STATUS_FINISHED_ID&&e.push(i.Symbol))}if(this.NetworkFilter){var r={Name:"KLineChartContainer::RequestMinuteRealtimeData",Explain:"当天1分钟K线数据",Request:{Url:t.RealtimeApiUrl,Data:{symbol:e,field:["name","symbol","price","yclose","minutecount","minute","date","time"]},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(r,(function(e){t.RecvMinuteRealtimeData(e),t.AutoUpdate()})),1==r.PreventDefault)return}x.HttpRequest({url:this.RealtimeApiUrl,data:{field:["name","symbol","price","yclose","minutecount","minute","date","time"],symbol:e,start:-1},type:"post",dataType:"json",async:!0,success:function(e){t.RecvMinuteRealtimeData(e),t.AutoUpdate()}})},this.SetSourceDatatLimit=function(t){for(var e in this.SourceDataLimit=new g.default,t){var a=t[e];this.SourceDataLimit.set(a.Period,a.MaxCount),M.Chart.Log("[KLineChartContainer::SetSourceDatatLimit] Period="+a.Period+", MaxCount="+a.MaxCount)}},this.ReduceSourceData=function(){if(this.SourceDataLimit&&this.SourceDataLimit.has(this.Period)){var t=this.SourceDataLimit.get(this.Period),e=null;if(this.Frame.Data?this.Frame.SubFrame&&this.Frame.SubFrame[0]&&(e=this.Frame.SubFrame[0].Frame.Data):e=this.Frame.Data,e&&!(t<50)){var a=e.DataOffset,i=0;while(this.SourceData.Data.length>t)this.SourceData.Data.shift(),--a,++i;i>0&&(a<0&&(a=0),e.DataOffset=a,M.Chart.Log("[KLineChartContainer::ReduceSourceData] remove data "+i+", dataOffset="+a))}}},this.RecvMinuteRealtimeDataV2=function(t){if(1!=this.IsOnTouch){var e=Pa.JsonDataToMinuteHistoryData(t);if(e&&!(e.length<=0)){this.IsApiPeriod&&this.ReduceSourceData();var a=this.GetHistoryDataCount();if(this.SourceData&&this.SourceData.MergeMinuteData(e)){M.Chart.Log("[KLineChartContainer::RecvMinuteRealtimeDataV2] update kline by 1 minute data ["+a+"->"+this.SourceData.Data.length+"]");var i=new It;if(i.Data=this.SourceData.Data,i.Period=this.Period,i.Right=this.Right,i.DataType=this.SourceData.DataType,i.Symbol=this.Symbol,i.Right>0&&It.IsDayPeriod(i.Period,!0)&&!this.IsApiPeriod){var r=i.GetRightDate(i.Right);i.Data=r}if((It.IsDayPeriod(i.Period,!1)||It.IsMinutePeriod(i.Period,!1))&&!this.IsApiPeriod){var n=i.GetPeriodData(i.Period);i.Data=n}this.UpdateMainData(i,a),this.BindInstructionIndexData(i);for(var s=0;s<this.Frame.SubFrame.length;++s)this.BindIndexData(s,i);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendKLineUpdateEvent(i)}}}},this.RecvMinuteRealtimeData=function(t){if(1!=this.IsOnTouch)if(2!=t.ver){var e=Pa.JsonDataToMinuteRealtimeData(t,this.Symbol);if(e){this.IsApiPeriod&&this.ReduceSourceData();var a=this.GetHistoryDataCount(),i=this.SourceData.Data.length;if(this.SourceData.MergeMinuteData(e)){M.Chart.Log("[KLineChartContainer::RecvMinuteRealtimeData] update kline by 1 minute data ["+i+"->"+this.SourceData.Data.length+"]");var r=new It;if(r.Data=this.SourceData.Data,r.Period=this.Period,r.Right=this.Right,r.DataType=this.SourceData.DataType,r.Symbol=this.Symbol,r.Right>0&&It.IsDayPeriod(r.Period,!0)&&!this.IsApiPeriod){var n=r.GetRightDate(r.Right);r.Data=n}if((It.IsDayPeriod(r.Period,!1)||It.IsMinutePeriod(r.Period,!1))&&!this.IsApiPeriod){var s=r.GetPeriodData(r.Period);r.Data=s}this.UpdateMainData(r,a),this.UpdateOverlayMinuteRealtimeData(t),this.BindInstructionIndexData(r);for(var o=0;o<this.Frame.SubFrame.length;++o)this.BindIndexData(o,r);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendKLineUpdateEvent(r)}}}else this.RecvMinuteRealtimeDataV2(t)},this.UpdateOverlayMinuteRealtimeData=function(t){for(var e in this.OverlayChartPaint){var a=this.OverlayChartPaint[e];if(a.Symbol&&(a.MainData&&a.Status==Rt.STATUS_FINISHED_ID)){var i=Pa.JsonDataToMinuteRealtimeData(t,a.Symbol);if(i){var r=a.SourceData;if(!r.MergeMinuteData(i))return;var n=new It;n.Data=r.Data,n.Period=this.Period,n.Right=this.Right,n.DataType=0;var s=this.SourceData.GetOverlayMinuteData(n.Data,this.IsApiPeriod);if(n.Data=s,It.IsMinutePeriod(n.Period,!1)&&!this.IsApiPeriod){var o=n.GetPeriodData(n.Period);n.Data=o}a.Data=n}}}},this.GetHistoryDataCount=function(){var t=null;if(this.Frame.Data?this.Frame.SubFrame&&this.Frame.SubFrame[0]&&(t=this.Frame.SubFrame[0].Frame.Data):t=this.Frame.Data,!t)return-1;var e=t.Data.length;return e},this.GetRequestDataCount=function(){var t={MaxRequestDataCount:this.MaxReqeustDataCount,MaxRequestMinuteDayCount:this.MaxRequestMinuteDayCount};if(!this.SourceData||!this.SourceData.Data||this.SourceData.Data.length<=0)return t;if(It.IsDayPeriod(this.Period,!0)){var e=this.SourceData.Data.length;e>t.MaxRequestDataCount&&(t.MaxRequestDataCount=e)}else if(It.IsMinutePeriod(this.Period,!0)){var a;e=0;for(var i in this.SourceData.Data){var r=this.SourceData.Data[i];r.Date!=a&&++e,a=r.Date}e>t.MaxRequestMinuteDayCount&&(t.MaxRequestMinuteDayCount=e)}return t},this.RequestTickData=function(){var t=this;t.ChartSplashPaint.IsEnableSplash=!0,t.Draw();var e=Ma.CacheDomain+"/cache/dealday/today/"+t.Symbol+".json";if(this.NetworkFilter){var a={Name:"KLineChartContainer::RequestTickData",Explain:"当天分笔数据",Request:{Url:e,Data:{symbol:t.Symbol},Type:"GET"},Self:this,PreventDefault:!1};if(this.NetworkFilter(a,(function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvTickData(e),t.AutoUpdate()})),1==a.PreventDefault)return}x.HttpRequest({url:e,data:{symbol:t.Symbol},type:"get",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvTickData(e),t.AutoUpdate(1)},error:function(e,a){t.ChartSplashPaint.IsEnableSplash=!1,t.AutoUpdate()}})},this.RecvTickData=function(t){var e=Pa.JsonDataToTickData(t),a=new It;a.Data=e,a.DataType=2,this.SourceData=a,this.BeforeBindMainData&&this.BeforeBindMainData("RecvTickData");var i,r=new It;r.Data=e,r.Right=this.Right,r.Period=this.Period,r.DataType=2,this.Symbol=t.symbol,this.Name=t.name,this.BindMainData(r,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("RecvTickData"),this.BindInstructionIndexData(r);for(var n=0;n<this.Frame.SubFrame.length;++n)0==n&&(i=this.Frame.SubFrame[n].Frame),this.BindIndexData(n,r);if(i&&i.YSplitOperator&&(i.YSplitOperator.Symbol=this.Symbol,i.YSplitOperator.Data=this.ChartPaint[0].Data,i.YSplitOperator.Period=this.Period,i.YSplitOperator.KLineChart=this.ChartPaint[0]),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex(),this.mapEvent.has(b.RECV_HISTROY_DATA)){var s=this.mapEvent.get(b.RECV_HISTROY_DATA);t={HistoryData:r,Stock:{Symbol:this.Symbol,Name:this.Name}};s.Callback(s,t,this)}},this.RequestTickRealtimeData=function(){var t=this,e=0;if(this.SourceData&&this.SourceData.Data&&(e=this.SourceData.Data.length),this.NetworkFilter){var a={Name:"KLineChartContainer::RequestTickRealtimeData",Explain:"当天最新分笔数据",Request:{Url:t.TickApiUrl,Data:{symbol:t.Symbol,start:e,end:e+1e3},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(a,(function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvTickData(e),t.AutoUpdate()})),1==a.PreventDefault)return}x.HttpRequest({url:t.TickApiUrl,data:{symbol:t.Symbol,start:e-10,end:e+1e3},type:"post",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvTickRealtimeData(e),t.AutoUpdate()}})},this.RecvTickRealtimeData=function(t){var e=Pa.JsonDataToTickData(t);if(e&&!(e.length<=0)){var a=this.SourceData.Data,i=this.SourceData.Data.length,r=0;a.length>0&&(r=a[a.length-1].Time);var n=0;for(var s in e){var o=e[s];o.Time<=r||(a.push(o),++n)}if(!(n<=0)){var h=new It;h.Data=a,h.Right=this.Right,h.Period=this.Period,h.DataType=2,this.Symbol=t.symbol,this.Name=t.name,this.UpdateMainData(h,i),this.BindInstructionIndexData(h);for(s=0;s<this.Frame.SubFrame.length;++s)this.BindIndexData(s,h);this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex()}}},this.ChangePeriod=function(t,e){var a=!1,i=!1;if(e&&(e.KLine&&Le.IsNumber(e.KLine.DrawType)&&(a=!0),1==e.Reload&&(i=!0)),this.Period!=t||0!=i){a&&this.ChangeKLineDrawType(e.KLine.DrawType,!1);var r=!1;if(t>pt&&t<=Tt)0!=this.SourceData.DataType&&(r=!0);else if(t>At&&t<=gt||t>Ft&&t<=Et)1!=this.SourceData.DataType&&(r=!0);else switch(t){case 0:case 1:case 2:case 3:case 9:case 21:0!=this.SourceData.DataType&&(r=!0);break;case 4:case 5:case 6:case 7:case 8:case 11:case 12:1!=this.SourceData.DataType&&(r=!0);break;case 10:2!=this.SourceData.DataType&&(r=!0);break}this.Period=t,this.ReloadChartDrawPicture(),0!=r||this.IsApiPeriod?It.IsDayPeriod(this.Period,!0)?(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangePeriod"),this.ResetOverlaySymbolStatus(),this.RequestHistoryData(),this.ReqeustKLineInfoData()):It.IsMinutePeriod(this.Period,!0)||It.IsSecondPeriod(this.Period)?(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangePeriod"),this.ResetOverlaySymbolStatus(),this.ReqeustHistoryMinuteData()):It.IsTickPeriod(this.Period)&&(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangePeriod"),this.RequestTickData()):this.Update({UpdateCursorIndexType:2})}else a&&this.ChangeKLineDrawType(e.KLine.DrawType)},this.ChangeRight=function(t){if(Li.IsSHSZStockA(this.Symbol)&&!It.IsTickPeriod(this.Period)){var e=this.Symbol.toUpperCase();Li.IsBIT(e)||t<0||t>2||this.Right!=t&&(this.Right=t,this.IsApiPeriod?It.IsDayPeriod(this.Period,!0)?(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeRight"),this.ResetOverlaySymbolStatus(),this.RequestHistoryData()):(It.IsMinutePeriod(this.Period,!0)||It.IsSecondPeriod(this.Period))&&(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeRight"),this.ResetOverlaySymbolStatus(),this.ReqeustHistoryMinuteData()):this.Update())}},this.SetFirstShowDate=function(t){if(t&&t.Date){M.Chart.Log("[KLineChartContainer::SetFirstShowDate] obj=",t);var e=null;if(e=this.Frame.Data?this.Frame.SubFrame[0].Frame.Data:this.Frame.Data,e){var a=null;if(It.IsDayPeriod(this.Period,!0))for(var i=0;i<e.Data.length;++i){var r=e.Data[i];if(r.Date>=t.Date){a=i;break}}else if(It.IsMinutePeriod(this.Period,!0)){var n=t.Time;if(Le.IsPlusNumber(n))for(i=0;i<e.Data.length;++i){r=e.Data[i];if(r.Date>t.Date||r.Date==t.Date&&r.Time>=n){a=i;break}}else for(i=0;i<e.Data.length;++i){r=e.Data[i];if(r.Date>=t.Date){a=i;break}}}if(null!==a){var s=e.Data.length-a,o=s;t.PageSize>0&&(o=t.PageSize);var h=this.GetMaxMinPageSize();for(var i in h.Max<o?o=h.Max:h.Min>o&&(o=h.Min),this.Frame.SubFrame){r=this.Frame.SubFrame[i].Frame;r.XPointCount=o}e.DataOffset=a,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,M.Chart.Log("[KLineChartContainer::SetFirstShowDate] dataOffset="+e.DataOffset+" CursorIndex="+this.CursorIndex+" PageSize="+o),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdatePointByCursorIndex(2),this.Draw()}else M.Chart.Log("[KLineChartContainer::SetFirstShowDate] an't find first date="+t.Date+" time="+t.Time,t)}}},this.DeleteIndexPaint=function(t){var e=new Array;for(var a in this.ChartPaint){var i=this.ChartPaint[a];0!=a&&i.ChartFrame==this.Frame.SubFrame[t].Frame||e.push(i)}this.Frame.SubFrame[t].Frame.YSpecificMaxMin=null,this.Frame.SubFrame[t].Frame.IsLocked=!1,this.Frame.SubFrame[t].Frame.YSplitScale=null,this.ChartPaint=e;var r=t+1;this.TitlePaint[r].Data=[],this.TitlePaint[r].Title=null},this.ShowKLine=function(t){this.ChartPaint.length<=0||!this.ChartPaint[0]||(this.ChartPaint[0].IsShow=t)},this.SetInstructionData=function(t,e){if(!(this.ChartPaint.length<=0)&&this.ChartPaint[0]){var a=this.TitlePaint[1];2==t?(this.ChartPaint[0].ColorData=e.Data,a&&(a.ColorIndex={Name:e.Name,Param:e.Param})):1==t&&(this.ChartPaint[0].TradeData={Sell:e.Sell,Buy:e.Buy,Name:e.Name,Param:e.Param},a&&(a.TradeIndex={Name:e.Name,Param:e.Param}))}},this.ChangeInstructionIndex=function(t){var e=new P,a=e.Get(t);a&&(1!=a.InstructionType&&2!=a.InstructionType||(a.ID=t,this.ChangeInstructionScriptIndex(a)))},this.ChangeInstructionScriptIndex=function(t){if(1==t.InstructionType)this.TradeIndex=new Cr(t.Name,t.Script,t.Args,t);else{if(2!=t.InstructionType)return;this.ColorIndex=new Cr(t.Name,t.Script,t.Args,t)}var e=this.ChartPaint[0].Data;this.BindInstructionIndexData(e),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.CancelInstructionIndex=function(){if(!(this.ChartPaint.length<=0)&&this.ChartPaint[0]){this.ColorIndex=null,this.TradeIndex=null,this.ChartPaint[0].ColorData=null,this.ChartPaint[0].TradeData=null;var t=this.TitlePaint[1];t&&(t.TradeIndex=null,t.ColorIndex=null),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.ChangeScriptIndex=function(t,e){this.DeleteIndexPaint(t),this.WindowIndex[t]=new Cr(e.Name,e.Script,e.Args,e);var a=this.ChartPaint[0].Data;this.BindIndexData(t,a),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeAPIIndex=function(t,e){this.DeleteIndexPaint(t);var a=e.API;this.WindowIndex[t]=new cr(a.Name,a.Script,a.Args,e);var i=this.ChartPaint[0].Data;this.BindIndexData(t,i),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeIndex=function(t,e,a){if(a&&a.API)return this.ChangeAPIIndex(t,a);var i=ya.Get(e);if(!i){var r=new P,n=r.Get(e);if(!n)return;n.IsMainIndex?t=0:0==t&&(t=1);var s={Name:n.Name,Script:n.Script,Args:n.Args,ID:e,KLineType:n.KLineType,YSpecificMaxMin:n.YSpecificMaxMin,YSplitScale:n.YSplitScale,FloatPrecision:n.FloatPrecision,Condition:n.Condition,StringFormat:n.StringFormat};return a&&(a.FloatPrecision>=0&&(s.FloatPrecision=a.FloatPrecision),a.StringFormat>0&&(s.StringFormat=a.StringFormat),a.Args&&(s.Args=a.Args),a.TitleFont&&(s.TitleFont=a.TitleFont),a.IsShortTitle&&(s.IsShortTitle=a.IsShortTitle)),this.ChangeScriptIndex(t,s)}i.IsMainIndex?t>0&&(t=0):0==t&&(t=1);var o=new Array;for(var h in this.ChartPaint){var l=this.ChartPaint[h];0!=h&&l.ChartFrame==this.Frame.SubFrame[t].Frame||o.push(l)}this.Frame.SubFrame[t].Frame.YSpecificMaxMin=null,this.Frame.SubFrame[t].Frame.IsLocked=!1,this.Frame.SubFrame[t].Frame.YSplitScale=null,this.ChartPaint=o;var u=t+1;this.TitlePaint[u].Data=[],this.TitlePaint[u].Title=null,this.WindowIndex[t]=i.Create(),this.CreateWindowIndex(t);var C=this.ChartPaint[0].Data;this.BindIndexData(t,C),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangePyScriptIndex=function(t,e){this.DeleteIndexPaint(t),this.WindowIndex[t]=new ti(e.Name,e.Script,e.Args,e);var a=this.ChartPaint[0].Data;this.BindIndexData(t,a),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.AddOverlayIndex=function(t){var e=this.CreateOverlayWindowsIndex(t);if(e){var a=this.ChartPaint[0].Data;this.BindOverlayIndexData(e,t.WindowIndex,a),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.CreateOverlayWindowsIndex=function(t){var e=t.IndexName,a=t.WindowIndex,i=null,r=null,n=null;if(t.API)i=t.API;else{var s=new P;if(r=s.Get(e),!r&&(n=ya.Get(e),!n))return console.warn("[KLineChartContainer::CreateOverlayIndex] can not find index["+e+"]"),null}var o=this.Frame.SubFrame[a];o.Interval=this.OverlayIndexFrameWidth;var h=new ht;t.Identify&&(h.Identify=t.Identify);var l="KLineChartHScreenContainer"===this.ClassName?new st:new rt;if(l.Canvas=this.Canvas,l.MainFrame=o.Frame,l.ChartBorder=o.Frame.ChartBorder,!0===t.ShowRightText?l.IsShow=!0:!1===t.ShowRightText&&(l.IsShow=!1),l.YSplitOperator=new xe,l.YSplitOperator.LanguageID=this.LanguageID,l.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),l.YSplitOperator.Frame=l,l.YSplitOperator.ChartBorder=l.ChartBorder,l.YSplitOperator.SplitCount=o.Frame.YSplitOperator.SplitCount,h.Frame=l,i){var u=new cr(i.Name,i.Script,i.Args,t,!0);u.OverlayIndex={IsOverlay:!0,Identify:h.Identify,WindowIndex:a,Frame:h},h.Script=u}else if(r){var C={Name:r.Name,Script:r.Script,Args:r.Args,ID:e,KLineType:r.KLineType,YSpecificMaxMin:r.YSpecificMaxMin,YSplitScale:r.YSplitScale,FloatPrecision:r.FloatPrecision,Condition:r.Condition};t.Args&&(C.Args=t.Args);var D=new Dr(C.Name,C.Script,C.Args,C);D.OverlayIndex={IsOverlay:!0,Identify:h.Identify,WindowIndex:a,Frame:h},h.Script=D}else{D=n.Create();D.OverlayIndex={IsOverlay:!0,Identify:h.Identify,WindowIndex:a,Frame:h},D.Create(this,a),h.Script=D}return o.OverlayIndex.push(h),h},this.DeleteOverlayWindowsIndex=function(t){var e=null;for(var a in this.Frame.SubFrame){var i=this.Frame.SubFrame[a];for(var r in i.OverlayIndex){var n=i.OverlayIndex[r];if(n.Identify===t){i.OverlayIndex.splice(r,1),e=parseInt(a);break}}}if(null!=e){var s=e+1,o=this.TitlePaint[s];o.OverlayIndex.has(t)&&o.OverlayIndex.delete(t),this.Draw()}else console.warn("[KLineChartContainer::DeleteOverlayWindowsIndex] can't find overlay index. [identify="+t+"]")},this.ChangeKLineDrawType=function(t,e){if(this.KLineDrawType!=t){for(var a in this.KLineDrawType=t,this.ChartPaint){var i=this.ChartPaint[a];0==a?i.DrawType=this.KLineDrawType:"ChartVolStick"==i.ClassName&&(i.KLineDrawType=this.KLineDrawType)}for(var a in this.OverlayChartPaint){i=this.OverlayChartPaint[a];i.DrawType=this.KLineDrawType}0!=e&&(this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw())}},this.ChangeCoordinateType=function(t){if((this.Frame||this.Frame.SubFrame)&&this.Frame.SubFrame.length){if(Le.IsNumber(t)){var e=t;if(2==e)this.Frame.SubFrame[0].Frame.CoordinateType=1;else if(1==e)this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=e;else if(0==e)this.Frame.SubFrame[0].Frame.CoordinateType=0,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=0;else{if(3!=e)return;this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=2}}else t.Type>=0&&t.Type<=2&&(this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=t.Type),!0===t.IsReverse?this.Frame.SubFrame[0].Frame.CoordinateType=1:0==t.IsReverse&&(this.Frame.SubFrame[0].Frame.CoordinateType=0);this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.ChangeIndexWindowCount=function(t,e){if(!(t<=0)&&this.Frame.SubFrame.length!=t){var a=this.Frame.SubFrame.length;if(a>t){for(var i=a-1;i>=t;--i)this.DeleteIndexPaint(i),this.Frame.SubFrame[i].Frame.ClearToolbar();this.Frame.SubFrame.splice(t,a-t),this.WindowIndex.splice(t,a-t);for(i=0;i<this.Frame.SubFrame.length;++i){var r=this.Frame.SubFrame[i].Frame;i==this.Frame.SubFrame.length-1?r.XSplitOperator.ShowText=!0:r.XSplitOperator.ShowText=!1}}else{for(i=a;i<t;++i){var n=this.CreateSubFrameItem(i);this.Frame.SubFrame[i]=n;var s=new $e;s.Frame=this.Frame.SubFrame[i].Frame,s.Canvas=this.Canvas,s.LanguageID=this.LanguageID,this.TitlePaint[i+1]=s}var o=[{Index:"RSI"},{Index:"MACD"},{Index:"VOL"},{Index:"UOS"},{Index:"CHO"},{Index:"BRAR"}];e&&e.Windows.length>0&&(o=e.Windows);var h=new P;for(i=a;i<t;++i){r=o[i%o.length];var l=r.Index,u=h.Get(l),C=u.Args;r.Args&&(C=r.Args);var D={Name:u.Name,Script:u.Script,Args:C,ID:r.Index,KLineType:u.KLineType,YSpecificMaxMin:u.YSpecificMaxMin,YSplitScale:u.YSplitScale,FloatPrecision:u.FloatPrecision,Condition:u.Condition};this.WindowIndex[i]=new Cr(D.Name,D.Script,D.Args,D),null!=r.Modify&&(this.Frame.SubFrame[i].Frame.ModifyIndex=r.Modify),null!=r.Change&&(this.Frame.SubFrame[i].Frame.ChangeIndex=r.Change),null!=r.Close&&(this.Frame.SubFrame[i].Frame.CloseIndex=r.Close),null!=r.Overlay&&(chart.Frame.SubFrame[i].Frame.OverlayIndex=r.Overlay),1==r.IsDrawTitleBG&&(this.Frame.SubFrame[i].Frame.IsDrawTitleBG=r.IsDrawTitleBG),Le.IsNumber(r.TitleHeight)?this.Frame.SubFrame[i].Frame.ChartBorder.TitleHeight=r.TitleHeight:r.TitleHeight=this.Frame.SubFrame[i].Frame.ChartBorder.TitleHeight,0==r.IsShowTitleArraw&&(this.Frame.SubFrame[i].Frame.IsShowTitleArraw=!1),0==r.IsShowIndexName&&(this.Frame.SubFrame[i].Frame.IsShowIndexName=!1),r.IndexParamSpace>=0&&(this.Frame.SubFrame[i].Frame.IndexParamSpace=r.IndexParamSpace);var c=this.ChartPaint[0].Data;this.BindIndexData(i,c)}for(i=0;i<this.Frame.SubFrame.length;++i){r=this.Frame.SubFrame[i].Frame;i==this.Frame.SubFrame.length-1?r.XSplitOperator.ShowText=!0:r.XSplitOperator.ShowText=!1}this.UpdataDataoffset()}this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}},this.ChangeIndexTemplate=function(t){if(t.Windows){var e=t.Windows.length;if(!(e<=0)){for(var a=this.Frame.SubFrame.length,i=0;i<a;++i){this.DeleteIndexPaint(i);var r=this.Frame.SubFrame[i];r.YSpecificMaxMin=null,r.IsLocked=!1,r.YSplitScale=null}if(a>e){for(i=a-1;i>=e;--i)this.Frame.SubFrame[i].Frame.ClearToolbar();this.Frame.SubFrame.splice(e,a-e),this.WindowIndex.splice(e,a-e)}else for(i=a;i<e;++i){var n=this.CreateSubFrameItem(i);this.Frame.SubFrame[i]=n;var s=new $e;s.Frame=this.Frame.SubFrame[i].Frame,s.Canvas=this.Canvas,s.LanguageID=this.LanguageID,this.TitlePaint[i+1]=s}var o=new P,h=this.ChartPaint[0].Data;for(i=0;i<e;++i){var l=i,u=t.Windows[i],C=l+1;if(this.TitlePaint[C].Data=[],this.TitlePaint[C].Title=null,u.Script)this.WindowIndex[i]=new Cr(u.Name,u.Script,u.Args,u),this.BindIndexData(l,h);else{var D=u.Index,c=ya.Get(D);if(c)this.WindowIndex[i]=c.Create(),this.CreateWindowIndex(l),this.BindIndexData(l,h);else{var f=o.Get(D);if(f){var d=f.Args;t.Windows[i].Args&&(d=t.Windows[i].Args);var m={Name:f.Name,Script:f.Script,Args:d,ID:D,KLineType:f.KLineType,YSpecificMaxMin:f.YSpecificMaxMin,YSplitScale:f.YSplitScale,FloatPrecision:f.FloatPrecision,Condition:f.Condition};this.WindowIndex[i]=new Cr(m.Name,m.Script,m.Args,m),this.BindIndexData(l,h)}}}null!=u.Modify&&(this.Frame.SubFrame[i].Frame.ModifyIndex=u.Modify),null!=u.Change&&(this.Frame.SubFrame[i].Frame.ChangeIndex=u.Change),null!=u.Close&&(this.Frame.SubFrame[i].Frame.CloseIndex=u.Close),null!=u.Overlay&&(chart.Frame.SubFrame[i].Frame.OverlayIndex=u.Overlay),1==u.IsDrawTitleBG&&(this.Frame.SubFrame[i].Frame.IsDrawTitleBG=u.IsDrawTitleBG),Le.IsNumber(u.TitleHeight)?this.Frame.SubFrame[i].Frame.ChartBorder.TitleHeight=u.TitleHeight:u.TitleHeight=this.Frame.SubFrame[i].Frame.ChartBorder.TitleHeight,0==u.IsShowTitleArraw&&(this.Frame.SubFrame[i].Frame.IsShowTitleArraw=!1),0==u.IsShowIndexName&&(this.Frame.SubFrame[i].Frame.IsShowIndexName=!1),u.IndexParamSpace>=0&&(this.Frame.SubFrame[i].Frame.IndexParamSpace=u.IndexParamSpace)}for(i=0;i<this.Frame.SubFrame.length;++i){u=this.Frame.SubFrame[i].Frame;i==this.Frame.SubFrame.length-1?u.XSplitOperator.ShowText=!0:u.XSplitOperator.ShowText=!1}this.UpdataDataoffset(),this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}}},this.RemoveIndexWindow=function(t){if(M.Chart.Log("[KLineChartContainer::RemoveIndexWindow] remove id",t),0!=t&&this.Frame.SubFrame&&!(t>=this.Frame.SubFrame.length)){var e=this.Frame.SubFrame[t].Frame;this.DeleteIndexPaint(t),this.Frame.SubFrame[t].Frame.ClearToolbar(),this.Frame.SubFrame.splice(t,1),this.WindowIndex.splice(t,1),this.TitlePaint.splice(t+1,1);for(var a=0;a<this.Frame.SubFrame.length;++a){var i=this.Frame.SubFrame[a].Frame;a==this.Frame.SubFrame.length-1?i.XSplitOperator.ShowText=!0:i.XSplitOperator.ShowText=!1,i.Identify=a}if(this.ChartDrawPicture.length>0){var r=[];for(var a in this.ChartDrawPicture){i=this.ChartDrawPicture[a];i.Frame!=e&&r.push(i)}this.ChartDrawPicture=r}this.Frame.SetSizeChage(!0),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()}},this.GetIndexInfo=function(){var t=[];for(var e in this.WindowIndex){var a=this.WindowIndex[e],i={Name:a.Name};a.ID&&(i.ID=a.ID),t.push(i)}return t},this.CreateExtendChart=function(t,e){var a;switch(t){case"筹码分布":return a=new pe,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.Left=this.Frame.ChartBorder.Right,a.SetOption(e),this.ExtendChartPaint.push(a),this.Frame.ChartBorder.Right+=a.Width,a;case"画图工具":return a=new Te,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.Left=this.Frame.ChartBorder.Right,a.SetOption(e),this.ExtendChartPaint.push(a),this.Frame.ChartBorder.Right+=a.Width,a;case"KLineTooltip":return a=e.Create&&"function"==typeof e.Create?e.Create():new ve,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,e.LanguageID=this.LanguageID,a.SetOption(e),this.ExtendChartPaint.push(a),a;case"深度图":return a=new Ae,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.SetOption(e),this.ExtendChartPaint.push(a),a;case"背景图":return a=new ge,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.SetOption(e),this.ExtendChartPaint.push(a),a;default:return null}},this.OnTouchFinished=function(){if(this.DragMode==_.CLICK_TOUCH_MODE_ID){if(1==this.TouchStatus.CorssCursorShow&&this.TouchDrawCount>0)return;return this.TouchStatus.CorssCursorShow=!1,void this.DrawDynamicInfo()}if(!0!==this.CorssCursorTouchEnd)for(var t in this.ExtendChartPaint){var e=this.ExtendChartPaint[t];"KLineTooltipPaint"===e.ClassName&&this.DrawDynamicInfo()}else this.TouchDrawCount>0&&this.DrawDynamicInfo()},this.GetExtendChartByClassName=function(t){for(var e in this.ExtendChartPaint){var a=this.ExtendChartPaint[e];if(a.ClassName==t)return{Index:e,Chart:a}}return null},this.DeleteExtendChart=function(t){t.Index>=this.ExtendChartPaint.length||this.ExtendChartPaint[t.Index]==t.Chart&&("function"==typeof t.Chart.Clear&&t.Chart.Clear(),this.ExtendChartPaint.splice(t.Index,1))},this.LockIndex=function(t){if(t&&t.IndexName)for(var e in this.WindowIndex){var a=this.WindowIndex[e];if(a||conintue,a.Name==t.IndexName){a.SetLock(t),this.Update();break}}},this.TryClickLock=function(t,e){for(var a in this.Frame.SubFrame){var i=this.Frame.SubFrame[a];if(i.Frame.IsLocked&&i.Frame.LockPaint){var r=new Lt;if(i.Frame.LockPaint.GetTooltipData(t,e,r))return r.HQChart=this,r.Data.Callback&&r.Data.Callback(r),!0}}return!1},this.TryClickIndexTitle=function(t,e){for(var a in this.TitlePaint){var i=this.TitlePaint[a];if(i.IsClickTitle&&i.IsClickTitle(t,e)){var r={Point:{X:t,Y:e},Title:i.Title,FrameID:i.Frame.Identify};M.Chart.Log("[KLineChartContainer::TryClickIndexTitle] click title ",r);var n=this.GetEventCallback(b.ON_CLICK_INDEXTITLE);return n&&n.Callback&&n.Callback(n,r,this),!0}}return!1},this.SetSizeChage=function(t){for(var e in this.Frame.SetSizeChage(t),this.ExtendChartPaint){var a=this.ExtendChartPaint[e];a.SizeChange=t}},this.Update=function(t){if(this.SourceData){this.BeforeBindMainData&&this.BeforeBindMainData("Update");var e=new It;if(e.Data=this.SourceData.Data,e.Period=this.Period,e.Right=this.Right,e.DataType=this.SourceData.DataType,e.Symbol=this.Symbol,e.Right>0&&It.IsDayPeriod(e.Period,!0)){var a=e.GetRightDate(e.Right);e.Data=a}if(It.IsDayPeriod(e.Period,!1)||It.IsMinutePeriod(e.Period,!1)){var i=e.GetPeriodData(e.Period);e.Data=i}this.BindMainData(e,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("Update");for(var r=0;r<this.Frame.SubFrame.length;++r)this.BindIndexData(r,e);for(var r in this.OverlayChartPaint){var n=this.OverlayChartPaint[r];if(n.SourceData)if(It.IsMinutePeriod(this.Period,!0)){e=new It;e.Data=n.SourceData.Data,e.Period=this.Period,e.Right=this.Right;var s=this.SourceData.GetOverlayMinuteData(e.Data,this.IsApiPeriod);if(e.Data=s,It.IsMinutePeriod(e.Period,!1)&&!this.IsApiPeriod){i=e.GetPeriodData(e.Period);e.Data=i}n.Data=e}else{e=new It;if(e.Data=n.SourceData.Data,e.Period=this.Period,e.Right=this.Right,e.Right>0&&Li.IsSHSZStockA(n.Symbol)){a=e.GetRightDate(e.Right);e.Data=a}s=this.SourceData.GetOverlayData(e.Data,this.IsApiPeriod);if(e.Data=s,It.IsDayPeriod(e.Period,!1)&&!this.IsApiPeriod){i=e.GetPeriodData(e.Period);e.Data=i}n.Data=e}}this.ReqeustKLineInfoData(),this.CreateChartDrawPictureByStorage(),this.UpdataDataoffset(),t&&t.UpdateCursorIndexType>0?this.UpdatePointByCursorIndex(t.UpdateCursorIndexType):this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw();for(r=0;r<this.Frame.SubFrame.length;++r){n=this.Frame.SubFrame[r];for(var o in n.OverlayIndex){var h=n.OverlayIndex[o];this.BindOverlayIndexData(h,r,e)}}}},this.ChangeSymbol=function(t){if(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeSymbol"),this.Symbol=t,t){if(Li.IsSHSZIndex(t)&&(this.Right=0),this.Frame&&this.Frame.SubFrame)for(var e=0;e<this.Frame.SubFrame.length;++e)this.DeleteIndexPaint(e);this.ReloadChartDrawPicture(),It.IsDayPeriod(this.Period,!0)?(this.RequestHistoryData(),this.ReqeustKLineInfoData()):It.IsMinutePeriod(this.Period,!0)||It.IsSecondPeriod(this.Period)?this.ReqeustHistoryMinuteData():It.IsTickPeriod(this.Period)&&this.RequestTickData()}else this.DrawEmpty()},this.ReqeustKLineInfoData=function(){if(this.ChartPaint.length>0){var t=this.ChartPaint[0];t.InfoData=new g.default}for(var e in this.ChartInfo)this.ChartInfo[e].RequestData(this)},this.SetKLineInfo=function(t,e){for(var a in this.ChartInfo=[],t){var i=ii.Get(t[a]);if(i){var r=i.Create();r.MaxReqeustDataCount=this.MaxReqeustDataCount,this.ChartInfo.push(r)}}1==e&&this.ReqeustKLineInfoData()},this.AddKLineInfo=function(t,e){var a=ii.GetClassInfo(t);if(a){for(var i in this.ChartInfo){var r=this.ChartInfo[i];if(r.ClassName==a.ClassName)return}var n=ii.Get(t);if(n){r=n.Create();r.MaxReqeustDataCount=this.MaxReqeustDataCount,this.ChartInfo.push(r),1==e&&r.RequestData(this)}}else console.warn("[KLineChartContainer::AddKLineInfo] can't find infoname=",t)},this.DeleteKLineInfo=function(t){var e=ii.GetClassInfo(t);if(e)for(var a in this.ChartInfo){var i=this.ChartInfo[a];if(i.ClassName==e.ClassName){this.ChartInfo.splice(a,1),this.UpdataChartInfo(),this.Draw();break}}else console.warn("[KLineChartContainer::DeleteKLineInfo] can't find infoname=",t)},this.ClearKLineInfo=function(){if(this.ChartInfo&&!(this.ChartInfo.length<=0)){this.ChartInfo=[];var t=this.ChartPaint[0];t.InfoData=null,this.Draw()}},this.OverlaySymbol=function(t,e){for(var a in this.OverlayChartPaint){var i=this.OverlayChartPaint[a];if(i.Symbol===t)return console.warn("[KLineChartContainer::OverlaySymbol] overlay symbol="+t+" exist."),!1}var r=new Pt;return r.Canvas=this.Canvas,r.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,r.ChartFrame=this.Frame.SubFrame[0].Frame,r.Name="Overlay-KLine",r.DrawType=this.KLineDrawType,r.Symbol=t,e&&e.Color?r.Color=e.Color:r.Color=Ma.OverlaySymbol.Color[Ma.OverlaySymbol.Random%Ma.OverlaySymbol.Color.length],r.SetOption(e),++Ma.OverlaySymbol.Random,this.ChartPaint[0]&&this.ChartPaint[0].Data&&this.SourceData&&(r.MainData=this.ChartPaint[0].Data),this.OverlayChartPaint.push(r),It.IsDayPeriod(this.Period,!0)?this.RequestOverlayHistoryData():It.IsMinutePeriod(this.Period,!0)&&this.RequestOverlayHistoryMinuteData(),!0},this.RequestOverlayHistoryData=function(){var t=this;if(this.OverlayChartPaint.length&&this.SourceData&&this.SourceData.Data){var e=this,a=this.GetRequestDataCount(),i=this.SourceData.Data[0].Date,r=function(){var r=t.OverlayChartPaint[n];if(!r.MainData)return"continue";if(r.Status!=Rt.STATUS_NONE_ID)return"continue";var o=r.Symbol;return o?(r.Status=Rt.STATUS_REQUESTDATA_ID,t.NetworkFilter&&(s={Name:"KLineChartContainer::RequestOverlayHistoryData",Explain:"叠加股票日K线数据",Request:{Url:e.KLineApiUrl,Data:{symbol:o,count:a.MaxRequestDataCount,first:{date:i},field:["name","symbol","yclose","open","price","high","vol","amount"]},Type:"POST"},Self:t,PreventDefault:!1},t.NetworkFilter(s,(function(t){r.Status=Rt.STATUS_RECVDATA_ID,e.RecvOverlayHistoryData(t,r)})),1==s.PreventDefault)?{v:void 0}:void x.HttpRequest({url:t.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high"],symbol:o,start:-1,count:a.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(t){r.Status=Rt.STATUS_RECVDATA_ID,e.RecvOverlayHistoryData(t,r)}})):"continue"};for(var n in this.OverlayChartPaint){var s,o=r();switch(o){case"continue":continue;default:if("object"===("undefined"===typeof o?"undefined":(0,d.default)(o)))return o.v}}}},this.RecvOverlayHistoryData=function(t,e){if(!e.IsDelete){var a=Pa.JsonDataToHistoryData(t),i=new It;i.Data=a,i.DataType=0;var r=new It;if(r.Data=a,r.Period=this.Period,r.Right=this.Right,r.DataType=0,r.Right>0&&Li.IsSHSZStockA(t.symbol)){var n=r.GetRightDate(r.Right);r.Data=n}var s=this.SourceData.GetOverlayData(r.Data,this.IsApiPeriod);if(r.Data=s,It.IsDayPeriod(r.Period,!1)&&!this.IsApiPeriod){var o=r.GetPeriodData(r.Period);r.Data=o}e.Data=r,e.SourceData=i,e.Title=t.name,e.Symbol=t.symbol,e.Status=Rt.STATUS_FINISHED_ID,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=1,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.RequestOverlayHistoryMinuteData=function(){var t=this;if(this.OverlayChartPaint.length&&this.SourceData&&this.SourceData.Data){var e=this,a=this.GetRequestDataCount(),i=this.SourceData.Data[0].Date,r=this.SourceData.Data[0].Time,n=function(){var n=t.OverlayChartPaint[s];if(!n.MainData)return"continue";if(n.Status!=Rt.STATUS_NONE_ID)return"continue";var h=n.Symbol;return h?(n.Status=Rt.STATUS_REQUESTDATA_ID,t.NetworkFilter&&(o={Name:"KLineChartContainer::RequestOverlayHistoryMinuteData",Explain:"叠加股票分钟K线数据",Request:{Url:e.MinuteKLineApiUrl,Data:{symbol:h,count:a.MaxRequestMinuteDayCount,first:{date:i,time:r},field:["name","symbol","yclose","open","price","high","vol","amount"]},Type:"POST"},Self:t,PreventDefault:!1},t.NetworkFilter(o,(function(t){n.Status=Rt.STATUS_RECVDATA_ID,e.RecvOveralyHistoryMinuteData(t,n)})),1==o.PreventDefault)?{v:void 0}:void x.HttpRequest({url:t.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","vol","amount"],symbol:h,start:-1,count:a.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(t){n.Status=Rt.STATUS_RECVDATA_ID,e.RecvOveralyHistoryMinuteData(t,n)}})):"continue"};for(var s in this.OverlayChartPaint){var o,h=n();switch(h){case"continue":continue;default:if("object"===("undefined"===typeof h?"undefined":(0,d.default)(h)))return h.v}}}},this.RecvOveralyHistoryMinuteData=function(t,e){var a=Pa.JsonDataToMinuteHistoryData(t);if(a){var i=new It;i.Data=a,i.DataType=1;var r=new It;r.Data=a,r.Period=this.Period,r.Right=this.Right,r.DataType=1;var n=this.SourceData.GetOverlayMinuteData(r.Data,this.IsApiPeriod);if(r.Data=n,It.IsMinutePeriod(r.Period,!1)&&!this.IsApiPeriod){var s=r.GetPeriodData(r.Period);r.Data=s}e.Data=r,e.SourceData=i,e.Title=t.name,e.Symbol=t.symbol,e.Status=Rt.STATUS_FINISHED_ID,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=1,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.ResetOverlaySymbolStatus=function(){for(var t in this.OverlayChartPaint){var e=this.OverlayChartPaint[t];e.Status=Rt.STATUS_NONE_ID}},this.ClearOverlaySymbol=function(){for(var t in this.OverlayChartPaint){var e=this.OverlayChartPaint[t];e.IsDelete=!0}this.OverlayChartPaint=[],this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=0,this.UpdateFrameMaxMin(),this.Draw()},this.DeleteOverlaySymbol=function(t){for(var e in this.OverlayChartPaint){var a=this.OverlayChartPaint[e];if(a.Symbol===t)return a.IsDelete=!0,this.OverlayChartPaint.splice(e,1),this.OverlayChartPaint.length<=0&&(this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=0),this.UpdateFrameMaxMin(),this.Draw(),!0}return console.warn("[KLineChartContainer::DeleteOverlaySymbol] overlay symbol="+t+" not exist."),!1},this.RequestFlowCapitalData=function(){if(this.Symbol&&1!=this.FlowCapitalReady){var t=this.Symbol.toUpperCase(),e=!0;if((Li.IsBIT(t)||Li.IsFutures(t))&&(e=!1),this.EnableFlowCapital&&Li.IsBIT(t)&&1==this.EnableFlowCapital.BIT&&(e=!0),!e)return M.Chart.Log("[KLineChartContainer::RequestFlowCapitalData] symbol="+this.Symbol+" not need download data."),void(this.FlowCapitalReady=!0);var a=this,i=["name","date","symbol","capital.a"];if(this.NetworkFilter){var r={Name:"KLineChartContainer::RequestFlowCapitalData",Explain:"流通股本数据",Request:{Url:a.StockHistoryDayApiUrl,Data:{symbol:[this.Symbol],orderfield:"date",field:i},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(r,(function(t){a.RecvFlowCapitalData(t)})),1==r.PreventDefault)return}x.HttpRequest({url:this.StockHistoryDayApiUrl,data:{field:i,symbol:[this.Symbol],orderfield:"date"},type:"post",dataType:"json",async:!0,success:function(t){a.RecvFlowCapitalData(t)}})}},this.RecvFlowCapitalData=function(t){if(t.stock&&1==t.stock.length){var e=t.stock[0],a=new Array;for(var i in e.stockday){var r=e.stockday[i],n=new ft;n.Date=r.date;var s=r.capital;s&&(s.a>0&&(n.Value=s.a,a.push(n)))}if(It.IsMinutePeriod(this.Period,!0)){var o=this.SourceData.GetMinuteFittingFinanceData(a);for(var h in this.SourceData.Data){r=this.SourceData.Data[h];r.FlowCapital=o[h].Value}var l=this.ChartPaint[0].Data,u=new It;if(u.Data=this.SourceData.Data,It.IsMinutePeriod(l.Period,!1)){var C=u.GetPeriodData(l.Period);u.Data=C}l.Data=u.Data}else{o=this.SourceData.GetFittingFinanceData(a);for(var D in this.SourceData.Data){r=this.SourceData.Data[D];r.FlowCapital=o[D].Value}l=this.ChartPaint[0].Data,u=new It;if(u.Data=this.SourceData.Data,l.Right>0){var c=u.GetRightDate(l.Right);u.Data=c}if(It.IsDayPeriod(l.Period,!1)){C=u.GetPeriodData(l.Period);u.Data=C}l.Data=u.Data}this.FlowCapitalReady=!0;var f=!1;for(var d in this.ExtendChartPaint){r=this.ExtendChartPaint[d];if("StockChip"==r.ClassName){f=!0;break}}f&&this.Draw()}},this.SetChartDrawOption=function(t){Le.IsBool(t.IsLockScreen)&&(this.ChartDrawOption.IsLockScreen=t.IsLockScreen),Le.IsNumber(t.Zoom)&&t.Zoom>=0&&(this.ChartDrawOption.Zoom=t.Zoom)},this.CreateChartDrawPicture=function(t,e,a){var i=null;switch(t){case"线段":i=new ea;break;case"射线":i=new aa;break;case"水平线":i=new ia;break;case"趋势线":i=new ra;break;case"矩形":i=new na;break;case"圆弧线":i=new sa;break;case"M头W底":i=new oa;break;case"平行线":i=new ha;break;case"平行通道":i=new ua;break;case"价格通道线":i=new la;break;case"文本":i=new Ca,i.HQChart=this;break;case"江恩角度线":i=new ca;break;case"阻速线":i=new fa;break;case"黄金分割":i=new da;break;case"百分比线":i=new ma;break;case"波段线":i=new va;break;case"三角形":i=new Sa;break;case"对称角度":i=new Ia;break;case"圆":i=new pa;break;case"平行四边形":i=new Ta;break;case"斐波那契周期线":i=new Aa;break;default:var r=new g.default([["icon-arrow_up",{Text:"",Color:"#318757"}],["icon-arrow_down",{Text:"",Color:"#db563e"}],["icon-arrow_right",{Text:"",Color:"#318757"}],["icon-arrow_left",{Text:"",Color:"#318757"}]]);if(r.has(t)){var n=r.get(t);i=new Da,i.FontOption.Family="iconfont",i.Text=n.Text,n.Color&&(i.LineColor=n.Color);break}return!1}i.Canvas=this.Canvas,i.Status=0,i.Symbol=this.Symbol,i.Period=this.Period,i.Option=this.ChartDrawOption,a&&(i.FinishedCallback=a),e&&i.SetOption(e);var s=this;return i.Update=function(){s.DrawDynamicInfo()},this.CurrentChartDrawPicture=i,!0},this.PointAbsoluteToRelative=function(t,e,a){var i={X:t,Y:e},r=V(),n=this.UIElement.getBoundingClientRect();return a?(i.X=t-n.left*r,i.Y=e-n.top*r):(i.X=(t-n.left)*r,i.Y=(e-n.top)*r),i},this.SetChartDrawPictureFirstPoint=function(t,e,a){var i=this.CurrentChartDrawPicture;if(!i)return!1;if(!this.Frame.SubFrame||this.Frame.SubFrame.length<=0)return!1;var r=this.PointAbsoluteToRelative(t,e,a),n=r.X,s=r.Y;for(var o in this.Frame.SubFrame){var h=this.Frame.SubFrame[o].Frame,l=h.ChartBorder.GetLeft(),u=h.ChartBorder.GetTopEx(),C=h.ChartBorder.GetHeight(),D=h.ChartBorder.GetWidth();if(this.Canvas.beginPath(),this.Canvas.rect(l,u,D,C),this.Canvas.isPointInPath(n,s)){i.Frame=h;break}}return!!i.Frame&&(i.Point[0]=new K,i.Point[0].X=n,i.Point[0].Y=s,i.Status=1,!0)},this.SetChartDrawPictureSecondPoint=function(t,e,a){var i=this.CurrentChartDrawPicture;if(!i)return!1;var r=this.PointAbsoluteToRelative(t,e,a);return i.Point[1]=new K,i.Point[1].X=r.X,i.Point[1].Y=r.Y,i.Status=2,!0},this.SetChartDrawPictureThirdPoint=function(t,e,a){var i=this.CurrentChartDrawPicture;if(!i)return!1;var r=this.PointAbsoluteToRelative(t,e,a);return i.Point[2]=new K,i.Point[2].X=r.X,i.Point[2].Y=r.Y,i.Status=3,!0},this.MoveChartDrawPicture=function(t,e,a){var i=this.CurrentChartDrawPicture;if(!i)return!1;var r=V();a&&(r=1);var n=t*r,s=e*r;return i.Move(n,s),!0},this.FinishChartDrawPicturePoint=function(){var t=this.CurrentChartDrawPicture;if(!t)return!1;if(t.PointCount!=t.Point.length)return!1;t.Status=10,t.PointToValue(),this.ChartDrawPicture.push(t),this.CurrentChartDrawPicture=null;var e=this.GetEventCallback(b.ON_FINISH_DRAWPICTURE);if(e&&e.Callback){var a={DrawPicture:t};e.Callback(e,a,this)}else t.FinishedCallback&&t.FinishedCallback(t);return this.ChartDrawStorage&&this.ChartDrawStorage.SaveDrawData(t),!0},this.UpdateChartDrawXValue=function(){for(var t in this.ChartDrawPicture){var e=this.ChartDrawPicture[t];e.UpdateXValue()}},this.OnRightMenu=function(t,e,a){var i=V();if(this.RightMenu){var r=this.Frame.PtInFrame(t*i,e*i);a.data={Chart:this,FrameID:r},this.RightMenu.DoModal(a)}var n=this.GetEventCallback(b.ON_CONTEXT_MENU);if(n){r=this.Frame.PtInFrame(t*i,e*i);var s={X:t,Y:e,Event:a,FrameID:r};n.Callback(n,s,this)}},this.FinishMoveChartDrawPicture=function(){var t=this.CurrentChartDrawPicture;return!!t&&(t.PointCount==t.Point.length&&(t.Status=10,t.PointToValue(),this.ChartDrawStorage&&this.ChartDrawStorage.SaveDrawData(t),this.CurrentChartDrawPicture=null,!0))},this.ClearChartDrawPicture=function(t){if(t)for(var e in this.ChartDrawPicture)this.ChartDrawPicture[e]==t&&(this.ChartDrawStorage&&this.ChartDrawStorage.DeleteDrawData(t),this.ChartDrawPicture.splice(e,1),this.Draw());else this.ChartDrawPicture=[],this.ChartDrawStorage&&this.ChartDrawStorage.Clear(),this.Draw()},this.ReloadChartDrawPicture=function(){this.ChartDrawPicture=[],this.ChartDrawStorageCache,this.ChartDrawStorage&&(this.ChartDrawStorageCache=this.ChartDrawStorage.GetDrawData({Symbol:this.Symbol,Period:this.Period}))},this.CreateChartDrawPictureByStorage=function(){if(this.ChartDrawStorageCache&&!(this.ChartDrawStorageCache.length<=0)){for(var t in this.ChartDrawStorageCache){var e=this.ChartDrawStorageCache[t];if(!(e.FrameID<0||!this.Frame.SubFrame||this.Frame.SubFrame.length<e.FrameID)){var a=ta.CreateChartDrawPrictrue(e);a&&(a.Canvas=this.Canvas,a.Status=10,a.Frame=this.Frame.SubFrame[e.FrameID].Frame,a.UpdateXValue(),a.ValueToPoint(),"ChartDrawPictureText"===a.ClassName&&(a.IsInitialized=!0),this.ChartDrawPicture.push(a))}}this.ChartDrawStorageCache=null}},this.OnSelectChartPicture=function(t){},this.RequestKLineMatch=function(t,e){var a=this,i=e.Scope,r=e.WaitDialog;M.Chart.Log("[KLineChartContainer::RequestKLineMatch",t,i);for(var n=new Array,s=new Array,o=t.Start;o<t.End&&o<t.Data.Data.length;++o){var h=t.Data.Data[o];n.push(h.Date),s.push(h.Close)}var l={Stock:t.Stock,Index:{Start:t.Start,End:t.End},Date:{Start:n[0],End:n[n.length-1]},Minsimilar:i.Minsimilar,Plate:i.Plate,DayRegion:300};E.default.ajax({url:this.KLineMatchUrl,data:{userid:"guest",plate:i.Plate,period:this.Period,right:this.Right,dayregion:l.DayRegion,minsimilar:i.Minsimilar,sampledate:n,samplevalue:s},type:"post",dataType:"json",async:!0,success:function(t){r&&r.Close(),a.RecvKLineMatchData(t,l)},error:function(t,e,a){console.warn("[KLineChartContainer::RequestKLineMatch] failed",t,e,a),r&&r.Close()}})},this.RecvKLineMatchData=function(t,e){M.Chart.Log("[KLineChartContainer::RecvKLineMatchData] recv",t,e);var a=[];for(var i in t.match){var r=t.match[i];if(r.symbol!=e.Stock.Symbol)for(var n in r.data){var s=r.data[n],o={Symbol:r.symbol,Name:r.name,Similar:s.similar,Start:s.start,End:s.end};a.push(o)}}if(a.sort((function(t,e){return e.Similar-t.Similar})),M.Chart.Log("[KLineChartContainer::RecvKLineMatchData] filterData",a),this.mapEvent.has(b.RECV_KLINE_MATCH)){r=this.mapEvent.get(b.RECV_KLINE_MATCH),t={Sample:e,Match:a,Source:t};r.Callback(r,t,this)}else{var h=new Ii(this.Frame.ChartBorder.UIElement.parentNode),l={data:{Chart:this,MatchData:a,Sample:e,Source:t}};h.DoModal(l)}},this.UpdataChartInfo=function(){var t=null;if(0==this.Period)for(var e in t=new g.default,this.ChartInfo){var a=this.ChartInfo[e].Data;for(var i in a){var r=a[i];t.has(r.Date.toString())?t.get(r.Date.toString()).Data.push(r):t.set(r.Date.toString(),{Data:new Array(r)})}}else if(It.IsDayPeriod(this.Period,!1)){t=new g.default;var n=this.ChartPaint[0].Data;for(var e in this.ChartInfo)this.ChartInfo[e].TempID=this.ChartInfo[e].Data.length-1;for(e=0;e<n.Data.length;++e){var s=n.Data[e];for(var i in this.ChartInfo){var o=this.ChartInfo[i];for(a=o.Data;o.TempID>=0;--o.TempID){var h=a[o.TempID];if(h.Date>s.Date)break;t.has(s.Date.toString())?t.get(s.Date.toString()).Data.push(h):t.set(s.Date.toString(),{Data:new Array(h)})}}}for(var e in this.ChartInfo)delete this.ChartInfo[e].TempID}var l=this.ChartPaint[0];l.InfoData=t},this.UpdateWindowIndex=function(t){var e=new It;if(e.Data=this.SourceData.Data,e.Period=this.Period,e.Right=this.Right,e.Right>0){var a=e.GetRightDate(e.Right);e.Data=a}if(It.IsDayPeriod(e.Period,!1)||It.IsMinutePeriod(e.Period,!1)){var i=e.GetPeriodData(e.Period);e.Data=i}if("function"==typeof this.WindowIndex[t].ExecuteScript){var r=this.ChartPaint[0].Data;this.WindowIndex[t].ExecuteScript(this,t,r)}else this.WindowIndex[t].BindData(this,t,e);this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeWindowIndexParam=function(t){this.WindowIndex[t].Index[0].Param+=1,this.WindowIndex[t].Index[1].Param+=1,this.UpdateWindowIndex(t)},this.OnDoubleClick=function(t,e,a){var i=null;if(this.mapEvent.has(b.DBCLICK_KLINE)&&(i=this.mapEvent.get(b.DBCLICK_KLINE)),this.MinuteDialog||i){var r=new Lt;for(var n in this.ChartPaint){var s=this.ChartPaint[n];if(s.GetTooltipData(t,e,r))break}if(r.Data){if(i){var o={Tooltip:r,Stock:{Symbol:this.Symbol,Name:this.Name}};i.Callback(i,o,this)}this.MinuteDialog&&(a.data={Chart:this,Tooltip:r},this.MinuteDialog.DoModal(a))}}},this.OnSelectChartPicture=function(t){M.Chart.Log("[KLineChartContainer::OnSelectChartPicture",t),this.ChartPictureMenu||(this.ChartPictureMenu=new Fi(this.UIElement.parentNode));var e={data:{ChartPicture:t,HQChart:this}};this.ChartPictureMenu.DoModal(e)},this.CancelAutoUpdate=function(){"number"==typeof this.AutoUpdateTimer&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=void 0)},this.AutoUpdate=function(t){if(this.CancelAutoUpdate(),this.IsAutoUpdate&&this.Symbol){var e=this,a=Li.GetMarketStatus(this.Symbol);if(0!=a&&3!=a){var i=this.AutoUpdateFrequency;1==a?this.AutoUpdateTimer=setTimeout((function(){e.AutoUpdate()}),i):2==a&&(this.AutoUpdateTimer=setTimeout((function(){It.IsDayPeriod(e.Period,!0)?e.RequestRealtimeData():It.IsMinutePeriod(e.Period,!0)||It.IsSecondPeriod(e.Period)?e.RequestMinuteRealtimeData():It.IsTickPeriod(e.Period)&&e.RequestTickRealtimeData()}),i))}}},this.GetMaxMinPageSize=function(){var t={},e=this.Frame.ChartBorder.GetWidth(),a=Nt[Nt.length-1][0]+Nt[Nt.length-1][1];return t.Max=parseInt(e/a)-2,a=Nt[0][0]+Nt[0][1],t.Min=parseInt(e/a)-2,M.Chart.Log("[KLineChartContainer::GetMaxMinPageSize] Max="+t.Max+" Min="+t.Min),t},this.GetChartStatus=function(){var t=this.Frame.SubFrame[0].Frame;if(!t)return null;var e=t.Data;if(!e)return null;var a={KLine:{},Zoom:{}};return a.KLine.Count=e.Data.length,a.KLine.Offset=e.DataOffset,a.KLine.PageSize=t.XPointCount,a.Zoom.Index=t.ZoomIndex,a.Zoom.Max=Nt.length,a},this.DragDownloadData=function(){var t=null;if(t=this.Frame.Data?this.Frame.SubFrame[0].Frame.Data:this.Frame.Data,!t)return!1;if(!(t.DataOffset>0))if(It.IsMinutePeriod(this.Period,!0)){if(M.Chart.Log("[KLineChartContainer.DragDownloadData] Minute:[Enable="+this.DragDownload.Minute.Enable+", IsEnd="+this.DragDownload.Minute.IsEnd+", Status="+this.DragDownload.Minute.Status+"]"),!this.DragDownload.Minute.Enable)return;if(this.DragDownload.Minute.IsEnd)return;if(0!=this.DragDownload.Minute.Status)return;this.RequestDragMinuteData()}else if(It.IsDayPeriod(this.Period,!0)){if(M.Chart.Log("[KLineChartContainer.DragDownloadData] Day:[Enable="+this.DragDownload.Minute.Enable+", IsEnd="+this.DragDownload.Minute.IsEnd+", Status="+this.DragDownload.Minute.Status+"]"),!this.DragDownload.Day.Enable)return;if(this.DragDownload.Day.IsEnd)return;if(0!=this.DragDownload.Day.Status)return;this.RequestDragDayData()}},this.RequestDragMinuteData=function(){var t=this;this.AutoUpdateEvent(!1,"KLineChartContainer::RequestDragMinuteData"),this.CancelAutoUpdate();var e=this.DragDownload.Minute;e.Status=1;var a=this.SourceData.Data[0],i={field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,enddate:a.Date,endtime:a.Time,count:t.MaxRequestMinuteDayCount,first:{date:a.Date,time:a.Time}};if(this.NetworkFilter){var r={Name:"KLineChartContainer::RequestDragMinuteData",Explain:"拖拽1分钟K线数据下载",Request:{Url:this.DragMinuteKLineApiUrl,Type:"POST",Data:i},DragDownload:e,Self:this,PreventDefault:!1};if(this.NetworkFilter(r,(function(a){t.RecvDragMinuteData(a),e.Status=0,t.AutoUpdateEvent(!0,"KLineChartContainer::RequestDragMinuteData"),t.AutoUpdate()})),1==r.PreventDefault)return}x.HttpRequest({url:this.DragMinuteKLineApiUrl,data:i,type:"post",dataType:"json",async:!0,success:function(a){t.RecvDragMinuteData(a),e.Status=0,t.AutoUpdateEvent(!0,"KLineChartContainer::RequestDragMinuteData"),t.AutoUpdate()}})},this.RecvDragMinuteData=function(t){var e=Pa.JsonDataToMinuteHistoryData(t);if(!e||e.length<=0)this.DragDownload.Minute.IsEnd=!0;else{for(var a=this.GetHistoryDataCount(),i=this.SourceData.Data[0],r=null,n=e.length-1;n>=0;--n){var s=e[n];if(i.Date>s.Date||i.Date==s.Date&&i.Time>s.Time){r=n;break}if(i.Date==s.Date&&i.Time==s.Time){i.YClose=s.YClose,r=n-1;break}}if(!(null==r&&r<0)){for(n=0;n<e.length&&n<=r;++n){s=e[n];this.SourceData.Data.splice(n,0,s)}var o=new It;if(o.Data=this.SourceData.Data,o.Period=this.Period,o.Right=this.Right,o.DataType=this.SourceData.DataType,o.Symbol=this.Symbol,!this.IsApiPeriod&&(It.IsDayPeriod(o.Period,!1)||It.IsMinutePeriod(o.Period,!1))){var h=o.GetPeriodData(o.Period);o.Data=h}this.UpdateMainData(o,a),this.BindInstructionIndexData(o);for(n=0;n<this.Frame.SubFrame.length;++n)this.BindIndexData(n,o);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdateChartDrawXValue(),this.Draw()}}},this.RequestDragDayData=function(){var t=this;this.AutoUpdateEvent(!1,"KLineChartContainer::RequestDragDayData"),this.CancelAutoUpdate();var e=this.DragDownload.Day;e.Status=1;var a=this.SourceData.Data[0],i={field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,enddate:a.Date,count:t.MaxReqeustDataCount,first:{date:a.Date}};if(this.NetworkFilter){var r={Name:"KLineChartContainer::RequestDragDayData",Explain:"拖拽日K数据下载",Request:{Url:this.DragKLineApiUrl,Type:"POST",Data:i},DragDownload:e,Self:this,PreventDefault:!1};if(this.NetworkFilter(r,(function(a){t.RecvDragDayData(a),e.Status=0,t.AutoUpdateEvent(!0,"KLineChartContainer::RequestDragDayData"),t.AutoUpdate()})),1==r.PreventDefault)return}x.HttpRequest({url:this.DragKLineApiUrl,data:i,type:"post",dataType:"json",async:!0,success:function(a){t.RecvDragDayData(a),e.Status=0,t.AutoUpdateEvent(!0,"KLineChartContainer::RequestDragDayData"),t.AutoUpdate()}})},this.RecvDragDayData=function(t){var e=Pa.JsonDataToHistoryData(t);if(!e||e.length<=0)this.DragDownload.Day.IsEnd=!0;else{for(var a=this.GetHistoryDataCount(),i=this.SourceData.Data[0],r=null,n=e.length-1;n>=0;--n){var s=e[n];if(i.Date>s.Date){r=n;break}if(i.Date==s.Date){i.YClose=s.YClose,r=n-1;break}}if(!(null==r&&r<0)){for(n=0;n<e.length&&n<=r;++n){s=e[n];this.SourceData.Data.splice(n,0,s)}var o=new It;if(o.Data=this.SourceData.Data,o.Period=this.Period,o.Right=this.Right,o.DataType=this.SourceData.DataType,o.Symbol=this.Symbol,!this.IsApiPeriod&&(It.IsDayPeriod(o.Period,!1)||It.IsMinutePeriod(o.Period,!1))){var h=o.GetPeriodData(o.Period);o.Data=h}this.UpdateMainData(o,a),this.BindInstructionIndexData(o);for(n=0;n<this.Frame.SubFrame.length;++n)this.BindIndexData(n,o);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdateChartDrawXValue(),this.Draw()}}},this.SetCustomVerical=function(t,e){if(this.Frame&&!(t>=this.Frame.SubFrame.length)){var a=this.Frame.SubFrame[t];a.Frame&&(a.Frame.CustomVerticalInfo=e)}},this.OnSize=function(){if(this.Frame&&this.Frame.OnSize){var t=this.Frame.OnSize();this.Frame.SetSizeChage(!0),t.Changed&&(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(2),this.UpdateFrameMaxMin()),this.Draw()}}}function wa(t){this.newMethod=H,this.newMethod(t),delete this.newMethod,this.ClassName="MinuteChartContainer",this.WindowIndex=new Array,this.Symbol,this.Name,this.SourceData,this.IsAutoUpdate=!0,this.AutoUpdateFrequency=3e4,this.AutoUpdateTimer,this.TradeDate=0,this.DayCount=1,this.DayData,this.LimitPrice,this.IsShowBeforeData=!1,this.BeforeData=null,this.IsBeforeData=!1,this.IsShowLead=!0,this.MinuteApiUrl=Ma.Domain+"/API/Stock",this.HistoryMinuteApiUrl=Ma.Domain+"/API/StockMinuteData",this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.OnTouchStart=function(e){if(0!=this.DragMode&&(this.IsOnTouch=!0,this.TouchDrawCount=0,this.PhonePinch=null,this.StopDragTimer(),0==this.EnableScrollUpDown&&e.preventDefault(),this.IsPhoneDragging(e))){var a={Click:{},LastMove:{}},i=this.GetToucheData(e,this.IsForceLandscape);a.Click.X=i[0].clientX,a.Click.Y=i[0].clientY,a.LastMove.X=i[0].clientX,a.LastMove.Y=i[0].clientY;var r=this,n=function(){if(!0===r.ChartCorssCursor.IsShow){var i=V(),n=a.Click.X-t.getBoundingClientRect().left*i,s=a.Click.Y-t.getBoundingClientRect().top*i;r.OnMouseMove(n,s,e)}};1==this.EnableScrollUpDown&&(this.DragTimer=setTimeout((function(){if(a.Click.X==a.LastMove.X&&a.Click.Y==a.LastMove.Y){r.MouseDrag;r.MouseDrag=null,n(),r.PreventTouchEvent(e)}}),800)),this.MouseDrag=a,this.SelectChartDrawPicture=null,0==this.EnableScrollUpDown&&n()}},this.OnTouchMove=function(e){var a=this.GetToucheData(e,this.IsForceLandscape);if(this.IsPhoneDragging(e)){var i=this.MouseDrag;if(null==i){var r=V(),n=a[0].clientX-t.getBoundingClientRect().left*r,s=a[0].clientY-t.getBoundingClientRect().top*r;this.OnMouseMove(n,s,e)}else{var o=this.GetMoveAngle(i.LastMove,{X:a[0].clientX,Y:a[0].clientY}),h=Math.abs(i.LastMove.X-a[0].clientX),l=Math.abs(i.LastMove.Y-a[0].clientY);if(h=parseInt(h),(l>0&&h<=3||o<=this.TouchMoveMinAngle)&&1==this.EnableScrollUpDown)return void this.StopDragTimer();this.PreventTouchEvent(e),this.MouseDrag=null;r=V(),n=a[0].clientX-t.getBoundingClientRect().left*r,s=a[0].clientY-t.getBoundingClientRect().top*r;this.OnMouseMove(n,s,e)}}0==this.EnableScrollUpDown?e.preventDefault():null==i?this.PreventTouchEvent(e):this.StopDragTimer()},this.OnTouchEnd=function(t){M.Chart.Log("[MinuteChartContainer::OnTouchEnd]",t),this.IsOnTouch=!1,this.StopDragTimer(),this.OnTouchFinished(),this.TouchDrawCount=0},this.OnKeyDown=function(t){var e=t.keyCode?t.keyCode:t.which;switch(e){case 37:if(this.CursorIndex=parseInt(this.CursorIndex),this.CursorIndex<=.99999){if(!this.DataMoveLeft())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw()}else--this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo();break;case 39:var a=0;if(a=this.Frame.XPointCount?this.Frame.XPointCount:this.Frame.SubFrame[0].Frame.XPointCount,this.CursorIndex=parseInt(this.CursorIndex),this.CursorIndex+1>=a){if(!this.DataMoveRight())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw()}else{var i=null;if(i=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data,!i)break;if(this.CursorIndex+i.DataOffset+1>=i.Data.length)break;++this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo()}break;default:return}t.preventDefault?t.preventDefault():t.returnValue=!1},this.OnRightMenu=function(t,e,a){if(this.RightMenu){var i=this.Frame.PtInFrame(t,e);a.data={Chart:this,FrameID:i},this.RightMenu.DoModal(a)}var r=this.GetEventCallback(b.ON_CONTEXT_MENU);if(r){i=this.Frame.PtInFrame(t,e);var n={X:t,Y:e,Event:a,FrameID:i};r.Callback(r,n,this)}},this.OnWheel=function(t){M.Chart.Log("[MinuteChartContainer::OnWheel]",t)},this.UpdatePointByCursorIndex=function(){this.LastPoint.X=this.Frame.GetXFromIndex(this.CursorIndex);var t=this.CursorIndex;t=parseInt(t.toFixed(0));var e=this.Frame.SourceData;if(!(e.DataOffset+t>=e.Data.length)){var a=e.Data[e.DataOffset+t],i=null;i=a.Before?a.Before.Close:a.Close,this.LastPoint.Y=this.Frame.GetYFromData(i)}},this.Create=function(t,e){var a=this;for(var i in this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new Pe,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=new Ve,this.ChartCorssCursor.StringFormatY=new _e,this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID,this.ChartSplashPaint=new we,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new lt,this.Frame.ChartBorder=new q,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=25,this.Frame.ChartBorder.Left=50,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(t),this.CreateMainKLine(),this.Frame.SubFrame){var r=new $e;r.Frame=this.Frame.SubFrame[i].Frame,r.Canvas=this.Canvas,r.LanguageID=this.LanguageID,this.TitlePaint.push(r)}this.ChartCorssCursor.StringFormatX.Frame=this.Frame.SubFrame[0].Frame;var n=!0,s=!0;e&&(!1===e.KeyDown&&(n=!1,M.Chart.Log("[MinuteChartContainer::Create] not register keydown event.")),!1===e.Wheel&&(s=!1,M.Chart.Log("[MinuteChartContainer::Create] not register wheel event."))),n&&this.UIElement.addEventListener("keydown",(function(t){a.OnKeyDown(t)}),!0),s&&this.UIElement.addEventListener("wheel",(function(t){a.OnWheel(t)}),!0)},this.CreateChildWindow=function(t){for(var e=0;e<t;++e){var a=new q;a.UIElement=this.UIElement;var i=new tt;i.Canvas=this.Canvas,i.ChartBorder=a,i.Identify=e,e<2&&(i.ChartBorder.TitleHeight=0),i.XPointCount=243,e>=2&&(this.ModifyIndexDialog&&(i.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(i.ChangeIndexEvent=this.ChangeIndexDialog.DoModal));var r=[9,8,7,6,5,4,3,2,1];for(var n in i.HorizontalMax=r[0],i.HorizontalMin=r[r.length-1],0==e?(i.YSplitOperator=new Oe,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price")):(i.YSplitOperator=new xe,i.YSplitOperator.LanguageID=this.LanguageID,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double")),i.YSplitOperator.Frame=i,i.YSplitOperator.ChartBorder=a,i.XSplitOperator=new ye,i.XSplitOperator.Frame=i,i.XSplitOperator.ChartBorder=a,e!=t-1&&(i.XSplitOperator.ShowText=!1),i.XSplitOperator.Operator(),r)i.HorizontalInfo[n]=new z,i.HorizontalInfo[n].Value=r[n],0==e&&n==i.HorizontalMin||(i.HorizontalInfo[n].Message[1]=r[n].toString(),i.HorizontalInfo[n].Font="14px 微软雅黑");var s=new ot;s.Frame=i,s.Height=0==e?20:10,this.Frame.SubFrame[e]=s}},this.CreateSubFrameItem=function(t){var e=new q;e.UIElement=this.UIElement;var a=new tt;a.Canvas=this.Canvas,a.ChartBorder=e,a.Identify=t,a.XPointCount=243,t>=2&&(this.ModifyIndexDialog&&(a.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(a.ChangeIndexEvent=this.ChangeIndexDialog.DoModal));var i=[9,8,7,6,5,4,3,2,1];a.HorizontalMax=i[0],a.HorizontalMin=i[i.length-1],a.YSplitOperator=new xe,a.YSplitOperator.LanguageID=this.LanguageID,a.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),a.YSplitOperator.Frame=a,a.YSplitOperator.ChartBorder=e,a.XSplitOperator=new ye,a.XSplitOperator.Frame=a,a.XSplitOperator.ChartBorder=e,a.XSplitOperator.ShowText=!1;var r=this.Frame.SubFrame[0].Frame.XPointCount;for(var n in a.XPointCount=r,a.Data=this.ChartPaint[0].Data,i)a.HorizontalInfo[n]=new z,a.HorizontalInfo[n].Value=i[n],a.HorizontalInfo[n].Message[1]=i[n].toString(),a.HorizontalInfo[n].Font="14px 微软雅黑";var s=new ot;return s.Frame=a,s.Height=10,s},this.DeleteIndexPaint=function(t){var e=new Array;for(var a in this.ChartPaint){var i=this.ChartPaint[a];0!=a&&i.ChartFrame==this.Frame.SubFrame[t].Frame||e.push(i)}this.Frame.SubFrame[t].Frame.YSpecificMaxMin=null,this.Frame.SubFrame[t].Frame.IsLocked=!1,this.ChartPaint=e;var r=t+1;this.TitlePaint[r].Data=[],this.TitlePaint[r].Title=null},this.CreateStockInfo=function(){this.ExtendChartPaint[0]=new Ie,this.ExtendChartPaint[0].Canvas=this.Canvas,this.ExtendChartPaint[0].ChartBorder=this.Frame.ChartBorder,this.ExtendChartPaint[0].ChartFrame=this.Frame,this.Frame.ChartBorder.Right=300},this.CreateMainKLine=function(){var t=new Zt;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,t.ChartFrame=this.Frame.SubFrame[0].Frame,t.Name="Minute-Line",t.Color=Ma.Minute.PriceColor,t.AreaColor=Ma.Minute.AreaPriceColor,this.ChartPaint[0]=t;var e=new Zt;e.Canvas=this.Canvas,e.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,e.ChartFrame=this.Frame.SubFrame[0].Frame,e.Name="Minute-Average-Line",e.Color=Ma.Minute.AvPriceColor,e.IsDrawArea=!1,this.ChartPaint[1]=e;var a=new wt;a.Color=Ma.Minute.VolBarColor,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.SubFrame[1].Frame.ChartBorder,a.ChartFrame=this.Frame.SubFrame[1].Frame,a.Name="Minute-Vol-Bar",this.ChartPaint[2]=a,this.TitlePaint[0]=new Ze,this.TitlePaint[0].Frame=this.Frame.SubFrame[0].Frame,this.TitlePaint[0].Canvas=this.Canvas,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].LanguageID=this.LanguageID},this.ChangeScriptIndex=function(t,e){this.DeleteIndexPaint(t),this.WindowIndex[t]=new Cr(e.Name,e.Script,e.Args,e);var a=this.SourceData;this.BindIndexData(t,a),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeIndex=function(t,e,a){if(!(this.Frame.SubFrame.length<3)){var i=new P,r=i.Get(e);if(r){t<2&&(t=2),t>=this.Frame.SubFrame.length&&(t=2);var n={Name:r.Name,Script:r.Script,Args:r.Args,ID:e,KLineType:r.KLineType,YSpecificMaxMin:r.YSpecificMaxMin,YSplitScale:r.YSplitScale,FloatPrecision:r.FloatPrecision,Condition:r.Condition,StringFormat:r.StringFormat};return a&&(a.FloatPrecision>=0&&(n.FloatPrecision=a.FloatPrecision),a.StringFormat>0&&(n.StringFormat=a.StringFormat),a.Args&&(n.Args=a.Args)),this.ChangeScriptIndex(t,n)}}},this.ChangeIndexWindowCount=function(t){if(!(t<2)&&this.Frame.SubFrame.length!=t){var e=this.Frame.SubFrame.length;if(e>t){for(var a=e-1;a>=t;--a){this.DeleteIndexPaint(a);var i=this.Frame.SubFrame[a].Frame;i.ClearToolbar&&i.ClearToolbar()}this.Frame.SubFrame.splice(t,e-t),this.WindowIndex.splice(t,e-t)}else{for(a=e;a<t;++a){var r=this.CreateSubFrameItem(a);this.Frame.SubFrame[a]=r;var n=new $e;n.Frame=this.Frame.SubFrame[a].Frame,n.Canvas=this.Canvas,n.LanguageID=this.LanguageID,this.TitlePaint[a+1]=n}var s=["RSI","MACD","DMA","DMI","KDJ","WR"],o=new P;for(a=e;a<t;++a){var h=s[a%s.length],l=o.Get(h);this.WindowIndex[a]=new Cr(l.Name,l.Script,l.Args,l);var u=this.SourceData;this.BindIndexData(a,u)}for(a=0;a<this.Frame.SubFrame.length;++a){i=this.Frame.SubFrame[a].Frame;a==this.Frame.SubFrame.length-1?i.XSplitOperator.ShowText=!0:i.XSplitOperator.ShowText=!1}this.UpdataDataoffset()}this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}},this.RemoveIndexWindow=function(t){if(M.Chart.Log("[MinuteChartContainer::RemoveIndexWindow] remove id",t),!(t<2)&&this.Frame.SubFrame&&!(t>=this.Frame.SubFrame.length)){this.Frame.SubFrame[t].Frame;this.DeleteIndexPaint(t),this.Frame.SubFrame[t].Frame.ClearToolbar(),this.Frame.SubFrame.splice(t,1),this.WindowIndex.splice(t,1),this.TitlePaint.splice(t+1,1);for(var e=0;e<this.Frame.SubFrame.length;++e){var a=this.Frame.SubFrame[e].Frame;e==this.Frame.SubFrame.length-1?a.XSplitOperator.ShowText=!0:a.XSplitOperator.ShowText=!1,a.Identify=e}this.Frame.SetSizeChage(!0),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()}},this.ChangeSymbol=function(t){this.CancelAutoUpdate(),this.Symbol=t,this.ResetOverlaySymbolStatus(),t?(this.ChartSplashPaint.IsEnableSplash=!0,this.Draw(),this.RequestData()):this.DrawEmpty()},this.ChangeDayCount=function(t){t<0||t>10||(this.DayCount=t,this.ResetOverlaySymbolStatus(),this.RequestData())},this.OverlaySymbol=function(t,e){for(var a in this.OverlayChartPaint){var i=this.OverlayChartPaint[a];if(i.Symbol==t)return console.warn("[MinuteChartContainer::OverlaySymbol] overlay symbol="+t+" exist."),!1}var r=new Qt;return r.Canvas=this.Canvas,r.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,r.ChartFrame=this.Frame.SubFrame[0].Frame,r.Name="Overlay-Minute",r.Symbol=t,e&&e.Color?r.Color=e.Color:r.Color=Ma.OverlaySymbol.Color[Ma.OverlaySymbol.Random%Ma.OverlaySymbol.Color.length],++Ma.OverlaySymbol.Random,this.ChartPaint[0].YClose>0&&this.ChartPaint[0].Data&&(r.MainData=this.ChartPaint[0].Data,r.MainYClose=this.ChartPaint[0].YClose),this.OverlayChartPaint.push(r),this.DayCount<=1?this.RequestOverlayMinuteData():this.RequestOverlayHistoryMinuteData(),!0},this.ResetOverlaySymbolStatus=function(){for(var t in this.OverlayChartPaint){var e=this.OverlayChartPaint[t];e.Status=Rt.STATUS_NONE_ID}},this.DeleteOverlaySymbol=function(t){for(var e in this.OverlayChartPaint){var a=this.OverlayChartPaint[e];if(a.Symbol===t)return a.IsDelete=!0,this.OverlayChartPaint.splice(e,1),this.UpdateFrameMaxMin(),this.Draw(),!0}return console.warn("[MinuteChartContainer::DeleteOverlaySymbol] overlay symbol="+t+" not exist."),!1},this.ClearOverlaySymbol=function(){for(var t in this.OverlayChartPaint){var e=this.OverlayChartPaint[t];e.IsDelete=!0}this.OverlayChartPaint=[],this.Frame.SubFrame[0].Frame.YSplitOperator.OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.UpdateFrameMaxMin(),this.Draw()},this.ShowBeforeData=function(t){this.IsShowBeforeData!=t&&(this.IsShowBeforeData=t,this.RequestData())},this.RequestData=function(){this.DayCount<=1?this.RequestMinuteData():this.RequestHistoryMinuteData()},this.ChangeDrawType=function(t){if(!(this.ChartPaint.length<=0)){if(0==t)this.ChartPaint[0].IsDrawArea=!0;else{if(1!=t)return;this.ChartPaint[0].IsDrawArea=!1}this.Draw()}},this.RequestHistoryMinuteData=function(){var t=this;if(this.IsBeforeData=!1,this.ChartSplashPaint.IsEnableSplash=!0,this.Draw(),this.NetworkFilter){var e={Name:"MinuteChartContainer::RequestHistoryMinuteData",Explain:"多日分时数据",Request:{Url:t.HistoryMinuteApiUrl,Data:{daycount:t.DayCount,symbol:t.Symbol},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(e,(function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvHistoryMinuteData(e)})),1==e.PreventDefault)return}x.HttpRequest({url:t.HistoryMinuteApiUrl,data:{symbol:t.Symbol,daycount:t.DayCount},type:"post",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvHistoryMinuteData(e)}})},this.RecvHistoryMinuteData=function(t){this.DayData=wa.JsonDataToMinuteDataArray(t),this.Symbol=t.symbol,this.Name=t.name,this.CaclutateLimitPrice(this.DayData[0].YClose,t.data[0].limitprice),this.UpdateHistoryMinuteUI(),this.RecvMinuteDataEvent(),this.RequestOverlayHistoryMinuteData(),this.AutoUpdate()},this.UpdateHistoryMinuteUI=function(){var t=this.HistoryMinuteDataToArray(this.DayData),e=new It;e.Data=t,this.SourceData=e,this.TradeDate=this.DayData[0].Date,this.BindMainData(e,this.DayData[0].YClose);var a=this.Symbol.toUpperCase();if(Li.IsForeignExchange(a)&&(this.ChartPaint[1].Data=null),this.Frame.SubFrame.length>2){var i=new It;i.Data=t;for(var r=2;r<this.Frame.SubFrame.length;++r)this.BindIndexData(r,i)}for(var n in this.Frame.SubFrame){var s=this.Frame.SubFrame[n];for(var o in s.Frame.XSplitOperator.Symbol=this.Symbol,s.Frame.XSplitOperator.DayCount=this.DayData.length,s.Frame.XSplitOperator.DayData=this.DayData,s.Frame.XSplitOperator.Operator(),s.Frame.XSplitOperator.IsBeforeData=this.IsBeforeData,s.Frame.YSplitOperator.Symbol=this.Symbol,s.Frame.IsBeforeData=this.IsBeforeData,s.OverlayIndex){var h=s.OverlayIndex[o];h.Frame.XPointCount=s.Frame.XPointCount,h.Frame.MinuteCount=s.Frame.MinuteCount}}this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.IsBeforeData=this.IsBeforeData,this.TitlePaint[0].IsShowDate=!0,this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()},this.HistoryMinuteDataToArray=function(t){for(var e=[],a=t.length-1;a>=0;--a){var i=t[a];for(var r in i.Data)e.push(i.Data[r])}return e},this.UpdateLatestMinuteData=function(t,e){for(var a in this.DayData){var i=this.DayData[a];if(i.Date===e){i.Data=t;break}}},this.RequestMinuteData=function(){var t=this,e=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","minute","minutecount"],a=this.Symbol.toUpperCase();if(Li.IsFutures(a)&&(e.push("clearing"),e.push("yclearing")),this.IsBeforeData=!1,this.IsShowBeforeData&&1===this.DayCount&&Li.IsSHSZStockA(t.Symbol)&&(this.IsBeforeData=!0,e.push("before")),this.NetworkFilter){var i={Name:"MinuteChartContainer::RequestMinuteData",Explain:"最新分时数据",Request:{Url:t.MinuteApiUrl,Data:{field:e,symbol:[t.Symbol]},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,(function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvMinuteData(e)})),1==i.PreventDefault)return}x.HttpRequest({url:t.MinuteApiUrl,data:{field:e,symbol:[t.Symbol],start:-1},type:"post",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvMinuteData(e)}})},this.RecvMinuteDataEvent=function(){if(this.mapEvent.has(b.RECV_MINUTE_DATA)){var t=this.mapEvent.get(b.RECV_MINUTE_DATA),e={MinuteData:this.SourceData,Stock:{Symbol:this.Symbol,Name:this.Name}};t.Callback(t,e,this)}},this.RecvMinuteData=function(t){if(this.IsBeforeData)var e=wa.JsonDataToMinuteData2(t);else e=wa.JsonDataToMinuteData(t);if(this.DayCount>1)return this.UpdateLatestMinuteData(e,t.stock[0].date),this.UpdateHistoryMinuteUI(),this.RecvMinuteDataEvent(),this.RequestOverlayMinuteData(),void this.AutoUpdate();var a=new It;a.Data=e,this.TradeDate=t.stock[0].date,this.SourceData=a,this.Symbol=t.stock[0].symbol,this.Name=t.stock[0].name;var i=t.stock[0].yclose,r=this.Symbol.toUpperCase(),n=Li.IsFutures(r);t.stock[0].yclearing>0&&n&&(i=t.stock[0].yclearing),this.CaclutateLimitPrice(i,t.stock[0].limitprice);var s=null;if(t.stock[0].high>0&&t.stock[0].low>0&&(s={High:t.stock[0].high,Low:t.stock[0].low}),this.BindMainData(a,i,s),this.Frame.SubFrame.length>2){var o=new It;o.Data=e;for(var h=2;h<this.Frame.SubFrame.length;++h)this.BindIndexData(h,o)}for(var l in this.Frame.SubFrame){var u=this.Frame.SubFrame[l];for(var C in u.Frame.XSplitOperator.Symbol=this.Symbol,u.Frame.XSplitOperator.DayCount=1,u.Frame.XSplitOperator.Operator(),u.Frame.XSplitOperator.IsBeforeData=this.IsBeforeData,u.Frame.YSplitOperator.Symbol=this.Symbol,u.Frame.IsBeforeData=this.IsBeforeData,u.OverlayIndex){var D=u.OverlayIndex[C];D.Frame.XPointCount=u.Frame.XPointCount,D.Frame.MinuteCount=u.Frame.MinuteCount}}this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.IsBeforeData=this.IsBeforeData,Li.IsSHSZ(r)&&(this.TitlePaint[0].IsShowDate=!1);var c=this.GetChartMinuteInfo();c&&(c.SourceData=this.SourceData),this.RecvMinuteDataEvent(),this.RequestMinuteInfoData(),this.RequestOverlayMinuteData(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.AutoUpdate()},this.CaclutateLimitPrice=function(t,e){if(this.LimitPrice=null,e&&e.max>0&&e.min>0)this.LimitPrice={Max:e.max,Min:e.min};else{var a=Li.GetLimitPriceRange(this.Symbol,this.Name);a?t<=0||(this.LimitPrice={Max:t*(1+a.Max),Min:t*(1+a.Min)},M.Chart.Log("[MinuteChartContainer::CaclutateLimitPrice] "+this.Symbol+" yClose:"+t+" max:"+this.LimitPrice.Max+" min:"+this.LimitPrice.Min),this.LimitPrice.Max=parseFloat(this.LimitPrice.Max.toFixed(2)),this.LimitPrice.Min=parseFloat(this.LimitPrice.Min.toFixed(2)),M.Chart.Log("[MinuteChartContainer::CaclutateLimitPrice] "+this.Symbol+" tofixed(2) max:"+this.LimitPrice.Max+" min:"+this.LimitPrice.Min)):M.Chart.Log("[MinuteChartContainer::CaclutateLimitPrice] "+this.Symbol+" no limit price.")}},this.RequestOverlayMinuteData=function(){var t=this,e=this,a=this.TradeDate,i=function(){var i=t.OverlayChartPaint[r];return i.MainData&&i.MainYClose>0?i.Status!=Rt.STATUS_NONE_ID?"continue":(n=i.Symbol,n?(i.Status=Rt.STATUS_REQUESTDATA_ID,t.NetworkFilter&&(s={Name:"MinuteChartContainer::RequestOverlayMinuteData",Explain:"叠加股票最新分时数据",Request:{Url:e.HistoryMinuteApiUrl,Data:{days:[a],symbol:n},Type:"POST"},Self:t,PreventDefault:!1},t.NetworkFilter(s,(function(t){i.Status=Rt.STATUS_RECVDATA_ID,e.RecvOverlayMinuteData(t,i)})),1==s.PreventDefault)?"continue":void x.HttpRequest({url:e.HistoryMinuteApiUrl,data:{symbol:n,days:[a]},type:"post",dataType:"json",async:!0,success:function(t){i.Status=Rt.STATUS_RECVDATA_ID,e.RecvOverlayMinuteData(t,i)}})):{v:void 0}):"continue"};for(var r in this.OverlayChartPaint){var n,s,o=i();switch(o){case"continue":continue;default:if("object"===("undefined"===typeof o?"undefined":(0,d.default)(o)))return o.v}}},this.RecvOverlayMinuteData=function(t,e){if(!e.IsDelete){var a,i=wa.JsonDataToMinuteDataArray(t),r=null;if(this.DayCount>1){if(i.length<=0)return;var n=i[0];for(var s in e.SourceData){var o=e.SourceData[s];if(o.Date==n.Date){e.SourceData[s]=n;var h=this.HistoryMinuteDataToArray(e.SourceData);r=new It;r.Data=h,a=n.YClose;break}}if(null==r)return}else r=i.length>0?i[0]:new It,a=r.YClose;e.Data=r,e.Title=t.name,e.Symbol=t.symbol,e.YClose=a,e.Status=Rt.STATUS_FINISHED_ID,this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.RequestOverlayHistoryMinuteData=function(){var t=this,e=this,a=[];for(var i in this.DayData){var r=this.DayData[i];a.push(r.Date)}if(!(a.length<=0)){var n=function(){var r=t.OverlayChartPaint[i];return s=r.Symbol,s?r.Status!=Rt.STATUS_NONE_ID?"continue":(r.Status=Rt.STATUS_REQUESTDATA_ID,t.NetworkFilter&&(o={Name:"MinuteChartContainer::RequestOverlayHistoryMinuteData",Explain:"叠加股票多日分时数据",Request:{Url:e.HistoryMinuteApiUrl,Data:{days:a,symbol:s},Type:"POST"},Self:t,PreventDefault:!1},t.NetworkFilter(o,(function(t){r.Status=Rt.STATUS_RECVDATA_ID,e.RecvOverlayHistoryMinuteData(t,r)})),1==o.PreventDefault)?{v:void 0}:void x.HttpRequest({url:e.HistoryMinuteApiUrl,data:{symbol:s,days:a},type:"post",dataType:"json",async:!0,success:function(t){r.Status=Rt.STATUS_RECVDATA_ID,e.RecvOverlayHistoryMinuteData(t,r)}})):{v:void 0}};for(var i in this.OverlayChartPaint){var s,o,h=n();switch(h){case"continue":continue;default:if("object"===("undefined"===typeof h?"undefined":(0,d.default)(h)))return h.v}}}},this.RecvOverlayHistoryMinuteData=function(t,e){var a=wa.JsonDataToMinuteDataArray(t),i=[];for(var r in this.DayData){var n=this.DayData[r],s=!1;for(var o in a)if(n.Date==a[o].Date){i.push(a[r]),s=!0;break}if(!s){var h=new It;h.Date=n.Date}}e.SourceData=i;var l=this.HistoryMinuteDataToArray(i),u=i[0].YClose,C=new It;C.Data=l,e.Data=C,e.Title=t.name,e.Symbol=t.symbol,e.YClose=u,e.Status=Rt.STATUS_FINISHED_ID,this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()},this.CancelAutoUpdate=function(){"number"==typeof this.AutoUpdateTimer&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=void 0)},this.AutoUpdate=function(){if(this.CancelAutoUpdate(),this.IsAutoUpdate&&this.Symbol){var t=this,e=Li.GetMarketStatus(this.Symbol);if(0!=e&&3!=e){var a=this.AutoUpdateFrequency;1==e?this.AutoUpdateTimer=setTimeout((function(){t.AutoUpdate()}),a):2==e&&(this.AutoUpdateTimer=setTimeout((function(){t.ResetOverlaySymbolStatus(),t.RequestMinuteData()}),a))}}},this.BindIndexData=function(t,e){this.WindowIndex[t]&&("function"!=typeof this.WindowIndex[t].RequestData?"function"!=typeof this.WindowIndex[t].ExecuteScript?this.WindowIndex[t].BindData(this,t,e):this.WindowIndex[t].ExecuteScript(this,t,e):this.WindowIndex[t].RequestData(this,t,e))},this.BindMainData=function(t,e,a){var i=new It;if(i.Data=t.GetClose(),this.ChartPaint[0].Data=i,this.ChartPaint[0].YClose=e,this.ChartPaint[0].NotSupportMessage=null,this.ChartPaint[0].SourceData=this.IsBeforeData?t:null,this.ChartPaint[0].IsShowLead=!1,this.ChartPaint[0].LeadData=null,Li.IsSHSZIndex(this.Symbol)&&1==this.DayCount&&this.IsShowLead){var r=new It;r.Data=t.GetLead(),this.ChartPaint[0].LeadData=r,this.ChartPaint[0].IsShowLead=!0}this.Frame.SubFrame[0].Frame.YSplitOperator.YClose=e,this.Frame.SubFrame[0].Frame.YSplitOperator.Data=i,this.Frame.Data=this.ChartPaint[0].Data,this.Frame.SourceData=t,i=new It,i.Data=t.GetMinuteAvPrice(),this.ChartPaint[1].Data=i;var n=this.Symbol.toUpperCase();Li.IsForeignExchange(n)&&(this.ChartPaint[1].Data=null),this.Frame.SubFrame[0].Frame.YSplitOperator.AverageData=i,this.Frame.SubFrame[0].Frame.YSplitOperator.SourceData=this.IsBeforeData?t:null,this.Frame.SubFrame[0].Frame.YSplitOperator.OverlayChartPaint=this.OverlayChartPaint,this.Frame.SubFrame[0].Frame.YSplitOperator.LimitPrice=this.LimitPrice,a&&(this.Frame.SubFrame[0].Frame.YSplitOperator.High=a.High,this.Frame.SubFrame[0].Frame.YSplitOperator.Low=a.Low),this.ChartPaint[2].Data=t,this.ChartPaint[2].YClose=e,Li.IsFutures(n)||Li.IsSHO(n)?this.BindOverlayMainData(t,e):this.ClearBindOverlayMainData(),this.TitlePaint[0].Data=this.SourceData,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=this.Name,this.TitlePaint[0].YClose=e,this.ChartCorssCursor&&this.ChartCorssCursor.StringFormatY&&(this.ChartCorssCursor.StringFormatY.YClose=e,this.ChartCorssCursor.StringFormatX.Data=this.ChartPaint[0].Data),this.ExtendChartPaint[0]&&(this.ExtendChartPaint[0].Symbol=this.Symbol,this.ExtendChartPaint[0].Name=this.Name);var s=0,o=this.IsBeforeData;for(var h in this.DayCount>1&&(o=!1),o&&(s=15),this.OverlayChartPaint){var l=this.OverlayChartPaint[h];l.MainData=this.ChartPaint[0].Data,l.MainYClose=e,l.BeforeDataCount=s,l.IsBeforeData=o}},this.BindOverlayMainData=function(t,e){if(!(this.Frame.SubFrame.length<2)){var a=null,i=null,r=this.Frame.SubFrame[1];if(r.OverlayIndex.length<=0){var n=new ht;n.Identify="Position_Line_Frame",i=new et,i.Canvas=this.Canvas,i.MainFrame=r.Frame,i.ChartBorder=r.Frame.ChartBorder,n.Frame=i,i.YSplitOperator=new xe,i.YSplitOperator.LanguageID=this.LanguageID,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),i.YSplitOperator.Frame=i,i.YSplitOperator.ChartBorder=i.ChartBorder,i.YSplitOperator.SplitCount=r.Frame.YSplitOperator.SplitCount;a=new Bt;a.Canvas=this.Canvas,a.Name="Position-Line",a.ChartBorder=i.ChartBorder,a.ChartFrame=i,a.Identify=n.Identify,a.Color=Ma.Minute.PositionColor,n.ChartPaint.push(a),r.OverlayIndex.push(n),r.Frame.RightFrame=i}else a=r.OverlayIndex[0].ChartPaint[0],i=r.OverlayIndex[0].Frame;var s=this.Frame.SubFrame[0].Frame.XPointCount;i.XPointCount=s;var o=new It;o.Data=t.GetPosition(),a.Data=o}},this.ClearBindOverlayMainData=function(){if(!(this.Frame.SubFrame.length<2)){var t=this.Frame.SubFrame[1];t.Frame.RightFrame=null,t.OverlayIndex=[]}},this.GetChartPaint=function(t){var e=new Array;for(var a in this.ChartPaint)if(!(a<3)){var i=this.ChartPaint[a];i.ChartFrame==this.Frame.SubFrame[t].Frame&&e.push(i)}return e},this.CreateWindowIndex=function(t){this.WindowIndex[t].Create(this,t)},this.GetIndexInfo=function(){var t=[];for(var e in this.WindowIndex){var a=this.WindowIndex[e],i={Name:a.Name};a.ID&&(i.ID=a.ID),t.push(i)}return t},this.OnTouchFinished=function(){!0!==this.CorssCursorTouchEnd||this.DrawDynamicInfo()},this.CreateExtendChart=function(t,e){var a;switch(t){case"MinuteTooltip":return a=new Se,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,e.LanguageID=this.LanguageID,a.SetOption(e),this.ExtendChartPaint.push(a),a;default:return null}},this.SetMinuteInfo=function(t,e){for(var a in this.ChartInfo=[],t){var i=Ci.Get(t[a]);if(i){var r=i.Create();this.ChartInfo.push(r)}}1==e&&this.RequestMinuteInfoData()},this.GetChartMinuteInfo=function(){return this.ChartInfoPaint},this.CreateMinuteInfo=function(t){var e=new jt;return e.Canvas=this.Canvas,e.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,e.ChartFrame=this.Frame.SubFrame[0].Frame,e.HQChartBorder=this.Frame.ChartBorder,e.ChartMinutePrice=this.ChartPaint[0],t&&e.SetOption&&e.SetOption(t),this.ChartInfoPaint=e,e},this.RequestMinuteInfoData=function(){if(!(this.ChartInfo.length<=0)){var t=this.GetChartMinuteInfo();for(var e in t||(t=this.CreateMinuteInfo(null)),t.SourceData=this.SourceData,this.ChartInfo)this.ChartInfo[e].RequestData(this)}},this.UpdataChartInfo=function(){var t=this.GetChartMinuteInfo();if(t){var e=new g.default;for(var a in this.ChartInfo){var i=this.ChartInfo[a].Data;for(var r in i){var n=i[r],s=n.Date+" "+n.Time;e.has(s)?e.get(s).Data.push(n):e.set(s,{Data:new Array(n)})}}t.Data=e}},this.UpdateWindowIndex=function(t){if(!(t<2)){var e=this.SourceData;this.BindIndexData(t,e),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}}}function ba(t){this.newMethod=wa,this.newMethod(t),delete this.newMethod,this.HistoryMinuteApiUrl="https://opensourcecache.zealink.com/cache/minuteday/day/",this.ClassName="HistoryMinuteChartContainer",this.CreateMainKLine=function(){var t=new Zt;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,t.ChartFrame=this.Frame.SubFrame[0].Frame,t.Name="Minute-Line",t.Color=Ma.Minute.PriceColor,this.ChartPaint[0]=t;var e=new Bt;e.Canvas=this.Canvas,e.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,e.ChartFrame=this.Frame.SubFrame[0].Frame,e.Name="Minute-Average-Line",e.Color=Ma.Minute.AvPriceColor,this.ChartPaint[1]=e;e=new wt;e.Color=Ma.Minute.VolBarColor,e.Canvas=this.Canvas,e.ChartBorder=this.Frame.SubFrame[1].Frame.ChartBorder,e.ChartFrame=this.Frame.SubFrame[1].Frame,e.Name="Minute-Vol-Bar",this.ChartPaint[2]=e,this.TitlePaint[0]=new Ze,this.TitlePaint[0].Frame=this.Frame.SubFrame[0].Frame,this.TitlePaint[0].Canvas=this.Canvas,this.TitlePaint[0].IsShowDate=!0},this.ChangeTradeDate=function(t){t&&(this.TradeDate=t,this.RequestData())},this.RequestData=function(){var t=new Date,e=1e4*t.getFullYear()+100*(t.getMonth()+1)+t.getDate();e==this.TradeDate?this.RequestMinuteData():this.RequestHistoryMinuteData()},this.RequestHistoryMinuteData=function(){var t=this,e=this.HistoryMinuteApiUrl+this.TradeDate.toString()+"/"+this.Symbol+".json";x.HttpRequest({url:e,type:"get",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvHistoryMinuteData(e)},error:function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvHistoryMinuteError(e)}})},this.RecvHistoryMinuteError=function(t){if(404==t.status){var e=new It;for(var a in this.SourceData=e,this.ChartPaint)this.ChartPaint[a].Data=e,0==a&&(this.ChartPaint[a].NotSupportMessage="没有权限访问!");this.TitlePaint[0].Data=this.SourceData,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=null,this.Draw()}},this.RecvHistoryMinuteData=function(t){var e=ba.JsonDataToMinuteData(t),a=new It;if(a.Data=e,this.TradeDate=t.date,this.SourceData=a,this.Symbol=t.symbol,this.Name=t.name,this.BindMainData(a,t.day.yclose),this.Frame.SubFrame.length>2){var i=new It;i.Data=e;for(var r=2;r<this.Frame.SubFrame.length;++r)this.BindIndexData(r,i)}this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}}function Ba(t){this.newMethod=Pa,this.newMethod(t),delete this.newMethod,this.ClassName="CustomKLineChartContainer",this.CustomKLineApiUrl=Ma.Domain+"/API/IndexCalculate",this.CustomStock,this.QueryDate={Start:20180101,End:20180627},this.RequestHistoryData=function(){var t=this;this.ChartSplashPaint.IsEnableSplash=!0,this.Draw(),x.HttpRequest({url:this.CustomKLineApiUrl,data:{stock:t.CustomStock,Name:t.Symbol,date:{startdate:t.QueryDate.Start,enddate:t.QueryDate.End}},type:"post",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.IsEnableSplash=!1,t.RecvHistoryData(e)}})},this.RecvHistoryData=function(t){var e=Pa.JsonDataToHistoryData(t),a=new It;a.Data=e,a.DataType=0;var i=new It;if(i.Data=e,i.Right=this.Right,i.Period=this.Period,i.DataType=0,i.Right>0){var r=i.GetRightDate(i.Right);i.Data=r}if(It.IsDayPeriod(this.Period,!1)){var n=a.GetPeriodData(i.Period);i.Data=n}this.SourceData=a,this.Name=t.name,this.BindMainData(i,this.PageSize);for(var s=0;s<this.Frame.SubFrame.length;++s)this.BindIndexData(s,i);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}}function _a(t,e){!0===e?(this.newMethod=Ha,this.newMethod(t),delete this.newMethod):(this.newMethod=Pa,this.newMethod(t),delete this.newMethod),this.BuySellPaint,this.TrainDataCount=300,this.TrainStartDate,this.AutoRunTimer=null,this.BuySellData=[],this.TrainCallback,this.DragMode=1,this.IsAutoUpdate=!1,this.KLineSourceData,this.TrainInfo={Start:{},End:{}},this.CreateBuySellPaint=function(){var t=new De;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,t.ChartFrame=this.Frame.SubFrame[0].Frame,t.Name="KLine-Train-BuySell",this.ChartPaintEx[0]=t},this.GetKDataIndexByDateTime=function(t,e){if(!e||!t)return-1;for(var a in t){var i=t[a];if(It.IsMinutePeriod(this.Period,!0)){if(Le.IsNumber(this.TrainStartDate.Time)){if(i.Date>=this.TrainStartDate.Date&&i.Time>=this.TrainStartDate.Time)return parseInt(a)}else if(i.Date>=this.TrainStartDate.Date)return parseInt(a)}else if((It.IsDayPeriod(this.Period,!0)||It.IsTickPeriod(this.Period))&&i.Date>=this.TrainStartDate.Date)return parseInt(a)}return-1},this.AfterBindMainData=function(t){this.ChartPaintEx[0]||this.CreateBuySellPaint();var e=this.ChartPaint[0].Data;this.ChartPaintEx[0].Data=e;var a=e.Data[e.Data.length-1];this.TrainInfo.LastShowData=a,this.TrainInfo.LastData=this.SourceData.Data[this.SourceData.Data.length-1],"Update"!=t&&this.UpdateTrainUICallback("开始")},this.BeforeBindMainData=function(t){if("Update"!=t){this.KLineSourceData=new It,this.KLineSourceData.Data=this.SourceData.Data.slice(0);var e=this.SourceData.Data.length,a=e-this.TrainDataCount-20,i=this.GetKDataIndexByDateTime(this.SourceData.Data,this.TrainStartDate);i>=0&&(a=i+1,e-a<this.TrainDataCount&&(this.TrainDataCount=e-a));var r=a-1,n=this.SourceData.Data[r];this.TrainInfo.Start.Index=r,this.TrainInfo.Start.Date=n.Date,this.TrainInfo.Start.Time=n.Time,this.TrainInfo.End.Index=r,this.TrainInfo.End.Date=n.Date,this.TrainInfo.End.Time=n.Time,this.TrainInfo.LastData=n,this.SourceData.Data.length=a}},this.Run=function(t){if(!this.AutoRunTimer&&!(this.TrainDataCount<=0)){var e=this;this.AutoRunTimer=setInterval((function(){e.MoveNextKLineData(t)||clearInterval(e.AutoRunTimer)}),1e3)}},this.MoveNextKLineData=function(t){if(this.TrainDataCount<=0)return!1;var e=1;t&&t.Step>1&&(e=t.Step);for(var a=0,i=0;i<e;++i){var r=this.TrainInfo.End.Index+1;if(r>=this.KLineSourceData.Data.length)break;var n=this.KLineSourceData.Data[r];if(this.SourceData.Data.push(n),this.TrainInfo.End.Index=r,this.TrainInfo.End.Date=n.Date,this.TrainInfo.End.Time=n.Time,--this.TrainDataCount,++a,this.TrainDataCount<=0)break}if(0==a)return!1;var s=this.Frame.GetCurrentPageSize();return Le.IsNumber(s)&&(this.PageSize=s-this.RightSpaceCount),t&&t.PageSize>0&&(this.PageSize=t.PageSize),this.Update(),this.TrainDataCount<=0?(this.FinishTrainData(),this.UpdateTrainUICallback("结束"),!1):(this.UpdateTrainUICallback("训练中"),!0)},this.UpdateTrainUICallback=function(t){if(this.mapEvent.has(b.RECV_TRAIN_MOVE_STEP)){var e=this.mapEvent.get(b.RECV_TRAIN_MOVE_STEP);if(e.Callback){var a={TrainDataCount:this.TrainDataCount,BuySellData:this.BuySellData,KLine:{Start:{Index:this.TrainInfo.Start.Index,Date:this.TrainInfo.Start.Date},End:{Index:this.TrainInfo.End.Index,Date:this.TrainInfo.End.Date}},LastData:this.TrainInfo.LastData,LastShowData:this.TrainInfo.LastShowData};Le.IsNumber(this.TrainInfo.Start.Time)&&(a.KLine.Start.Time=this.TrainInfo.Start.Time),Le.IsNumber(this.TrainInfo.End.Time)&&(a.KLine.End.Time=this.TrainInfo.End.Time),t&&(a.Description=t),this.TrainDataCount<=0&&(a.Symbol=this.Symbol,a.Name=this.Name),e.Callback(e,a,this)}}},this.FinishTrainData=function(){M.Chart.Log("[KLineTrainChartContainer::FinishTrainData] trian end ")},this.Stop=function(){null!=this.AutoRunTimer&&clearInterval(this.AutoRunTimer),this.AutoRunTimer=null},this.BuyOrSell=function(t,e){var a=this.TrainInfo.LastShowData;if(!a)return!1;var i=this.ChartPaintEx[0];if(!i)return!1;var r=this.ChartPaint[0].Data;if(!r||r.Data.length<=0)return!1;var n=r.Data.length-1,s={Date:this.TrainInfo.End.Date,Time:this.TrainInfo.End.Time,Price:t.Price,Vol:t.Vol,Op:0,ID:t.ID};1==t.Op&&(s.Op=1);var o=n;s.Key=o,this.BuySellData.push(s),i.AddTradeItem(s),1==e&&this.Draw()},this.RestartTrain=function(t){M.Chart.Log("[KLineTrainChartContainer::RestartTrain] option ",t),this.TrainInfo={Start:{},End:{}},this.BuySellData=[],this.KLineSourceData=null;var e=this.ChartPaintEx[0];e&&(e.Data=null,e.ClearTradeData()),t.Symbol&&(this.Symbol=t.Symbol),Le.IsNumber(t.Period)&&(this.Period=t.Period),Le.IsNumber(t.Right)&&(this.Right=t.Right),t.Train&&(t.Train.DataCount>1&&(this.TrainDataCount=t.Train.DataCount),t.Train.DateTime&&(this.TrainStartDate=t.Train.DateTime));var a=this.Symbol;this.ChangeSymbol(a)},this.RecvFlowCapitalData=function(t){if(t.stock&&1==t.stock.length){var e=t.stock[0],a=new Array;for(var i in e.stockday){var r=e.stockday[i],n=new ft;n.Date=r.date;var s=r.capital;s&&(s.a>0&&(n.Value=s.a,a.push(n)))}if(It.IsMinutePeriod(this.Period,!0)){var o=this.SourceData.GetMinuteFittingFinanceData(a);for(var h in this.SourceData.Data){r=this.SourceData.Data[h];r.FlowCapital=o[h].Value}var l=this.ChartPaint[0].Data,u=new It;if(u.Data=this.SourceData.Data,It.IsMinutePeriod(l.Period,!1)){var C=u.GetPeriodData(l.Period);u.Data=C}l.Data=u.Data;o=this.KLineSourceData.GetMinuteFittingFinanceData(a);for(var D in this.KLineSourceData.Data){r=this.KLineSourceData.Data[D];r.FlowCapital=o[D].Value}}else{o=this.SourceData.GetFittingFinanceData(a);for(var c in this.SourceData.Data){r=this.SourceData.Data[c];r.FlowCapital=o[c].Value}l=this.ChartPaint[0].Data,u=new It;if(u.Data=this.SourceData.Data,l.Right>0){var f=u.GetRightDate(l.Right);u.Data=f}if(It.IsDayPeriod(l.Period,!1)){C=u.GetPeriodData(l.Period);u.Data=C}l.Data=u.Data;o=this.KLineSourceData.GetFittingFinanceData(a);for(var d in this.KLineSourceData.Data){r=this.KLineSourceData.Data[d];r.FlowCapital=o[d].Value}}this.FlowCapitalReady=!0;var m=!1;for(var v in this.ExtendChartPaint){r=this.ExtendChartPaint[v];if("StockChip"==r.ClassName){m=!0;break}}m&&this.Draw()}},this.AutoUpdate()}function Ha(t){this.newMethod=Pa,this.newMethod(t),delete this.newMethod,this.ClassName="KLineChartHScreenContainer",this.OnMouseMove=function(t,e,a){this.LastPoint.X=t,this.LastPoint.Y=e,this.CursorIndex=this.Frame.GetXData(e),this.DrawDynamicInfo()},t.onmousedown=function(e){if(this.JSChartContainer&&0!=this.JSChartContainer.DragMode){var a=V();if(this.JSChartContainer.TryClickLock){var i=(e.clientX-this.getBoundingClientRect().left)*a,r=(e.clientY-this.getBoundingClientRect().top)*a;if(this.JSChartContainer.TryClickLock(i,r))return}var n={Click:{},LastMove:{}};n.Click.X=e.clientX,n.Click.Y=e.clientY,n.LastMove.X=e.clientX,n.LastMove.Y=e.clientY,this.JSChartContainer.MouseDrag=n,document.JSChartContainer=this.JSChartContainer,this.JSChartContainer.SelectChartDrawPicture=null,t.ondblclick=function(t){var e=t.clientX-this.getBoundingClientRect().left,a=t.clientY-this.getBoundingClientRect().top;this.JSChartContainer&&this.JSChartContainer.OnDoubleClick(e,a,t)},document.onmousemove=function(t){if(this.JSChartContainer&&(!this.JSChartContainer.ChartSplashPaint||1!=this.JSChartContainer.ChartSplashPaint.IsEnableSplash)){var e=this.JSChartContainer.MouseDrag;if(e){var a=Math.abs(e.LastMove.Y-t.clientY);if(1==this.JSChartContainer.DragMode){if(a<5)return;var i=!0;e.LastMove.Y<t.clientY&&(i=!1),this.JSChartContainer.DataMove(a,i)&&(this.JSChartContainer.UpdataDataoffset(),this.JSChartContainer.UpdatePointByCursorIndex(),this.JSChartContainer.UpdateFrameMaxMin(),this.JSChartContainer.ResetFrameXYSplit(),this.JSChartContainer.Draw()),e.LastMove.X=t.clientX,e.LastMove.Y=t.clientY}}}},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,this.JSChartContainer.MouseDrag=null,this.JSChartContainer.CurrentChartDrawPicture=null,this.JSChartContainer=null}}},this.OnTouchStart=function(e){this.PhonePinch=null,this.IsOnTouch=!0,this.TouchDrawCount=0,this.StopDragTimer();var a=this.IsSingleTouch(e);if(e.cancelable&&e.preventDefault(),this.IsPhoneDragging(e)){if(this.TryClickLock||this.TryClickIndexTitle){var i=this.GetToucheData(e,this.IsForceLandscape),r=i[0].clientX,n=i[0].clientY,s=V();if(r-=t.getBoundingClientRect().left*s,n-=t.getBoundingClientRect().top*s,this.TryClickLock&&this.TryClickLock(r,n))return;if(this.TryClickIndexTitle&&this.TryClickIndexTitle(r,n))return}var o=!0;this.ChartDrawOption.IsLockScreen?o=!1:this.DragMode==_.CLICK_TOUCH_MODE_ID?1==this.TouchStatus.CorssCursorShow&&(o=!1):this.DragMode==_.DISABLE_DRAG_ID?o=!1:a||(o=!1);var h={Click:{},LastMove:{}};i=this.GetToucheData(e,!1);if(h.Click.X=i[0].clientX,h.Click.Y=i[0].clientY,h.LastMove.X=i[0].clientX,h.LastMove.Y=i[0].clientY,this.MouseDrag=h,this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null,this.CurrentChartDrawPicture){var l=this.CurrentChartDrawPicture;return 2==l.Status?this.SetChartDrawPictureThirdPoint(h.Click.X,h.Click.Y,!0):(this.SetChartDrawPictureFirstPoint(h.Click.X,h.Click.Y,!0),this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo({Corss:!1,Tooltip:!1})),void(e.cancelable&&e.preventDefault())}var u={};s=V();if(u.X=i[0].clientX-t.getBoundingClientRect().left,u.Y=i[0].clientY-t.getBoundingClientRect().top,this.GetChartDrawPictureByPoint(u)){u.ChartDrawPicture.Status=20,u.ChartDrawPicture.ValueToPoint(),u.ChartDrawPicture.MovePointIndex=u.PointIndex,u.ChartDrawPicture.IsSelected=!0,this.CurrentChartDrawPicture=u.ChartDrawPicture,this.SelectChartDrawPicture=u.ChartDrawPicture;var C=this.GetEventCallback(b.ON_CLICK_DRAWPICTURE);if(C&&C.Callback){var D={DrawPicture:u.ChartDrawPicture};C.Callback(C,D,this)}return void(e.cancelable&&e.preventDefault())}if(o){var c=this;this.DragTimer=setTimeout((function(){if(h.Click.X==h.LastMove.X&&h.Click.Y==h.LastMove.Y){c.MouseDrag;c.MouseDrag=null,c.MoveCorssCursor(h.Click,e)}}),c.PressTime)}this.ChartDrawOption.IsLockScreen?this.MouseDrag=null:this.DragMode==_.CLICK_TOUCH_MODE_ID||(this.DragMode==_.DISABLE_DRAG_ID?(this.MouseDrag=null,this.MoveCorssCursor(h.Click,e)):this.IsClickShowCorssCursor&&this.MoveCorssCursor(h.Click,e))}else if(this.IsPhonePinching(e)){var f={Start:{},Last:{}};i=this.GetToucheData(e,!1);f.Start={X:i[0].pageX,Y:i[0].pageY,X2:i[1].pageX,Y2:i[1].pageY},f.Last={X:i[0].pageX,Y:i[0].pageY,X2:i[1].pageX,Y2:i[1].pageY},this.PhonePinch=f,this.SelectChartDrawPicture=null}},this.OnTouchMove=function(t){t.cancelable&&t.preventDefault();var e=this.GetToucheData(t,!1);if(this.IsPhoneDragging(t)){var a=this.MouseDrag;if(null==a)this.ChartDrawOption.IsLockScreen||this.MoveCorssCursor({X:e[0].clientX,Y:e[0].clientY},t);else{var i=Math.abs(a.LastMove.Y-e[0].clientY),r=Math.abs(a.LastMove.X-e[0].clientX),n=this.DragMode==_.CLICK_TOUCH_MODE_ID&&1==this.TouchStatus.CorssCursorShow;if(this.CurrentChartDrawPicture){var s=this.CurrentChartDrawPicture;if(1==s.Status||2==s.Status){if(i<5&&r<5)return;this.SetChartDrawPictureSecondPoint(e[0].clientX,e[0].clientY,!0)&&this.DrawDynamicInfo()}else if(3==s.Status)this.SetChartDrawPictureThirdPoint(e[0].clientX,e[0].clientY,!0)&&this.DrawDynamicInfo();else if(20==s.Status){if(i<5&&r<5)return;this.MoveChartDrawPicture(e[0].clientX-a.LastMove.X,e[0].clientY-a.LastMove.Y,!0)&&this.DrawDynamicInfo()}a.LastMove.X=e[0].clientX,a.LastMove.Y=e[0].clientY}if(n){this.MouseDrag;this.MouseDrag=null,this.MoveCorssCursor(a.Click,t)}else if(1==this.DragMode||0==n){if(i<5)return;var o=!0;a.LastMove.Y<e[0].clientY&&(o=!1),this.DataMove(i,o)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()):this.DragDownloadData&&this.DragDownloadData(),a.LastMove.X=e[0].clientX,a.LastMove.Y=e[0].clientY}}}else if(this.IsPhonePinching(t)){if(this.DragMode==_.DISABLE_DRAG_ID)return;var h=this.PhonePinch;if(!h)return;var l=Math.abs(e[0].pageX-e[1].pageX),u=Math.abs(h.Last.X-h.Last.X2),C=l-u;if(Math.abs(C)<5)return;if(C>0){var D={};if(D.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(D))return;this.CursorIndex=D.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown()}else{D={};if(D.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(D))return;this.CursorIndex=D.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown()}h.Last={X:e[0].pageX,Y:e[0].pageY,X2:e[1].pageX,Y2:e[1].pageY}}},this.OnTouchEnd=function(t){M.Chart.Log("[KLineChartHScreenContainer:OnTouchEnd]",t);if(this.CurrentChartDrawPicture){var e=this.CurrentChartDrawPicture;2==e.Status||1==e.Status||3==e.Status?(e.PointStatus=e.Status,this.FinishChartDrawPicturePoint()?this.DrawDynamicInfo():!1):20==e.Status&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}this.IsOnTouch=!1,this.StopDragTimer(),this.OnTouchFinished(),this.TouchDrawCount=0},this.Create=function(t){for(var e in this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new Pe,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=Ke.Create("CorssCursor_XStringFormat"),this.ChartCorssCursor.StringFormatY=Ke.Create("CorssCursor_YStringFormat"),this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY.ExtendChartPaint=this.ExtendChartPaint,this.ChartSplashPaint=new we,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new ut,this.Frame.ChartBorder=new q,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(t),this.CreateMainKLine(),this.Frame.SubFrame){var a=new $e;a.Frame=this.Frame.SubFrame[e].Frame,a.Canvas=this.Canvas,a.LanguageID=this.LanguageID,this.TitlePaint.push(a)}this.UIElement.addEventListener("keydown",G,!0)},this.CreateChildWindow=function(t){for(var e=0;e<t;++e){var a=new q;a.UIElement=this.UIElement;var i=new nt;if(i.Canvas=this.Canvas,i.ChartBorder=a,i.Identify=e,i.RightSpaceCount=this.RightSpaceCount,this.ModifyIndexDialog&&(i.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(i.ChangeIndexEvent=this.ChangeIndexDialog.DoModal),i.HorizontalMax=20,i.HorizontalMin=10,0==e){i.YSplitOperator=new Me,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price");var r=V();a.TopSpace=12*r,a.BottomSpace=12*r}else i.YSplitOperator=new xe,i.YSplitOperator.LanguageID=this.LanguageID,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double");i.YSplitOperator.Frame=i,i.YSplitOperator.ChartBorder=a,i.XSplitOperator=new Ne,i.XSplitOperator.Frame=i,i.XSplitOperator.ChartBorder=a,e!=t-1&&(i.XSplitOperator.ShowText=!1);for(var n=i.HorizontalMin;n<=i.HorizontalMax;n+=1)i.HorizontalInfo[n]=new z,i.HorizontalInfo[n].Value=n,0==e&&n==i.HorizontalMin||(i.HorizontalInfo[n].Message[1]=n.toString(),i.HorizontalInfo[n].Font="14px 微软雅黑");var s=new ot;s.Frame=i,s.Height=0==e?20:10,this.Frame.SubFrame[e]=s}}}function Va(t){this.newMethod=wa,this.newMethod(t),delete this.newMethod,this.ClassName="MinuteChartHScreenContainer",this.OnMouseMove=function(t,e,a){this.LastPoint.X=t,this.LastPoint.Y=e,this.CursorIndex=this.Frame.GetXData(e),this.DrawDynamicInfo()},this.Create=function(t){for(var e in this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new Pe,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=new Ve,this.ChartCorssCursor.StringFormatY=new _e,this.ChartSplashPaint=new we,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new ut,this.Frame.ChartBorder=new q,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=25,this.Frame.ChartBorder.Left=50,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(t),this.CreateMainKLine(),this.Frame.SubFrame){var a=new $e;a.Frame=this.Frame.SubFrame[e].Frame,a.Canvas=this.Canvas,a.LanguageID=this.LanguageID,this.TitlePaint.push(a)}this.ChartCorssCursor.StringFormatX.Frame=this.Frame.SubFrame[0].Frame,this.UIElement.addEventListener("keydown",G,!0)},this.CreateChildWindow=function(t){for(var e=0;e<t;++e){var a=new q;a.UIElement=this.UIElement;var i=new at;i.Canvas=this.Canvas,i.ChartBorder=a,e<2&&(i.ChartBorder.TitleHeight=0),i.XPointCount=243;var r=[9,8,7,6,5,4,3,2,1];for(var n in i.HorizontalMax=r[0],i.HorizontalMin=r[r.length-1],0==e?(i.YSplitOperator=new Oe,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price")):(i.YSplitOperator=new xe,i.YSplitOperator.LanguageID=this.LanguageID,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double")),i.YSplitOperator.Frame=i,i.YSplitOperator.ChartBorder=a,i.XSplitOperator=new ye,i.XSplitOperator.Frame=i,i.XSplitOperator.ChartBorder=a,e!=t-1&&(i.XSplitOperator.ShowText=!1),i.XSplitOperator.Operator(),r)i.HorizontalInfo[n]=new z,i.HorizontalInfo[n].Value=r[n],0==e&&n==i.HorizontalMin||(i.HorizontalInfo[n].Message[1]=r[n].toString(),i.HorizontalInfo[n].Font="14px 微软雅黑");var s=new ot;s.Frame=i,s.Height=0==e?20:10,this.Frame.SubFrame[e]=s}}}function Ga(t){this.newMethod=H,this.newMethod(t),delete this.newMethod,this.MainDataControl,this.Create=function(){this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new we,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new Ct,this.Frame.ChartBorder=new q,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor&&(this.ChartCorssCursor.Frame=this.Frame),this.ChartSplashPaint.Frame=this.Frame,this.CreateMainChart(),this.UIElement.addEventListener("keydown",G,!0)},this.SetMainDataConotrl=function(t){t&&(this.MainDataControl=t,this.ChartPaint=[],this.CreateMainChart(),this.Draw(),this.RequestData())},this.CreateMainChart=function(){if(this.MainDataControl){for(var t in this.MainDataControl.DataType){var e=this.MainDataControl.DataType[t];if("BAR"==e.Type){var a=new te;a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.Name=e.Name,e.Color&&(a.UpBarColor=e.Color),e.Color2&&(a.DownBarColor=e.Color2),this.ChartPaint.push(a)}else if("LINE"==e.Type){a=new Bt;a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.Name=e.Name,e.Color&&(a.Color=e.Color),this.ChartPaint.push(a)}}this.Frame.YSplitOperator=new xe,this.Frame.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),this.Frame.YSplitOperator.Frame=this.Frame,this.Frame.YSplitOperator.ChartBorder=this.Frame.ChartBorder,this.Frame.XSplitOperator=new Re,this.Frame.XSplitOperator.Frame=this.Frame,this.Frame.XSplitOperator.ChartBorder=this.Frame.ChartBorder}},this.RequestData=function(){this.MainDataControl&&(this.MainDataControl.JSChartContainer=this,this.MainDataControl.RequestData())},this.UpdateMainData=function(t){var e=0;for(var a in t.Data){var i=new It;i.Data=t.Data[a],this.ChartPaint[a].Data=i,e<i.Data.length&&(e=i.Data.length)}this.Frame.XPointCount=e,this.Frame.Data=this.ChartPaint[0].Data,this.Frame.XData=t.XData,this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}}function ka(t){this.Radius,this.newMethod=H,this.newMethod(t),delete this.newMethod,this.MainDataControl,this.OnMouseMove=function(t,e,a){},this.Create=function(){this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new we,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new Q,this.Frame.ChartBorder=new q,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame,this.CreateMainChart()},this.SetMainDataConotrl=function(t){t&&(this.MainDataControl=t,this.ChartPaint=[],this.CreateMainChart(),this.Draw(),this.RequestData())},this.CreateMainChart=function(){if(this.MainDataControl)for(var t in this.MainDataControl.DataType){var e=this.MainDataControl.DataType[t];if("PIE"==e.Type){var a=new ce;a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.Name=e.Name,this.Radius&&(a.Radius=this.Radius),this.ChartPaint.push(a)}else if("RADAR"==e.Type){a=new fe;a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.Name=e.Name,e.StartAngle&&(a.StartAngle=e.StartAngle),this.ChartPaint.push(a)}}},this.RequestData=function(){this.MainDataControl&&(this.MainDataControl.JSChartContainer=this,this.MainDataControl.RequestData())},this.UpdateMainData=function(t){for(var e in t.Data){var a=new It;a.Data=t.Data[e],this.ChartPaint[e].Data=a}this.Frame.SetSizeChage(!0),this.Draw()}}function Ya(t){this.newMethod=H,this.newMethod(t),delete this.newMethod,this.MainDataControl,this.OnMouseMove=function(t,e,a){},this.Create=function(){this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new we,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new Q,this.Frame.ChartBorder=new q,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame,this.CreateMainChart()},this.SetMainDataConotrl=function(t){t&&(this.MainDataControl=t,this.ChartPaint=[],this.CreateMainChart(),this.Draw(),this.RequestData())},this.CreateMainChart=function(){if(this.MainDataControl){var t=new de;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.ChartBorder,t.ChartFrame=this.Frame,t.Name=this.MainDataControl.DataType[0].Name,this.Radius&&(t.Radius=this.Radius),this.ChartPaint.push(t)}},this.RequestData=function(){this.MainDataControl&&(this.MainDataControl.JSChartContainer=this,this.MainDataControl.RequestData())},this.UpdateMainData=function(t){this.ChartPaint[0].Data=t.Data[0],this.Frame.SetSizeChage(!0),this.Draw()}}function Ua(t,e){this.Name=t,this.Param=e,this.LineColor,this.ReqeustData=null}function Wa(t){this.Index,this.Name=t,this.Script=null,this.OverlayIndex=null,this.Create=function(t,e){},this.NotSupport=function(t,e,a){var i=this.IsOverlay();if(!i){t.DeleteIndexPaint(e);var r=t.Frame.SubFrame[e].Frame,n=new bt;n.Canvas=t.Canvas,n.ChartBorder=r.ChartBorder,n.ChartFrame=r,n.NotSupportMessage=a,t.ChartPaint.push(n)}},this.FormatIndexTitle=function(){var t=this.Name,e=null;for(var a in this.Index){var i=this.Index[a];null!=i.Param&&(e?e+=","+i.Param.toString():e=i.Param.toString())}return e&&(t+="("+e+")"),t},this.IsOverlay=function(){return!(!this.OverlayIndex||1!=this.OverlayIndex.IsOverlay)},this.CreateChart=function(t){return new Bt},this.CreatePaints=function(t,e){var a=null,i=this.IsOverlay();i?(a=this.OverlayIndex.Frame.Frame,this.OverlayIndex.Frame.ChartPaint=[]):(a=t.Frame.SubFrame[e].Frame,t.DeleteIndexPaint(e));var r=[];for(var n in this.Index){var s=this.CreateChart(n);s.Color=this.Index[n].LineColor,s.Canvas=t.Canvas,s.Name=this.Name+"-"+n.toString(),s.ChartBorder=a.ChartBorder,s.ChartFrame=a,i?this.OverlayIndex.Frame.ChartPaint.push(s):t.ChartPaint.push(s),r.push(s)}return r},this.SendEvent=function(t,e,a,i){if(t.GetIndexEvent){var r=t.GetIndexEvent();if(r){var n={Data:this.GetOutData(),WindowIndex:e,Name:this.Name,HistoryData:a,Stock:{Symbol:t.Symbol,Name:t.Name}};i&&(n.Error=i),r.Callback(r,n,self)}}},this.GetOutData=function(){return null}}function Xa(){this.newMethod=Wa,this.newMethod("CJL"),delete this.newMethod,this.Index=new Array(new Ua("VOL",null),new Ua("OPID",null)),this.Index[0].LineColor=Ma.Index.LineColor[0],this.Index[1].LineColor=Ma.Index.LineColor[1],this.CreateChart=function(t){if(0==t){var e=new Ut;return e}if(1==t){e=new _t;return e.LineWidth=1*V(),e}},this.RequestData=function(t,e,a){return this.BindData(t,e,a),t.UpdataDataoffset(),t.UpdateFrameMaxMin(),t.Draw(),!0},this.BindData=function(t,e,a){var i=this.CreatePaints(t,e),r=this.IsOverlay();if(i.length!=this.Index.length)return!1;var n=a.GetVol(),s=a.GetPosition();i[0].HistoryData=a,i[0].Data.Data=n,i[1].Data.Data=s;var o=e+1;if(r){var h=t.TitlePaint[o],l={Data:[],Title:""};for(var u in h.OverlayIndex.set(this.OverlayIndex.Identify,l),i){var C=new je(i[u].Data,this.Index[u].Name,this.Index[u].LineColor);h.OverlayIndex.get(this.OverlayIndex.Identify).Data[u]=C}}else t.TitlePaint[o].Data[0]=new je(i[0].Data,this.Index[0].Name,this.Index[0].LineColor),t.TitlePaint[o].Data[1]=new je(i[1].Data,this.Index[1].Name,this.Index[1].LineColor),t.TitlePaint[o].Title=this.Name;return!0}}function Ka(){this.newMethod=Wa,this.newMethod("Long-Short"),delete this.newMethod,this.Index=new Array(new Ua("多头区域",null),new Ua("空头区域",null),new Ua("市场多空指标",null)),this.Index[0].LineColor=Ma.UpBarColor,this.Index[1].LineColor=Ma.DownBarColor,this.Index[2].LineColor=Ma.Index.LineColor[0],this.LongShortData,this.CreateChart=function(t){if(2==t){var e=new Bt;return e.LineWidth=2,e}return new zt},this.GetOutData=function(){return{LongShortData:this.LongShortData}},this.RequestData=function(t,e,a){var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a};return this.LongShortData=[],r.HQChart.Period>0?(this.NotSupport(r.HQChart,r.WindowIndex,"不支持周期切换"),r.HQChart.Draw(),this.SendEvent(t,e,a,"不支持周期切换"),!1):(x.HttpRequest({url:Ma.Index.MarketLongShortApiUrl,data:{},type:"post",dataType:"json",async:!0,success:function(n){i.RecvData(n,r),i.SendEvent(t,e,a)}}),!0)},this.RecvData=function(t,e){if(!(t.data.length<=0)){var a=new Array;for(var i in t.data){var r=t.data[i],n=new ft;n.Date=r[0],n.Value=r[1],a.push(n)}var s=e.HistoryData.GetFittingData(a),o=new It;o.Data=s,o.Period=e.HQChart.Period,o.Right=e.HQChart.Right,this.LongShortData=o.GetValue(),this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()}},this.BindData=function(t,e,a){var i=this.CreatePaints(t,e),r=this.IsOverlay();if(i.length!=this.Index.length)return!1;i[2].Data.Data=this.LongShortData,i[0].Data.Data[0]=8,i[1].Data.Data[0]=1;var n=e+1;if(r){this.OverlayIndex.Frame.Frame.YSpecificMaxMin={Max:9,Min:0,Count:3};var s=t.TitlePaint[n],o={Data:[],Title:""};for(var h in s.OverlayIndex.set(this.OverlayIndex.Identify,o),i){var l=new je(i[h].Data,this.Index[h].Name,this.Index[h].LineColor);2!=h&&(l.DataType="StraightLine"),s.OverlayIndex.get(this.OverlayIndex.Identify).Data[h]=l}}else for(var h in t.Frame.SubFrame[e].Frame.YSpecificMaxMin={Max:9,Min:0,Count:3},i)t.TitlePaint[n].Data[h]=new je(i[h].Data,this.Index[h].Name,this.Index[h].LineColor),2!=h&&(t.TitlePaint[n].Data[h].DataType="StraightLine");return!0}}function Ja(){this.newMethod=Wa,this.newMethod("Market-Timing"),delete this.newMethod,this.Index=new Array(new Ua("因子择时",null)),this.TimingData,this.TitleColor=Ma.FrameSplitTextColor,this.CreateChart=function(t){return new $t},this.GetOutData=function(){return{TimingData:this.TimingData}},this.RequestData=function(t,e,a){var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a};return this.LongShortData=[],r.HQChart.Period>0?(this.NotSupport(r.HQChart,r.WindowIndex,"不支持周期切换"),r.HQChart.Draw(),this.SendEvent(t,e,a,"不支持周期切换"),!1):(x.HttpRequest({url:Ma.Index.MarketLongShortApiUrl,data:{},type:"post",dataType:"json",async:!0,success:function(n){i.RecvData(n,r),i.SendEvent(t,e,a)}}),!0)},this.RecvData=function(t,e){if(!(t.data.length<=0)){var a=new Array;for(var i in t.data){var r=t.data[i],n=new ft;n.Date=r[0],n.Value=r[2],a.push(n)}var s=e.HistoryData.GetFittingData(a),o=new It;o.Data=s,o.Period=e.HQChart.Period,o.Right=e.HQChart.Right,this.TimingData=o.GetValue(),this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()}},this.BindData=function(t,e,a){var i=this.CreatePaints(t,e),r=this.IsOverlay();if(i.length!=this.Index.length)return!1;i[0].Data.Data=this.TimingData,i[0].NotSupportMessage=null;var n=e+1;if(r){var s=t.TitlePaint[n],o={Data:[],Title:""};for(var h in s.OverlayIndex.set(this.OverlayIndex.Identify,o),i){var l=new je(i[h].Data,this.Index[h].Name,this.Index[h].LineColor);l.StringFormat=Qe.THOUSANDS,l.FloatPrecision=0,s.OverlayIndex.get(this.OverlayIndex.Identify).Data[h]=l}}else for(var h in i)t.TitlePaint[n].Data[h]=new je(i[h].Data,this.Index[h].Name,this.TitleColor),t.TitlePaint[n].Data[h].StringFormat=Qe.THOUSANDS,t.TitlePaint[n].Data[h].FloatPrecision=0;return!0}}function za(){this.newMethod=Wa,this.newMethod("Market-Attention"),delete this.newMethod,this.Index=new Array(new Ua("市场关注度",null)),this.Data,this.TitleColor=Ma.FrameSplitTextColor,this.ApiUrl=Ma.Index.MarketAttentionApiUrl,this.CreateChart=function(t){return new $t},this.GetOutData=function(){return{Data:this.Data}},this.SetFrame=function(t,e,a){var i=this.IsOverlay();i?this.OverlayIndex.Frame.Frame.YSpecificMaxMin={Max:6,Min:0,Count:3}:t.Frame.SubFrame[e].Frame.YSpecificMaxMin={Max:6,Min:0,Count:3}},this.RequestData=function(t,e,a){var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a};return this.Data=[],r.HQChart.Period>0?(this.NotSupport(r.HQChart,r.WindowIndex,"不支持周期切换"),r.HQChart.Draw(),this.SendEvent(t,e,a,"不支持周期切换"),!1):(x.HttpRequest({url:this.ApiUrl,data:{symbol:r.HQChart.Symbol,startdate:20100101},type:"post",dataType:"json",async:!0,success:function(n){i.RecvData(n,r),i.SendEvent(t,e,a)}}),!0)},this.RecvData=function(t,e){if(!(t.date.length<0)){var a=new Array;for(var i in t.date){var r=new ft;r.Date=t.date[i],r.Value=t.value[i],a.push(r)}var n=e.HistoryData.GetFittingData(a),s=new It;s.Data=n,s.Period=e.HQChart.Period,s.Right=e.HQChart.Right,this.Data=s.GetValue(),this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),this.SetFrame(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()}},this.BindData=function(t,e,a){var i=this.CreatePaints(t,e),r=this.IsOverlay();if(i.length!=this.Index.length)return!1;i[0].Data.Data=this.Data,i[0].NotSupportMessage=null;var n=e+1;if(r){var s=t.TitlePaint[n],o={Data:[],Title:""};for(var h in s.OverlayIndex.set(this.OverlayIndex.Identify,o),i){var l=new je(i[h].Data,this.Index[h].Name,this.Index[h].LineColor);l.StringFormat=Qe.THOUSANDS,l.FloatPrecision=0,s.OverlayIndex.get(this.OverlayIndex.Identify).Data[h]=l}}else for(var h in i)t.TitlePaint[n].Data[h]=new je(i[h].Data,this.Index[h].Name,this.TitleColor),t.TitlePaint[n].Data[h].StringFormat=Qe.THOUSANDS,t.TitlePaint[n].Data[h].FloatPrecision=0;return!0}}function qa(){this.newMethod=Wa,this.newMethod("Market-Heat"),delete this.newMethod,this.Index=new Array(new Ua("热度",5),new Ua("MA",10),new Ua("MA",null)),this.Data,this.ApiUrl=Ma.Index.MarketHeatApiUrl,this.Index[0].LineColor=Ma.FrameSplitTextColor,this.Index[1].LineColor=Ma.Index.LineColor[0],this.Index[2].LineColor=Ma.Index.LineColor[1],this.CreateChart=function(t){return 0==t?new $t:new Bt},this.RequestData=function(t,e,a){var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a};return this.Data=[],r.HQChart.Period>0?(this.NotSupport(r.HQChart,r.WindowIndex,"不支持周期切换"),r.HQChart.Draw(),!1):(x.HttpRequest({url:this.ApiUrl,data:{symbol:r.HQChart.Symbol,startdate:20100101},type:"post",dataType:"json",async:!0,success:function(t){i.RecvData(t,r)}}),!0)},this.RecvData=function(t,e){if(!(t.date.length<0)){var a=new Array;for(var i in t.date){var r=new ft;r.Date=t.date[i],r.Value=t.value[i],a.push(r)}var n=e.HistoryData.GetFittingData(a),s=new It;s.Data=n,s.Period=e.HQChart.Period,s.Right=e.HQChart.Right,this.Data=s.GetValue(),this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()}},this.BindData=function(t,e,a){var i=this.CreatePaints(t,e),r=this.IsOverlay();if(i.length!=this.Index.length)return!1;i[0].Data.Data=this.Data,i[0].NotSupportMessage=null;var n=Ra.MA(this.Data,this.Index[0].Param);i[1].Data.Data=n;var s=Ra.MA(this.Data,this.Index[1].Param);i[2].Data.Data=s;var o=e+1;if(r){var h=t.TitlePaint[o],l={Data:[],Title:""};for(var u in h.OverlayIndex.set(this.OverlayIndex.Identify,l),i){var C="";C=0==u?t.Name+this.Index[u].Name:"MA"+this.Index[u-1].Param;var D=new je(i[u].Data,C,this.Index[u].LineColor);D.StringFormat=Qe.DEFAULT,D.FloatPrecision=2,h.OverlayIndex.get(this.OverlayIndex.Identify).Data[u]=D}}else for(var u in i){C="";C=0==u?t.Name+this.Index[u].Name:"MA"+this.Index[u-1].Param,t.TitlePaint[o].Data[u]=new je(i[u].Data,C,this.Index[u].LineColor),t.TitlePaint[o].Data[u].StringFormat=Qe.DEFAULT,t.TitlePaint[o].Data[u].FloatPrecision=2}return!0}}function Za(){this.newMethod=Wa,this.newMethod("Market-Heat"),delete this.newMethod,this.Index=new Array(new Ua("区域",3),new Ua("热度指数",10),new Ua("MA",5),new Ua("MA",10)),this.Data,this.ApiUrl=Ma.Index.CustomIndexHeatApiUrl,this.Index[1].LineColor=Ma.Index.LineColor[1],this.Index[2].LineColor=Ma.Index.LineColor[2],this.Index[3].LineColor=Ma.Index.LineColor[3],this.Create=function(t,e){for(var a in this.Index){var i=null;0==a?i=new qt:(i=new Bt,i.Color=this.Index[a].LineColor),i.Canvas=t.Canvas,i.Name=this.Name+"-"+a.toString(),i.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,i.ChartFrame=t.Frame.SubFrame[e].Frame,t.ChartPaint.push(i)}},this.RequestData=function(t,e,a){var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a};return this.Data=[],r.HQChart.Period>0?(this.NotSupport(r.HQChart,r.WindowIndex,"不支持周期切换"),r.HQChart.Draw(),!1):(x.HttpRequest({url:this.ApiUrl,data:{stock:r.HQChart.CustomStock,date:{startdate:r.HQChart.QueryDate.Start,enddate:r.HQChart.QueryDate.End},day:[this.Index[0].Param,this.Index[1].Param]},type:"post",dataType:"json",async:!0,success:function(t){i.RecvData(t,r)}}),!0)},this.RecvData=function(t,e){if(!(null==t.data||t.data.length<0)){var a=new Array;for(var i in t.data){var r=t.data[i],n=new ft;n.Date=r[0],n.Value=r[1],a.push(n)}var s=e.HistoryData.GetFittingData(a),o=new It;o.Data=s,o.Period=e.HQChart.Period,o.Right=e.HQChart.Right,this.Data=o.GetValue(),this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()}},this.BindData=function(t,e,a){var i=t.GetChartPaint(e);if(i.length!=this.Index.length)return!1;i[0].NotSupportMessage=null,i[0].Data.Data=[{Value:0,Value2:.2,Color:"rgb(50,205,50)",Title:"热度1",TitleColor:"rgb(245,255 ,250)"},{Value:.2,Value2:.4,Color:"rgb(255,140,0)",Title:"热度2",TitleColor:"rgb(245,255 ,250)"},{Value:.4,Value2:.8,Color:"rgb(255,106,106)",Title:"热度3",TitleColor:"rgb(245,255 ,250)"},{Value:.8,Value2:1,Color:"rgb(208, 32 ,144)",Title:"热度4",TitleColor:"rgb(245,255 ,250)"}],i[1].Data.Data=this.Data;var r=Ra.MA(this.Data,this.Index[2].Param);i[2].Data.Data=r;var n=Ra.MA(this.Data,this.Index[3].Param);i[3].Data.Data=n,t.Frame.SubFrame[e].Frame.YSpecificMaxMin={Max:1,Min:0,Count:3};for(var s=e+1,o=1;o<i.length;++o){var h=this.Index[o].Name;"MA"==h&&(h="MA"+this.Index[o].Param),t.TitlePaint[s].Data[o]=new je(i[o].Data,h,this.Index[o].LineColor),t.TitlePaint[s].Data[o].StringFormat=Qe.DEFAULT,t.TitlePaint[s].Data[o].FloatPrecision=2}return t.TitlePaint[s].Title="热度("+this.Index[0].Param+","+this.Index[1].Param+","+this.Index[2].Param+","+this.Index[3].Param+")",!0}}function Qa(){this.newMethod=Wa,this.newMethod("财务粉饰"),delete this.newMethod,this.Index=new Array(new Ua("区域",null),new Ua("系数",null)),this.Data,this.ApiUrl=Ma.Index.StockHistoryDayApiUrl,this.Index[0].LineColor=Ma.Index.LineColor[0],this.Index[1].LineColor="rgb(105,105,105)",this.CreateChart=function(t){return 0==t?new qt:new Wt},this.GetOutData=function(){return{Data:this.Data}},this.RequestData=function(t,e,a){var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a};if(this.Data=[],2!=r.HQChart.Period)return this.NotSupport(r.HQChart,r.WindowIndex,"只支持月线"),r.HQChart.Draw(),this.SendEvent(t,e,a,"只支持月线"),!1;var n=["finance.benford","announcement2.quarter","announcement1.quarter","announcement3.quarter","announcement4.quarter"],s=[{item:["date","int32","gte","20130101"]},{item:["announcement1.year","int32","gte",0,"announcement2.year","int32","gte",0,"announcement3.year","int32","gte",0,"announcement4.year","int32","gte",0,"or"]}];return x.HttpRequest({url:this.ApiUrl,data:{symbol:[r.HQChart.Symbol],field:n,condition:s},type:"post",dataType:"json",async:!0,success:function(n){i.RecvData(n,r),i.SendEvent(t,e,a)}}),!0},this.JsonDataToMapSingleData=function(t){var e=t.stock[0].stockday,a=new g.default;for(var i in e){var r=e[i],n=new ft;if(n.Date=r.date,n.Value=new Array,null!=r.finance1&&null!=r.announcement1){var s=r.announcement1.year,o=r.announcement1.quarter,h=r.finance1.benford;n.Value.push({Year:s,Quarter:o,Value:h})}if(null!=r.finance2&&null!=r.announcement2){var l=r.announcement2.year,u=r.announcement2.quarter,C=r.finance2.benford;n.Value.push({Year:l,Quarter:u,Value:C})}if(null!=r.finance3&&null!=r.announcement3){var D=r.announcement3.year,c=r.announcement3.quarter,f=r.finance3.benford;n.Value.push({Year:D,Quarter:c,Value:f})}if(null!=r.finance4&&null!=r.announcement4){var d=r.announcement4.year,m=r.announcement4.quarter,v=r.finance4.benford;n.Value.push({Year:d,Quarter:m,Value:v})}a.set(n.Date,n)}var S=new Array,I=!0,p=!1,A=void 0;try{for(var F,E=(0,T.default)(a);!(I=(F=E.next()).done);I=!0){r=F.value;S.push(r[1])}}catch(L){p=!0,A=L}finally{try{!I&&E.return&&E.return()}finally{if(p)throw A}}return S},this.RecvData=function(t,e){if(M.Chart.Log(t),!(null==t.stock||t.stock.length<=0)){var a=this.JsonDataToMapSingleData(t),i=e.HistoryData.GetFittingMonthData(a),r=new It;r.Data=i,r.Period=e.HQChart.Period,r.Right=e.HQChart.Right,this.Data=r.GetValue(),this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()}},this.BindData=function(t,e,a){var i=this.CreatePaints(t,e);if(i.length!=this.Index.length)return!1;i[0].NotSupportMessage=null,i[0].Data.Data=[{Value:0,Value2:.2,Color:"rgb(50,205,50)",Title:"安全区",TitleColor:"rgb(245,255 ,250)"},{Value:.2,Value2:.4,Color:"rgb(255,140,0)",Title:"预警区",TitleColor:"rgb(245,255 ,250)"},{Value:.4,Value2:1,Color:"rgb(255,106,106)",Title:"警示区",TitleColor:"rgb(245,255 ,250)"}],i[1].Data.Data=this.Data,t.Frame.SubFrame[e].Frame.YSpecificMaxMin={Max:1,Min:0,Count:3};var r=e+1;return t.TitlePaint[r].Data[1]=new je(i[1].Data,this.Index[1].Name,this.Index[1].LineColor),t.TitlePaint[r].Data[1].DataType="MultiReport",t.TitlePaint[r].Title=this.FormatIndexTitle(),!0}}function ja(){this.newMethod=Wa,this.newMethod("Lighter-Trend"),delete this.newMethod,this.Index=new Array(new Ua("STICKLINE",null),new Ua("STICKLINE",null)),this.Index[0].LineColor="rgb(255,0,0)",this.Index[1].LineColor="rgb(0,0,255)",this.Create=function(t,e){for(var a in this.Index){var i=new Xt;i.Canvas=t.Canvas,i.Name=this.Name,i.Name=this.Name+"-"+a.toString(),i.Color=this.Index[a].LineColor,i.LineWidth=2,i.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,i.ChartFrame=t.Frame.SubFrame[e].Frame,t.ChartPaint.push(i)}},this.BindData=function(t,e,a){var i=t.GetChartPaint(e);if(2!=i.length)return!1;var r=a.GetClose(),n=Ra.SMA(r,6.5,1),s=Ra.SMA(r,13.5,1),o=Ra.STICKLINE(Ra.ARRAY_GT(n,s),n,s),h=Ra.STICKLINE(Ra.ARRAY_GT(s,n),n,s);i[0].Data.Data=o,i[1].Data.Data=h;var l=e+1;return t.TitlePaint[l].Title="大盘/个股 趋势函数",!0}}function $a(){this.newMethod=Wa,this.newMethod("位置研判函数"),delete this.newMethod,this.Index=new Array(new Ua("STICKLINE",34),new Ua("STICKLINE",3),new Ua("STICKLINE",null),new Ua("STICKLINE",null),new Ua("STICKLINE",null),new Ua("STICKLINE",null),new Ua("LINE",null),new Ua("TEXT",null)),this.Index[0].LineColor="rgb(0,0,138)",this.Index[1].LineColor="rgb(133,0,138)",this.Index[2].LineColor="rgb(101,118,0)",this.Index[3].LineColor="rgb(105,0,121)",this.Index[4].LineColor="rgb(121,183,21)",this.Index[5].LineColor="rgb(0,0,138)",this.Index[6].LineColor="rgb(255,0,0)",this.Create=function(t,e){for(var a in this.Index){var i=null;"LINE"==this.Index[a].Name?(i=new Bt,i.Color=this.Index[a].LineColor):"TEXT"==this.Index[a].Name?i=new Kt:(i=new Xt,i.Color=this.Index[a].LineColor,i.LineWidth=5),i.Canvas=t.Canvas,i.Name=this.Name,i.Name=this.Name+"-"+a.toString(),i.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,i.ChartFrame=t.Frame.SubFrame[e].Frame,t.ChartPaint.push(i)}},this.BindData=function(t,e,a){var i=t.GetChartPaint(e);if(i.length!=this.Index.length)return!1;var r=a.GetClose(),n=a.GetHigh(),s=a.GetLow();i[0].Data.Data=Ra.STICKLINE(Ra.ARRAY_GT(r,0),0,2),i[1].Data.Data=Ra.STICKLINE(Ra.ARRAY_GT(r,0),2,5),i[2].Data.Data=Ra.STICKLINE(Ra.ARRAY_GT(r,0),5,10),i[3].Data.Data=Ra.STICKLINE(Ra.ARRAY_GT(r,0),10,21.5),i[4].Data.Data=Ra.STICKLINE(Ra.ARRAY_GT(r,0),21.5,23,5),i[5].Data.Data=Ra.STICKLINE(Ra.ARRAY_GT(r,0),23,28,5);var o=Ra.ARRAY_DIVIDE(Ra.EMA(Ra.ARRAY_MULTIPLY(Ra.ARRAY_DIVIDE(Ra.ARRAY_SUBTRACT(r,Ra.LLV(s,this.Index[0].Param)),Ra.ARRAY_SUBTRACT(Ra.HHV(n,this.Index[0].Param),Ra.LLV(s,this.Index[0].Param))),100),this.Index[1].Param),4);i[6].Data.Data=o;var h=new Array;h[0]={Value:1,Message:"底部区域",Color:"rgb(0,255,255)",Position:"Left"},h[1]={Value:3.5,Message:"介入区域",Color:"rgb(0,255,255)",Position:"Left"},h[2]={Value:7.5,Message:"稳健区域",Color:"rgb(0,255,255)",Position:"Left"},h[3]={Value:16,Message:"高位区域",Color:"rgb(0,255,255)",Position:"Left"},h[4]={Value:22,Message:"风险区域",Color:"rgb(0,0,255)",Position:"Left"},h[5]={Value:25.5,Message:"顶部区域",Color:"rgb(255,0,255)",Position:"Left"},i[7].Data.Data=h;var l=e+1;return t.TitlePaint[l].Data[0]=new je(i[6].Data,"财貌双拳",i[6].Color),t.TitlePaint[l].Title=this.FormatIndexTitle(),!0}}function ti(t,e,a,i){this.newMethod=Wa,this.newMethod(t),delete this.newMethod,this.Script=e,this.Arguments=[],this.OutVar=[],this.ApiUrl=Ma.PyIndexDomain+"/hq/code",a&&(this.Arguments=a),this.RequestData=function(t,e,a){this.OutVar=[];var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a},n="";for(var s in this.Arguments){n.length>0&&(n+=",");var o=this.Arguments[s];n+='"'+o.Name+'":'+o.Value}n="{"+n+"}";var h=JSON.parse(n),l=(0,v.default)({code:this.Script,symbol:r.HQChart.Symbol,period:r.HQChart.Period,right:r.HQChart.Right,params:h,numcount:t.MaxReqeustDataCount});return x.HttpRequest({url:this.ApiUrl,data:l,type:"post",dataType:"json",contentType:" application/json; charset=utf-8",async:!0,success:function(t){i.RecvData(t,r)},complete:function(t){},error:function(t,e){i.RecvError(t,e,r)}}),!0},this.RecvError=function(t,e,a){M.Chart.Log("[PyScriptIndex::RecvError] error",e),a.HQChart.ScriptErrorCallback&&a.HQChart.ScriptErrorCallback(e)},this.RecvData=function(t,e){if(0!=t.code)return M.Chart.Log("[PyScriptIndex::RecvData] failed.",t),void(e.HQChart.ScriptErrorCallback&&e.HQChart.ScriptErrorCallback(t.msg));M.Chart.Log("[PyScriptIndex::RecvData] recv data.",t);var a=t.date;for(var i in t.data){for(var r=t.data[i],n=[],s=0;s<a.length&&s<a.length;++s)if(!(s>=r.data.length)){var o=new ft;o.Date=a[s],o.Value=r.data[s],n.push(o)}var h=e.HistoryData.GetFittingData(n),l=new It;l.Data=h,l.Period=e.HQChart.Period,l.Right=e.HQChart.Right;var u={Name:r.name,Type:r.graph,LineWidth:r.width,Data:l.GetValue(),Color:r.color};this.OutVar.push(u)}this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()},this.BindData=function(t,e,a){for(var i in t.DeleteIndexPaint(e),this.OutVar){var r=this.OutVar[i];switch(r.Type){case"line":this.CreateLine(t,e,r,i);break;case"colorstick":this.CreateColorStock(t,e,r,i);break}}var n=e+1;t.TitlePaint[n].Title=this.Name;var s="";for(var o in this.Arguments){var h=this.Arguments[o];s.length>0&&(s+=","),s+=h.Value.toString()}return s.length>0&&(t.TitlePaint[n].Title=this.Name+"("+s+")"),!0},this.CreateLine=function(t,e,a,i){var r=new Bt;r.Canvas=t.Canvas,r.DrawType=1,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=a.Color:r.Color=this.GetDefaultColor(i),a.LineWidth>0&&(r.LineWidth=a.LineWidth),0==a.IsShow&&(r.IsShow=!1);var n=e+1;r.Data.Data=a.Data,t.TitlePaint[n].Data[i]=new je(r.Data,a.Name,r.Color),t.ChartPaint.push(r)},this.CreateColorStock=function(t,e,a,i){var r=new $t;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame;var n=e+1;r.Data.Data=a.Data,t.TitlePaint[n].Data[i]=new je(r.Data,a.Name,this.GetDefaultColor(i)),t.ChartPaint.push(r)},this.GetDefaultColor=function(t){var e=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],a=parseInt(t);return e[a%(e.length-1)]}}function ei(t,e,a,i){this.newMethod=ti,this.newMethod(t),delete this.newMethod,this.JsonData,i.JsonData&&(this.JsonData=i.JsonData),this.RequestData=function(t,e,a){if(this.JsonData){var i={HQChart:t,WindowIndex:e,HistoryData:a};this.JsonData.code=0;var r=this.JsonData;this.RecvData(r,i)}else console.warn("[PyScriptIndex::RequestData] JsonData is null"),i.HQChart.ScriptErrorCallback&&i.HQChart.ScriptErrorCallback("json 数据不能为空")}}function ai(){this.newMethod=Wa,this.newMethod("点位研判函数"),delete this.newMethod,this.Index=new Array(new Ua("启动买点",null)),this.Index[0].LineColor="rgb(255,0,0)",this.BindData=function(t,e,a){var i=t.GetChartPaint(e);if(i.length!=this.Index.length)return!1;var r=a.GetClose(),n=(a.GetHigh(),a.GetLow()),s=Ra.REF(n,1),o=Ra.ARRAY_MULTIPLY(Ra.ARRAY_DIVIDE(Ra.SMA(Ra.ABS(Ra.ARRAY_SUBTRACT(n,s)),13,1),Ra.SMA(Ra.MAX(Ra.ARRAY_SUBTRACT(n,s),0),13,1)),100),h=Ra.EMA(Ra.ARRAY_IF(Ra.ARRAY_MULTIPLY(r,1.2),Ra.ARRAY_MULTIPLY(o,13),Ra.ARRAY_DIVIDE(o,13)),13),l=Ra.LLV(n,34),u=Ra.HHV(h,34),C=Ra.ARRAY_IF(Ra.LLV(n,56),1,0),D=Ra.ARRAY_DIVIDE(Ra.ARRAY_ADD(h,Ra.ARRAY_MULTIPLY(u,2)),2),c=Ra.ARRAY_MULTIPLY(Ra.ARRAY_DIVIDE(Ra.EMA(Ra.ARRAY_IF(Ra.ARRAY_LTE(n,l),D,0),3),618),C),f=Ra.ARRAY_GT(c,Ra.REF(c,1)),d=Ra.REF(Ra.LLV(n,100),3),m=Ra.REFDATE(d,-1),v=Ra.ARRAY_EQ(n,m),S=Ra.ARRAY_AND(f,v);i[0].Data.Data=S;var I=e+1;for(var p in i)t.TitlePaint[I].Data[p]=new je(i[p].Data,this.Index[p].Name,this.Index[p].LineColor);return t.TitlePaint[I].Title=this.FormatIndexTitle(),!0}}function ii(){}function ri(){this.MaxReqeustDataCount=1e3,this.StartDate=20160101,this.Data,this.ClassName="IKLineInfo",this.Explain="IKLineInfo",this.GetToday=function(){var t=new Date,e=1e4*t.getFullYear()+100*(t.getMonth()+1)+t.getDate();return e},this.GetRequestData=function(t){var e={Symbol:t.Symbol,MaxReqeustDataCount:t.MaxReqeustDataCount,MaxRequestMinuteDayCount:t.MaxRequestMinuteDayCount};return e},this.NetworkFilter=function(t){if(!t.NetworkFilter)return!1;var e=this,a={HQChart:t},i={Name:this.ClassName+"::RequestData",Explain:this.Explain,Request:this.GetRequestData(t),Self:this,HQChart:t,PreventDefault:!1};return t.NetworkFilter(i,(function(t){e.RecvData(t,a)})),1==i.PreventDefault}}function ni(){this.newMethod=ri,this.newMethod(),delete this.newMethod,this.ClassName="InvestorInfo",this.Explain="互动易",this.RequestData=function(t){var e=this,a={HQChart:t};if(this.Data=[],!this.NetworkFilter(t)){var i={filed:["question","answerdate","symbol","id"],symbol:[a.HQChart.Symbol],querydate:{StartDate:this.StartDate,EndDate:this.GetToday()},start:0,end:this.MaxReqeustDataCount};return x.HttpRequest({url:Ma.KLine.Info.Investor.ApiUrl,data:i,type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)}}),!0}},this.RecvData=function(t,e){if(!(t.list.length<=0)){for(var a in t.list){var i=t.list[a],r=new mt;r.Date=i.answerdate,r.Title=i.question,r.InfoType=dt.INVESTOR,this.Data.push(r)}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}}}function si(){this.newMethod=ri,this.newMethod(),delete this.newMethod,this.ClassName="AnnouncementInfo",this.Explain="公告",this.ApiType=1,this.RequestData=function(t){var e=this,a={HQChart:t};if(this.Data=[],!this.NetworkFilter(t))if(1==this.ApiType){var i=Ma.CacheDomain+"/cache/analyze/shszreportlist/"+a.HQChart.Symbol+".json";x.HttpRequest({url:i,type:"get",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)},error:function(t,i){e.RecvError(t,i,a)}})}else x.HttpRequest({url:Ma.KLine.Info.Announcement.ApiUrl,data:{filed:["title","releasedate","symbol","id"],symbol:[a.HQChart.Symbol],querydate:{StartDate:this.StartDate,EndDate:this.GetToday()},start:0,end:this.MaxReqeustDataCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)},error:function(t,i){e.RecvError(t,i,a)}})},this.RecvData=function(t,e){if(!(t.report.length<=0)){for(var a in t.report){var i=t.report[a],r=new mt;for(var n in r.Date=i.releasedate,r.Title=i.title,r.InfoType=dt.ANNOUNCEMENT,i.type){var s=i.type[n];switch(s){case"一季度报告":r.InfoType=dt.ANNOUNCEMENT_QUARTER_1;break;case"半年度报告":r.InfoType=dt.ANNOUNCEMENT_QUARTER_2;break;case"三季度报告":r.InfoType=dt.ANNOUNCEMENT_QUARTER_3;break;case"年度报告":r.InfoType=dt.ANNOUNCEMENT_QUARTER_4;break}}for(var n in i.typeex){var o=i.typeex[n];r.InfoType=dt.ANNOUNCEMENT_EX_START+o;break}this.Data.push(r)}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}},this.RecvError=function(t,e,a){console.warn("[AnnouncementInfo::RecvError] error, http ",e,t)}}function oi(){this.newMethod=ri,this.newMethod(),delete this.newMethod,this.ClassName="PforecastInfo",this.RequestData=function(t){var e=this,a={HQChart:t};return this.Data=[],x.HttpRequest({url:Ma.KLine.Info.Pforecast.ApiUrl,data:{field:["pforecast.type","pforecast.reportdate","fweek"],condition:[{item:["pforecast.reportdate","int32","gte",this.StartDate]}],symbol:[a.HQChart.Symbol],start:0,end:this.MaxReqeustDataCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)}}),!0},this.RecvData=function(t,e){if(1==t.stock.length&&!(t.stock[0].stockday.length<=0)){for(var a in t.stock[0].stockday){var i=t.stock[0].stockday[a];if(i.pforecast.length>0){var r=i.pforecast[0],n=new mt;n.Date=i.date,n.Title=r.type,n.InfoType=dt.PFORECAST,n.ExtendData={Type:r.type,ReportDate:r.reportdate},i.fweek&&(n.ExtendData.FWeek={},null!=i.fweek.week1&&(n.ExtendData.FWeek.Week1=i.fweek.week1),null!=i.fweek.week4&&(n.ExtendData.FWeek.Week4=i.fweek.week4)),this.Data.push(n)}}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}}}function hi(){this.newMethod=ri,this.newMethod(),delete this.newMethod,this.ClassName="ResearchInfo",this.RequestData=function(t){var e=this,a={HQChart:t};return this.Data=[],x.HttpRequest({url:Ma.KLine.Info.Research.ApiUrl,data:{filed:["releasedate","researchdate","level","symbol","id","type"],querydate:{StartDate:this.StartDate,EndDate:this.GetToday()},symbol:[a.HQChart.Symbol],start:0,end:this.MaxReqeustDataCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)}}),!0},this.RecvData=function(t,e){if(!(t.list.length<=0)){for(var a in t.list){var i=t.list[a],r=new mt;r.ID=i.id,r.Date=i.researchdate,r.InfoType=dt.RESEARCH,r.ExtendData={Level:i.level,Type:i.type},this.Data.push(r)}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}}}function li(){this.newMethod=ri,this.newMethod(),delete this.newMethod,this.ClassName="BlockTrading",this.RequestData=function(t){var e=this,a={HQChart:t};return this.Data=[],x.HttpRequest({url:Ma.KLine.Info.BlockTrading.ApiUrl,data:{field:["blocktrading.price","blocktrading.vol","blocktrading.premium","fweek","price"],condition:[{item:["date","int32","gte",this.StartDate]},{item:["blocktrading.vol","int32","gte","0"]}],symbol:[a.HQChart.Symbol],start:0,end:this.MaxReqeustDataCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)}}),!0},this.RecvData=function(t,e){if(1==t.stock.length&&!(t.stock[0].stockday.length<=0)){for(var a in t.stock[0].stockday){var i=t.stock[0].stockday[a],r=new mt;r.Date=i.date,r.InfoType=dt.BLOCKTRADING,r.ExtendData={Price:i.blocktrading.price,Premium:i.blocktrading.premium,Vol:i.blocktrading.vol,ClosePrice:i.price},i.fweek&&(r.ExtendData.FWeek={},null!=i.fweek.week1&&(r.ExtendData.FWeek.Week1=i.fweek.week1),null!=i.fweek.week4&&(r.ExtendData.FWeek.Week4=i.fweek.week4)),this.Data.push(r)}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}}}function ui(){this.newMethod=ri,this.newMethod(),delete this.newMethod,this.ClassName="TradeDetail",this.RequestData=function(t){var e=this,a={HQChart:t};return this.Data=[],x.HttpRequest({url:Ma.KLine.Info.TradeDetail.ApiUrl,data:{field:["tradedetail.typeexplain","tradedetail.type","fweek"],condition:[{item:["date","int32","gte",this.StartDate]},{item:["tradedetail.type","int32","gte","0"]}],symbol:[a.HQChart.Symbol],start:0,end:this.MaxReqeustDataCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)}}),!0},this.RecvData=function(t,e){if(1==t.stock.length&&!(t.stock[0].stockday.length<=0)){for(var a in t.stock[0].stockday){var i=t.stock[0].stockday[a],r=new mt;for(var n in r.Date=i.date,r.InfoType=dt.TRADEDETAIL,r.ExtendData={Detail:new Array},i.tradedetail){var s=i.tradedetail[n];r.ExtendData.Detail.push({Type:s.type,TypeExplain:s.typeexplain})}i.fweek&&(r.ExtendData.FWeek={},null!=i.fweek.week1&&(r.ExtendData.FWeek.Week1=i.fweek.week1),null!=i.fweek.week4&&(r.ExtendData.FWeek.Week4=i.fweek.week4)),this.Data.push(r)}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}}}function Ci(){}function Di(){this.Data,this.ClassName="IMinuteInfo"}function ci(){this.newMethod=Di,this.newMethod(),delete this.newMethod,this.ClassName="MarketEventInfo",this.RequestData=function(t){var e=this;this.Data=[];var a={HQChart:t},i=Ma.CacheDomain+"/cache/analyze/shszevent/marketevent/concept/"+t.TradeDate+".json";if(t.NetworkFilter){var r={Name:"MarketEventInfo::RequestData",Explain:"大盘异动",Request:{Url:i,Type:"Get",Data:{Date:t.TradeDate,Symbol:t.Symbol}},Self:this,PreventDefault:!1};if(t.NetworkFilter(r,(function(t){e.RecvData(t,a),a.HQChart.UpdataChartInfo(),a.HQChart.Draw()})),1==r.PreventDefault)return}return x.HttpRequest({url:i,type:"get",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)},error:function(t,e){console.warn("[MarketEventInfo::RequestData] error, http ",e,t)}}),!0},this.RecvData=function(t,e){for(var a in t.event){var i=t.event[a];for(var r in i.data){var n=i.data[r];if(Array.isArray(n)){if(n.length<2)continue;var s={Date:i.date,Time:n[0],Title:n[1],Type:0};n.length>=3&&n[2]&&"string"==typeof n[2]&&(s.Color=n[2]),n.length>=4&&n[3]&&"string"==typeof n[3]&&(s.BGColor=n[3]),this.Data.push(s)}else{if(!Le.IsNumber(n.Date)||!Le.IsNumber(n.Time)||!n.Title)continue;s={Date:n.Date,Time:n.Time,Title:n.Title,Type:0};n.Color&&(s.Color=n.Color),n.BGColor&&(s.BGColor=n.BGColor),Le.IsNumber(n.Price)&&(s.Price=n.Price),n.Content&&(s.Content=n.Content),n.Link&&(s.Link=n.Link),this.Data.push(s)}}}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}}function fi(t){this.DivElement=t,this.ID=null,this.TimeOut=null,this.Hide=function(){(0,E.default)("#"+this.ID).hide()},this.Show=function(t,e,a,i){var r={display:"block"};Le.IsNumber(t)&&(r.left=t+"px"),Le.IsNumber(e)&&(r.top=e+"px"),Le.IsNumber(a)&&(r.width=a+"px"),Le.IsNumber(i)&&(r.height=i+"px"),(0,E.default)("#"+this.ID).css(r)}}function di(t){this.newMethod=fi,this.newMethod(t),delete this.newMethod,this.Title={ID:Y()},this.ParamList={ID:Y()},this.ParamData=[],this.Identify,this.HQChart,this.Create=function(){this.ID=Y();var t=document.createElement("div");t.className="jchart-modifyindex-box",t.id=this.ID,t.innerHTML="<div class='parameter'>            <div class='parameter-header'>                <span></span>                <strong id='close' class='icon iconfont icon-close'></strong>            </div>            <div class='parameter-content'><input/>MA</div>            <div class='parameter-footer'>                <button class='submit' >确定</button>                <button class='cancel' >取消</button>            </div>        </div>",this.DivElement.appendChild(t),(0,E.default)("#"+this.ID+" .submit").click({divBox:this},(function(t){t.data.divBox.Hide()}));var e=t.getElementsByTagName("span")[0];e.id=this.Title.ID;var a=t.getElementsByClassName("parameter-content")[0];a.id=this.ParamList.ID},this.SetTitle=function(t){(0,E.default)("#"+this.Title.ID).html(t)},this.ClearParamList=function(){(0,E.default)("#"+this.ParamList.ID).empty(),this.ParamData=[]},this.BindParam=function(t,e){var a=t.WindowIndex[e];for(var i in a.Arguments){var r=a.Arguments[i];if(null==r.Name||isNaN(r.Value))break;var n=Y(),s='<input class="row-line" id="'+n+'" value="'+r.Value+'" type="number" step="1"/>'+r.Name+"<br>";(0,E.default)("#"+this.ParamList.ID).append(s),this.ParamData.push({ID:n,Value:r.Value})}var o=this;for(var i in this.ParamData){r=this.ParamData[i];(0,E.default)("#"+r.ID).mouseup({Chart:t,Identify:e,ParamIndex:i},(function(t){var e=parseInt((0,E.default)(this).val()),a=o.HQChart,i=o.Identify,r=t.data.ParamIndex;a.WindowIndex[i].Arguments[r].Value=e,a.UpdateWindowIndex(i)})),(0,E.default)("#"+r.ID).keyup({Chart:t,Identify:e,ParamIndex:i},(function(t){var e=parseInt((0,E.default)(this).val()),a=o.HQChart,i=o.Identify,r=t.data.ParamIndex;a.WindowIndex[i].Arguments[r].Value=e,a.UpdateWindowIndex(i)}))}},this.BindCancel=function(){var t=this;(0,E.default)("#"+this.ID+" .cancel").click((function(){var e=t.HQChart,a=t.Identify;t.RestoreParam(e.WindowIndex[a]),e.UpdateWindowIndex(a),t.Hide()})),(0,E.default)("#"+this.ID+" #close").click((function(){var e=t.HQChart,a=t.Identify;t.RestoreParam(e.WindowIndex[a]),e.UpdateWindowIndex(a),t.Hide()}))},this.RestoreParam=function(t){for(var e in this.ParamData){var a=this.ParamData[e];t.Arguments[e].Value=a.Value}},this.DoModal=function(t){var e=t.data.Chart,a=t.data.Identify,i=e.ModifyIndexDialog;i&&(null==i.ID&&i.Create(),i.Identify=a,i.HQChart=e,i.SetTitle(e.WindowIndex[a].Name+" 指标参数设置"),i.ClearParamList(),i.BindParam(e,a),i.BindCancel(),i.Show())}}function mi(t){this.newMethod=fi,this.newMethod(t),delete this.newMethod,this.DivElement=t,this.IndexTreeApiUrl="https://opensourcecache.zealink.com/cache/hqh5/index/commonindextree.json",this.OverlayIndexTreeApiUrl="https://opensourcecache.zealink.com/cache/hqh5/index/commonindextree.json",this.IsOverlayIndex=!1,this.Create=function(){var t=document.createElement("div");t.className="jchart-changeindex-box",t.id=this.ID=Y(),t.innerHTML='<div class="target-panel">\n            <div class="target-header">\n                <span>换指标</span>\n                <strong class="close-tar icon iconfont icon-close"></strong>\n            </div>\n            <div class="target-content">\n                <div class="target-left">\n                    <input type="text">\n                    <ul></ul>\n                </div>\n                <div class="target-right">\n                    <ul></ul>\n                </div>\n            </div>\n        </div>',this.DivElement.appendChild(t)},this.ReqeustData=function(){if((0,E.default)("#"+this.ID+" .target-left ul li").length>0)return!1;var t=this.IndexTreeApiUrl;function e(t){(0,E.default)(".target-left ul").html(""),E.default.each(t,(function(t,e){var a;a="<li>"+e.node+"</li>",(0,E.default)(".target-left ul").append(a)})),(0,E.default)(".target-left ul li:first-child").addClass("active-list")}function a(t){var e,a=[];E.default.each(t,(function(t,e){a.push(e.list)})),E.default.each(a[0],(function(t,a){e="<li id="+a.id+">"+a.name+"</li>",(0,E.default)(".target-right ul").append(e)})),(0,E.default)(".target-left ul").delegate("li","click",(function(){(0,E.default)(this).addClass("active-list").siblings().removeClass("active-list");var t=(0,E.default)(this).index();(0,E.default)(".target-right ul").html(""),E.default.each(a[t],(function(t,a){e="<li id="+a.id+">"+a.name+"</li>",(0,E.default)(".target-right ul").append(e)}))}))}1==this.IsOverlayIndex&&(t=this.OverlayIndexTreeApiUrl),x.HttpRequest({url:t,type:"get",success:function(t){var i=t.list;e(i),a(i)}})},this.BindClose=function(t){(0,E.default)("#"+this.ID+" .close-tar").click({Chart:t},(function(t){var e=t.data.Chart;e.ChangeIndexDialog.Hide()}))},this.BindSearch=function(t){(0,E.default)(".target-left input").on("input",{Chart:t},(function(t){var e=new P,a=e.Search(t.target.value);for(var i in(0,E.default)(".target-right ul").html(""),a){var r=a[i],n="<li id="+r+">"+r+"</li>";(0,E.default)(".target-right ul").append(n)}}))},this.DoModal=function(t){var e=t.data.Chart,a=t.data.Identify,i=e.ChangeIndexDialog,r=t.data.IsOverlay;function n(){(0,E.default)(".target-right ul").undelegate().delegate("li","click",(function(){var t=(0,E.default)(this).attr("id");r?e.AddOverlayIndex({WindowIndex:a,IndexName:t}):e.ChangeIndex(a,t),(0,E.default)(this).addClass("active-list").siblings().removeClass("active-list")}))}i&&(null==i.ID&&i.Create(),i.IsOverlayIndex=r,i.ReqeustData(),n(),i.BindSearch(e),i.BindClose(e),i.Show())}}function vi(t){this.newMethod=fi,this.newMethod(t),delete this.newMethod,this.JSChart=null,this.Height=500,this.Width=600,this.Symbol,this.TradeDate,this.HistoryData,this.Create=function(){this.ID=Y();var t=document.createElement("div");t.className="jchart-kline-minute-box",t.id=this.ID;var e=Y();t.innerHTML="<div><div class='minute-dialog-title'><span></span><strong class='close-munite icon iconfont icon-close'></strong></div><div class='minute-hqchart' id='"+e+"' ></div></div>",t.style.width=this.Height+"px",t.style.height=this.Width+"px",this.DivElement.appendChild(t),this.JSChart=w.Init(document.getElementById(e));var a={Type:"历史分钟走势图",Symbol:this.Symbol,IsAutoUpdate:!1,IsShowRightMenu:!1,HistoryMinute:{TradeDate:this.TradeDate,IsShowName:!1,IsShowDate:!1}};this.JSChart.SetOption(a)},this.BindClose=function(t){(0,E.default)("#"+this.ID+" .close-munite").click({Chart:t},(function(t){var e=t.data.Chart;e.MinuteDialog.Hide()}))},this.DoModal=function(t){this.UpColor=Ma.UpTextColor,this.DownColor=Ma.DownTextColor,this.UnchagneColor=Ma.UnchagneTextColor;var e=t.data.Chart,a=t.data.Tooltip,i=e.MinuteDialog;if(i.Symbol=e.Symbol,i.TradeDate=a.Data.Date,i){null==i.ID?i.Create():(i.JSChart.JSChartContainer.TradeDate=i.TradeDate,i.JSChart.ChangeSymbol(this.Symbol));t.clientX,t.clientY;i.Show(500,100,600,500),i.JSChart.OnSize(),this.BindClose(e),this.GetColor=function(t,e){return t>e?this.UpColor:t<e?this.DownColor:this.UnchagneColor};var r=t.data.Chart.Name,n=t.data.Tooltip.Data,s=(new Date(parseInt(n.Date/1e4),n.Date/100%100-1,n.Date%100),n.Date.toString()),o=s.substring(0,4)+"-"+s.substring(4,6)+"-"+s.substring(6,8),h="<span>"+r+"</span><span>"+o+"</span>&nbsp;<span style='color:"+this.GetColor(n.Open,n.YClose)+";'>开:"+n.Open.toFixed(2)+"</span><span style='color:"+this.GetColor(n.High,n.YClose)+";'>高:"+n.High.toFixed(2)+"</span><span style='color:"+this.GetColor(n.Low,n.YClose)+";'>低:"+n.Low.toFixed(2)+"</span><span style='color:"+this.GetColor(n.Close,n.YClose)+";'>收:"+n.Close.toFixed(2)+"</span><span style='color:"+this.VolColor+";'>量:"+Le.FormatValueString(n.Vol,2)+"</span><span style='color:"+this.AmountColor+";'>额:"+Le.FormatValueString(n.Amount,2)+"</span>";(0,E.default)(".minute-dialog-title span").html(h)}}}function Si(t){this.newMethod=fi,this.newMethod(t),delete this.newMethod,this.SelectData,this.Dialog,this.HQChart,this.Close=function(){this.Dialog&&(this.DivElement.removeChild(this.Dialog),this.Dialog=null),this.HQChart.HideSelectRect()},this.Create=function(){this.ID=Y();var t=document.createElement("div");t.className="jchart-select-statistics-box",t.id=this.ID,t.innerHTML="<div class='parameter jchart-select-section'>            <div class='parameter-header'>                <span>区间统计</span>                <strong id='close' class='icon iconfont icon-close'></strong>            </div>            <div class='parameter-content'>统计数据</div>        <div class='parameter-footer'>            <button id='close' class='submit' >确定</button>            <button id='match' class='submit' >形态匹配</button>        </div>        </div>",this.DivElement.appendChild(t),this.Dialog=t,(0,E.default)("#"+this.ID+" #close").click({divBox:this},(function(t){t.data.divBox.Close()})),(0,E.default)("#"+this.ID+" #match").click({divBox:this},(function(t){t.data.divBox.KLineMatch()}))},this.BindData=function(){for(var t=this.SelectData.Data,e=this.SelectData.Start,a=this.SelectData.End,i={Open:0,Close:0,High:0,Low:0,YClose:0,Vol:0,Amount:0,Date:{Start:0,End:0},Count:0,KLine:{Up:0,Down:0,Unchanged:0}},r=e;r<=a&&r<t.Data.length;++r){var n=t.Data[r];r==e&&(i.Date.Start=n.Date,i.Open=n.Open,i.High=n.High,i.Low=n.Low,i.YClose=n.YClose),i.Date.End=n.Date,i.Close=n.Close,i.Vol+=n.Vol,i.Amount+=n.Amount,++i.Count,i.High<n.High&&(i.High=n.High),i.Low>n.Low&&(i.Low=n.Low),n.Close>n.Open?++i.KLine.Up:n.Close<n.Open?++i.KLine.Down:++i.KLine.Unchanged}i.Vol>0&&(i.AvPrice=i.Amount/i.Vol),n.YClose>0&&(i.Increase=(i.Close-i.YClose)/i.YClose*100,i.Amplitude=(i.High-i.Low)/i.YClose*100);var s=Ui(this.SelectData.Symbol),o=i.Date.Start.toString().substring(0,4)+"/"+i.Date.Start.toString().substring(4,6)+"/"+i.Date.Start.toString().substring(6,8),h=i.Date.End.toString().substring(0,4)+"/"+i.Date.End.toString().substring(4,6)+"/"+i.Date.End.toString().substring(6,8),l="",u="",C="",D="";e<=0&&(l="BtnBackground"),e>=a&&(u="BtnBackground",C="BtnBackground"),a>=t.Data.length-1&&(D="BtnBackground");var c=document.createElement("div");c.className="jchart-select-table-right",c.innerHTML='<div class="jchart-select-date">\n            <span>开始: '+o+'<i class="start-date-left '+l+'"><</i><i class="start-date-right '+u+'">></i></span>\n            <span>结束: '+h+'<i class="end-date-left '+C+'"><</i><i class="end-date-right '+D+'">></i></span>\n            <span>总个数: '+i.Count+"</span>\n        </div>\n        <table>\n            <tr><td><strong>起始价: </strong><span>"+i.YClose.toFixed(s)+"</span></td>               <td><strong>最终价: </strong><span>"+i.Close.toFixed(s)+"</span></td>               <td><strong>均价: </strong><span>"+i.AvPrice.toFixed(s)+"</span></td></tr>\n            <tr><td><strong>最低价: </strong><span>"+i.Low.toFixed(s)+"</span></td>               <td><strong>最高价: </strong><span>"+i.High.toFixed(s)+'</span></td>               <td><strong>涨跌幅: </strong><span class="'+Le.FormatValueColor(i.Increase)+'">'+i.Increase.toFixed(2)+"%</span></td></tr>\n            <tr><td><strong>振幅: </strong><span>"+i.Amplitude.toFixed(2)+"%</span></td>               <td><strong>成交量: </strong><span>"+Le.FormatValueString(i.Vol,2)+"股</span></td>               <td><strong>金额: </strong><span>"+Le.FormatValueString(i.Amount,2)+"元</span></td></tr>\n            <tr><td><strong>阴线: </strong><span>"+i.KLine.Up+"</span></td>               <td><strong>阳线: </strong><span>"+i.KLine.Down+"</span></td>               <td><strong>平线: </strong><span>"+i.KLine.Unchanged+"</span></td></tr>\n        </table>",(0,E.default)(".parameter-content").html(c),this.BindEvent()},this.BindEvent=function(){var t=this;t.SelectData.Start>0&&(0,E.default)(".jchart-select-date .start-date-left").click((function(){t.SelectData.Start--,t.BindData(),t.HQChart.UpdateSelectRect(t.SelectData.Start,t.SelectData.End)})),t.SelectData.Start<t.SelectData.End&&((0,E.default)(".jchart-select-date .start-date-right").click((function(){t.SelectData.Start++,t.BindData(),t.HQChart.UpdateSelectRect(t.SelectData.Start,t.SelectData.End)})),(0,E.default)(".jchart-select-date .end-date-left").click((function(){t.SelectData.End--,t.BindData(),t.HQChart.UpdateSelectRect(t.SelectData.Start,t.SelectData.End)}))),t.SelectData.End<t.SelectData.Data.Data.length-1&&(0,E.default)(".jchart-select-date .end-date-right").click((function(){t.SelectData.End++,t.BindData(),t.HQChart.UpdateSelectRect(t.SelectData.Start,t.SelectData.End)}))},this.DoModal=function(t){var e=t.data.Chart;null==this.ID&&this.Create(),this.SelectData=t.data.SelectData,this.HQChart=e,this.BindData(),this.Show()},this.KLineMatch=function(t){var e=new pi(this.DivElement);e.DoModal({data:{Title:"计算中......",Chart:this.HQChart}}),this.Close();var a=this.HQChart,i={Scope:{Plate:["CNA.ci"],Minsimilar:.9},WaitDialog:e};a.RequestKLineMatch(this.SelectData,i)}}function Ii(t){this.newMethod=fi,this.newMethod(t),delete this.newMethod,this.MatchData,this.Sample,this.Dialog,this.HQChart,this.PageData,this.Close=function(){this.DivElement.removeChild(this.Dialog)},this.Create=function(){this.ID=Y();var t=document.createElement("div");t.className="jchart-kline-match-box",t.id=this.ID,t.innerHTML="<div class='parameter jchart-kline-match-box'>\n            <div class='parameter-header'>\n                <span>形态匹配</span>\n                <strong id='close' class='icon iconfont icon-close'></strong>\n            </div>\n            <div class='parameter-content'>\n                <p class='dataCount'></p>\n                <table class='matchTable'>\n                    <thead>\n                        <tr>\n                            <td>股票名称</td>\n                            <td>匹配度</td>\n                            <td>时间段</td>\n                        </tr>\n                    </thead>\n                    <tbody>\n                    </tbody>\n                </table>\n                <div class='pagination' data-current='1'></div>\n            </div>\n            <div class='parameter-footer'>\n                <button id='close' class='submit' >确定</button>\n            </div>\n        </div>".trim(),this.DivElement.appendChild(t),this.Dialog=t,(0,E.default)("#"+this.ID+" #close").click({divBox:this},(function(t){t.data.divBox.Close()}))},this.BindData=function(){M.Chart.Log("[KLineMatchDialog::BindData] 形态源: "+this.Sample.Stock.Name+" 区间:"+this.Sample.Date.Start+" - "+this.Sample.Date.End);var t=this.MatchData.length+1,e={NewData:{},MetaData:[],PageCount:0,Count:t},a=0;(0,E.default)("#"+this.ID+" .dataCount").html("个数："+t);for(var i=0;i<t;i++){var r={};if(0==i)r={Symbol:this.Sample.Stock.Symbol,Name:this.Sample.Stock.Name,Rate:"形态源",Color:"red",Date:this.Sample.Date.Start+"-"+this.Sample.Date.End};else{var n=this.MatchData[i-1];r={Symbol:n.Symbol,Name:n.Name,Rate:Number(100*n.Similar).toFixed(2),Color:"",Date:n.Start+"-"+n.End}}e.MetaData.push(r)}a=e.Count%10==0?e.Count/10:Math.floor(e.Count/10)+1,e.PageCount=a,this.PaginationMetaData(e),this.PageData=e,M.Chart.Log("[KLineMatchDialog::DoModal pageData]",e),this.RenderDom(1),this.PaginationInit("#"+this.ID,e.PageCount,this.paginationCallback)},this.RenderDom=function(t){var e=this.PageData.NewData[t];M.Chart.Log("[KLineMatchDialog::RenderDom currentPageData]",e);for(var a="",i=0;i<e.length;i++)a+=("<tr>\n                        <td class="+e[i].Color+">"+e[i].Name+"</td>\n                        <td class="+e[i].Color+">"+e[i].Rate+"</td>\n                        <td class="+e[i].Color+">"+e[i].Date+"</td>\n                    </tr>").trim();(0,E.default)("#"+this.ID+" .matchTable tbody").html(a)};var e=this;this.paginationCallback=function(t){e.RenderDom(t),e.PaginationInit("#"+e.ID,e.PageData.PageCount,e.paginationCallback)},this.PaginationInit=function(t,e,a){var i="",r=(0,E.default)(t+" .pagination").data("current"),n=0,s=5;if(r<s)if(e>=s)for(var o=0;o<s;o++)i+=o+1!=r?"<span>"+(o+1)+"</span>":"<span class='active'>"+(o+1)+"</span>";else for(o=0;o<e;o++)i+=o+1!=r?"<span>"+(o+1)+"</span>":"<span class='active'>"+(o+1)+"</span>";else{n=r+1>e?r:r+1;for(var h=r-3;h<=n;h++)i+=h!=r?"<span>"+h+"</span>":"<span class='active'>"+h+"</span>"}i="<span class='beforePage'>上一页</span>"+i+"<span class='nextPage'>下一页</span>",(0,E.default)(t+" .pagination").html(i),(0,E.default)(t+" .pagination span").bind("click",{maxpage:e,Callback:a},this.PaginationCurrentIndex)},this.PaginationCurrentIndex=function(t){var e=(0,E.default)(this).text();M.Chart.Log("[::PaginationCurrentIndex text]",e);var a=Number((0,E.default)(this).parent().data("current")),i=t.data.maxpage,r=t.data.Callback,n=1;n="上一页"===e?1===a?a:a-1:"下一页"===e?a===i?a:a+1:Number(e),(0,E.default)(this).parent().data("current",n),r(n)},this.PaginationMetaData=function(t){for(var e={},a=t.MetaData,i=t.PageCount,r=0;r<i;r++){for(var n=[],s=0;s<10;s++){var o=10*r+s;if(!(o<=a.length-1))break;var h=a[o];n.push(h)}e[r+1]=n}t.NewData=e},this.DoModal=function(t){var e=t.data.Chart;null==this.ID&&this.Create(),this.MatchData=t.data.MatchData,this.Sample=t.data.Sample,this.HQChart=e,this.BindData();var a=e.Frame.ChartBorder,i=(U(),a.GetWidth()/2),r=a.GetHeight()/2;this.Show(i,r,200,200)}}function pi(t){this.newMethod=fi,this.newMethod(t),delete this.newMethod,this.Title="加载中......",this.Dialog,this.Close=function(){this.Dialog&&(this.DivElement.removeChild(this.Dialog),this.Dialog=null)},this.SetTitle=function(t){this.Title=t,this.Dialog},this.Create=function(){this.ID=Y();var t=document.createElement("div");t.className="jchart-wait-box",t.id=this.ID,t.innerHTML=("<div class='parameter jchart-kline-match-box'>\n            <div class='parameter-header'>\n                <span>"+this.Title+"</span>\n            </div>\n        </div>").trim(),this.DivElement.appendChild(t),this.Dialog=t},this.DoModal=function(t){this.Title=t.data.Title;var e=t.data.Chart;null==this.ID&&this.Create();var a=e.Frame.ChartBorder,i=(U(),a.GetWidth()/2),r=a.GetHeight()/2;this.Show(i,r,200,40)}}function Ti(t){this.newMethod=fi,this.newMethod(t),delete this.newMethod,this.option={},this.Create=function(){var t=this;this.ID=Y(),t.BindData(),t.BindEvent()},this.BindData=function(){var t=this,e=this.DivElement.id,a=(0,E.default)("#"+e);a.find("div[id^='topMenu_']").remove(),a.find("div[id^='childMenu_']").remove();var i=(0,E.default)("<div />");i.attr("id","topMenu_"+t.ID).addClass("context-menu-wrapper topmenu").hide(),a.append(i);var r=(0,E.default)("<table />");r.attr({id:"topTable_"+t.ID,cellspacing:"0",cellpadding:"0"}).addClass("context-menu"),i.append(r),r.append(t.childrenList(t.option.data));for(var n=0;n<t.option.data.length;n++){var s="undefined"!=typeof t.option.data[n].children;if(s){var o=(0,E.default)("<div />");o.attr({id:"childMenu_"+t.ID+n,"data-index":n}).addClass("context-menu-wrapper").hide(),a.append(o);var h=(0,E.default)("<table />");h.attr({id:"childTable_"+t.ID+n,cellspacing:"0",cellpadding:"0"}).addClass("context-menu"),o.append(h),h.append(t.childrenList(t.option.data[n].children))}}},this.Update=function(){var t=this;t.BindData(),t.BindEvent()},this.childrenList=function(t){for(var e=[],a=0;a<t.length;a++){var i="undefined"!=typeof t[a].isBorder&&t[a].isBorder,r=(0,E.default)("<tr />");r.addClass("font_Arial context-menu"),i&&r.addClass("border");var n=(0,E.default)("<td />");t[a].selected?n.addClass("spacer context-menu").html("√"):n.addClass("spacer context-menu");var s=(0,E.default)("<td />");s.addClass("text").html(t[a].text);var o=(0,E.default)("<td />");o.addClass("right shortcut");var h=(0,E.default)("<td />");h.addClass("undefined"!=typeof t[a].children?"submenu-arrow":"context-menu spacer"),r.append(n).append(s).append(o).append(h),e.push(r)}return e},this.Show=function(t){var e=this;E.default.extend(e.option,t),e.ID?e.Update():e.Create();var a=(0,E.default)("#topMenu_"+e.ID),i=a.outerWidth(),r=a.outerHeight(),n=e.option.x,s=e.option.y;i>e.option.position.X+e.option.position.W-n&&(n-=i),r>e.option.position.Y+e.option.position.H-s&&(s-=r),a.hide(),a.css({position:"absolute",left:n+"px",top:s+"px"}).show(),this.isInit=!0},this.Hide=function(){var t=this;(0,E.default)("#topMenu_"+t.ID).hide(),(0,E.default)("[id^='childMenu_"+t.ID+"']").hide()},this.BindEvent=function(){var t=this,e=(0,E.default)("[id^='childMenu_"+t.ID+"']");(0,E.default)("#topTable_"+t.ID).find("tr").mouseenter((function(){var a=(0,E.default)(this),i=a.index(),r=(0,E.default)("#topMenu_"+t.ID),n=(0,E.default)("#childMenu_"+t.ID+i),s=a.outerWidth(),o=a.outerHeight(),h=r.position().left+s+1,l=r.position().top+o*i;s>t.option.position.X+t.option.position.W-h&&(h=h-s-r.outerWidth()-2),n.outerHeight()>t.option.position.Y+t.option.position.H-l&&(l=r.position().top+r.outerHeight()-n.outerHeight()),e.hide(),n.css({left:h+"px",top:l+"px"}).show()})).mouseleave((function(){var e=(0,E.default)(this).index();setTimeout((function(){1!=(0,E.default)("#childMenu_"+t.ID+e).attr("data-isShow")&&(0,E.default)("#childMenu_"+t.ID+e).hide()}),10)})).click((function(){var e=(0,E.default)(this),a=e.index();"function"==E.default.type(t.option.data[a].click)&&(t.option.data[a].click(t.option.returnData),e.hide())})).contextmenu((function(){return!1})),e.mouseenter((function(){(0,E.default)(this).attr("data-isShow","1")})).mouseleave((function(){(0,E.default)(this).attr("data-isShow","0")})).contextmenu((function(){return!1})),e.find("tr").click((function(){var a=(0,E.default)(this),i=parseInt(a.closest("div").attr("data-index")),r=a.index();"function"==E.default.type(t.option.data[i].children[r].click)&&(t.option.data[i].children[r].click(t.option.windowIndex||1),e.hide())}))},this.GetPeriod=function(t){var e=[{text:"日线",Value:0,click:function(){t.ChangePeriod(0)}},{text:"周线",Value:1,click:function(){t.ChangePeriod(1)}},{text:"双周线",Value:21,click:function(){t.ChangePeriod(21)}},{text:"月线",Value:2,click:function(){t.ChangePeriod(2)}},{text:"季线",Value:9,click:function(){t.ChangePeriod(9)}},{text:"年线",Value:3,click:function(){t.ChangePeriod(3)}},{text:"1分",Value:4,click:function(){t.ChangePeriod(4)}},{text:"5分",Value:5,click:function(){t.ChangePeriod(5)}},{text:"15分",Value:6,click:function(){t.ChangePeriod(6)}},{text:"30分",Value:7,click:function(){t.ChangePeriod(7)}},{text:"60分",Value:8,click:function(){t.ChangePeriod(8)}},{text:"2小时",Value:11,click:function(){t.ChangePeriod(11)}},{text:"4小时",Value:12,click:function(){t.ChangePeriod(12)}},{text:"分笔",Value:10,click:function(){t.ChangePeriod(10)}},{text:"自定义周期:3分钟",Value:20003,click:function(){t.ChangePeriod(20003)}},{text:"自定义周期:35分钟",Value:20035,click:function(){t.ChangePeriod(20035)}},{text:"自定义周期:8日",Value:40008,click:function(){t.ChangePeriod(40008)}}];for(var a in e){var i=e[a];if(i.Value==t.Period){i.selected=!0;break}}return e},this.GetRight=function(t){var e=[{text:"不复权",click:function(){t.ChangeRight(0)}},{text:"前复权",click:function(){t.ChangeRight(1)}},{text:"后复权",click:function(){t.ChangeRight(2)}}];return t.Right>=0&&t.Right<e.length&&(e[t.Right].selected=!0),e},this.GetIndex=function(t){return[{text:"均线",click:function(e){t.ChangeIndex(e,"均线")}},{text:"BOLL",click:function(e){t.ChangeIndex(e,"BOLL")},isBorder:!0},{text:"MACD",click:function(e){t.ChangeIndex(e,"MACD")}},{text:"KDJ",click:function(e){t.ChangeIndex(e,"KDJ")}},{text:"VOL",click:function(e){t.ChangeIndex(e,"VOL")}},{text:"RSI",click:function(e){t.ChangeIndex(e,"RSI")}},{text:"BRAR",click:function(e){t.ChangeIndex(e,"BRAR")}},{text:"WR",click:function(e){t.ChangeIndex(e,"WR")}},{text:"BIAS",click:function(e){t.ChangeIndex(e,"BIAS")}},{text:"OBV",click:function(e){t.ChangeIndex(e,"OBV")}},{text:"DMI",click:function(e){t.ChangeIndex(e,"DMI")}},{text:"CR",click:function(e){t.ChangeIndex(e,"CR")}},{text:"PSY",click:function(e){t.ChangeIndex(e,"PSY")}},{text:"CCI",click:function(e){t.ChangeIndex(e,"CCI")}},{text:"DMA",click:function(e){t.ChangeIndex(e,"DMA")}},{text:"TRIX",click:function(e){t.ChangeIndex(e,"TRIX")}},{text:"VR",click:function(e){t.ChangeIndex(e,"VR")}},{text:"EMV",click:function(e){t.ChangeIndex(e,"EMV")}},{text:"ROC",click:function(e){t.ChangeIndex(e,"ROC")}},{text:"MIM",click:function(e){t.ChangeIndex(e,"MIM")}},{text:"FSL",click:function(e){t.ChangeIndex(e,"FSL")}}]},this.GetColorIndex=function(t){var e=[{text:"十字星",click:function(e){t.ChangeInstructionIndex("五彩K线-十字星")}},{text:"早晨之星",click:function(e){t.ChangeInstructionIndex("五彩K线-早晨之星")}},{text:"垂死十字",click:function(e){t.ChangeInstructionIndex("五彩K线-垂死十字")}},{text:"三只乌鸦",click:function(e){t.ChangeInstructionIndex("五彩K线-三只乌鸦")}},{text:"光脚阴线",click:function(e){t.ChangeInstructionIndex("五彩K线-光脚阴线")}},{text:"黄昏之星",click:function(e){t.ChangeInstructionIndex("五彩K线-黄昏之星")}}];return t.ColorIndex&&(e[e.length-1].isBorder=!0,e.push({text:"删除五彩K线",click:function(e){t.CancelInstructionIndex()}})),e},this.GetTradeIndex=function(t){var e=[{text:"BIAS",click:function(e){t.ChangeInstructionIndex("交易系统-BIAS")}},{text:"CCI",click:function(e){t.ChangeInstructionIndex("交易系统-CCI")}},{text:"DMI",click:function(e){t.ChangeInstructionIndex("交易系统-DMI")}},{text:"KD",click:function(e){t.ChangeInstructionIndex("交易系统-KD")}},{text:"BOLL",click:function(e){t.ChangeInstructionIndex("交易系统-BOLL")}},{text:"KDJ",click:function(e){t.ChangeInstructionIndex("交易系统-KDJ")}}];return t.TradeIndex&&(e[e.length-1].isBorder=!0,e.push({text:"删除专家系统",click:function(e){t.CancelInstructionIndex()}})),e},this.GetOverlay=function(t){var e=[{text:"上证指数",click:function(){t.OverlaySymbol("000001.sh")}},{text:"深证成指",click:function(){t.OverlaySymbol("399001.sz")}},{text:"中小板指",click:function(){t.OverlaySymbol("399005.sz")}},{text:"创业板指",click:function(){t.OverlaySymbol("399006.sz")}},{text:"沪深300",click:function(){t.OverlaySymbol("000300.sh")}}];for(var a in t.OverlayChartPaint){var i,r=t.OverlayChartPaint[a],n=r.Symbol,s=new g.default([["000001.sh",0],["399001.sz",1],["399005.sz",2],["399006.sz",3],["000300.sh",4]]);if(s.has(n))(function(){i=e[s.get(n)];var a=n;i.selected=!0,i.click=function(){t.DeleteOverlaySymbol(a)}})()}return t.OverlayChartPaint&&t.OverlayChartPaint.length>0&&(e[e.length-1].isBorder=!0,e.push({text:"取消叠加",click:function(){t.ClearOverlaySymbol()}})),e},this.GetKLineType=function(t){var e=[{text:"K线(空心阳线)",click:function(){t.ChangeKLineDrawType(3)}},{text:"K线(实心阳线)",click:function(){t.ChangeKLineDrawType(0)}},{text:"美国线",click:function(){t.ChangeKLineDrawType(2)}},{text:"收盘线",click:function(){t.ChangeKLineDrawType(1)}},{text:"收盘面积",click:function(){t.ChangeKLineDrawType(4)}}];switch(t.KLineDrawType){case 0:e[1].selected=!0;break;case 1:e[3].selected=!0;break;case 2:e[2].selected=!0;break;case 3:e[0].selected=!0;break;case 4:e[4].selected=!0;break}return e},this.GetIndexWindowCount=function(t){var e=[{text:"1个窗口",click:function(){t.ChangeIndexWindowCount(1)}},{text:"2个窗口",click:function(){t.ChangeIndexWindowCount(2)}},{text:"3个窗口",click:function(){t.ChangeIndexWindowCount(3)}},{text:"4个窗口",click:function(){t.ChangeIndexWindowCount(4)}},{text:"5个窗口",click:function(){t.ChangeIndexWindowCount(5)}}],a=t.Frame.SubFrame.length;return a-1>=0&&a-1<e.length&&(e[a-1].selected=!0),e},this.GetCoordinateType=function(t){var e=[{text:"普通坐标",click:function(){t.ChangeCoordinateType({Type:0})}},{text:"百分比坐标",click:function(){t.ChangeCoordinateType({Type:1})}},{text:"反转坐标",click:function(){t.ChangeCoordinateType({IsReverse:!0})}},{text:"对数坐标",click:function(){t.ChangeCoordinateType({Type:2})}}];return t.Frame&&t.Frame.SubFrame&&t.Frame.SubFrame.length>0&&(1==t.Frame.SubFrame[0].Frame.CoordinateType&&(e[2].selected=!0,e[2].click=function(){t.ChangeCoordinateType({IsReverse:!1})}),1==t.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType?e[1].selected=!0:0==t.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType?e[0].selected=!0:2==t.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType&&(e[3].selected=!0)),e},this.GetDragModeType=function(t){var e=[{text:"禁止拖拽",click:function(){t.DragMode=0}},{text:"启动拖拽",click:function(){t.DragMode=1}},{text:"区间选择",click:function(){t.DragMode=2}}];return t.DragMode>=0&&t.DragMode<e.length&&(e[t.DragMode].selected=!0),e},this.GetTools=function(t){var e=[],a=t.GetExtendChartByClassName("DrawToolsButton");a?e.push({text:"关闭画图工具",click:function(){for(var e=a.Chart.Width,i=parseInt(a.Index),r=i+1;r<t.ExtendChartPaint.length;++r){var n=t.ExtendChartPaint[r];"StockChip"==n.ClassName&&(n.Left-=e)}t.DeleteExtendChart(a),t.Frame.ChartBorder.Right-=e,t.SetSizeChage(!0),t.Draw()}}):e.push({text:"画图工具",click:function(){var e={Name:"画图工具",Top:t.Frame.ChartBorder.Top};t.CreateExtendChart(e.Name,e);t.SetSizeChage(!0),t.Draw()}});var i=t.GetExtendChartByClassName("StockChip");return i?e.push({text:"关闭移动筹码",click:function(){for(var e=i.Chart.Width,a=parseInt(i.Index),r=a+1;r<t.ExtendChartPaint.length;++r){var n=t.ExtendChartPaint[r];"DrawToolsButton"==n.ClassName&&(n.Left-=e)}t.DeleteExtendChart(i),t.Frame.ChartBorder.Right-=e,t.SetSizeChage(!0),t.Draw()}}):e.push({text:"移动筹码",click:function(){var e={Name:"筹码分布",ShowType:1,Width:230};t.CreateExtendChart(e.Name,e);t.SetSizeChage(!0),t.Draw()}}),e},this.GetKLineInfo=function(t){var e=new I.default;for(var a in t.ChartInfo){var i=t.ChartInfo[a];e.add(i.ClassName)}var r=["公告","业绩预告","调研","大宗交易","龙虎榜","互动易"],n=[];for(var a in r){var s=r[a],o=ii.GetClassInfo(s);if(o){i=this.CreateKlineInfoItem(s,e.has(o.ClassName),t);n.push(i)}}if(t.ChartInfo.length>0){n[n.length-1].isBorder=!0;i={text:"删除所有",click:function(){t.ClearKLineInfo()}};n.push(i)}return n},this.CreateKlineInfoItem=function(t,e,a){var i={text:t,selected:e};return i.click=e?function(){a.DeleteKLineInfo(t)}:function(){a.AddKLineInfo(t,!0)},i},this.DoModal=function(t){var e=t.data.Chart,a=e.RightMenu,i=t.offsetX,r=t.offsetY,n=[{text:"分析周期",children:this.GetPeriod(e)},{text:"复权处理",children:this.GetRight(e)},{text:"指标切换",children:this.GetIndex(e)},{text:"五彩K线",children:this.GetColorIndex(e)},{text:"专家系统",children:this.GetTradeIndex(e)},{text:"信息地雷",children:this.GetKLineInfo(e)},{text:"叠加品种",children:this.GetOverlay(e)},{text:"主图线型",children:this.GetKLineType(e)},{text:"坐标类型",children:this.GetCoordinateType(e)},{text:"指标窗口个数",children:this.GetIndexWindowCount(e)},{text:"鼠标拖拽",children:this.GetDragModeType(e)},{text:"工具",children:this.GetTools(e)}],s=e.Symbol.toUpperCase();(Li.IsSHSZIndex(e.Symbol)||Li.IsBIT(s))&&n.splice(1,1);var o=t.data.FrameID,h=this.GetOverlayIndex(e,o);if(h&&h.length>0){var l={text:"删除叠加指标",children:this.GetDeleteOverlayIndex(e,h)};n.splice(3,0,l)}M.Chart.Log("[KLineRightMenu::DoModal]",o),a.Show({windowIndex:o,x:i+e.UIElement.offsetLeft,y:r+e.UIElement.offsetTop,position:e.Frame.Position,data:n}),(0,E.default)(document).click((function(){a.Hide()}))},this.GetOverlayIndex=function(t,e){if(e>=t.Frame.SubFrame.length)return[];var a=[],i=t.Frame.SubFrame[e];for(var r in i.OverlayIndex){var n=i.OverlayIndex[r];a.push({Name:n.Script.Name,Identify:n.Identify})}return a},this.GetDeleteOverlayIndex=function(t,e){var a=[],i=function(){var i=e[r].Identify;a.push({text:e[r].Name,click:function(){t.DeleteOverlayWindowsIndex(i)}})};for(var r in e)i();return a}}function Ai(t){this.newMethod=Ti,this.newMethod(t),delete this.newMethod,this.DoModal=function(e){var a=e.data.Chart,i=this,r=e.data.X,n=e.data.Y,s=[{text:"区间统计",click:function(){M.Chart.Log("[KLineSelectRightMenu::click] 区间统计");var a=new Si(t);a.DoModal(e)}},{text:"区间放大",click:function(){M.Chart.Log("[KLineSelectRightMenu::click] 区间放大");var t=e.data.Chart;t.ShowSelectData(e.data.SelectData)}}];i.Show({x:r,y:n,position:a.Frame.Position,data:s})},this.Show=function(t){var e=this;E.default.extend(e.option,t),e.ID||e.Create();var a="topMenu_"+e.ID,i=document.getElementById(a);i||e.Create();var r=(0,E.default)("#topMenu_"+e.ID),n=r.outerWidth(),s=r.outerHeight();r.contextmenu((function(){return!1}));var o=e.option.x,h=e.option.y;n>e.option.position.X+e.option.position.W-o&&(o-=n),s>e.option.position.Y+e.option.position.H-h&&(h-=s),r.hide(),r.css({position:"absolute",left:o+"px",top:h+"px"}).show(),(0,E.default)("#topMenu_"+e.ID).find("tr").show(),this.isInit=!0}}function gi(t){this.newMethod=Ti,this.newMethod(t),delete this.newMethod,this.DoModal=function(t){var e=t.data.Chart,a=e.RightMenu,i=t.offsetX,r=t.offsetY,n=[{text:"叠加品种",children:this.GetOverlay(e)},{text:"多日分时图",children:this.GetDayCount(e)},{text:"指标窗口个数",children:this.GetIndexWindowCount(e)},{text:"副图指标切换",children:this.GetIndex(e)}],s=e.Symbol;Li.IsSHSZStockA(s)&&n.push({text:"集合竞价",children:this.GetShowBeforeData(e)});var o=t.data.FrameID;M.Chart.Log("[MinuteRightMenu::DoModal]",o),a.Show({windowIndex:o,x:i+e.UIElement.offsetLeft,y:r+e.UIElement.offsetTop,position:e.Frame.Position,data:n}),(0,E.default)(document).click((function(){a.Hide()}))},this.GetDayCount=function(t){var e=[{text:"当日分时图",click:function(){t.ChangeDayCount(1)},isBorder:!0},{text:"最近2日",click:function(){t.ChangeDayCount(2)}},{text:"最近3日",click:function(){t.ChangeDayCount(3)}},{text:"最近4日",click:function(){t.ChangeDayCount(4)}},{text:"最近5日",click:function(){t.ChangeDayCount(5)}},{text:"最近6日",click:function(){t.ChangeDayCount(6)}}];return t.DayCount-1>=0&&t.DayCount-1<e.length&&(e[t.DayCount-1].selected=!0),e},this.GetIndex=function(t){var e=[{text:"MACD",click:function(e){t.ChangeIndex(e,"MACD")}},{text:"DMI",click:function(e){t.ChangeIndex(e,"DMI")}},{text:"DMA",click:function(e){t.ChangeIndex(e,"DMA")}},{text:"BRAR",click:function(e){t.ChangeIndex(e,"BRAR")}},{text:"KDJ",click:function(e){t.ChangeIndex(e,"KDJ")}},{text:"RSI",click:function(e){t.ChangeIndex(e,"RSI")}},{text:"WR",click:function(e){t.ChangeIndex(e,"WR")}},{text:"CCI",click:function(e){t.ChangeIndex(e,"CCI")}},{text:"TRIX",click:function(e){t.ChangeIndex(e,"TRIX")}}];return e},this.GetShowBeforeData=function(t){if(t.IsShowBeforeData){var e=[{text:"隐藏",click:function(){t.ShowBeforeData(!1)}}];return e}e=[{text:"显示",click:function(){t.ShowBeforeData(!0)}}];return e},this.GetIndexWindowCount=function(t){var e=[{text:"1个窗口",click:function(){t.ChangeIndexWindowCount(2)}},{text:"2个窗口",click:function(){t.ChangeIndexWindowCount(3)}},{text:"3个窗口",click:function(){t.ChangeIndexWindowCount(4)}}],a=t.Frame.SubFrame.length-1;return a-1>=0&&a-1<e.length&&(e[a-1].selected=!0),e}}function Fi(t){this.newMethod=fi,this.newMethod(t),delete this.newMethod,this.HQChart,this.ChartPicture,this.SubToolsDiv,this.SettingMenu,this.DoModal=function(t){if(!this.SubToolsDiv){this.ID=Y();var e=document.createElement("div");e.className="subTolls",e.id=this.ID,this.DivElement.appendChild(e),this.SubToolsDiv=e}this.HQChart=t.data.HQChart,this.ChartPicture=t.data.ChartPicture;var a=V(),i=this.HQChart.Frame.SubFrame[0].Frame,r=i.ChartBorder.Top+40,n=i.ChartBorder.Right,s=i.ChartBorder.GetLeft(),o=this.ChartPicture.ClassName,h="";h="ChartDrawPictureText"===o?'<span class="changes-color" title="改变图形颜色"><i class="iconfont icon-bianji"></i><input type="color" name="color" id="color" class="change-color" value="'+this.ChartPicture.LineColor+'"></span>\n<span class="subtool-set" title="设置"><i class="iconfont icon-shezhi"></i></span><span class="subtool-del"><i class="iconfont icon-recycle_bin"></i></span>':'<p class="changes-color" title="改变图形颜色"><i class="iconfont icon-bianji"></i><input type="color" name="color" id="color" class="change-color" value="'+this.ChartPicture.LineColor+'"></p>\n        <p class="subtool-del"><i class="iconfont icon-recycle_bin"></i></p>',this.SubToolsDiv.style.right=n/a+"px",this.SubToolsDiv.style.top=r/a+"px",this.SubToolsDiv.innerHTML=h,this.SubToolsDiv.style.position="absolute",this.SubToolsDiv.style.display="block";var l=this.HQChart,u=this.ChartPicture;this.SubToolsDiv;(0,E.default)(".subtool-del").click((function(){l.ClearChartDrawPicture(u),(0,E.default)(".subTolls").css("display","none")}));var C=this;(0,E.default)(".subtool-set").click((function(){(0,E.default)(C.SubToolsDiv).hide(),this.SettingMenu||(C.SettingMenu=new Ei(i.ChartBorder.UIElement.parentNode)),C.SettingMenu.ChartPicture=u,C.SettingMenu.HQChart=l,C.SettingMenu.Position={Left:n+80,Top:r+20},C.SettingMenu.DoModal()})),(0,E.default)(".changes-color").click((function(){document.getElementById("color").click(),(0,E.default)(".change-color").change((function(){var t=(0,E.default)(".change-color").val();u.LineColor=t,u.PointColor=t,l.ChartDrawStorage&&l.ChartDrawStorage.SaveDrawData(u)}))})),M.Chart.Log("[ChartPictureSettingMenu::DoModal]",{Top:r,Left:s,Right:n})}}function Ei(t){this.newMethod=fi,this.newMethod(t),delete this.newMethod,this.ChartPicture,this.SettingDiv,this.Position,this.BackupData,this.Close=function(){this.SettingDiv&&this.DivElement.removeChild(this.SettingDiv)},this.DoModal=function(){var t=this.ChartPicture.Text,e=this.ChartPicture.FontOption,a=this.ChartPicture.LineColor;this.BackupData={Text:t,LineColor:a,FontOption:{Family:e.Family,Size:e.Size,Weight:e.Weight,Style:e.Style}},M.Chart.Log("[ChartPictureTextSettingMenu::DoModal] picture info",this.BackupData);var i=this,r=this.DivElement.getElementsByClassName("chartpicture-text-setting")[0];r?this.SettingDiv=r:(r=document.createElement("div"),r.className="chartpicture-text-setting",this.DivElement.appendChild(r),this.SettingDiv=r);var n='<div class="titleWrap"><span class="titleName">样式设置</span><i class="closeBtn iconfont icon-close"></i></div>',s=[10,11,12,14,16,20,24,28,32,40],o=["微软雅黑","宋体","Arial","仿宋"],h="",l="";o.forEach((function(t,e){l+=0!==e?"<p>"+t+"</P>":'<p class="active">'+t+"</P>"})),s.forEach((function(t,e){h+=5!==e?"<p>"+t+"</P>":'<p class="active">'+t+"</P>"}));var u='<div class="contentWrap"><div class="styleOptions"><span class="colorPicker"><input type="color" id="fontColor" value="#1e90ff"></span><div class="likeSelect fontSelect"><span class="choicedText">微软雅黑</span><div class="selectList">'+l+'</div><i class="iconfont icon-xia"></i></div><div class="likeSelect fontSizeSelect"><span class="choicedText">20</span><div class="selectList">'+h+'</div><i class="iconfont icon-xia"></i></div><span class="strongFont likeBtn"><i class="iconfont icon-jiacu"></i></span><span class="italicsFont likeBtn"><i class="iconfont icon-qingxieL"></i></span></div><textarea class="tArea" id="tArea" placeholder="Text"></textarea></div>',C='<div class="btnsContainer"><span class="okBtn btn">确认</span><span class="cancelBtn btn">取消</span></div>',D=V(),c=n+u+C;this.SettingDiv.style.left=this.Position.Left/D+"px",this.SettingDiv.style.top=this.Position.Top/D+"px",this.SettingDiv.innerHTML=c,this.SettingDiv.style.position="absolute",this.SettingDiv.style.display="block",(0,E.default)(".chartpicture-text-setting .colorPicker").css({borderColor:i.ChartPicture.LineColor,"background-color":i.ChartPicture.LineColor});var f=this.ChartPicture.FontOption.Family;(0,E.default)(".chartpicture-text-setting .fontSelect .choicedText").html(f),o.forEach((function(t,e){t==f&&((0,E.default)(".chartpicture-text-setting .fontSelect p").removeClass("active"),(0,E.default)(".chartpicture-text-setting .fontSelect p").eq(e).addClass("active"))}));var d=this.ChartPicture.FontOption.Size;(0,E.default)(".chartpicture-text-setting .fontSizeSelect .choicedText").html(d),s.forEach((function(t,e){t==d&&((0,E.default)(".chartpicture-text-setting .fontSizeSelect p").removeClass("active"),(0,E.default)(".chartpicture-text-setting .fontSizeSelect p").eq(e).addClass("active"))}));var m=this.ChartPicture.FontOption.Weight;null!=m&&"bold"==m&&(0,E.default)(".chartpicture-text-setting .strongFont").addClass("hot");var v=this.ChartPicture.FontOption.Style;null!=v&&"italic"==v&&(0,E.default)(".chartpicture-text-setting .italicsFont").addClass("hot");t=this.ChartPicture.Text;(0,E.default)(".chartpicture-text-setting .tArea").val(t);(0,E.default)(".chartpicture-text-setting #fontColor").change({Picture:this.ChartPicture},(function(t){var e=(0,E.default)(this).val();(0,E.default)(this).parent().css({borderColor:e,"background-color":e});var a=t.data.Picture;a.LineColor=e,a.Update&&a.Update()})),(0,E.default)(".chartpicture-text-setting .fontSelect,.chartpicture-text-setting .fontSizeSelect").click((function(){(0,E.default)(this).find(".selectList").toggle(),(0,E.default)(this).toggleClass("hot")})),(0,E.default)(".chartpicture-text-setting .fontSelect p").click({Picture:this.ChartPicture},(function(t){var e=(0,E.default)(this).closest(".fontSelect").find(".choicedText").html(),a=t.currentTarget.innerHTML;if(e!==a){(0,E.default)(this).closest(".fontSelect").find(".choicedText").html(a),(0,E.default)(this).siblings().removeClass("active"),(0,E.default)(this).addClass("active");var i=t.data.Picture;i.FontOption.Family=a,i.Update&&i.Update()}})),(0,E.default)(".chartpicture-text-setting .fontSizeSelect p").click({Picture:this.ChartPicture},(function(t){var e=(0,E.default)(this).closest(".fontSizeSelect").find(".choicedText").html(),a=t.currentTarget.innerHTML;if(e!==a){(0,E.default)(this).closest(".fontSizeSelect").find(".choicedText").html(a),(0,E.default)(this).siblings().removeClass("active"),(0,E.default)(this).addClass("active");var i=t.data.Picture;i.FontOption.Size=Number(a),i.Update&&i.Update()}})),(0,E.default)(".chartpicture-text-setting .strongFont").click({Picture:this.ChartPicture},(function(t){(0,E.default)(this).toggleClass("hot");var e=(0,E.default)(this).attr("class");if(e.indexOf("hot")>0){var a=t.data.Picture;a.FontOption.Weight="bold",a.Update&&a.Update()}})),(0,E.default)(".chartpicture-text-setting .italicsFont").click({Picture:this.ChartPicture},(function(t){(0,E.default)(this).toggleClass("hot");var e=(0,E.default)(this).attr("class");if(e.indexOf("hot")>0){var a=t.data.Picture;a.FontOption.Style="italic",a.Update&&a.Update()}})),(0,E.default)(".chartpicture-text-setting .titleWrap .closeBtn,.chartpicture-text-setting .btnsContainer .cancelBtn").click({Picture:this.ChartPicture},(function(t){var e=t.data.Picture;e.Text=i.BackupData.Text,e.LineColor=i.BackupData.LineColor,e.FontOption=i.BackupData.FontOption,e.Update&&e.Update(),i.Close()})),(0,E.default)(".chartpicture-text-setting .tArea").keyup({Picture:this.ChartPicture},(function(t){M.Chart.Log('[ChartPictureTextSettingMenu::DoModal] $(".chartpicture-text-setting .tArea").keyup()');var e=(0,E.default)(this).val(),a=t.data.Picture;a.Text=e,a.Update&&a.Update()})),(0,E.default)(".chartpicture-text-setting .btnsContainer .okBtn").click((function(){i.Close(),i.HQChart&&i.HQChart.ChartDrawStorage&&i.HQChart.ChartDrawStorage.SaveDrawData(i.ChartPicture)}))}}ya.Get=function(t){var e=new g.default([["市场多空",{IsMainIndex:!1,Create:function(){return new Ka}}],["市场择时",{IsMainIndex:!1,Create:function(){return new Ja}}],["市场关注度",{IsMainIndex:!1,Create:function(){return new za}}],["指数热度",{IsMainIndex:!1,Create:function(){return new qa}}],["财务粉饰",{IsMainIndex:!1,Create:function(){return new Qa}}],["自定义指数热度",{IsMainIndex:!1,Create:function(){return new Za},Name:"自定义指数热度"}],["能图-趋势",{IsMainIndex:!1,Create:function(){return new ja},Name:"大盘/个股趋势"}],["能图-位置研判",{IsMainIndex:!1,Create:function(){return new $a},Name:"位置研判"}],["能图-点位研判",{IsMainIndex:!1,Create:function(){return new ai},Name:"点位研判"}],["CJL",{IsMainIndex:!1,Create:function(){return new Xa}}]]);return e.get(t)},Ra.EMA=function(t,e){var a=[],i=0;if(i>=t.length)return a;for(;i<t.length;++i)if(null!=t[i]&&!isNaN(t[i]))break;var r=i,n=i+1;a[r]=t[r];for(var s=i+1;s<t.length;++s,++r,++n)a[n]=(2*t[n]+(e-1)*a[r])/(e+1);return a},Ra.SMA=function(t,e,a){for(var i=[],r=0,n=null;r<t.length;++r)if(null!=t[r]&&!isNaN(t[r])){n=t[r],i[r]=n;break}for(++r;r<t.length;++r)i[r]=(a*t[r]+(e-a)*n)/e,n=i[r];return i},Ra.DMA=function(t,e){var a=[];if(t.length<0||t.length!=e.length)return a;for(var i=0;i<t.length;++i)if(null!=t[i]&&!isNaN(t[i])&&null!=e[i]&&!isNaN(e[i])){a[i]=t[i];break}for(i+=1;i<t.length;++i)null==t[i]||null==e[i]?a[i]=null:t[i]<1?a[i]=e[i]*t[i]+(1-e[i])*a[i-1]:a[i]=t[i];return a},Ra.HHV=function(t,e){var a=[];if(e>t.length)return a;for(var i=-1e4,r=e,n=0;r<t.length;++r,++n){if(r<e+i)i=t[r]<t[i]?i:r;else for(n=1+(i=r-e+1);n<=r;++n)t[n]>t[i]&&(i=n);a[r]=t[i]}return a},Ra.LLV=function(t,e){var a=[];if(e>t.length)return a;for(var i=-1e4,r=e;r<t.length;++r,++n){if(r<e+i)i=t[r]>t[i]?i:r;else for(var n=1+(i=r-e+1);n<=r;++n)t[n]<t[i]&&(i=n);a[r]=t[i]}return a},Ra.REF=function(t,e){var a=[];if(t.length<=0)return a;if(e>=t.length)return a;a=t.slice(0,t.length-e);for(var i=0;i<e;++i)a.unshift(null);return a},Ra.REFDATE=function(t,e){var a=[];if(t.length<=0)return a;for(var i in e=t.length-1,t)a[i]=t[e];return a},Ra.SUM=function(t,e){var a=[];if(0==e){a[0]=t[0];for(var i=1;i<t.length;++i)a[i]=a[i-1]+t[i]}else{i=e-1;for(var r=0;i<t.length;++i,++r)for(var n=0;n<e;++n)0==n?a[i]=t[n+r]:a[i]+=t[n+r]}return a},Ra.ARRAY_SUBTRACT=function(t,e){var a=[],i="number"==typeof e;if(i)for(var r in t)null==t[r]||isNaN(t[r])?a[r]=null:a[r]=t[r]-e;else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&r<e.length?null==t[r]||null==e[r]?a[r]=null:a[r]=t[r]-e[r]:a[r]=null}return a},Ra.ARRAY_GT=function(t,e){var a=[],i="number"==typeof e;if(i)for(var r in t)a[r]=t[r]>e?1:0;else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&r<e.length?a[r]=t[r]>e[r]?1:0:a[r]=null}return a},Ra.ARRAY_GTE=function(t,e){var a=[],i="number"==typeof e;if(i)for(var r in t)a[r]=t[r]>=e?1:0;else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&r<e.length?a[r]=t[r]>=e[r]?1:0:a[r]=null}return a},Ra.ARRAY_LT=function(t,e){var a=[],i="number"==typeof e;if(i)for(var r in t)a[r]=t[r]<e?1:0;else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&r<e.length?a[r]=t[r]<e[r]?1:0:a[r]=null}return a},Ra.ARRAY_LTE=function(t,e){var a=[],i="number"==typeof e;if(i)for(var r in t)a[r]=t[r]<=e?1:0;else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&r<e.length?a[r]=t[r]<=e[r]?1:0:a[r]=null}return a},Ra.ARRAY_EQ=function(t,e){var a=[],i="number"==typeof e;if(i)for(var r in t)a[r]=t[r]==e?1:0;else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&r<e.length?a[r]=t[r]==e[r]?1:0:a[r]=null}return a},Ra.ARRAY_IF=function(t,e,a){var i=[],r=["number"==typeof e,"number"==typeof a];for(var n in t)t[n]?r[0]?i[n]=e:i[n]=e[n]:r[1]?i[n]=a:i[n]=a[n];return i},Ra.ARRAY_AND=function(t,e){var a=[],i="number"==typeof e;if(i)for(var r in t)a[r]=t[r]&&e?1:0;else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&r<e.length?a[r]=t[r]&&e[r]?1:0:a[r]=0}return a},Ra.ARRAY_OR=function(t,e){var a=[],i="number"==typeof e;if(i)for(var r in t)a[r]=t[r]||e?1:0;else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&t[r]?a[r]=1:r<e.length&&e[r]?a[r]=1:a[r]=0}return a},Ra.ARRAY_MULTIPLY=function(t,e){if(2==arguments.length){var a=[],i="number"==typeof e;if(i)for(var r in t)null==t[r]||isNaN(t[r])?a[r]=null:a[r]=t[r]*e;else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&r<e.length?a[r]=t[r]*e[r]:a[r]=null}return a}for(a=Ra.ARRAY_MULTIPLY(arguments[0],arguments[1]),r=2;r<arguments.length;++r)a=Ra.ARRAY_MULTIPLY(a,arguments[r]);return a},Ra.ARRAY_DIVIDE=function(t,e){var a=[],i="number"==typeof e;if(i)for(var r in t)a[r]=t[r]/e;else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&r<e.length?null==t[r]||null==e[r]||isNaN(t[r])||isNaN(e[r])?a[r]=null:0==e[r]?a[r]=null:a[r]=t[r]/e[r]:a[r]=null}return a},Ra.ARRAY_ADD=function(t,e){if(2==arguments.length){var a=[],i="number"==typeof e;if(i)for(var r in t)a[r]=t[r]+e;else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&r<e.length?null==t[r]||null==e[r]||isNaN(t[r])||isNaN(e[r])?a[r]=null:a[r]=t[r]+e[r]:a[r]=null}return a}for(a=Ra.ARRAY_ADD(arguments[0],arguments[1]),r=2;r<arguments.length;++r)a=Ra.ARRAY_ADD(a,arguments[r]);return a},Ra.MAX=function(t,e){var a=[],i="number"==typeof e;if(i)for(var r in t)null==t[r]?a[r]=null:a[r]=Math.max(t[r],e);else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&r<e.length?null==t[r]||null==e[r]?a[r]=null:a[r]=Math.max(t[r],e[r]):a[r]=null}return a},Ra.MIN=function(t,e){var a=[],i="number"==typeof e;if(i)for(var r in t)null==t[r]?a[r]=null:a[r]=Math.min(t[r],e);else{var n=Math.max(t.length,e.length);for(r=0;r<n;++r)r<t.length&&r<e.length?null==t[r]||null==e[r]?a[r]=null:a[r]=Math.min(t[r],e[r]):a[r]=null}return a},Ra.ABS=function(t){var e=[];for(var a in t)null==t[a]?e[a]=null:e[a]=Math.abs(t[a]);return e},Ra.MA=function(t,e){for(var a=[],i=0,r=t.length;i<r;i++)if(i<e)a[i]=null;else{for(var n=0,s=0;s<e;s++)n+=t[i-s];a[i]=n/e}return a},Ra.EXPMA=function(t,e){var a=[];if(e>=t.length)return a;for(var i=e;i<t.length;++i)if(null!=t[i]){a[i]=t[i];break}for(i+=1;i<t.length;++i)null!=a[i-1]&&null!=t[i]?a[i]=(2*t[i]+(e-1)*a[i-1])/(e+1):null!=a[i-1]&&(a[i]=a[i-1]);return a},Ra.EXPMEMA=function(t,e){var a=[];if(e>=t.length)return a;for(var i=0;i<t.length;++i)if(t[i]&&!isNaN(t[i]))break;for(var r=0,n=0;i<t.length&&n<e;++n,++i)t[i]&&!isNaN(t[i])?r+=t[i]:r+=t[i-1];for(a[i-1]=r/e;i<t.length;++i)null!=a[i-1]&&null!=t[i]?a[i]=(2*t[i]+(e-1)*a[i-1])/(e+1):null!=a[i-1]&&(a[i]=a[i-1]);return a},Ra.STD=function(t,e){for(var a=[],i=0,r=[],n=e-1;n<t.length;++n){i=0;for(var s=0;s<e;++s)i+=t[n-s];r[n]=i/e}for(n=e-1;n<t.length;++n){i=0;for(s=0;s<e;++s)i+=Math.pow(t[n-s]-r[n],2);a[n]=Math.sqrt(i/e)}return a},Ra.AVEDEV=function(t,e){for(var a=[],i=0,r=[],n=e-1;n<t.length;++n){i=0;for(var s=0;s<e;++s)i+=t[n-s];r[n]=i/e}for(n=e-1;n<t.length;++n){i=0;for(s=0;s<e;++s)i+=Math.abs(t[n-s]-r[n]);a[n]=i/e}return a},Ra.COUNT=function(t,e){for(var a=[],i=e-1;i<t.length;++i){for(var r=0,n=0;n<e;++n)t[i-n]&&++r;a[i]=r}return a},Ra.CROSS=function(t,e){var a=[];if(t.length!=e.length)return[];for(var i=0;i<t.length;++i)if(null!=t[i]&&!isNaN(t[i])&&null!=e[i]&&isNaN(e[i]))break;for(++i;i<t.length;++i)a[i]=t[i]>e[i]&&t[i-1]<e[i-1]?1:0;return a},Ra.MULAR=function(t,e){var a=[];if(t.length<e)return a;for(var i=e;i<t.length;++i)if(null!=t[i]&&!isNaN(t[i])){a[i]=t[i];break}for(++i;i<t.length;++i)a[i]=a[i-1]*t[i];return a},Ra.STICKLINE=function(t,e,a){var i=[];if(t.length<=0)return i;var r="number"==typeof e,n="number"==typeof a;for(var s in t)if(i[s]=null,!isNaN(t[s])&&t[s])if(r&&n)i[s]={Value:e,Value2:a};else if(r&&!n){if(isNaN(a[s]))continue;i[s]={Value:e,Value2:a[s]}}else if(!r&&n){if(isNaN(e[s]))continue;i[s]={Value:e[s],Value2:a}}else{if(isNaN(e[s])||isNaN(a[s]))continue;i[s]={Value:e[s],Value2:a[s]}}return i},Pa.JsonDataToHistoryData=function(t){var e=[];if(!t.data)return e;var a=null;t.symbol&&(a=t.symbol.toUpperCase());Li.IsFutures(a);for(var i=t.data,r=0,n=1,s=2,o=3,h=4,l=5,u=6,C=7,D=8,c=0;c<i.length;++c){var f=new Dt,d=i[c];f.Date=d[r],f.Open=d[s],f.YClose=d[n],f.Close=d[l],f.High=d[o],f.Low=d[h],f.Vol=d[u],f.Amount=d[C],Le.IsNumber(d[D])&&(f.Position=d[D]),isNaN(f.Open)||f.Open<=0||e.push(f)}return e},Pa.JsonDataToRealtimeData=function(t,e){if(!t.stock)return null;var a;for(var i in t.stock){var r=t.stock[i];if(r&&r.symbol==e){a=r;break}}if(!a)return null;var n=e.toUpperCase(),s=(Li.IsSHSZ(n),new Dt);return s.Date=a.date,s.Open=a.open,s.YClose=a.yclose,s.High=a.high,s.Low=a.low,s.Vol=a.vol,s.Amount=a.amount,s.Close=a.price,Le.IsNumber(a.position)&&(s.Position=a.position),s},Pa.JsonDataToMinuteRealtimeData=function(t,e){if(!t.stock)return null;var a;for(var i in t.stock){var r=t.stock[i];if(r&&r.symbol==e){a=r;break}}if(!a)return null;var n=e.toUpperCase(),s=(Li.IsSHSZ(n),Li.IsFutures(n)),o=new Array,h=a.yclose,l=a.date;for(var i in s&&a.yclearing&&(h=a.yclearing),a.minute){var u=a.minute[i],C=new Dt;C.Close=u.price,C.Open=u.open,C.High=u.high,C.Low=u.low,C.Vol=u.vol,C.Amount=u.amount,u.date>0?C.Date=u.date:C.Date=l,C.Time=u.time,C.YClose=h,Le.IsNumber(u.position)&&(C.Position=u.position),C.Close||(C.Close=h,C.Open=C.High=C.Low=C.Close),C.Open<=0&&(C.Open=null),C.Close<=0&&(C.Close=null),C.High<=0&&(C.High=null),C.Low<=0&&(C.Low=null),u.price>0&&(h=u.price),o[i]=C}return o},Pa.JsonDataToMinuteHistoryData=function(t){var e=null;t.symbol&&(e=t.symbol.toUpperCase());e&&Li.IsSHSZ(e);e&&Li.IsFutures(e);for(var a=t.data,i=new Array,r=0,n=1,s=2,o=3,h=4,l=5,u=6,C=7,D=8,c=9,f=0;f<a.length;++f){var d=new Dt,m=a[f];d.Date=m[r],d.Open=m[s],d.YClose=m[n],d.Close=m[l],d.High=m[o],d.Low=m[h],d.Vol=m[u],d.Amount=m[C],d.Time=m[D],Le.IsNumber(m[c])&&(d.Position=m[c]),i.push(d)}for(f=0;f<i.length;++f){var v=i[f];if(null==v&&coninue,isNaN(v.Open)||v.Open<=0||isNaN(v.High)||v.High<=0||isNaN(v.Low)||v.Low<=0||isNaN(v.Close)||v.Close<=0)if(0==f)v.YClose>0&&(v.Open=v.YClose,v.High=v.YClose,v.Low=v.YClose,v.Close=v.YClose);else for(var S=f-1;S>=0;--S){var I=i[S];if(null==I&&coninue,I.Open>0&&I.High>0&&I.Low>0&&I.Close>0){v.YClose<=0&&(v.YClose=I.Close),v.Open=I.Open,v.High=I.High,v.Low=I.Low,v.Close=I.Close;break}}}return i},Pa.JsonDataToTickData=function(t){var e=[];if(!t.detail)return e;var a=t.date,i=t.yclose;for(var r in t.detail){var n=new Dt,s=t.detail[r];s&&(n.Date=a,n.Time=s[0],n.Low=n.High=n.Close=n.Open=s[1],n.YClose=i,n.Vol=s[2],n.Amount=s[3],n.Flag=s[4],isNaN(n.Open)||n.Open<=0||(i=n.Close,e.push(n)))}return e},wa.JsonDataToMinuteData2=function(t){t.stock[0].symbol;var e=t.stock[0].yclose,a=t.stock[0].yclose,i=t.stock[0].yclose,r=[],n=t.stock[0],s=n.date;for(var o in n.before){var h=new ct,l=n.before[o],u=l[0];h.Before={},h.Before.Close=l[1],h.Before.Close?e=h.Before.Close:h.Before.Close=e,h.Before.Vol=l[2]/100,h.Before.Amount=l[3],h.DateTime=s.toString()+" "+u.toString(),h.Date=s,h.Time=u,i&&h.Before.Close&&(h.Before.Increase=(h.Before.Close-i)/i*100),r.push(h)}for(var o in n.minute){l=n.minute[o],h=new ct;l.price&&(e=l.price),l.avprice&&(a=l.avprice),925!=l.time&&(h.Close=l.price,h.Open=l.open,h.High=l.high,h.Low=l.low,h.Amount=l.amount,h.Vol=l.vol/100,h.DateTime=t.stock[0].date.toString()+" "+l.time.toString(),h.Date=t.stock[0].date,h.Time=l.time,h.Increase=l.increase,h.Risefall=l.risefall,h.AvPrice=l.avprice,h.Close||(h.Open=h.High=h.Low=h.Close=e),h.AvPrice||(h.AvPrice=a),i&&h.Close&&(h.Increase=(h.Close-i)/i*100),r.push(h))}return r},wa.JsonDataToMinuteData=function(t,e){var a=t.stock[0].symbol,i=a.toUpperCase(),r=Li.IsSHSZ(i),n=Li.IsFutures(i),s=Li.IsSHO(i),o=new Array,h=t.stock[0].yclose,l=t.stock[0].yclose,u=t.stock[0].yclose;n&&t.stock[0].yclearing&&(u=h=l=t.stock[0].yclearing);var C=t.stock[0].date;for(var D in t.stock[0].minute){var c=t.stock[0].minute[D],f=new ct;f.Close=c.price,f.Open=c.open,f.High=c.high,f.Low=c.low,f.Vol=r?c.vol/100:c.vol,f.Amount=c.amount,c.date>0&&(C=c.date),f.DateTime=C.toString()+" "+c.time.toString(),f.Date=C,f.Time=c.time,(n||s)&&(f.Position=c.position),0==D&&(f.IsFristData=!0),f.Increase=c.increase,f.Risefall=c.risefall,f.AvPrice=c.avprice,Le.IsNumber(c.lead)&&(f.Lead=c.lead),f.Close||(f.Close=h,f.Open=f.High=f.Low=f.Close),f.AvPrice||(f.AvPrice=l),f.Open<=0&&(f.Open=null),f.Close<=0&&(f.Close=null),f.AvPrice<=0&&(f.AvPrice=null),f.High<=0&&(f.High=null),f.Low<=0&&(f.Low=null),u&&f.Close&&(f.Increase=(f.Close-u)/u*100);var d=Math.abs(f.AvPrice-f.Close);r&&d>.13*f.Close&&(f.AvPrice=l),c.price>0&&(h=c.price),c.avprice>0&&f.AvPrice===c.avprice&&(l=c.avprice),o[D]=f}return o},wa.JsonDataToMinuteDataArray=function(t){var e=t.symbol,a=e.toUpperCase(),i=Li.IsSHSZ(a),r=Li.IsSHO(a),n=Li.IsFutures(a),s=[];for(var o in t.data){var h=[],l=t.data[o],u=l.date,C=l.yclose,D=C,c=null;for(var f in l.minute){var d=l.minute[f];d[2]&&(D=d[2]);var m=new ct;if(m.Close=d[2],m.Open=d[1],m.High=d[3],m.Low=d[4],m.Vol=i?d[5]/100:d[5],m.Amount=d[6],7<d.length&&d[7]>0&&(m.AvPrice=d[7]),m.DateTime=u.toString()+" "+d[0].toString(),m.Date=u,m.Time=d[0],8<d.length&&d[8]>0&&(m.Date=d[8]),(n||r)&&9<d.length&&(m.Position=d[9]),m.Close||(m.Close=D,m.Open=m.High=m.Low=m.Close),!m.AvPrice&&c&&(m.AvPrice=c),m.Close&&C?m.Increase=(m.Close-C)/C*100:m.Increase=null,0==f&&(m.IsFristData=!0),m.Open<=0&&(m.Open=null),m.Close<=0&&(m.Close=null),m.AvPrice<=0&&(m.AvPrice=null),m.High<=0&&(m.High=null),m.Low<=0&&(m.Low=null),m.AvPrice<=0&&(m.AvPrice=null),m.AvPrice&&i){var v=Math.abs(m.AvPrice-m.Close);v>.13*m.Close&&(m.AvPrice=c)}d.length>7&&d[7]>0&&m.AvPrice===d[7]&&(c=d[7]),h[f]=m}var S=new It;S.Data=h,S.YClose=C,S.Close=l.close,S.Date=u,s.push(S)}return s},ba.JsonDataToMinuteData=function(t){var e=[];for(var a in t.minute.time){var i=new ct;t.minute.price[a]<=0&&a>0?(i.Close=e[a-1].Close,i.Open=e[a-1].Close,i.High=i.Close,i.Low=i.Close,i.Vol=t.minute.vol[a],i.Amount=t.minute.amount[a],i.DateTime=t.date.toString()+" "+t.minute.time[a].toString(),i.AvPrice=e[a-1].AvPrice):(i.Close=t.minute.price[a],i.Open=t.minute.open[a],i.High=t.minute.high[a],i.Low=t.minute.low[a],i.Vol=t.minute.vol[a],i.Amount=t.minute.amount[a],i.DateTime=t.date.toString()+" "+t.minute.time[a].toString(),i.AvPrice=t.minute.avprice[a]),i.Open<=0&&(i.Open=null),i.Close<=0&&(i.Close=null),i.AvPrice<=0&&(i.AvPrice=null),i.High<=0&&(i.High=null),i.Low<=0&&(i.Low=null),e[a]=i}return e},ti.prototype.GetDefaultColor=function(t){var e=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],a=parseInt(t);return e[a%(e.length-1)]},ii.Get=function(t){var e=new g.default([["互动易",{Create:function(){return new ni}}],["公告",{Create:function(){return new si}}],["业绩预告",{Create:function(){return new oi}}],["调研",{Create:function(){return new hi}}],["大宗交易",{Create:function(){return new li}}],["龙虎榜",{Create:function(){return new ui}}]]);return e.get(t)},ii.GetClassInfo=function(t){var e=new g.default([["互动易",{ClassName:"InvestorInfo"}],["公告",{ClassName:"AnnouncementInfo"}],["业绩预告",{ClassName:"PforecastInfo"}],["调研",{ClassName:"ResearchInfo"}],["大宗交易",{ClassName:"BlockTrading"}],["龙虎榜",{ClassName:"TradeDetail"}]]);return e.get(t)},ii.GetIconUrl=function(t){switch(t){case dt.INVESTOR:return Ma.KLine.Info.Investor.Icon;case dt.PFORECAST:return Ma.KLine.Info.Pforecast.Icon;case dt.ANNOUNCEMENT:return Ma.KLine.Info.Announcement.Icon;case dt.ANNOUNCEMENT_QUARTER_1:case dt.ANNOUNCEMENT_QUARTER_2:case dt.ANNOUNCEMENT_QUARTER_3:case dt.ANNOUNCEMENT_QUARTER_4:return Ma.KLine.Info.Announcement.IconQuarter;case dt.RESEARCH:return Ma.KLine.Info.Research.Icon;case dt.BLOCKTRADING:return Ma.KLine.Info.BlockTrading.Icon;case dt.TRADEDETAIL:return Ma.KLine.Info.TradeDetail.Icon;default:return Ma.KLine.Info.Announcement.Icon}},ii.GetIconLibrary=function(t){var e=Ma.KLine.Info.IconLibrary;if(!e||!e.Icon)return Ma.KLine.Info.Announcement.IconFont;if(t>=0&&t<e.Icon.length){var a=e.Icon[t],i={Text:a.Text,HScreenText:a.HScreenText,Color:a.Color,Family:e.Family};return i}return Ma.KLine.Info.Announcement.IconFont},ii.GetIconFont=function(t){if(t>=dt.ANNOUNCEMENT_EX_START&&t<=dt.ANNOUNCEMENT_EX_END){var e=t-dt.ANNOUNCEMENT_EX_START;return ii.GetIconLibrary(e)}switch(t){case dt.INVESTOR:return Ma.KLine.Info.Investor.IconFont;case dt.PFORECAST:return Ma.KLine.Info.Pforecast.IconFont;case dt.ANNOUNCEMENT:return Ma.KLine.Info.Announcement.IconFont;case dt.ANNOUNCEMENT_QUARTER_1:case dt.ANNOUNCEMENT_QUARTER_2:case dt.ANNOUNCEMENT_QUARTER_3:case dt.ANNOUNCEMENT_QUARTER_4:return Ma.KLine.Info.Announcement.IconFont2;case dt.RESEARCH:return Ma.KLine.Info.Research.IconFont;case dt.BLOCKTRADING:return Ma.KLine.Info.BlockTrading.IconFont;case dt.TRADEDETAIL:return Ma.KLine.Info.TradeDetail.IconFont;default:return Ma.KLine.Info.Announcement.IconFont}},Ci.InfoMap=new g.default([["大盘异动",{Create:function(){return new ci}}]]),Ci.Get=function(t){return Ci.InfoMap.get(t)};var Li={SH:".SH",SZ:".SZ",SHO:".SHO",HK:".HK",FHK:".FHK",SHFE:".SHF",SHFE2:".SHFE",CFFEX:".CFE",DCE:".DCE",CZCE:".CZC",USA:".USA",FTSE:".FTSE",BIT:".BIT",BIZ:".BIZ",FOREX:".FOREX",NYMEX:".NYMEX",COMEX:".COMEX",NYBOT:".NYBOT",CBOT:".CBOT",LME:".LME",ET:".ET",IsET:function(t){return!!t&&t.indexOf(this.ET)>0},IsETShowAvPrice:function(t){return!1},IsNYMEX:function(t){return!!t&&t.indexOf(this.NYMEX)>0},IsCOMEX:function(t){return!!t&&t.indexOf(this.COMEX)>0},IsNYBOT:function(t){return!!t&&t.indexOf(this.NYBOT)>0},IsCBOT:function(t){return!!t&&t.indexOf(this.CBOT)>0},IsLME:function(t){return!!t&&t.indexOf(this.LME)>0},IsForeignExchange:function(t){return!!t&&t.indexOf(this.FOREX)>0},IsFTSE:function(t){return!!t&&t.indexOf(this.FTSE)>0},IsFHK:function(t){return!!t&&t.indexOf(this.FHK)>0},IsBIT:function(t){return!!t&&(t.indexOf(this.BIT)>0||t.indexOf(this.BIZ)>0)},IsUSA:function(t){return!!t&&t.indexOf(this.USA)>0},IsSH:function(t){var e=t.length-this.SH.length,a=t.indexOf(this.SH);return a==e},IsSZ:function(t){var e=t.length-this.SZ.length,a=t.indexOf(this.SZ);return a==e},IsSHO:function(t){var e=t.length-this.SHO.length,a=t.indexOf(this.SHO);return a==e},IsHK:function(t){var e=t.length-this.HK.length,a=t.indexOf(this.HK);return a==e},IsSHFE:function(t){return!!t&&(t.indexOf(this.SHFE)>0||t.indexOf(this.SHFE2)>0)},IsCFFEX:function(t){return!!t&&t.indexOf(this.CFFEX)>0},IsDCE:function(t){return!!t&&t.indexOf(this.DCE)>0},IsCZCE:function(t){return!!t&&t.indexOf(this.CZCE)>0},IsChinaFutures:function(t){return this.IsCFFEX(t)||this.IsCZCE(t)||this.IsDCE(t)||this.IsSHFE(t)},IsFutures:function(t){return this.IsChinaFutures(t)||this.IsNYMEX(t)||this.IsCOMEX(t)||this.IsNYBOT(t)||this.IsCBOT(t)||this.IsLME(t)},IsSHSZ:function(t){return this.IsSZ(t)||this.IsSH(t)},IsSHSZFund:function(t){if(!t)return!1;if(this.IsSH(t)){if("5"==t.charAt(0)&&"1"==t.charAt(1))return!0}else if(this.IsSZ(t)&&"1"==t.charAt(0)&&("5"==t.charAt(1)||"6"==t.charAt(1)||"7"==t.charAt(1)||"8"==t.charAt(1)))return!0;return!1},IsSHSZIndex:function(t){if(!t)return!1;var e=t.toUpperCase();if(this.IsSH(e)){var a=e.replace(".SH","");if("0"==e.charAt(0)&&parseInt(a)<=3e3)return!0}else if(this.IsSZ(e)){if("3"==e.charAt(0)&&"9"==e.charAt(1))return!0}else if(e.indexOf(".CI")>0)return!0;return!1},IsSHSZStockA:function(t){if(!t)return!1;var e=t.toUpperCase();if(this.IsSH(e)){e.replace(".SH","");if("6"==e.charAt(0))return!0}else if(this.IsSZ(e)&&"0"==e.charAt(0)){if("0"==e.charAt(1)&&"2"==e.charAt(2))return!0;if("7"!=e.charAt(1)&&"8"!=e.charAt(1))return!0}return!1},IsSHStockSTAR:function(t){if(!t)return!1;var e=t.toUpperCase();return!!this.IsSH(e)&&("6"==e.charAt(0)&&"8"==e.charAt(1)&&"8"==e.charAt(2))},GetMarketStatus:function(t){if(!t)return 0;var e=t.toUpperCase(),a=new Date,i=a.getDay(),r=100*a.getHours()+a.getMinutes();if(this.IsUSA(e)){var n=Wi(-4);i=n.getDay(),r=100*n.getHours()+n.getMinutes();return 6==i||0==i?0:r>1730?3:r<930?1:2}return this.IsBIT(e)?2:this.IsForeignExchange(e)?2:this.IsFTSE(e)?6==i||0==i?0:r>=830&&r<=2359?2:r>=0&&r<=500?2:0:this.IsFHK(e)?6==i||0==i?0:r>=900&&r<=2359?2:r>=0&&r<=320?2:0:this.IsET(e)?this.GetETMarketStatus(t):this.IsHK(e)?6==i||0==i?0:r>1630?3:r<925?1:2:this.IsNYMEX(e)?this.GetNYMEXMarketStatus(e):this.IsCOMEX(e)?this.GetCOMEXMarketStatus(e):this.IsNYBOT(e)?this.GetNYBOTMarketStatus(e):this.IsCBOT(e)?this.GetCBOTMarketStatus(e):this.IsLME(e)?this.GetLMEMarketStatus(e):6==i||0==i?0:r>1540?3:r<925?1:2},GetLimitPriceRange:function(t,e){return this.IsSHSZStockA(t)?this.IsSHStockSTAR(t)?{Max:.2,Min:-.2}:e?e.indexOf("ST")>=0?{Max:.05,Min:-.05}:{Max:.1,Min:-.1}:null:null},GetFHKDecimal:function(t){return 0},GetFTSEDecimal:function(t){return 0},GetBITDecimal:function(t){return 2},GetSHODecimal:function(t){return 4},GetETDecimal:function(t){return 2},GetForeignExchangeDecimal:function(t){return 4},GetNYMEXDecimal:function(t){return Hi.GetDecimal(t)},GetCOMEXDecimal:function(t){return Vi.GetDecimal(t)},GetNYBOTDecimal:function(t){return Gi.GetDecimal(t)},GetCBOTDecimal:function(t){return ki.GetDecimal(t)},GetLMEDecimal:function(t){return Yi.GetDecimal(t)},GetETMarketStatus:function(t){return 2},GetNYMEXMarketStatus:function(t){return Hi.GetMarketStatus(t)},GetCOMEXMarketStatus:function(t){return Vi.GetMarketStatus(t)},GetNYBOTMarketStatus:function(t){return Gi.GetMarketStatus(t)},GetCBOTMarketStatus:function(t){return ki.GetMarketStatus(t)},GetLMEMarketStatus:function(t){return Yi.GetMarketStatus(t)}};function Mi(){this.SHSZ=null,this.SHO=null,this.HK=null,this.Futures=new g.default,this.USA=null,this.FTSE=null,this.FHK=null,this.ForeEx=null,this.BIT=null,this.Initialize=function(){},this.GetET=function(t){throw{Name:"MinuteTimeStringData::GetET",Error:"not implement"}},this.GetSHSZ=function(){return this.SHSZ||(this.SHSZ=this.CreateSHSZData()),this.SHSZ},this.GetSHO=function(){return this.SHO||(this.SHO=this.CreateSHOData()),this.SHO},this.GetHK=function(){return this.HK||(this.HK=this.CreateHKData()),this.HK},this.GetFutures=function(t){if(!this.Futures.has(t.Name)){var e=this.CreateTimeData(t.Data);this.Futures.set(t.Name,e)}return this.Futures.get(t.Name)},this.GetUSA=function(){return this.USA||(this.USA=this.CreateUSAData(0)),this.USA},this.GetFTSE=function(){return this.FTSE||(this.FTSE=this.CreateFTSEData()),this.FTSE},this.GetFHK=function(){return this.FHK||(this.FHK=this.CreateFHKData()),this.FHK},this.GetForeignExchange=function(){return this.ForeEx||(this.ForeEx=this.CreateForeignExchangeData()),this.ForeEx},this.GetBIT=function(t){return this.BIT||(this.BIT=this.CreateBITData()),this.BIT},this.CreateSHSZData=function(){var t=[{Start:925,End:925},{Start:930,End:1130},{Start:1300,End:1500}];return this.CreateTimeData(t)},this.CreateSHOData=function(){var t=[{Start:930,End:1129},{Start:1300,End:1500}];return this.CreateTimeData(t)},this.CreateHKData=function(){var t=[{Start:930,End:1200},{Start:1300,End:1600}];return this.CreateTimeData(t)},this.CreateFTSEData=function(){var t=[{Start:1700,End:2359},{Start:0,End:445},{Start:900,End:1630}];return this.CreateTimeData(t)},this.CreateFHKData=function(){var t=[{Start:1715,End:2359},{Start:0,End:300},{Start:915,End:1200},{Start:1300,End:1630}];return this.CreateTimeData(t)},this.CreateUSAData=function(t){if(1==t){var e=[{Start:2130,End:2359},{Start:0,End:400}];return this.CreateTimeData(e)}if(2==t){var a=[{Start:2230,End:2359},{Start:0,End:500}];return this.CreateTimeData(a)}var i=[{Start:930,End:1600}];return this.CreateTimeData(i)},this.CreateForeignExchangeData=function(){var t=[{Start:600,End:2359},{Start:0,End:559}];return this.CreateTimeData(t)},this.CreateBITData=function(){var t=[{Start:600,End:2359},{Start:0,End:559}];return this.CreateTimeData(t)},this.CreateTimeData=function(t){var e=[];for(var a in t)for(var i=t[a],r=i.Start;r<=i.End;++r)r%100>=60||e.push(r);return e},this.GetTimeData=function(t){if(!t)return this.SHSZ;var e=t.toLocaleUpperCase();if(Li.IsSH(e)||Li.IsSZ(e))return this.GetSHSZ();if(Li.IsSHO(e))return this.GetSHO();if(Li.IsHK(e))return this.GetHK();if(Li.IsUSA(e))return this.GetUSA(!0);if(Li.IsCFFEX(e)||Li.IsCZCE(e)||Li.IsDCE(e)||Li.IsSHFE(e)){var a=_i.GetSplitData(e);return a?this.GetFutures(a):null}if(Li.IsFTSE(e))return this.GetFTSE();if(Li.IsFHK(e))return this.GetFHK();if(Li.IsForeignExchange(e))return this.GetForeignExchange();if(Li.IsET(e))return this.GetET(e);if(Li.IsBIT(e))return this.GetBIT(e);if(Li.IsNYMEX(e)){a=Hi.GetSplitData(e);return a?this.GetFutures(a):null}if(Li.IsCOMEX(e)){a=Vi.GetSplitData(e);return a?this.GetFutures(a):null}if(Li.IsNYBOT(e)){a=Gi.GetSplitData(e);return a?this.GetFutures(a):null}if(Li.IsCBOT(e)){a=ki.GetSplitData(e);return a?this.GetFutures(a):null}if(Li.IsLME(e)){a=Yi.GetSplitData(e);return a?this.GetFutures(a):null}}}function xi(){var t={Full:[[0,0,"rgb(200,200,200)","09:30"],[31,0,"RGB(200,200,200)","10:00"],[61,0,"RGB(200,200,200)","10:30"],[91,0,"RGB(200,200,200)","11:00"],[122,1,"RGB(200,200,200)","13:00"],[152,0,"RGB(200,200,200)","13:30"],[182,0,"RGB(200,200,200)","14:00"],[212,0,"RGB(200,200,200)","14:30"],[242,1,"RGB(200,200,200)","15:00"]],Simple:[[0,0,"rgb(200,200,200)","09:30"],[61,0,"RGB(200,200,200)","10:30"],[122,1,"RGB(200,200,200)","13:00"],[182,0,"RGB(200,200,200)","14:00"],[242,1,"RGB(200,200,200)","15:00"]],Min:[[0,0,"rgb(200,200,200)","09:30"],[122,1,"RGB(200,200,200)","13:00"],[242,1,"RGB(200,200,200)","15:00"]],Count:243,MiddleCount:122,GetData:function(t){return t<200?this.Min:t<400?this.Simple:this.Full}},e={Full:[[0,0,"rgb(200,200,200)","09:30"],[30,0,"RGB(200,200,200)","10:00"],[60,0,"RGB(200,200,200)","10:30"],[90,0,"RGB(200,200,200)","11:00"],[120,1,"RGB(200,200,200)","13:00"],[150,0,"RGB(200,200,200)","13:30"],[180,0,"RGB(200,200,200)","14:00"],[210,0,"RGB(200,200,200)","14:30"],[240,1,"RGB(200,200,200)","15:00"]],Simple:[[0,0,"rgb(200,200,200)","09:30"],[60,0,"RGB(200,200,200)","10:30"],[120,1,"RGB(200,200,200)","13:00"],[180,0,"RGB(200,200,200)","14:00"],[240,1,"RGB(200,200,200)","15:00"]],Min:[[0,0,"rgb(200,200,200)","09:30"],[120,1,"RGB(200,200,200)","13:00"],[240,1,"RGB(200,200,200)","15:00"]],Count:241,MiddleCount:120,GetData:function(t){return t<200?this.Min:t<400?this.Simple:this.Full}},a={Full:[[0,1,"RGB(200,200,200)","09:30"],[30,0,"RGB(200,200,200)","10:00"],[60,1,"RGB(200,200,200)","10:30"],[90,0,"RGB(200,200,200)","11:00"],[120,1,"RGB(200,200,200)","11:30"],[151,0,"RGB(200,200,200)","13:00"],[181,1,"RGB(200,200,200)","13:30"],[211,0,"RGB(200,200,200)","14:00"],[241,1,"RGB(200,200,200)","14:30"],[271,0,"RGB(200,200,200)","15:00"],[301,1,"RGB(200,200,200)","15:30"],[331,1,"RGB(200,200,200)","16:00"]],Simple:[[0,1,"RGB(200,200,200)","09:30"],[60,1,"RGB(200,200,200)","10:30"],[120,1,"RGB(200,200,200)","11:30"],[211,0,"RGB(200,200,200)","14:00"],[271,0,"RGB(200,200,200)","15:00"],[331,1,"RGB(200,200,200)","16:00"]],Min:[[0,1,"RGB(200,200,200)","09:30"],[151,0,"RGB(200,200,200)","13:00"],[331,1,"RGB(200,200,200)","16:00"]],Count:332,MiddleCount:151,GetData:function(t){return t<200?this.Min:t<450?this.Simple:this.Full}},i={Full:[[0,0,"rgb(200,200,200)","9:30"],[30,0,"RGB(200,200,200)","10:00"],[90,1,"RGB(200,200,200)","11:00"],[150,0,"RGB(200,200,200)","12:00"],[210,0,"RGB(200,200,200)","13:00"],[270,0,"RGB(200,200,200)","14:00"],[330,0,"RGB(200,200,200)","15:00"],[390,0,"RGB(200,200,200)","16:00"]],Simple:[[30,0,"rgb(200,200,200)","10:00"],[150,1,"RGB(200,200,200)","12:00"],[270,0,"RGB(200,200,200)","14:00"],[390,0,"RGB(200,200,200)","16:00"]],Min:[[30,0,"rgb(200,200,200)","10:00"],[210,1,"RGB(200,200,200)","13:00"],[390,0,"RGB(200,200,200)","16:00"]],Count:391,MiddleCount:211,GetData:function(t){return t<200?this.Min:t<400?this.Simple:this.Full}},r={Full:[[0,1,"RGB(200,200,200)","17:00"],[120,1,"RGB(200,200,200)","19:00"],[240,1,"RGB(200,200,200)","21:00"],[360,1,"RGB(200,200,200)","23:00"],[480,1,"RGB(200,200,200)","01:00"],[600,1,"RGB(200,200,200)","03:00"],[706,1,"RGB(200,200,200)","09:00"],[826,1,"RGB(200,200,200)","11:00"],[946,1,"RGB(200,200,200)","13:00"],[1066,1,"RGB(200,200,200)","15:00"],[1156,1,"RGB(200,200,200)","16:30"]],Simple:[[0,1,"RGB(200,200,200)","17:00"],[240,1,"RGB(200,200,200)","21:00"],[480,1,"RGB(200,200,200)","01:00"],[706,1,"RGB(200,200,200)","09:00"],[946,1,"RGB(200,200,200)","13:00"],[1156,1,"RGB(200,200,200)","16:30"]],Min:[[0,1,"RGB(200,200,200)","17:00"],[706,1,"RGB(200,200,200)","09:00"],[1156,1,"RGB(200,200,200)","16:30"]],Count:1157,MiddleCount:707,GetData:function(t){return t<200?this.Min:t<450?this.Simple:this.Full}},n={Full:[[0,1,"RGB(200,200,200)","17:15"],[105,1,"RGB(200,200,200)","19:00"],[225,1,"RGB(200,200,200)","21:00"],[345,1,"RGB(200,200,200)","23:00"],[586,0,"RGB(200,200,200)","09:15"],[691,1,"RGB(200,200,200)","11:00"],[812,1,"RGB(200,200,200)","14:00"],[963,1,"RGB(200,200,200)","16:30"]],Simple:[[0,1,"RGB(200,200,200)","17:15"],[225,1,"RGB(200,200,200)","21:00"],[586,0,"RGB(200,200,200)","09:15"],[752,1,"RGB(200,200,200)","13:00"],[963,1,"RGB(200,200,200)","16:30"]],Min:[[0,1,"RGB(200,200,200)","17:15"],[586,0,"RGB(200,200,200)","09:15"],[963,1,"RGB(200,200,200)","16:30"]],Count:963,MiddleCount:526,GetData:function(t){return t<200?this.Min:t<450?this.Simple:this.Full}},s={Full:[[0,1,"RGB(200,200,200)","06:00"],[120,1,"RGB(200,200,200)","08:00"],[240,1,"RGB(200,200,200)","10:00"],[360,1,"RGB(200,200,200)","12:00"],[480,0,"RGB(200,200,200)","14:00"],[600,1,"RGB(200,200,200)","16:00"],[720,1,"RGB(200,200,200)","18:00"],[840,1,"RGB(200,200,200)","20:00"],[960,1,"RGB(200,200,200)","22:00"],[1080,1,"RGB(200,200,200)","0:00"],[1200,1,"RGB(200,200,200)","02:00"],[1320,1,"RGB(200,200,200)","04:00"]],Simple:[[0,1,"RGB(200,200,200)","06:00"],[240,1,"RGB(200,200,200)","10:00"],[480,0,"RGB(200,200,200)","14:00"],[720,1,"RGB(200,200,200)","18:00"],[960,1,"RGB(200,200,200)","22:00"],[1200,1,"RGB(200,200,200)","02:00"]],Min:[[0,1,"RGB(200,200,200)","06:00"],[480,0,"RGB(200,200,200)","14:00"],[960,1,"RGB(200,200,200)","22:00"]],Count:1440,MiddleCount:600,GetData:function(t){return t<200?this.Min:t<450?this.Simple:this.Full}};this.GetCoordinateData=function(e,i){var r=null;if(e){var n=e.toLocaleUpperCase();if(Li.IsSH(n)||Li.IsSZ(n)||Li.IsSHSZIndex(n))r=this.GetSHSZData(n,i);else if(Li.IsSHO(n))r=this.GetSHOData(n,i);else if(Li.IsHK(n))r=a;else{if(Li.IsCFFEX(n)||Li.IsCZCE(n)||Li.IsDCE(n)||Li.IsSHFE(n))return this.GetChinatFuturesData(n,i);if(Li.IsUSA(n))r=this.GetUSAData(n,i);else if(Li.IsFTSE(n))r=this.GetFTSEData(n,i);else if(Li.IsFHK(n))r=this.GetFHKData(n,i);else if(Li.IsForeignExchange(n))r=this.GetForeignExchangeData(n,i);else if(Li.IsBIT(n,i))r=this.GetBITData(n,i);else if(Li.IsET(n))r=this.GetETData(n,i);else{if(Li.IsNYMEX(n,i))return this.GetNYMEXData(n,i);if(Li.IsCOMEX(n,i))return this.GetCOMEXData(n,i);if(Li.IsNYBOT(n,i))return this.GetNYBOTData(n,i);if(Li.IsCBOT(n,i))return this.GetCBOTData(n,i);if(Li.IsLME(n,i))return this.GetLMEData(n,i)}}}else r=t;var s={Count:r.Count,MiddleCount:r.MiddleCount,Data:r.GetData(i)};return s},this.GetSHSZData=function(e,a){var i=t;return i},this.GetUSAData=function(t,e){var a=i;return a},this.GetSHOData=function(t,a){var i=e;return i},this.GetFuturesData=function(t,e,a){var i=a.GetSplitData(t);if(!i)return null;var r=bi.GetFutures(i);if(!r)return null;var n={Count:r.length},s=null,o=200,h=480;s=e<o?i.Coordinate.Min:e<h?i.Coordinate.Simple:i.Coordinate.Full;for(var l=[],u=0;u<r.length;++u)for(var C=r[u],D=0;D<s.length;++D){var c=s[D];if(C==c.Value){var f=[u,0,"RGB(200,200,200)",c.Text];l.push(f);break}}return n.Data=l,n},this.GetChinatFuturesData=function(t,e){return this.GetFuturesData(t,e,_i)},this.GetNYMEXData=function(t,e){return this.GetFuturesData(t,e,Hi)},this.GetCOMEXData=function(t,e){return this.GetFuturesData(t,e,Vi)},this.GetNYBOTData=function(t,e){return this.GetFuturesData(t,e,Gi)},this.GetCBOTData=function(t,e){return this.GetFuturesData(t,e,ki)},this.GetLMEData=function(t,e){return this.GetFuturesData(t,e,Yi)},this.GetFTSEData=function(t,e){var a=r;return a},this.GetFHKData=function(t,e){var a=n;return a},this.GetForeignExchangeData=function(t,e){var a=s;return a},this.GetBITData=function(t,e){var a=s;return a},this.GetETData=function(t,e){throw{Name:"MinuteCoordinateData::GetETData",Error:"not implement"}}}function Ni(){this.TIME_SPLIT=[{Name:"9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:900,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1e3,Text:"10:00"},{Value:1330,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Min:[{Value:900,Text:"9:00"},{Value:1330,Text:"13:30"},{Value:1500,Text:"15:00"}]}},{Name:"9:15-11:30,13:00-15:15",Data:[{Start:915,End:1130},{Start:1301,End:1515}],Coordinate:{Full:[{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1515,Text:"15:15"}],Simple:[{Value:930,Text:"9:30"},{Value:1030,Text:"10:30"},{Value:1300,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1515,Text:"15:15"}],Min:[{Value:930,Text:"9:30"},{Value:1300,Text:"13:00"},{Value:1515,Text:"15:15"}]}},{Name:"9:30-11:30,13:00-15:00",Data:[{Start:930,End:1130},{Start:1301,End:1500}],Coordinate:{Full:[{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:930,Text:"9:30"},{Value:1030,Text:"10:30"},{Value:1300,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1500,Text:"15:00"}],Min:[{Value:930,Text:"9:30"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-23:30,9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:2100,End:2330},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-1:00,9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:2100,End:2359},{Start:0,End:100},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-2:30,9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:2100,End:2359},{Start:0,End:230},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-23:00,9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:2100,End:2300},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:1030,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1500,Text:"15:00"}]}}],this.MAP_TWOWORDS=new g.default([[Li.DCE+"-JD",{Time:0,Decimal:0,Name:"鸡蛋"}],[Li.DCE+"-FB",{Time:0,Decimal:2,Name:"纤板"}],[Li.DCE+"-BB",{Time:0,Decimal:2,Name:"胶板"}],[Li.DCE+"-PP",{Time:6,Decimal:0,Name:"丙烯"}],[Li.DCE+"-JM",{Time:6,Decimal:1,Name:"焦煤"}],[Li.DCE+"-EG",{Time:6,Decimal:0,Name:"乙二醇"}],[Li.DCE+"-EB",{Time:6,Decimal:0,Name:"苯乙烯"}],[Li.DCE+"-CS",{Time:6,Decimal:0,Name:"淀粉"}],[Li.DCE+"-PG",{Time:6,Decimal:0,Name:"液化气"}],[Li.DCE+"-RR",{Time:6,Decimal:0,Name:"梗米"}],[Li.SHFE+"-CU",{Time:4,Decimal:0}],[Li.SHFE+"-AL",{Time:4,Decimal:0}],[Li.SHFE+"-NI",{Time:4,Decimal:0}],[Li.SHFE+"-SN",{Time:4,Decimal:0}],[Li.SHFE+"-ZN",{Time:4,Decimal:0}],[Li.SHFE+"-PB",{Time:4,Decimal:0}],[Li.SHFE+"-RU",{Time:6,Decimal:0}],[Li.SHFE+"-FU",{Time:6,Decimal:0}],[Li.SHFE+"-RB",{Time:6,Decimal:0}],[Li.SHFE+"-BU",{Time:6,Decimal:0}],[Li.SHFE+"-HC",{Time:6,Decimal:0}],[Li.SHFE+"-SP",{Time:6,Decimal:0,Name:"纸浆"}],[Li.SHFE+"-WR",{Time:0,Decimal:0}],[Li.SHFE+"-AG",{Time:5,Decimal:0}],[Li.SHFE+"-AU",{Time:5,Decimal:2,Name:"黄金"}],[Li.SHFE+"-NR",{Time:5,Decimal:1}],[Li.SHFE+"-SC",{Time:5,Decimal:1}],[Li.CZCE+"-CF",{Time:6,Decimal:0,Name:"棉花"}],[Li.CZCE+"-SR",{Time:6,Decimal:0,Name:"油菜籽"}],[Li.CZCE+"-MA",{Time:6,Decimal:0,Name:"甲醇"}],[Li.CZCE+"-ZC",{Time:6,Decimal:1,Name:"动力煤"}],[Li.CZCE+"-TA",{Time:6,Decimal:0,Name:"精对苯二甲酸(PTA)"}],[Li.CZCE+"-RM",{Time:6,Decimal:0,Name:"菜籽粕"}],[Li.CZCE+"-OI",{Time:6,Decimal:0,Name:"菜籽油"}],[Li.CZCE+"-ME",{Time:3,Decimal:0,Name:"甲醇(老)"}],[Li.CZCE+"-FG",{Time:6,Decimal:0,Name:"平板玻璃"}],[Li.CZCE+"-WS",{Time:0,Decimal:0}],[Li.CZCE+"-WT",{Time:0,Decimal:0}],[Li.CZCE+"-GN",{Time:0,Decimal:0}],[Li.CZCE+"-RO",{Time:0,Decimal:0}],[Li.CZCE+"-RS",{Time:0,Decimal:0}],[Li.CZCE+"-ER",{Time:0,Decimal:0}],[Li.CZCE+"-RI",{Time:0,Decimal:0}],[Li.CZCE+"-WH",{Time:0,Decimal:0}],[Li.CZCE+"-AP",{Time:0,Decimal:0}],[Li.CZCE+"-PM",{Time:0,Decimal:0}],[Li.CZCE+"-QM",{Time:0,Decimal:0}],[Li.CZCE+"-TC",{Time:0,Decimal:0}],[Li.CZCE+"-JR",{Time:0,Decimal:0}],[Li.CZCE+"-LR",{Time:0,Decimal:0}],[Li.CZCE+"-SF",{Time:0,Decimal:0}],[Li.CZCE+"-SM",{Time:0,Decimal:0}],[Li.CFFEX+"-TF",{Time:1,Decimal:3}],[Li.CFFEX+"-TS",{Time:1,Decimal:3}],[Li.CFFEX+"-IH",{Time:2,Decimal:1}],[Li.CFFEX+"-IC",{Time:2,Decimal:1}],[Li.CFFEX+"-IF",{Time:2,Decimal:1}]]),this.MAP_ONEWORD=new g.default([[Li.DCE+"-C",{Time:6,Decimal:0,Name:"玉米"}],[Li.DCE+"-L",{Time:6,Decimal:0,Name:"乙烯"}],[Li.DCE+"-V",{Time:6,Decimal:0,Name:"PVC"}],[Li.DCE+"-A",{Time:6,Decimal:0,Name:"豆一"}],[Li.DCE+"-B",{Time:6,Decimal:0,Name:"豆二"}],[Li.DCE+"-M",{Time:6,Decimal:0,Name:"豆粕"}],[Li.DCE+"-Y",{Time:6,Decimal:0,Name:"豆油"}],[Li.DCE+"-P",{Time:6,Decimal:0,Name:"棕榈"}],[Li.DCE+"-J",{Time:6,Decimal:1,Name:"焦炭"}],[Li.DCE+"-I",{Time:6,Decimal:1,Name:"铁矿"}],[Li.CFFEX+"-T",{Time:1,Decimal:3}]]),this.AddNewFutures=function(t){if(t){var e=t.Suffix+"-"+t.Symbol,a={Time:t.Time,Decimal:t.Decimal,Name:t.Name};1==t.Symbol.length?this.MAP_ONEWORD.set(e,a):2==t.Symbol.length&&this.MAP_TWOWORDS.set(e,a)}},this.GetData=function(t){var e=t.charAt(0),a=t.substr(0,2),i=null,r=null;return Li.IsDCE(t)?(i=Li.DCE+"-"+e,r=Li.DCE+"-"+a):Li.IsSHFE(t)?(i=Li.SHFE+"-"+e,r=Li.SHFE+"-"+a):Li.IsCFFEX(t)?(i=Li.CFFEX+"-"+e,r=Li.CFFEX+"-"+a):Li.IsCZCE(t)&&(i=Li.CZCE+"-"+e,r=Li.CZCE+"-"+a),this.MAP_TWOWORDS.has(r)?this.MAP_TWOWORDS.get(r):this.MAP_ONEWORD.has(i)?this.MAP_ONEWORD.get(i):null},this.GetSplitData=function(t){var e=this.GetData(t);return e?this.TIME_SPLIT[e.Time]:null},this.GetDecimal=function(t){var e=this.GetData(t);return e?e.Decimal:2}}function Oi(){this.TIME_SPLIT=[{Name:"6:00-5:00",Data:[{Start:600,End:2359},{Start:0,End:500}],Coordinate:{Full:[{Value:600,Text:"6:00"},{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"},{Value:400,Text:"4:00"}],Simple:[{Value:600,Text:"6:00"},{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:600,Text:"6:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}}],this.TIME_SPLIT2=[{Name:"7:00-6:00",Data:[{Start:700,End:2359},{Start:0,End:600}],Coordinate:{Full:[{Value:700,Text:"7:00"},{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"},{Value:500,Text:"5:00"}],Simple:[{Value:700,Text:"7:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"},{Value:1900,Text:"19:00"},{Value:2300,Text:"23:00"},{Value:300,Text:"3:00"}],Min:[{Value:700,Text:"7:00"},{Value:1900,Text:"19:00"},{Value:500,Text:"5:00"}]}}],this.FUTURES_LIST=[{Symbol:"CL",Decimal:2,Time:0},{Symbol:"NG",Decimal:3,Time:0},{Symbol:"RB",Decimal:4,Time:0},{Symbol:"PL",Decimal:1,Time:0},{Symbol:"PA",Decimal:2,Time:0},{Symbol:"HR",Decimal:0,Time:0},{Symbol:"QM",Decimal:3,Time:0},{Symbol:"HO",Decimal:4,Time:0}],this.MarketSuffix=".NYMEX",this.TimeType=0,this.GetFuturesInfo=function(t){if(t.indexOf(this.MarketSuffix)<=0)return null;for(var e in this.FUTURES_LIST){var a=this.FUTURES_LIST[e];if(0==t.indexOf(a.Symbol))return a}return null},this.GetSplitData=function(t){var e=0==this.TimeType?this.TIME_SPLIT:this.TIME_SPLIT2,a=this.GetFuturesInfo(t);return a?e[a.Time]:e[0]},this.GetDecimal=function(t){var e=this.GetFuturesInfo(t);return e?e.Decimal:3},this.GetMarketStatus=function(t){var e=Wi(-4),a=new Date,i=e.getDay(),r=100*a.getHours()+a.getMinutes();return 6==i||0==i?0:r>430&&r<730?1:2}}function yi(){this.newMethod=Oi,this.newMethod(),delete this.newMethod,this.FUTURES_LIST=[{Symbol:"GC",Decimal:1,Time:0},{Symbol:"QO",Decimal:2,Time:0},{Symbol:"MG",Decimal:1,Time:0},{Symbol:"QI",Decimal:4,Time:0},{Symbol:"SI",Decimal:3,Time:0},{Symbol:"QI",Decimal:4,Time:0},{Symbol:"HG",Decimal:4,Time:0}],this.MarketSuffix=".COMEX"}function Ri(){this.newMethod=Oi,this.newMethod(),delete this.newMethod,this.TIME_SPLIT=[{Name:"9:00-2:20",Data:[{Start:900,End:2359},{Start:0,End:220}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:100,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1700,Text:"17:00"},{Value:100,Text:"1:00"}]}},{Name:"15:30-1:00",Data:[{Start:1530,End:2359},{Start:0,End:100}],Coordinate:{Full:[{Value:1600,Text:"16:00"},{Value:1700,Text:"17:00"},{Value:1800,Text:"18:00"},{Value:1900,Text:"19:00"},{Value:2e3,Text:"20:00"},{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:0,Text:"0:00"},{Value:100,Text:"1:00"}],Simple:[{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"}],Min:[{Value:1600,Text:"16:00"},{Value:2100,Text:"21:00"},{Value:100,Text:"1:00"}]}}],this.TIME_SPLIT2=[{Name:"10:00-3:20",Data:[{Start:1e3,End:2359},{Start:0,End:320}],Coordinate:{Full:[{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:1e3,Text:"10:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"16:30-2:00",Data:[{Start:1630,End:2359},{Start:0,End:200}],Coordinate:{Full:[{Value:1700,Text:"17:00"},{Value:1800,Text:"18:00"},{Value:1900,Text:"19:00"},{Value:2e3,Text:"20:00"},{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:0,Text:"0:00"},{Value:100,Text:"1:00"},{Value:200,Text:"2:00"}],Simple:[{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"}],Min:[{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:200,Text:"2:00"}]}}],this.FUTURES_LIST=[{Symbol:"SB",Decimal:2,Time:1},{Symbol:"CT",Decimal:2,Time:0}],this.MarketSuffix=".NYBOT",this.GetMarketStatus=function(t){var e=Wi(-4),a=e.getDay(),i=100*e.getHours()+e.getMinutes();if(6==a||0==a)return 0;var r=this.GetFuturesInfo(t);if(!r)return 2;if("SB"==r.Symbol){if(i>300&&i<1400)return 2}else if("CT"==r.Symbol)return i>=0&&i<=1500||i>=2e3&&i<=2359?2:1;return 0}}function Pi(){this.newMethod=Oi,this.newMethod(),delete this.newMethod,this.TIME_SPLIT=[{Name:"8:00-2:20",Data:[{Start:800,End:2359},{Start:0,End:220}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"8:00-2:45",Data:[{Start:800,End:2359},{Start:0,End:245}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"6:00-5:00",Data:[{Start:600,End:2359},{Start:0,End:500}],Coordinate:{Full:[{Value:600,Text:"6:00"},{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"},{Value:400,Text:"4:00"}],Simple:[{Value:600,Text:"6:00"},{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:600,Text:"6:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}}],this.TIME_SPLIT2=[{Name:"9:00-3:20",Data:[{Start:900,End:2359},{Start:0,End:320}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1900,Text:"19:00"},{Value:300,Text:"3:00"}]}},{Name:"9:00-3:45",Data:[{Start:900,End:2359},{Start:0,End:345}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1900,Text:"19:00"},{Value:300,Text:"3:00"}]}},{Name:"7:00-6:00",Data:[{Start:700,End:2359},{Start:0,End:600}],Coordinate:{Full:[{Value:700,Text:"7:00"},{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"},{Value:500,Text:"5:00"}],Simple:[{Value:700,Text:"7:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"},{Value:1900,Text:"19:00"},{Value:2300,Text:"23:00"},{Value:300,Text:"3:00"}],Min:[{Value:700,Text:"7:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}}],this.FUTURES_LIST=[{Symbol:"ZC",Decimal:2,Time:0},{Symbol:"XC",Decimal:2,Time:1},{Symbol:"ZS",Decimal:2,Time:0},{Symbol:"XK",Decimal:2,Time:1},{Symbol:"ZL",Decimal:2,Time:0},{Symbol:"ZR",Decimal:2,Time:0},{Symbol:"ZO",Decimal:2,Time:0},{Symbol:"ZW",Decimal:2,Time:0},{Symbol:"XW",Decimal:2,Time:1},{Symbol:"ZM",Decimal:1,Time:0},{Symbol:"EH",Decimal:3,Time:2},{Symbol:"YM",Decimal:0,Time:2},{Symbol:"ES",Decimal:2,Time:2},{Symbol:"NQ",Decimal:2,Time:2},{Symbol:"TY",Decimal:4,Time:2},{Symbol:"TU",Decimal:4,Time:2},{Symbol:"FV",Decimal:4,Time:2},{Symbol:"US",Decimal:4,Time:2},{Symbol:"UL",Decimal:4,Time:2}],this.MarketSuffix=".CBOT"}function wi(){this.newMethod=Oi,this.newMethod(),delete this.newMethod,this.TIME_SPLIT=[{Name:"LME 9:00-3:00",Data:[{Start:900,End:2359},{Start:0,End:300}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:100,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1800,Text:"18:00"},{Value:300,Text:"3:00"}]}}],this.TIME_SPLIT=[{Name:"LME 8:00-2:00",Data:[{Start:800,End:2359},{Start:0,End:200}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}}],this.FUTURES_LIST=[{Symbol:"SND",Decimal:0,Time:0},{Symbol:"AHD",Decimal:2,Time:0},{Symbol:"PBD",Decimal:2,Time:0},{Symbol:"ZSD",Decimal:2,Time:0},{Symbol:"CAD",Decimal:2,Time:0},{Symbol:"NID",Decimal:0,Time:0}],this.MarketSuffix=".LME"}var bi=new Mi,Bi=new xi,_i=new Ni,Hi=new Oi,Vi=new yi,Gi=new Ri,ki=new Pi,Yi=new wi;function Ui(t){var e=2;if(!t)return e;var a=t.toUpperCase();return Li.IsSHSZFund(a)?e=3:Li.IsSHO(a)?e=Li.GetSHODecimal(a):Li.IsChinaFutures(a)?e=_i.GetDecimal(a):Li.IsFHK(a)?e=Li.GetFHKDecimal(a):Li.IsFTSE(a)?e=Li.GetFTSEDecimal(a):Li.IsBIT(a)?e=Li.GetBITDecimal(a):Li.IsET(a)?e=Li.GetETDecimal(a):Li.IsForeignExchange(a)?e=Li.GetForeignExchangeDecimal(a):Li.IsNYMEX(a)?e=Hi.GetDecimal(a):Li.IsCOMEX(a)?e=Vi.GetDecimal(a):Li.IsNYBOT(a)?e=Gi.GetDecimal(a):Li.IsCBOT(a)&&(e=ki.GetDecimal(a)),e}function Wi(t){if("number"===typeof t){var e=new Date,a=e.getTime(),i=6e4*e.getTimezoneOffset(),r=a+i;return new Date(r+36e5*t)}}if(!M)M={Chart:{Log:console.log},Complier:{Log:console.log}};var Xi={Domain:"https://opensource.zealink.com",CacheDomain:"https://opensourcecache.zealink.com",DrawIcon:{Family:"iconfont",Data:new g.default([[1,{Text:"",Color:"rgb(255,106,106)"}],[2,{Text:"",Color:"rgb(46,139,87)"}],[11,{Text:"",Color:"rgb(245,159,40)"}],[12,{Text:"",Color:"rgb(245,159,40)"}],[13,{Text:"",Color:"rgb(209,37,35)"}],[14,{Text:"",Color:"rgb(127,209,59)"}],[9,{Text:"",Color:"rgb(245,159,40)"}],[36,{Text:"",Color:"rgb(255,106,106)"}],[37,{Text:"",Color:"rgb(46,139,87)"}],[38,{Text:"",Color:"rgb(238,44,44)"}],[39,{Text:"",Color:"rgb(0,139,69)"}],[46,{Text:"",Color:"rgb(51,51,51)"}]])},CustomDrawIcon:{Data:new g.default},CustomFunction:{Data:new g.default},CustomVariant:{Data:new g.default},GetDrawIcon:function(t){var e;if(Xi.CustomDrawIcon.Data.has(t)){var a=Xi.CustomDrawIcon.Data.get(t);return e={Symbol:a.Text,Color:a.Color,Family:a.Family,IconFont:!0,ID:t},e}if(Xi.DrawIcon.Data.has(t)){var i=Xi.DrawIcon.Data.get(t);return e={Symbol:i.Text,Color:i.Color,Family:Xi.DrawIcon.Family,IconFont:!0,ID:t},e}return null},IsCustomFunction:function(t){return!!Xi.CustomFunction.Data.has(t)},IsCustomVariant:function(t){return!!Xi.CustomVariant.Data.has(t)}},Ki={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"},Ji={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},zi={FromCodePoint:function(t){return t<65536?String.fromCharCode(t):String.fromCharCode(55296+(t-65536>>10))+String.fromCharCode(56320+(t-65536&1023))},IsWhiteSpace:function(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0},IsLineTerminator:function(t){return 10===t||13===t||8232===t||8233===t},IsIdentifierStart:function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&Ji.NonAsciiIdentifierStart.test(zi.FromCodePoint(t))},IsIdentifierPart:function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&Ji.NonAsciiIdentifierPart.test(zi.FromCodePoint(t))},IsDecimalDigit:function(t){return t>=48&&t<=57},IsHexDigit:function(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102},isOctalDigit:function(t){return t>=48&&t<=55}},qi={};function Zi(){this.Error=[],this.RecordError=function(t){this.Error.push(t)},this.ConstructError=function(t,e){var a=new Error(t);try{throw a}catch(i){c.default&&C.default&&(a=(0,c.default)(i),a.Column=e)}return a},this.CreateError=function(t,e,a,i){var r="Line "+e+": "+i,n=this.ConstructError(r,a);return n.Index=t,n.LineNumber=e,n.Description=i,n},this.ThrowError=function(t,e,a,i){var r=this.CreateError(t,e,a,i);throw r},this.ThrowDownloadJob=function(t,e,a,i,r){var n=this.CreateError(t,e,a,i);throw n.Job=r,n}}function Qi(t,e){this.Source=t,this.ErrorHandler=e,this.Length=t.length,this.Index=0,this.LineNumber=t.length>0?1:0,this.LineStart=0,this.CurlyStack=[],this.SaveState=function(){return{Index:this.Index,LineNumber:this.LineNumber,LineStart:this.LineStart}},this.RestoreState=function(t){this.Index=t.Index,this.LineNumber=t.LineNumber,this.LineStart=t.LineStart},this.IsEOF=function(){return this.Index>=this.Length},this.IsKeyword=function(t){return!1},this.CodePointAt=function(t){var e=this.Source.charCodeAt(t);if(e>=55296&&e<=56319){var a=this.Source.charCodeAt(t+1);if(a>=56320&&a<=57343){var i=e;e=1024*(i-55296)+a-56320+65536}}return e},this.Lex=function(){if(this.IsEOF())return{Type:2,Value:"",LineNumber:this.LineNumber,LineStart:this.LineStart,Start:this.Index,End:this.Index};var t=this.Source.charCodeAt(this.Index);return zi.IsIdentifierStart(t)?this.ScanIdentifier():40===t||41===t||59===t?this.ScanPunctuator():39===t||34===t?this.ScanStringLiteral():46==t?zi.IsDecimalDigit(this.Source.charCodeAt(this.Index+1))?this.ScanNumericLiteral():this.ScanPunctuator():zi.IsDecimalDigit(t)?this.ScanNumericLiteral():t>=55296&&t<57343&&zi.IsIdentifierStart(this.CodePointAt(this.Index))?this.ScanIdentifier():this.ScanPunctuator()},this.ScanIdentifier=function(){var t=void 0,e=this.Index,a=92===this.Source.charCodeAt(e)?this.GetComplexIdentifier():this.GetIdentifier();if(t=a.length?3:this.IsKeyword(a)?4:null==a?5:"true"==a||"false"==a?1:3,3!=t&&e+a.length!=this.Index){this.Index;throw this.Index=e,Ki.InvalidEscapedReservedWord}return"AND"!=a&&"OR"!=a||(t=7),{Type:t,Value:a,LineNumber:this.LineNumber,LineStart:this.LineStart,Start:e,End:this.Index}},this.GetIdentifier=function(){var t=this.Index++;while(!this.IsEOF()){var e=this.Source.charCodeAt(this.Index);if(92==e)return this.Index=t,this.GetComplexIdentifier();if(e>=55296&&e<57343)return this.Index=t,this.GetComplexIdentifier();if(!zi.IsIdentifierPart(e))break;++this.Index}return this.Source.slice(t,this.Index)},this.ScanPunctuator=function(){var t=this.Index,e=this.Source[this.Index];switch(e){case"(":++this.Index;break;case")":case";":case",":++this.Index;break;case".":++this.Index;break;default:e=this.Source.substr(this.Index,3),"AND"==e?this.Index+=3:(e=this.Source.substr(this.Index,2),"&&"===e||"||"===e||"=="===e||"!="===e||"<="===e||">="===e||"=>"===e||":="==e||"OR"==e||"<>"==e?this.Index+=2:(e=this.Source[this.Index],"<>=!+-*%&|^/:".indexOf(e)>=0&&++this.Index))}return this.Index==t&&this.ThrowUnecpectedToken(),{Type:7,Value:e,LineNumber:this.LineNumber,LineStart:this.LineStart,Start:t,End:this.Index}},this.ScanStringLiteral=function(){var t=this.Index,e=this.Source[this.Index];++this.Index;var a="";while(!this.IsEOF()){var i=this.Source[this.Index++];if(i==e){e="";break}if("\\"==i)throw"not complete";if(zi.IsLineTerminator(i.charCodeAt(0)))break;a+=i}return""!=e&&(this.Index=t,this.ThrowUnecpectedToken()),{Type:8,Value:a,LineNumber:this.LineNumber,LineStart:this.LineStart,Start:t,End:this.Index}},this.ScanNumericLiteral=function(){var t=this.Index,e=this.Source[this.Index],a="";if("."!=e){if(a=this.Source[this.Index++],e=this.Source[this.Index],"0"==a&&("x"==e||"X"==e))return++this.Index,this.ScanHexLiteral(t);while(zi.IsDecimalDigit(this.Source.charCodeAt(this.Index)))a+=this.Source[this.Index++];e=this.Source[this.Index]}if("."==e){a+=this.Source[this.Index++];while(zi.IsDecimalDigit(this.Source.charCodeAt(this.Index)))a+=this.Source[this.Index++];e=this.Source[this.Index]}if("e"==e||"E"==e)if(a+=this.Source[this.Index++],e=this.Source[this.Index],"+"!=e&&"-"!=e||(a+=this.Source[this.Index]),zi.IsDecimalDigit(this.Source.charCodeAt(this.Index)))while(zi.IsDecimalDigit(this.Source.charCodeAt(this.Index)))a+=this.Source[this.Index++];else this.ThrowUnecpectedToken();return zi.IsIdentifierStart(this.Source.charCodeAt(this.Index))&&this.ThrowUnecpectedToken(),{Type:6,Value:parseFloat(a),LineNumber:this.LineNumber,LineStart:this.LineStart,Start:t,End:this.Index}},this.ScanComments=function(){var t=void 0;this.Index;while(!this.IsEOF()){var e=this.Source.charCodeAt(this.Index);if(zi.IsWhiteSpace(e))++this.Index;else if(zi.IsLineTerminator(e))++this.Index,13==e&&10==this.Source.charCodeAt(this.Index)&&++this.Index,++this.LineNumber,this.LineStart=this.Index,!0;else if(47==e){if(e=this.Source.charCodeAt(this.Index+1),47!=e)break;this.Index+=2;this.SkipSingleLineComment(2);!0}else{if(123!=e)break;this.Index+=1;this.SkipMultiLineComment()}}return t},this.SkipMultiLineComment=function(){var t=[];while(!this.IsEOF()){var e=this.Source.charCodeAt(this.Index);if(zi.IsLineTerminator(e))++this.LineNumber,++this.Index,this.LineStart=this.Index;else{if(125==e)return this.Index+=1,t;++this.Index}}return t},this.SkipSingleLineComment=function(t){var e=[];while(!this.IsEOF()){var a=this.Source.charCodeAt(this.Index);if(++this.Index,zi.IsLineTerminator(a))return 13===a&&10===this.Source.charCodeAt(this.Index)&&++this.Index,++this.LineNumber,this.LineStart=this.Index,e}return e},this.ThrowUnecpectedToken=function(t){return t||(t=Ki.UnexpectedTokenIllegal),this.ErrorHandler.ThrowError(this.Index,this.LineNumber,this.Index-this.LineStart+1,t)}}function ji(t){this.ErrorHandler=new Zi,this.Scanner=new Qi(t,this.ErrorHandler),this.Buffer=[],this.GetNextToken=function(){if(0==this.Buffer.length){this.Scanner.ScanComments();if(!this.Scanner.IsEOF()){var t=this.Scanner.Lex(),e={Type:qi[t.Type],Value:this.Scanner.Source.slice(t.Start,t.End)};this.Buffer.push(e)}}return this.Buffer.shift()}}qi[1]="Boolean",qi[2]="<end>",qi[3]="Identifier",qi[4]="Keyword",qi[5]="Null",qi[6]="Numeric",qi[7]="Punctuator",qi[8]="String",qi[9]="RegularExpression",qi[10]="Template";var $i={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};function tr(){this.IsNeedIndexData=!1,this.IsNeedLatestIndexData=!1,this.IsNeedLatestData=!1,this.IsNeedSymbolData=!1,this.IsNeedSymbolDayData=!1,this.IsNeedFinanceData=new I.default,this.IsNeedMarginData=new I.default,this.IsNeedNewsAnalysisData=new I.default,this.NeedBlockIncreaseData=[],this.IsNeedSymbolExData=new I.default,this.NeedHK2SHSZData=[],this.IsNeedSectionFinance=new g.default,this.IsCustomFunction=[],this.IsCustomVariant=[],this.IsAPIData=[],this.ExecuteIndex=[],this.OtherSymbolData=[],this.GetDataJobList=function(){var t=[];for(var e in this.IsNeedSymbolData&&t.push({ID:or.JOB_DOWNLOAD_SYMBOL_DATA}),this.IsNeedIndexData&&t.push({ID:or.JOB_DOWNLOAD_INDEX_DATA}),this.IsNeedLatestData&&t.push({ID:or.JOB_DOWNLOAD_SYMBOL_LATEST_DATA}),this.IsNeedSymbolDayData&&t.push({ID:or.JOB_DOWNLOAD_SYMBOL_DAY_DATA}),this.IsNeedLatestIndexData&&t.push({ID:or.JOB_DOWNLOAD_LATEST_INDEX_DATA}),this.NeedBlockIncreaseData)t.push(this.NeedBlockIncreaseData[e]);var a=!0,i=!1,r=void 0;try{for(var n,s=(0,T.default)(this.IsNeedFinanceData);!(a=(n=s.next()).done);a=!0){var o=n.value;o==or.JOB_DOWNLOAD_DIVIDEND_YIELD_DATA&&t.push({ID:or.JOB_DOWNLOAD_MARKETVALUE_DATA}),t.push({ID:o})}}catch(O){i=!0,r=O}finally{try{!a&&s.return&&s.return()}finally{if(i)throw r}}var h=!0,l=!1,u=void 0;try{for(var C,D=(0,T.default)(this.IsNeedMarginData);!(h=(C=D.next()).done);h=!0){o=C.value;t.push({ID:o})}}catch(O){l=!0,u=O}finally{try{!h&&D.return&&D.return()}finally{if(l)throw u}}for(var e in this.NeedHK2SHSZData)t.push(this.NeedHK2SHSZData[e]);var c=!0,f=!1,d=void 0;try{for(var m,v=(0,T.default)(this.IsNeedNewsAnalysisData);!(c=(m=v.next()).done);c=!0){o=m.value;t.push({ID:o})}}catch(O){f=!0,d=O}finally{try{!c&&v.return&&v.return()}finally{if(f)throw d}}var S=!0,I=!1,p=void 0;try{for(var A,g=(0,T.default)(this.IsNeedSymbolExData);!(S=(A=g.next()).done);S=!0){o=A.value;t.push({ID:o})}}catch(O){I=!0,p=O}finally{try{!S&&g.return&&g.return()}finally{if(I)throw p}}var F=!0,E=!1,L=void 0;try{for(var M,x=(0,T.default)(this.IsNeedSectionFinance);!(F=(M=x.next()).done);F=!0){var N=M.value;t.push({ID:or.JOB_DOWNLOAD_SECTION_SF,SF:N})}}catch(O){E=!0,L=O}finally{try{!F&&x.return&&x.return()}finally{if(E)throw L}}for(var e in this.IsCustomVariant){N=this.IsCustomVariant[e];t.push({ID:N.ID,Name:N.Name})}for(var e in this.IsAPIData){N=this.IsAPIData[e];t.push(N)}for(var e in this.IsCustomFunction){N=this.IsCustomFunction[e];t.push(N)}for(var e in this.ExecuteIndex){N=this.ExecuteIndex[e];t.push(N)}for(var e in this.OtherSymbolData){N=this.OtherSymbolData[e];t.push(N)}return t},this.VerifySymbolVariable=function(t,e){var a=new I.default(["INDEXA","INDEXC","INDEXH","INDEXL","INDEXO","INDEXV","INDEXDEC","INDEXADV"]);if(a.has(t))this.IsNeedIndexData=!0;else{var i=new I.default(["CLOSE","C","VOL","V","OPEN","O","HIGH","H","LOW","L","AMOUNT","AMO","VOLINSTK"]);if(i.has(t))this.IsNeedSymbolData=!0;else if("VOLR"===t&&(this.IsNeedSymbolExData.has(or.JOB_DOWNLOAD_VOLR_DATA)||this.IsNeedSymbolExData.add(or.JOB_DOWNLOAD_VOLR_DATA)),"HYBLOCK"!=t&&"DYBLOCK"!=t&&"GNBLOCK"!=t||this.IsNeedSymbolExData.has(or.JOB_DOWNLOAD_GROUP_DATA)||this.IsNeedSymbolExData.add(or.JOB_DOWNLOAD_GROUP_DATA),"CAPITAL"===t&&(this.IsNeedFinanceData.has(or.JOB_DOWNLOAD_CAPITAL_DATA)||this.IsNeedFinanceData.add(or.JOB_DOWNLOAD_CAPITAL_DATA)),"EXCHANGE"===t&&(this.IsNeedFinanceData.has(or.JOB_DOWNLOAD_EXCHANGE_DATA)||this.IsNeedFinanceData.add(or.JOB_DOWNLOAD_EXCHANGE_DATA)),"FROMOPEN"!=t){if("ADVANCE"==t||"DECLINE"==t){var r={ID:or.JOB_DOWNLOAD_INDEX_INCREASE_DATA,IsSelfSymbol:!0,FunctionName:t};return e&&(r.Token={Index:e.Start,Line:e.LineNumber}),void this.NeedBlockIncreaseData.push(r)}if(Xi.IsCustomVariant(t)){r={Name:t,ID:or.JOB_CUSTOM_VARIANT_DATA};this.IsCustomVariant.push(r)}}else this.IsNeedLatestIndexData=!0}},this.VerifySymbolFunction=function(t,e,a){if(Xi.IsCustomFunction(t.Name)){var i={Name:t.Name,ID:or.JOB_CUSTOM_FUNCTION_DATA,Args:e};return a&&(i.Token={Index:a.Start,Line:a.LineNumber}),void this.IsCustomFunction.push(i)}if("DYNAINFO"!=t.Name)if("FINANCE"!=t.Name)if("MARGIN"!==t.Name)if("NEWS"!==t.Name){if("HK2SHSZ"===t.Name){i={ID:or.JOB_DOWNLOAD_HK_TO_SHSZ,Args:e,FunctionName:t.Name};return a&&(i.Token={Index:a.Start,Line:a.LineNumber}),void this.NeedHK2SHSZData.push(i)}if("COST"!=t.Name&&"WINNER"!=t.Name&&"PPART"!=t.Name&&"COSTEX"!=t.Name&&"LWINNER"!=t.Name&&"PWINNER"!=t.Name)if("BETA"!==t.Name){if("UPCOUNT"==t.Name||"DOWNCOUNT"==t.Name){i={ID:or.JOB_DOWNLOAD_INDEX_INCREASE_DATA,Args:e,FunctionName:t.Name};return a&&(i.Token={Index:a.Start,Line:a.LineNumber}),void this.NeedBlockIncreaseData.push(i)}if("STKINDI"==t.Name){i={ID:or.JOB_EXECUTE_INDEX,Args:e,FunctionName:t.Name};return a&&(i.Token={Index:a.Start,Line:a.LineNumber}),void this.ExecuteIndex.push(i)}if("COVER_C"!=t.Name&&"COVER_O"!=t.Name&&"COVER_H"!=t.Name&&"COVER_L"!=t.Name&&"COVER_A"!=t.Name&&"COVER_V"!=t.Name)if("SF"!=t.Name){if("LOADAPIDATA"==t.Name){i={Name:t.Name,ID:or.JOB_DOWNLOAD_CUSTOM_API_DATA,Args:e};return a&&(i.Token={Index:a.Start,Line:a.LineNumber}),void this.IsAPIData.push(i)}var r=new I.default(["CLOSE","VOL","V","OPEN","O","HIGH","H","LOW","L","AMOUNT","AMO","VOLINSTK"]);if(r.has(t.Name)){i={Name:t.Name,ID:or.JOB_DOWNLOAD_OTHER_SYMBOL_DATA,Args:e};return a&&(i.Token={Index:a.Start,Line:a.LineNumber}),void this.OtherSymbolData.push(i)}}else{var n=or.GetSectionReportPeriod(e[0].Value,e[1].Value);if(!n)return;var s=or.GetSectionFinanceID(e[2].Value);if(!s)return;var o=n.Year+"-"+n.Quarter;if(this.IsNeedSectionFinance.has(o)){h=this.IsNeedSectionFinance.get(o);h.Fields.has(s)||h.Fields.add(s)}else{var h={Period:n,Fields:new I.default([s])};this.IsNeedSectionFinance.set(o,h)}}else{var l=e[0].Value;"DAY"!=l&&"WEEK"!=l&&"YEAR"!=l&&"MONTH"!=l||(this.IsNeedSymbolDayData=!0)}}else this.IsNeedIndexData=!0;else this.IsNeedFinanceData.has(or.JOB_DOWNLOAD_FLOW_EQUITY_DATA)||this.IsNeedFinanceData.add(or.JOB_DOWNLOAD_FLOW_EQUITY_DATA)}else{var u=or.GetNewsAnalysisID(e[0].Value);u&&!this.IsNeedNewsAnalysisData.has(u)&&this.IsNeedNewsAnalysisData.add(u)}else{var C=or.GetMarginJobID(e[0].Value);C&&!this.IsNeedMarginData.has(C)&&this.IsNeedMarginData.add(C)}else{var D=or.GetFinnanceJobID(e[0].Value);D&&!this.IsNeedFinanceData.has(D)&&this.IsNeedFinanceData.add(D)}else this.IsNeedLatestData=!0},this.ExpressionStatement=function(t){return{Type:$i.ExpressionStatement,Expression:t}},this.Script=function(t){return{Type:$i.Program,Body:t,SourceType:"通达信脚本"}},this.SequenceExpression=function(t){return{Type:$i.SequenceExpression,Expression:t}},this.BinaryExpression=function(t,e,a){var i="||"===t||"&&"===t||"AND"==t||"OR"==t,r=i?$i.LogicalExpression:$i.BinaryExpression;return{Type:r,Operator:t,Left:e,Right:a}},this.Literal=function(t,e){return{Type:$i.Literal,Value:t,Raw:e}},this.Identifier=function(t,e){return this.VerifySymbolVariable(t,e),{Type:$i.Identifier,Name:t}},this.AssignmentExpression=function(t,e,a){return{Type:$i.AssignmentExpression,Operator:t,Left:e,Right:a}},this.UnaryExpression=function(t,e){return{Type:$i.UnaryExpression,Operator:t,Argument:e,Prefix:!0}},this.EmptyStatement=function(){return{Type:$i.EmptyStatement}},this.CallExpression=function(t,e,a){return this.VerifySymbolFunction(t,e,a),{Type:$i.CallExpression,Callee:t,Arguments:e}},this.StaticMemberExpression=function(t,e){return{Type:$i.MemberExpression,Computed:!1,Object:t,Property:e}}}function er(t){this.ErrorHandler=new Zi,this.Scanner=new Qi(t,this.ErrorHandler),this.Node=new tr,this.LookAhead={Type:2,Value:"",LineNumber:this.Scanner.LineNumber,LineStart:0,Start:0,End:0},this.HasLineTerminator=!1,this.Context={IsModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,FirstCoverInitializedNameError:null,IsAssignmentTarget:!1,IsBindingElement:!1,InFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},Strict:!1},this.PeratorPrecedence={")":0,";":0,",":0,"]":0,"||":1,OR:1,"&&":2,AND:2,"|":3,"^":4,"&":5,"==":6,"=":6,"!=":6,"<>":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.StartMarker={Index:0,Line:this.Scanner.LineNumber,Column:0},this.LastMarker={Index:0,Line:this.Scanner.LineNumber,Column:0},this.Initialize=function(){this.NextToken(),this.LastMarker={Index:this.Scanner.Index,Line:this.Scanner.LineNumber,Column:this.Scanner.Index-this.Scanner.LineStart}},this.CreateNode=function(){return{Index:this.StartMarker.Index,Line:this.StartMarker.Line,Column:this.StartMarker.Column}},this.StartNode=function(t,e){void 0==e&&(e=0);var a=t.Start-t.LineStart,i=t.LineNumber;return a<0&&(a+=e,i--),{Index:t.Start,Line:i,Column:a}},this.Match=function(t){return 7==this.LookAhead.Type&&this.LookAhead.Value==t},this.Expect=function(t){var e=this.NextToken();7==e.Type&&e.Value==t||this.ThrowUnexpectedToken(e)},this.MatchAssign=function(){if(7!=this.LookAhead.Type)return!1;var t=this.LookAhead.Value;return":"==t||":="==t},this.GetTokenRaw=function(t){return this.Scanner.Source.slice(t.Start,t.End)},this.NextToken=function(){var t=this.LookAhead;this.LastMarker.Index=this.Scanner.Index,this.LastMarker.Line=this.Scanner.LineNumber,this.LastMarker.Column=this.Scanner.Index-this.Scanner.LineStart,this.CollectComments(),this.Scanner.Index!==this.StartMarker.Index&&(this.StartMarker.Index=this.Scanner.Index,this.StartMarker.Line=this.Scanner.LineNumber,this.StartMarker.Column=this.Scanner.Index-this.Scanner.LineStart);var e=this.Scanner.Lex();return this.HasLineTerminator=t.LineNumber!=e.LineNumber,e&&this.Context.Strict&&e.Type,this.LookAhead=e,t},this.CollectComments=function(){this.Scanner.ScanComments()},this.ParseScript=function(){var t=this.CreateNode(),e=this.ParseDirectivePrologues();while(2!=this.LookAhead.Type)e.push(this.ParseStatementListItem());return this.Finalize(t,this.Node.Script(e))},this.ParseDirective=function(){this.LookAhead,this.CreateNode(),this.ParseExpression()},this.ParseDirectivePrologues=function(){var t=[];while(1){var e=this.LookAhead;if(8!=e.Type)break;var a=this.ParseDirective();t.push(a)}return t},this.ParseStatementListItem=function(){var t=void 0;return this.Context.IsAssignmentTarget=!0,this.Context.IsBindingElement=!0,4==this.LookAhead.Type||(t=this.ParseStatement()),t},this.ParseStatement=function(){var t=void 0;switch(this.LookAhead.Type){case 1:case 5:case 6:case 8:case 10:case 9:t=this.ParseExpressionStatement();break;case 7:var e=this.LookAhead.Value;t="("===e?this.ParseExpressionStatement():";"===e?this.ParseEmptyStatement():this.ParseExpressionStatement();break;case 3:t=this.ParseLabelledStatement();break;case 4:break;default:t="error"}return t},this.ParseEmptyStatement=function(){var t=this.CreateNode();return this.Expect(";"),this.Finalize(t,this.Node.EmptyStatement())},this.ParseLabelledStatement=function(){var t=this.CreateNode(),e=this.ParseExpression();this.ConsumeSemicolon();var a=new this.Node.ExpressionStatement(e);return this.Finalize(t,a)},this.ParseExpression=function(){var t=this.LookAhead,e=this.IsolateCoverGrammar(this.ParseAssignmentExpression);if(this.Match(",")){var a=[];a.push(e);while(2!=this.LookAhead.Type){if(!this.Match(","))break;this.NextToken(),a.push(this.IsolateCoverGrammar(this.ParseAssignmentExpression))}e=this.Finalize(this.StartNode(t),this.Node.SequenceExpression(a))}return e},this.ParseAssignmentExpression=function(){var t=void 0,e=this.LookAhead,a=e;if(t=this.ParseConditionalExpression(),this.MatchAssign()){if(!this.Context.IsAssignmentTarget){var i=t.Marker;this.ThrowUnexpectedError(i.Index,i.Line,i.Column,Ki.InvalidLHSInAssignment)}this.Match("=")||this.Match(":")?this.ReinterpretExpressionAsPattern(t):(this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1),a=this.NextToken();var r=a.Value,n=this.IsolateCoverGrammar(this.ParseAssignmentExpression);t=this.Finalize(this.StartNode(e),this.Node.AssignmentExpression(r,t,n)),this.Context.FirstCoverInitializedNameError=null}return t},this.ParseConditionalExpression=function(){this.LookAhead;var t=this.InheritCoverGrammar(this.ParseBinaryExpression);return t},this.ParseBinaryExpression=function(){var t=this.LookAhead,e=this.InheritCoverGrammar(this.ParseExponentiationExpression),a=this.LookAhead,i=this.BinaryPrecedence(a);if(i>0){this.NextToken(),this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1;var r=[t,this.LookAhead],n=e,s=this.IsolateCoverGrammar(this.ParseExponentiationExpression),o=[n,a.Value,s],h=[i];while(1){if(i=this.BinaryPrecedence(this.LookAhead),i<=0)break;while(o.length>2&&i<=h[h.length-1]){s=o.pop();var l=o.pop();h.pop(),n=o.pop(),r.pop();var u=this.StartNode(r[r.length-1]);o.push(this.Finalize(u,this.Node.BinaryExpression(l,n,s)))}o.push(this.NextToken().Value),h.push(i),r.push(this.LookAhead),o.push(this.IsolateCoverGrammar(this.ParseExponentiationExpression))}var C=o.length-1;e=o[C];var D=r.pop();while(C>1){var c=r.pop(),f=D&&D.LineStart,d=this.StartNode(c,f),m=o[C-1];e=this.Finalize(d,this.Node.BinaryExpression(m,o[C-2],e)),C-=2,D=c}}return e},this.ParseExponentiationExpression=function(){this.LookAhead;var t=this.InheritCoverGrammar(this.ParseUnaryExpression);return t},this.ParseUnaryExpression=function(){var t=void 0;if(this.Match("+")||this.Match("-")){var e=this.StartNode(this.LookAhead),a=this.NextToken();t=this.InheritCoverGrammar(this.ParseUnaryExpression),t=this.Finalize(e,this.Node.UnaryExpression(a.Value,t)),this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1}else t=this.ParseUpdateExpression();return t},this.ParseUpdateExpression=function(){var t=void 0;this.LookAhead;return t=this.InheritCoverGrammar(this.ParseLeftHandSideExpressionAllowCall),t},this.ParseLeftHandSideExpressionAllowCall=function(){var t=this.LookAhead,e=void 0;e=this.InheritCoverGrammar(this.ParsePrimaryExpression);while(1)if(this.Match(".")){this.Context.IsBindingElement=!1,this.Context.IsAssignmentTarget=!0,this.Expect(".");var a=this.ParseIdentifierName();e=this.Finalize(this.StartNode(t),this.Node.StaticMemberExpression(e,a))}else{if(!this.Match("("))break;this.Context.IsBindingElement=!1,this.Context.IsAssignmentTarget=!1;var i=this.ParseArguments();e=this.Finalize(this.StartNode(t),this.Node.CallExpression(e,i,t))}return e},this.IsIdentifierName=function(t){return 3===t.Type||4===t.Type||1===t.Type||5===t.Type},this.ParseIdentifierName=function(){var t=this.CreateNode(),e=this.NextToken();return this.IsIdentifierName(e)||this.ThrowUnexpectedToken(e),this.Finalize(t,this.Node.Identifier(e.Value,e))},this.ParseArguments=function(){this.Expect("(");var t=[];if(!this.Match(")"))while(1){var e=this.IsolateCoverGrammar(this.ParseAssignmentExpression);if(t.push(e),this.Match(")"))break;if(this.ExpectCommaSeparator(),this.Match(")"))break}return this.Expect(")"),t},this.ExpectCommaSeparator=function(){this.Expect(",")},this.ParsePrimaryExpression=function(){var t,e,a=this.CreateNode(),i=void 0;switch(this.LookAhead.Type){case 3:t=this.NextToken(),i=this.Finalize(a,this.Node.Identifier(t.Value,t));break;case 6:case 8:this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1,t=this.NextToken(),e=this.GetTokenRaw(t),i=this.Finalize(a,this.Node.Literal(t.Value,e));break;case 7:switch(this.LookAhead.Value){case"(":this.Context.IsBindingElement=!1,i=this.InheritCoverGrammar(this.ParseGroupExpression);break;default:i=this.ThrowUnexpectedToken(this.NextToken())}break;default:i=this.ThrowUnexpectedToken(this.NextToken())}return i},this.ParseGroupExpression=function(){var t=void 0;if(this.Expect("("),this.Match(")"))this.NextToken();else{this.LookAhead;var e=!1;if(this.Context.IsBindingElement=!0,t=this.InheritCoverGrammar(this.ParseAssignmentExpression),this.Match(",")){var a=[];this.Context.IsAssignmentTarget=!1,a.push(t);while(2!=this.LookAhead.Type){if(!this.Match(","))break;this.NextToken(),this.Match(")")}}e||(this.Expect(")"),this.Context.IsBindingElement=!1)}return t},this.ParseExpressionStatement=function(){var t=this.CreateNode(),e=this.ParseExpression();return this.ConsumeSemicolon(),this.Finalize(t,this.Node.ExpressionStatement(e))},this.ConsumeSemicolon=function(){this.Match(";")?this.NextToken():this.HasLineTerminator||(this.LastMarker.Index=this.StartMarker.Index,this.LastMarker.Line=this.StartMarker.Line,this.LastMarker.Column=this.StartMarker.Column)},this.ReinterpretExpressionAsPattern=function(t){switch(t.Type){case $i.Identifier:case $i.MemberExpression:case $i.AssignmentExpression:break;default:break}},this.Finalize=function(t,e){return e.Marker={Line:t.Line,Column:t.Column,Index:t.Index},e},this.BinaryPrecedence=function(t){var e=t.Value,a=void 0;return a=7===t.Type&&this.PeratorPrecedence[e]||0,a},this.IsolateCoverGrammar=function(t){var e=this.Context.IsBindingElement,a=this.Context.IsAssignmentTarget,i=this.Context.FirstCoverInitializedNameError;this.Context.IsBindingElement=!0,this.Context.IsAssignmentTarget=!0,this.Context.FirstCoverInitializedNameError=null;var r=t.call(this);return this.Context.FirstCoverInitializedNameError,this.Context.IsBindingElement=e,this.Context.IsAssignmentTarget=a,this.Context.FirstCoverInitializedNameError=i,r},this.InheritCoverGrammar=function(t){var e=this.Context.IsBindingElement,a=this.Context.IsAssignmentTarget,i=this.Context.FirstCoverInitializedNameError;this.Context.IsBindingElement=!0,this.Context.IsAssignmentTarget=!0,this.Context.FirstCoverInitializedNameError=null;var r=t.call(this);return this.Context.IsBindingElement=this.Context.IsBindingElement&&e,this.Context.IsAssignmentTarget=this.Context.IsAssignmentTarget&&a,this.Context.FirstCoverInitializedNameError=i||this.Context.FirstCoverInitializedNameError,r},this.ThrowUnexpectedToken=function(t,e){throw this.UnexpectedTokenError(t,e)},this.ThrowUnexpectedError=function(t,e,a,i){var r=i||"执行异常";return this.ErrorHandler.ThrowError(t,e,a,r)},this.UnexpectedTokenError=function(t,e){var a=e||Ki.UnexpectedToken,i="ILLEGAL";if(t&&(i=t.Value),a=a.replace("%0",i),t&&"number"==typeof t.LineNumber){var r=t.Start,n=t.LineNumber,s=this.LastMarker.Index-this.LastMarker.Column,o=t.Start-s+1;return this.ErrorHandler.CreateError(r,n,o,a)}var h=this.LastMarker.Index,l=this.LastMarker.Line,u=this.LastMarker.Column+1;return this.ErrorHandler.CreateError(h,l,u,a)}}function ar(t,e){this.ErrorHandler=t,this.SymbolData=e,this.Add=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return t+e;var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&this.IsNumber(t[s])&&this.IsNumber(e[s])&&(r[s]=t[s]+e[s]);return r}var o=void 0,h=void 0;for(var l in a?(o=t,h=e):(o=e,h=t),h)r[l]=null,this.IsNumber(h[l])&&this.IsNumber(o)&&(r[l]=o+h[l]);return r},this.Subtract=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return t-e;var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&this.IsNumber(t[s])&&this.IsNumber(e[s])&&(r[s]=t[s]-e[s]);return r}if(a)for(var o in e)r[o]=null,this.IsNumber(t)&&this.IsNumber(e[o])&&(r[o]=t-e[o]);else for(var h in t)r[h]=null,this.IsNumber(t[h])&&this.IsNumber(e)&&(r[h]=t[h]-e);return r},this.Multiply=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return t*e;var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&this.IsNumber(t[s])&&this.IsNumber(e[s])&&(r[s]=t[s]*e[s]);return r}var o=void 0,h=void 0;for(var l in a?(o=t,h=e):(o=e,h=t),h)r[l]=null,this.IsNumber(h[l])&&this.IsNumber(o)&&(r[l]=o*h[l]);return r},this.Divide=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return 0==e?null:t/e;var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&this.IsNumber(t[s])&&this.IsDivideNumber(e[s])&&(r[s]=t[s]/e[s]);return r}if(a)for(var o in e)r[o]=null,this.IsNumber(t)&&this.IsDivideNumber(e[o])&&(r[o]=t/e[o]);else for(var h in t)r[h]=null,this.IsNumber(t[h])&&this.IsDivideNumber(e)&&(r[h]=t[h]/e);return r},this.GT=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return t>e?1:0;var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&(isNaN(t[s])||isNaN(e[s])||(r[s]=t[s]>e[s]?1:0));return r}if(a)for(var o in e)r[o]=null,isNaN(t)||isNaN(e[o])||(r[o]=t>e[o]?1:0);else for(var h in t)r[h]=null,isNaN(t[h])||isNaN(e)||(r[h]=t[h]>e?1:0);return r},this.GTE=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return t>=e?1:0;var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&(isNaN(t[s])||isNaN(e[s])||(r[s]=t[s]>=e[s]?1:0));return r}if(a)for(var o in e)r[o]=null,isNaN(t)||isNaN(e[o])||(r[o]=t>=e[o]?1:0);else for(var h in t)r[h]=null,isNaN(t[h])||isNaN(e)||(r[h]=t[h]>=e?1:0);return r},this.LT=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return t<e?1:0;var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&(isNaN(t[s])||isNaN(e[s])||(r[s]=t[s]<e[s]?1:0));return r}if(a)for(var o in e)r[o]=null,isNaN(t)||isNaN(e[o])||(r[o]=t<e[o]?1:0);else for(var h in t)r[h]=null,isNaN(t[h])||isNaN(e)||(r[h]=t[h]<e?1:0);return r},this.LTE=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return t>=e?1:0;var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&(isNaN(t[s])||isNaN(e[s])||(r[s]=t[s]<=e[s]?1:0));return r}if(a)for(var o in e)r[o]=null,isNaN(t)||isNaN(e[o])||(r[o]=t<=e[o]?1:0);else for(var h in t)r[h]=null,isNaN(t[h])||isNaN(e)||(r[h]=t[h]<=e?1:0);return r},this.EQ=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return t==e?1:0;var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&(isNaN(t[s])||isNaN(e[s])||(r[s]=t[s]==e[s]?1:0));return r}if(a)for(var o in e)r[o]=null,isNaN(t)||isNaN(e[o])||(r[o]=t==e[o]?1:0);else for(var h in t)r[h]=null,isNaN(t[h])||isNaN(e)||(r[h]=t[h]==e?1:0);return r},this.NEQ=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return t!=e?1:0;var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&(isNaN(t[s])||isNaN(e[s])||(r[s]=t[s]!=e[s]?1:0));return r}if(a)for(var o in e)r[o]=null,isNaN(t)||isNaN(e[o])||(r[o]=t!=e[o]?1:0);else for(var h in t)r[h]=null,isNaN(t[h])||isNaN(e)||(r[h]=t[h]!=e?1:0);return r},this.And=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return t&&e?1:0;var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&(isNaN(t[s])||isNaN(e[s])||(r[s]=t[s]&&e[s]?1:0));return r}if(a)for(var o in e)r[o]=null,isNaN(t)||isNaN(e[o])||(r[o]=t&&e[o]?1:0);else for(var h in t)r[h]=null,isNaN(t[h])||isNaN(e)||(r[h]=t[h]&&e?1:0);return r},this.Or=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return t||e?1:0;var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&(isNaN(t[s])||isNaN(e[s])||(r[s]=t[s]||e[s]?1:0));return r}if(a)for(var o in e)r[o]=null,isNaN(t)||isNaN(e[o])||(r[o]=t||e[o]?1:0);else for(var h in t)r[h]=null,isNaN(t[h])||isNaN(e)||(r[h]=t[h]||e?1:0);return r},this.IF=function(t,e,a){var i="number"==typeof t,r="number"==typeof e,n="number"==typeof a;if(i)return t?e:a;var s=[];for(var o in t)t[o]?s[o]=r?e:e[o]:s[o]=n?a:a[o];return s},this.IFN=function(t,e,a){return this.IF(t,a,e)},this.REF=function(t,e){var a=[];if("number"==typeof e){if(t.length<=0)return a;if(e>=t.length)return a;a=t.slice(0,t.length-e);for(var i=t[0],r=0;r<e;++r)a.unshift(i)}else for(var n=0;n<t.length;++n)if(a[n]=null,!(n>=e.length)){var s=e[n];a[n]=s>=0&&s<=n?t[n-s]:n?a[n-1]:t[n]}return a},this.REFV=function(t,e){var a=[];if("number"==typeof e){if(t.length<=0)return a;if(e>=t.length)return a;a=t.slice(0,t.length-e);for(var i=0;i<e;++i)a.unshift(null)}else for(var r=0;r<t.length;++r)if(a[r]=null,!(r>=e.length)){var n=e[r];n>=0&&n<=r&&(a[r]=t[r-n])}return a},this.REFX=function(t,e){var a=[];if("number"==typeof e){if(t.length<=0)return a;if(e>=t.length)return a;a=t.slice(e,t.length);for(var i=t[t.length-1],r=0;r<e;++r)a.push(i)}else for(var n=t.length,s=0;s<t.length;++s)if(a[s]=null,!(s>=e.length)){var o=e[s];a[s]=o>=0&&o+s<n?t[s+o]:s?a[s-1]:t[s]}return a},this.REFXV=function(t,e){var a=[];if("number"==typeof e){if(t.length<=0)return a;if(e>=t.length)return a;a=t.slice(e,t.length);for(var i=0;i<e;++i)a.push(null)}else for(var r=t.length,n=0;n<t.length;++n)if(a[n]=null,!(n>=e.length)){var s=e[n];s>=0&&s+n<r&&(a[n]=t[n+s])}return a},this.MAX=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return Math.max(t,e);var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&(isNaN(t[s])||isNaN(e[s])||(r[s]=Math.max(t[s],e[s])));return r}if(a)for(var o in e)r[o]=null,isNaN(t)||isNaN(e[o])||(r[o]=Math.max(t,e[o]));else for(var h in t)r[h]=null,isNaN(t[h])||isNaN(e)||(r[h]=Math.max(t[h],e));return r},this.MIN=function(t,e){var a="number"==typeof t,i="number"==typeof e;if(a&&i)return Math.min(t,e);var r=[];if(!a&&!i){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)r[s]=null,s<t.length&&s<e.length&&(isNaN(t[s])||isNaN(e[s])||(r[s]=Math.min(t[s],e[s])));return r}if(a)for(var o in e)r[o]=null,isNaN(t)||isNaN(e[o])||(r[o]=Math.min(t,e[o]));else for(var h in t)r[h]=null,isNaN(t[h])||isNaN(e)||(r[h]=Math.min(t[h],e));return r},this.ABS=function(t){var e=[];for(var a in t)e[a]=null,isNaN(t[a])||(e[a]=Math.abs(t[a]));return e},this.MA=function(t,e){var a=[];if(e<=0)return a;if(Array.isArray(e)){for(h=0;h<t.length;++h)if(a[h]=null,!(h>=e.length)){var i=e[h];if(this.IsNumber(i)&&!(i<=0)){for(var r=0,n=0,s=h,o=0;s>=0&&o<i;--s,++o)r+=t[s],++n;n>0&&(a[h]=r/n)}}}else{if(e<=0&&(e=1),!t||!t.length)return a;for(var h=0;h<t.length;++h)if(a[h]=null,this.IsNumber(t[h]))break;t=t.slice(0);for(var l=0;h<t.length;++h,++l)if(l<e-1)a[h]=null;else{for(var u=t[h-(e-1)],C=0,D=e-1;D>=0;--D){var c=t[h-D];this.IsNumber(c)?u=c:(c=u,t[h-D]=c),C+=c}a[h]=C/e}}return a},this.EMA=function(t,e){var a=[];if(t.length<=0)return a;if(Array.isArray(e))for(var i=0;i<e.length;++i){var r=e[i];if(this.IsNumber(r)&&(r=parseInt(r),!(r<=0))){r>i+1&&(r=i+1);for(var n=[2/(r+1),(r-1)/(r+1)],s=null,o=null,h=0;h<r;++h){var l=i-(r-h-1),u=t[l];this.IsNumber(u)||coninue,null==o?(s=u,o=s):(s=n[0]*u+n[1]*o,o=s)}a[i]=s}}else{for(var C=0;C<t.length;++C)if(null!=t[C]&&!isNaN(t[C]))break;var D=C,c=C+1;a[D]=t[D];for(i=C+1;i<t.length;++i,++D,++c)a[c]=(2*t[c]+(e-1)*a[D])/(e+1)}return a},this.XMA=function(t,e){for(var a=[],i=0;i<t.length;++i)if(this.IsNumber(t[i]))break;for(var r=parseInt((e-2)/2),n=0,s=0,o=0,h=0,l=i,u=0;l<t.length;++l){for(o=l-r-1,h=l+(e-r)-1,u=o;u<h;++u)u>=0&&u<t.length&&this.IsNumber(t[u])&&(n+=t[u],++s);a[l]=0!=s?n/s:null,n=0,s=0}return a},this.SMA=function(t,e,a){var i=[];if(Array.isArray(e))for(var r=0;r<e.length;++r){var n=e[r];if(this.IsNumber(n)&&(n=parseInt(n),!(n<=0))){n>r+1&&(n=r+1);for(var s=null,o=null,h=0;h<n;++h){var l=r-(n-h-1),u=t[l];this.IsNumber(u)&&(null==s?(s=u,o=u):(o=(a*u+(n-a)*s)/n,s=o))}i[r]=o}}else{r=0;for(var C=null;r<t.length;++r)if(null!=t[r]&&!isNaN(t[r])){C=t[r],i[r]=C;break}for(++r;r<t.length;++r)i[r]=(a*t[r]+(e-a)*C)/e,C=i[r]}return i},this.DMA=function(t,e){var a=[];if(t.length<0||t.length!=e.length)return a;for(var i=0;i<t.length;++i)if(null!=t[i]&&!isNaN(t[i])&&null!=e[i]&&!isNaN(e[i])){a[i]=t[i];break}for(i+=1;i<t.length;++i)null==t[i]||null==e[i]?a[i]=null:e[i]<1?a[i]=e[i]*t[i]+(1-e[i])*a[i-1]:a[i]=t[i];return a},this.WMA=function(t,e){var a=[];if(!t||!t.length)return a;if(Array.isArray(e)){for(D=0;D<e.length&&D<t.length;++D){a[D]=null;var i=e[D];if(!(i<=0)){for(var r=0,n=0,s=0,o=0,h=0;h<i;++h)if(s=D-(i-h-1),n=t[s],r=h,this.IsNumber(n)){o=n;break}if(!(r>=i)){for(var l=0,u=0,C=(h=r,1);h<i;++h,++C)s=D-(i-h-1),n=t[s],this.IsNumber(n)?o=n:n=o,u+=C,l+=n*C;a[D]=l/u}}}return a}if(e<=0)return[];var D=0;for(D=0;D<t.length&&!this.IsNumber(t[D]);++D)a[D]=null;t=t.slice(0);for(var c=0;D<t.length;++D,++c)if(c<e-1)a[D]=null;else{for(o=t[D-(e-1)],l=0,u=0,h=e-1;h>=0;--h){n=t[D-h];this.IsNumber(n)?o=n:(n=o,t[D-h]=n),u+=e-h,l+=n*(e-h)}a[D]=l/u}return a},this.MEMA=function(t,e){var a=[];if(!t||!t.length)return a;var i=0,r=0;for(r=0;r<t.length&&!this.IsNumber(t[r]);++r)a[r]=null;if(i=r,e<1||i+e>=t.length)return a;var n=0;for(t=t.slice(0);i<r+e;++i)a[i]=null,!this.IsNumber(t[i])&&i-1>=0&&(t[i]=t[i-1]),n+=t[i];for(a[i-1]=n/e;i<t.length;++i)this.IsNumber(a[i-1])&&this.IsNumber(t[i])?a[i]=(t[i]+a[i-1]*(e-1))/e:i-1>-1&&this.IsNumber(a[i-1])?a[i]=a[i-1]:a[i]=null;return a},this.EXPMA=function(t,e){var a=[];if(e>=t.length)return a;for(var i=e;i<t.length;++i)if(null!=t[i]){a[i]=t[i];break}for(i+=1;i<t.length;++i)null!=a[i-1]&&null!=t[i]?a[i]=(2*t[i]+(e-1)*a[i-1])/(e+1):null!=a[i-1]&&(a[i]=a[i-1]);return a},this.EXPMEMA=function(t,e){var a=[];if(e>=t.length)return a;for(var i=0;i<t.length;++i)if(t[i]&&!isNaN(t[i]))break;for(var r=0,n=0;i<t.length&&n<e;++n,++i)t[i]&&!isNaN(t[i])?r+=t[i]:r+=t[i-1];for(a[i-1]=r/e;i<t.length;++i)null!=a[i-1]&&null!=t[i]?a[i]=(2*t[i]+(e-1)*a[i-1])/(e+1):null!=a[i-1]&&(a[i]=a[i-1]);return a},this.SUMBARS=function(t,e){var a=[];if(!t||!t.length||!e||!e.length)return a;for(var i=0,r=0,n=0;i<t.length&&!this.IsNumber(t[i]);++i)a[i]=null;for(r=t.length-1;r>=i;--r){var s=0;for(n=r,s=0;n>=i&&s<e[r];--n)s+=t[n];a[r]=n<i?null:r-n}for(r=i+1;r<t.length;++r)null==a[r]&&(a[r]=a[r-1]);return a},this.REVERSE=function(t){for(var e=[],a=0;a<t.length&&!this.isNumber(t[a]);++a)e[a]=null;for(;a<t.length;++a)this.isNumber(t[a])?e[a]=0-t[a]:e[a]=null;return e},this.COUNT=function(t,e){if(Array.isArray(e)){for(var a=null,i=t.length,r=0;r<i;++r)if(this.IsNumber(t[r])){a=r;break}if(null==a)return[];var n=[],s=0;for(r=0;r<e.length;++r){var o=e[r];if(Le.IsNumber(o)){o<1&&(o=r+1),s=0;for(var h=r,l=0;h>=0&&l<o;--h,++l)t[h]&&++s;n[r]=s}}return n}for(o=e,i=t.length,o=o<1?i:o,r=0,h=0;r<i;++r)if(this.IsNumber(t[r]))break;n=[];for(var u=0;r<i&&h<o;++r,++h)u=t[r]?u+1:u,n[r]=u;for(;r<i;++r)t[r-o]&&u&&u--,u=t[r]?u+1:u,n[r]=u;return n},this.HHV=function(t,e){var a=[];if(Array.isArray(e)){for(var i=null,r=0,n=0;r<t.length;++r)if(a[r]=null,!(r>=e.length)){i=null;var s=e[r];if(s>0&&s<=r)for(n=r-s;n<=r;++n)(null==i||i<t[n])&&(i=t[n]);else for(s=r,n=0;n<=r;++n)(null==i||i<t[n])&&(i=t[n]);a[r]=i}}else{if(e>t.length)return a;e<=0&&(e=t.length-1);var o=0;for(o=0;o<t.length;++o)if(this.IsNumber(t[o]))break;o<t.length&&(a[o]=t[o]);for(r=o+1,n=2;r<t.length&&n<e;++r,++n)t[r]>=t[o]&&(o=r),a[r]=t[o];for(;r<t.length;++r){if(r-o<e)o=t[r]<t[o]?o:r;else for(n=o=r-e+2;n<=r;++n)o=t[n]<t[o]?o:n;a[r]=t[o]}}return a},this.LLV=function(t,e){var a=[];if(Array.isArray(e)){for(var i=0;i<t.length;++i)if(a[i]=null,!(i>=e.length)){var r=null,n=e[i];if(n>0&&n<=i)for(var s=i-n;s<=i;++s)(null==r||r>t[s])&&(r=t[s]);else{n=i;for(s=0;s<=i;++s)(null==r||r>t[s])&&(r=t[s])}a[i]=r}}else{if(e>t.length)return a;e<=0&&(e=t.length-1);for(r=null,i=e;i<t.length;++i,++s){if(null==r||i<e+r)r=t[i]>t[r]?r:i;else for(s=1+(r=i-e+1);s<=i;++s)t[s]<t[r]&&(r=s);a[i]=t[r]}}return a},this.STD=function(t,e){for(var a=[],i=0,r=[],n=e-1;n<t.length;++n){i=0;for(var s=0;s<e;++s)i+=t[n-s];r[n]=i/e}for(n=e-1;n<t.length;++n){i=0;for(s=0;s<e;++s)i+=Math.pow(t[n-s]-r[n],2);a[n]=Math.sqrt(i/e)}return a},this.AVEDEV=function(t,e){for(var a=[],i=0,r=[],n=e-1;n<t.length;++n){i=0;for(var s=0;s<e;++s)i+=t[n-s];r[n]=i/e}for(n=e-1;n<t.length;++n){i=0;for(s=0;s<e;++s)i+=Math.abs(t[n-s]-r[n]);a[n]=i/e}return a},this.CROSS=function(t,e){var a=[];if(Array.isArray(t)&&Array.isArray(e)){if(t.length!=e.length)return[];for(var i=0;i<t.length;++i)if(this.IsNumber(t[i])&&this.IsNumber(e[i]))break;for(++i;i<t.length;++i)a[i]=t[i]>e[i]&&t[i-1]<e[i-1]?1:0}else if(Array.isArray(t)&&"number"==typeof e){for(i=0;i<t.length;++i)if(this.IsNumber(t[i]))break;for(++i;i<t.length;++i)a[i]=t[i]>e&&t[i-1]<e?1:0}else if("number"==typeof t&&Array.isArray(e)){for(i=0;i<e.length;++i)if(this.IsNumber(e[i]))break;for(++i;i<e.length;++i)a[i]=e[i]<t&&e[i-1]>t?1:0}return a},this.MULAR=function(t,e){var a=[];if(t.length<e)return a;for(var i=e;i<t.length;++i)if(null!=t[i]&&!isNaN(t[i])){a[i]=t[i];break}for(++i;i<t.length;++i)a[i]=a[i-1]*t[i];return a},this.SUM=function(t,e){var a=[];if(Array.isArray(e))for(r=0;r<t.length;++r){a[r]=null;var i=e[r];if(i>0)for(n=r,s=0;n>=0&&s<i;--n,++s)0==s?a[r]=t[n]:a[r]+=t[n]}else if(0==e){a[0]=t[0];for(var r=1;r<t.length;++r)a[r]=a[r-1]+t[r]}else for(var r=e-1,n=0;r<t.length;++r,++n)for(var s=0;s<e;++s)0==s?a[r]=t[s+n]:a[r]+=t[s+n];return a},this.BARSCOUNT=function(t){var e=[],a=null;for(var i in t){if(e[i]=0,null==a){if(!this.IsNumber(t[i]))continue;a=0}e[i]=a,++a}return e},this.DEVSQ=function(t,e){var a=[];"number"!=typeof e&&(e=parseInt(e));var i=e,r=t.length,n=0,s=0,o=0,h=0,l=0;for(n=0;n<r&&!this.isNumber(t[n]);++n)a[n]=null;if(i<1||n+i>r)return a;for(h=0;n<r&&s<i;++n,++s)h+=t[n]/i;if(s==i){for(l=0,n--;o<i;o++)l+=(t[n-o]-h)*(t[n-o]-h);a[n]=l,n++}for(;n<r;++n){for(h+=(t[n]-t[n-i])/i,l=0,o=0;o<i;++o)l+=(t[n-o]-h)*(t[n-o]-h);a[n]=l}return a},this.NOT=function(t){var e="number"==typeof t;if(e)return t?0:1;var a=[];for(var i in t)a[i]=null,this.IsNumber(t[i])&&(a[i]=t[i]?0:1);return a},this.FORCAST=function(t,e){var a=[];"number"!=typeof e&&(e=parseInt(e));var i=e,r=t.length;if(i<1||i>=r)return a;var n,s,o,h,l,u=0,C=0,D=0,c=0;for(h=0;h<r&&!this.IsNumber(t[h]);++h)a[h]=null;for(o=h+i-1;o<r;++o){for(u=C=D=c=0,h=0,l=i;h<i&&h<=o;++h,--l)u+=l,C+=t[o-h];for(u/=i,C/=i,h=0,l=i;h<i&&h<=o;++h,--l)D+=(l-u)*(t[o-h]-C),c+=(l-u)*(l-u);s=D/c,n=C-u*s,a[o]=s*i+n}return a},this.SLOPE=function(t,e){var a=[];if("number"!=typeof e&&(e=parseInt(e)),e<1||!t.length)return a;if(e>=t.length)return a;for(var i=0,r=0;r<t.length;++r,++i)if(a[r]=null,this.IsNumber(t[r]))break;for(var n=void 0,s=void 0,o=void 0,h=void 0,l=i+e-1;l<t.length;++l){a[l]=null,n=s=o=h=0;for(var u=0;u<e&&u<=l;++u)n+=l-u,s+=t[l-u];for(n/=e,s/=e,u=0;u<e&&u<=l;++u)o+=(l-u-n)*(t[l-u]-s),h+=(l-u-n)*(l-u-n);h?a[l]=o/h:l&&(a[l]=a[l-1])}return a},this.STDP=function(t,e){var a=[];"number"!=typeof e&&(e=parseInt(e));var i=e,r=t.length;if(i<1||i>=r)return a;var n=0,s=0;for(n=0;n<r&&!this.IsNumber(t[n]);++n)a[n]=null;for(var o,h=0,l=0;n<r&&s<i;++n,++s)h+=t[n]*t[n],l+=t[n];for(s==i&&(o=i*h-l*l,a[n-1]=Math.sqrt(o)/i);n<r;++n)h+=t[n]*t[n]-t[n-i]*t[n-i],l+=t[n]-t[n-i],o=i*h-l*l,a[n]=Math.sqrt(o)/i;return a},this.VAR=function(t,e){var a=[];"number"!=typeof e&&(e=parseInt(e));var i,r,n,s,o=e,h=t.length;if(o<=1||o>=h)return a;for(i=0;i<h&&!this.IsNumber(t[i]);++i)a[i]=null;for(r=0,i=i+o-1;i<h;++i){for(n=s=0,r=0;r<o&&r<=i;++r)n+=t[i-r]*t[i-r],s+=t[i-r];a[i]=(o*n-s*s)/o*(o-1)}return a},this.VARP=function(t,e){var a=[];"number"!=typeof e&&(e=parseInt(e));var i=e,r=t.length;if(i<1||i>=r)return a;var n=0,s=0;for(n=0;n<r&&!this.IsNumber(t[n]);++n)a[n]=null;for(var o=0,h=0;n<r&&s<i;++n,++s)o+=t[n]*t[n],h+=t[n];for(s==i&&(a[n-1]=(i*o-h*h)/(i*i));n<r;++n)o+=t[n]*t[n]-t[n-i]*t[n-i],h+=t[n]-t[n-i],a[n]=(i*o-h*h)/(i*i);return a},this.RANGE=function(t,e,a){var i="number"==typeof t,r="number"==typeof e,n="number"==typeof a;if(i&&r&&n)return t>Math.min(e,a)&&t<Math.max(e,a)?1:0;for(var s=[],o=void 0,h=void 0,l=0;l<t.length;++l)if(s[l]=null,o=t[l],this.IsNumber(o)){if(r)h=e;else{if(l>=e.length)continue;h=e[l]}if(this.IsNumber(h)){if(n)rangeValue2=a;else{if(l>=a.length)continue;rangeValue2=a[l]}this.IsNumber(rangeValue2)&&(s[l]=o>Math.min(h,rangeValue2)&&o<Math.max(h,rangeValue2)?1:0)}}return s},this.EXIST=function(t,e){if("number"==typeof t)return 0;if(Array.isArray(e)){var a=[];if(t.length<=0)return a;for(var i in t)a[i]=0;for(i=0;i<e.length&&i<t.length;++i){var r=e[i];if(this.IsNumber(r)&&(r=parseInt(r),!(r<=0))){r>i+1&&(r=i+1);for(var n=!1,s=0,o=0;o<r;++o)if(i-(r-o-1),s=t[i],this.IsNumber(s)&&s>0){n=!0;break}a[i]=n?1:0}}return a}e=parseInt(e);for(var h=null,l=(a=[],0);l<t.length;++l)a[l]=null,s=t[l],this.IsNumber(s)&&s>0&&(h=l),a[l]=null!=h&&l-h<e?1:0;return a},this.TFILTER=function(t,e,a){a=parseInt(a);for(var i=[],r=Math.max(t.length,e.length),n=0;n<r;++n);return i},this.FILTER=function(t,e){for(var a=[],i=0,r=0;i<t.length;++i)if(t[i]){for(a[i]=1,r=0;r<e&&r+i+1<t.length;++r)a[r+i+1]=0;i+=e}else a[i]=0;return a},this.BARSLAST=function(t){var e=[];if(!t)return e;for(var a=null,i=0;i<t.length;++i)e[i]=null,t[i]>0?a=0:null!=a&&++a,null!=a&&(e[i]=a);return e},this.BARSSINCEN=function(t,e){for(var a=[],i=null,r=0;r<t.length;++r)a[r]=null,null==i?t[r]&&(i=0):t[r]?i+1<e&&++i:i=null,i&&(a[r]=i);return a},this.BARSSINCE=function(t){for(var e=[],a=null,i=0;i<t.length;++i)e[i]=null,null==a?t[i]&&(a=0):++a,a&&(e[i]=a);return e},this.Trigonometric=function(t,e){if(Array.isArray(t)){var a=[];for(var i in t){var r=t[i];this.IsNumber(r)?a[i]=e(r):a[i]=null}return a}return this.IsNumber(t)?e(t):null},this.ASIN=function(t){if(Array.isArray(t)){var e=[];for(var a in t){var i=t[a];if(e[a]=null,this.IsNumber(i))if(i>=-1&&i<=1)e[a]=Math.asin(i);else if(a-1>=0){var r=e[a-1];this.IsNumber(r)&&(e[a]=r)}}return e}return this.IsNumber(t)?Math.acos(t):null},this.ACOS=function(t){if(Array.isArray(t)){var e=[];for(var a in t){var i=t[a];if(e[a]=null,this.IsNumber(i))if(i>=-1&&i<=1)e[a]=Math.acos(i);else if(a-1>=0){var r=e[a-1];this.IsNumber(r)&&(e[a]=r)}}return e}return this.IsNumber(t)?Math.acos(t):null},this.LAST=function(t,e,a){if(!Array.isArray(t))return[];for(var i=[],r=t.length,n=e,s=a,o=0,h=0,l=0,u=0;o<r;++o)if(t[o])break;for(h=o,u=o-s+1;h<r;++h,++u){for(l=0==n?o:Math.max(o,h-n);l<u;++l)if(t[l]<=0)break;i[h]=l<u?0:1}return i},this.ZIG=function(t,e){var a=this.SymbolData.Data,i=[];if("number"==typeof t)switch(t){case 0:t=a.GetOpen();break;case 1:t=a.GetHigh();break;case 2:t=a.GetLow();break;case 3:t=a.GetClose();break;default:return i}return this.ZIG_Calculate(t,e)},this.GetFirstVaildIndex=function(t){for(var e=0;e<t.length;++e)if(this.IsNumber(t[e]))return e;return t.length},this.ZIG_Calculate=function(t,e){var a=[],i=t.length,r=this.GetFirstVaildIndex(t),n=0,s=0,o=0,h=0,l=0;for(n=r+1,s=o=r;n<i-1&&o==r;++n)o=100*Math.abs(t[n]-t[r])>=e*t[r]?t[n]>t[r]?n:-n:r;for(;n<i-1;++n)if(t[n]>=t[n-1]&&t[n]>=t[n+1])if(o<0){if(100*(t[n]-t[-o])<e*t[-o])continue;for(l=(t[s]-t[h=-o])/(-o-s),a[h--]=t[-o];h>=s;h--)a[h]=t[-o]+(-o-h)*l;s=-o,o=n}else t[n]>t[o]&&(o=n);else if(t[n]<=t[n-1]&&t[n]<=t[n+1])if(o>0){if(100*(t[o]-t[n])<e*t[o])continue;for(l=(t[o]-t[h=s])/(o-s),a[h++]=t[s];h<=o;++h)a[h]=t[s]+(h-s)*l;s=o,o=-n}else t[n]<t[-o]&&(o=-n);if(Math.abs(o)>=i-2&&(o>0&&t[i-1]>=t[o]&&(o=i-1),o<0&&t[i-1]<=t[-o]&&(o=1-i)),o>0)for(l=(t[o]-t[h=s])/(o-s),a[h++]=t[s];h<=o;++h)a[h]=t[s]+(h-s)*l;else for(l=(t[s]-t[h=-o])/(-o-s),a[h--]=t[-o];h>=s;h--)a[h]=t[-o]+(-o-h)*l;if((o=Math.abs(o))<i-1)if(t[i-1]>=t[o])for(l=(t[i-1]-t[h=o])/(i-o),a[h++]=t[o];h<i;++h)a[h]=t[o]+(h-o)*l;else for(l=(t[o]-t[h=i-1])/(i-o),a[h--]=t[i-1];h>=o;h--)a[h]=t[i-1]+(i-h)*l;return a},this.JSDraw=null,this.CalculateZIGLine=function(t,e,a,i,r){null==this.JSDraw&&(this.JSDraw=new ir(this.ErrorHandler));var n=e.Up,s=t;if(n)for(var o=t.ID+1;o<a.ID;++o){var h=i[o];this.IsNumber(h)&&(s.Value<h&&(s={ID:o,Value:h}))}else for(o=t.ID+1;o<a.ID;++o){h=i[o];this.IsNumber(h)&&(s.Value>h&&(s={ID:o,Value:h}))}e.Value=s.Value,e.ID=s.ID;var l={Start:{ID:t.ID,Value:t.Value},End:{ID:e.ID,Value:e.Value}},u=this.JSDraw.CalculateDrawLine(l);for(var o in u){var C=u[o];r[C.ID]=C.Value}if(a.ID==i.length-1)for(var o in l={Start:{ID:e.ID,Value:e.Value},End:{ID:a.ID,Value:a.Value}},u=this.JSDraw.CalculateDrawLine(l),u){C=u[o];r[C.ID]=C.Value}else t.ID=e.ID,t.Value=e.Value,e.ID=a.ID,e.Value=a.Value,e.Up=t.Value<e.Value},this.TROUGHBARS=function(t,e,a){var i=this.ZIG(t,e),r=[],n=a;if(n<1)return r;for(var s=i.length,o=[],h=0;h<n;++h)o[h]=0;var l=0;h=this.GetFirstVaildIndex(i)+1;for(n--;h<s&&i[h]>i[h-1];++h);for(;h<s&&i[h]<i[h-1];++h);for(o[0]=--h;h<s-1;++h){if(i[h]<i[h+1]){if(l){if(n)for(var u=o.slice(0),C=0;C<n;++C)o[C+1]=u[C];o[l=0]=h}}else l=1;o[n]&&(r[h]=h-o[n])}return o[n]&&(r[h]=h-o[n]),r},this.TROUGH=function(t,e,a){var i=this.ZIG(t,e),r=[],n=a;if(n<1)return r;for(var s=i.length,o=[],h=0;h<n;++h)o[h]=0;h=1;var l=0;h=this.GetFirstVaildIndex(i)+1;for(n--;h<s&&i[h]>i[h-1];++h);for(;h<s&&i[h]<i[h-1];++h);for(o[0]=--h;h<s-1;++h){if(i[h]<i[h+1]){if(l){if(n)for(var u=o.slice(0),C=0;C<n;++C)o[C+1]=u[C];o[l=0]=h}}else l=1;o[n]&&(r[h]=i[o[n]])}return o[n]&&(r[h]=i[o[n]]),r},this.PEAKBARS=function(t,e,a){var i=this.ZIG(t,e),r=[],n=i.length,s=a;if(s<1)return r;for(var o=[],h=0;h<s;++h)o[h]=0;var l=0;h=this.GetFirstVaildIndex(i)+1;for(s--;h<n&&i[h]<i[h-1];++h);for(;h<n&&i[h]>i[h-1];++h);for(o[0]=--h;h<n-1;++h){if(i[h]>i[h+1]){if(l){if(s)for(var u=o.slice(0),C=0;C<s;++C)o[C+1]=u[C];o[l=0]=h}}else l=1;o[s]&&(r[h]=h-o[s])}return o[s]&&(r[h]=h-o[s]),r},this.PEAK=function(t,e,a){var i=this.ZIG(t,e),r=[],n=i.length,s=a;if(s<1)return r;for(var o=0,h=[],l=0;l<s;++l)h[l]=0;l=this.GetFirstVaildIndex(i)+1;for(s--;l<n&&i[l]<i[l-1];++l);for(;l<n&&i[l]>i[l-1];++l);for(h[0]=--l;l<n-1;++l){if(i[l]>i[l+1]){if(o){if(s)for(var u=h.slice(0),C=0;C<s;++C)h[C+1]=u[C];h[o=0]=l}}else o=1;h[s]&&(r[l]=i[h[s]])}return h[s]&&(r[l]=i[h[s]]),r},this.EVERY=function(t,e){var a=[];if(e<1)return a;for(var i=0;i<t.length;++i)if(a[i]=null,this.IsNumber(t[i]))break;for(var r=0;i<t.length;++i)t[i]?r+=1:r=0,r==e?(a[i]=1,--r):a[i]=0;return a},this.COST=function(t,e){var a=[],i=t/100;if(i<1e-6||i>1)return a;var r=this.SymbolData.Data.Data;if(!r||r.length<=0)return a;for(var n=this.SymbolData.GetFinanceCacheData(7,e),s=r[0].High,o=r[0].Low,h=0;h<r.length;++h){var l=r[h];o=Math.min(o,l.Low),s=Math.max(s,l.High)}(o>1e3||o<0||s>1e3||o<0)&&this.ThrowUnexpectedNode(e,"COST() 历史K线最大最小值错误, 超出(0,1000)范围");var u=parseInt(100*s+1),C=parseInt(100*o-1),D=0,c=0,f=0;s=u/100,o=C/100;var d=u-C+1;if(d<1)return a;var m=[],v=[];for(h=0;h<d;++h)m[h]=0,v[h]=0;var S=0,I=0,p=0,T=0;for(h=0;h<r.length;++h)if(!(h>=n.length)){if(n[h]>1){var A=r[h];S=A.Vol/n[h];for(var g=0;g<d;g++)m[g]*=1-S;D=parseInt(Math.min(u,Math.max(C,100*A.Low)))-C,c=parseInt(Math.min(u,Math.max(C,100*A.High)))-C,f=parseInt(Math.min(u,Math.max(C,100*A.Close)))-C;for(g=0;g<d;++g)v[g]=0;var F=parseInt((D+c+2*f)/4);if(F==c||F==D)v[F]+=A.Vol;else{for(var E=A.Vol/(F-D),L=D;L<F;++L)v[L]+=E/(F-D)*(L-D);for(L;L<=c;++L)v[L]+=E/(F-c)*(L-c)}for(I=0,g=D;g<=c;g++)m[g]+=v[g];for(g=0;g<d;g++)I+=m[g];for(g=0,T=p=0;g<d;++g)if(p+=m[g],p>=I*i){T=(s-o)*g/d+o;break}}a[h]=T}return a},this.WINNER=function(t,e){var a=[],i=this.SymbolData.Data.Data;if(!i||i.length<=0)return a;for(var r=this.SymbolData.GetFinanceCacheData(7,e),n=i[0].High,s=i[0].Low,o=0;o<i.length;++o){var h=i[o];s=Math.min(s,h.Low),n=Math.max(n,h.High)}(s>1e3||s<0||n>1e3||s<0)&&this.ThrowUnexpectedNode(e,"WINNER() 历史K线最大最小值错误, 超出(0,1000)范围");var l=parseInt(100*n+1),u=parseInt(100*s-1),C=0,D=0,c=0;n=l/100,s=u/100;var f=l-u+1;if(f<1)return a;var d=[],m=[];for(o=0;o<f;++o)d[o]=0,m[o]=0;var v=0,S=0,I=0;for(o=0;o<i.length;++o)if(!(o>=r.length)&&r[o]>1){var p=i[o];v=p.Vol/r[o];for(var T=0;T<f;T++)d[T]*=1-v;C=parseInt(Math.min(l,Math.max(u,100*p.Low)))-u,D=parseInt(Math.min(l,Math.max(u,100*p.High)))-u,c=parseInt(Math.min(l,Math.max(u,100*p.Close)))-u;for(T=0;T<f;++T)m[T]=0;var A=parseInt((C+D+2*c)/4);if(A==D||A==C)m[A]+=p.Vol;else{for(var g=p.Vol/(A-C),F=C;F<A;++F)m[F]+=g/(A-C)*(F-C);for(F;F<=D;++F)m[F]+=g/(A-D)*(F-D)}for(S=0,T=C;T<=D;T++)d[T]+=m[T];for(T=0;T<f;T++)S+=d[T];D=Array.isArray(t)?parseInt(Math.min(100*t[o]-u,f-1)):parseInt(Math.min(100*t-u,f-1));for(T=0,I=0;T<=D;T++)I+=d[T];S>0?a[o]=I/S:o-1>=0&&(a[o]=a[o-1])}return a},this.COSTEX=function(t,e,a){var i=[],r=this.SymbolData.Data.Data;if(!r||r.length<=0)return i;for(var n=this.SymbolData.GetFinanceCacheData(7,a),s=r[0].High,o=r[0].Low,h=0;h<r.length;++h){var l=r[h];o=Math.min(o,l.Low),s=Math.max(s,l.High)}(o>1e3||o<0||s>1e3||o<0)&&this.ThrowUnexpectedNode(a,"COSTEX() 历史K线最大最小值错误, 超出(0,1000)范围");var u=parseInt(100*s+1),C=parseInt(100*o-1),D=0,c=0,f=0;s=u/100,o=C/100;var d=u-C+1;if(d<1)return i;var m=[],v=[];for(h=0;h<d;++h)m[h]=0,v[h]=0;for(var S=0,I=0,p=0,T=0,A=0,g=0,F=(h=0,0);h<r.length;++h)if(!(h>=n.length)&&n[h]>1){var E=r[h];S=E.Vol/n[h];for(F=0;F<d;F++)m[F]*=1-S;D=parseInt(Math.min(u,Math.max(C,100*E.Low)))-C,c=parseInt(Math.min(u,Math.max(C,100*E.High)))-C,f=parseInt(Math.min(u,Math.max(C,100*E.Close)))-C;for(F=0;F<d;++F)v[F]=0;var L=parseInt((D+c+2*f)/4);if(L==c||L==D)v[L]+=E.Vol;else{for(var M=E.Vol/(L-D),x=D;x<L;++x)v[x]+=M/(L-D)*(x-D);for(x;x<=c;++x)v[x]+=M/(L-c)*(x-c)}0;for(F=D;F<=c;F++)m[F]+=v[F];for(F=0;F<d;F++)m[F];for(c=Array.isArray(t)?parseInt(Math.min(100*t[h]-C,d-1)):parseInt(Math.min(100*t-C,d-1)),F=0,p=0,T=0;F<=c;F++)p+=m[F],T+=.01*(F+C)*m[F];for(c=Array.isArray(e)?parseInt(Math.min(100*e[h]-C,d-1)):parseInt(Math.min(100*e-C,d-1)),F=0,A=0,g=0;F<=c;F++)A+=m[F],g+=.01*(F+C)*m[F];I=p-A,dPerVolRange=T-g,Math.abs(dPerVolRange)>.001&&0!=I?i[h]=dPerVolRange/I:h-1>=0&&(i[h]=i[h-1])}return i},this.PPART=function(t,e){var a=[],i=t;if(i<0)return a;var r=this.SymbolData.Data.Data;if(!r||r.length<=0)return a;for(var n=this.SymbolData.GetFinanceCacheData(7,e),s=i,o=0;s<r.length;++s){var h=s-i;if(!(h<0)){var l=0;for(o=0;o<i;++o){var u=r[o+h];l+=u.Vol}if(s<n.length&&n[s]>0){var C=1-l/n[s];a[s]=C}}}return a},this.LWINNER=function(t,e,a){var i=t;i<=0&&this.ThrowUnexpectedNode(a,"LWINNER() 第1个参数错误");var r=[],n=this.SymbolData.Data.Data;if(!n||n.length<=0)return r;for(var s=this.SymbolData.GetFinanceCacheData(7,a),o=0,h=0,l=i-1,u=0,C=0;l<n.length;++l){var D=l-i+1,c=n[D].High,f=n[D].Low;for(u=0;u<i;++u){var d=n[D+u];f=Math.min(f,d.Low),c=Math.max(c,d.High)}(f>1e3||f<0||c>1e3||f<0)&&this.ThrowUnexpectedNode(a,"LWINNER() 历史K线最大最小值错误, 超出(0,1000)范围");var m=parseInt(100*c+1),v=parseInt(100*f-1),S=0,I=0,p=0;c=m/100,f=v/100;var T=m-v+1;if(T<1)return r;var A=[],g=[];for(u=0;u<T;++u)A[u]=0,g[u]=0;for(u=0;u<i;++u){var F=s[D+u];if(!(F<1)){var E=n[D+u],L=E.Vol/F;for(C=0;C<T;C++)A[C]*=1-L;S=parseInt(Math.min(m,Math.max(v,100*E.Low)))-v,I=parseInt(Math.min(m,Math.max(v,100*E.High)))-v,p=parseInt(Math.min(m,Math.max(v,100*E.Close)))-v;for(C=0;C<T;++C)g[C]=0;var M=parseInt((S+I+2*p)/4);if(M==I||M==S)g[M]+=E.Vol;else{for(var x,N=E.Vol/(M-S),O=S;O<M;++O)g[O]+=N/(M-S)*(O-S);for(;x<=I;++x)g[x]+=N/(M-I)*(x-I)}o=0;for(C=S;C<=I;C++)A[C]+=g[C]}}for(u=0;u<T;u++)o+=A[u];for(I=Array.isArray(e)?parseInt(Math.min(100*e[l]-v,T-1)):parseInt(Math.min(100*e-v,T-1)),h=0,C=0;C<=I;C++)h+=A[C];o>0&&h>0&&h<=o?r[l]=h/o:l-1>=0&&(r[l]=r[l-1])}return r},this.PWINNER=function(t,e,a){var i=[];return i},this.CalculateChip=function(t,e,a,i){for(var r={Min:null,Max:null,Data:[]},n=1,s=null,o=null,h=t;h>=0;--h){var l={},u=a[h];l.Vol=h==t?u.Vol*e[h]:u.Vol*n,l.Date=u.Date,l.High=u.High,l.Low=u.Low,null==s?s=l.High:s<l.High&&(s=l.High),null==o?o=l.Low:o<l.Low&&(o=l.Low),r.Data[h]=l,n*=1-e[h]/100*i}return r.Max=s,r.Min=o,r},this.UPNDAY=function(t,e){var a=[];if(e<1)return a;if(null==t||e>t.length)return a;for(var i=0,r=0;r<t.length;++r)a[r]=0,r-1<0||(this.IsNumber(t[r])&&this.IsNumber(t[r-1])?(t[r]>t[r-1]?++i:i=0,i==e&&(a[r]=1,--i)):i=0);return a},this.DOWNNDAY=function(t,e){var a=[];if(e<1)return a;if(null==t||e>t.length)return a;for(var i=0,r=0;r<t.length;++r)a[r]=0,r-1<0||(this.IsNumber(t[r])&&this.IsNumber(t[r-1])?(t[r]<t[r-1]?++i:i=0,i==e&&(a[r]=1,--i)):i=0);return a},this.NDAY=function(t,e,a){var i=[];if(a<1)return i;if(!Array.isArray(t)&&!Array.isArray(e))return i;if(null==t||null==e)return i;if(Array.isArray(t)&&Array.isArray(e)){if(a>=t.length||a>=e.length)return i;for(var r=Math.max(t.length,e.length),n=0,s=0;s<r;++s)i[s]=0,s>=t.length||s>=e.length||(this.IsNumber(t[s])&&this.IsNumber(e[s])?(t[s]>e[s]?++n:n=0,n==a&&(i[s]=1,--n)):n=0)}else if(Array.isArray(t)&&!Array.isArray(e)){if(a>=t.length||!this.IsNumber(e))return;n=0;for(var o in t)i[o]=0,this.IsNumber(t[o])?(t[o]>e?++n:n=0,n==a&&(i[o]=1,--n)):n=0}else if(!Array.isArray(t)&&Array.isArray(e)){if(a>=e.length||!this.IsNumber(t))return;n=0;for(var h in e)i[h]=0,this.IsNumber(e[h])?(t>e[h]?++n:n=0,n==a&&(i[h]=1,--n)):n=0}return i},this.LONGCROSS=function(t,e,a){for(var i=[],r=Math.max(t.length,e.length),n=0;n<r;++n)i[n]=0,n-1<0||n>=t.length||n>=e.length||this.IsNumber(t[n])&&this.IsNumber(e[n])&&this.IsNumber(t[n-1])&&this.IsNumber(e[n-1])&&t[n]>e[n]&&t[n-1]<e[n-1]&&(i[n]=1);for(var s=0,o=0;s<r;++s)if(i[s])for(o=1;o<=a&&s-o>=0;++o)if(t[s-o]>=e[s-o]){i[s]=0;break}return i},this.EXISTR=function(t,e,a){var i=[];if(!Array.isArray(t))return i;if(e=parseInt(e),a=parseInt(a),e<=0&&(e=t.length),a<=0&&(a=1),a>e)return i;i=[];for(var r=0,n=0;r<t.length;++r)if(i[r]=null,!(r-e<0||r-a<0))for(i[r]=0,n=e;n>=a;--n){var s=t[r-n];if(this.IsNumber(s)&&s){i[r]=1;break}}return i},this.RELATE=function(t,e,a){var i=[];if(a<1&&(a=1),!Array.isArray(t)||!Array.isArray(e))return i;for(var r=this.CalculateAverage(t,a),n=this.CalculateAverage(e,a),s=Math.max(t.length,e.length),o=0,h=0;o<s;++o)if(i[o]=null,!(o>=t.length||o>=e.length||o>=r.length||o>=n.length)){var l=r[o],u=n[o],C=0,D=0,c=0;for(h=o-a+1;h<=o;++h)C+=(t[h]-l)*(e[h]-u),D+=Math.pow(t[h]-l,2),c+=Math.pow(e[h]-u,2);i[o]=C/a/(Math.sqrt(D/a)*Math.sqrt(c/a))}return i},this.CalculateAverage=function(t,e){var a=[];if(e<1)return a;for(var i=0,r=0;r<t.length;++r)if(this.IsNumber(t[r]))break;for(;r<t.length&&r<e;++r){a[r]=null;var n=t[r];this.IsNumber(n)&&(i+=n)}for(a[r-1]=i/e;r<t.length;++r){n=t[r];var s=t[r-e];this.IsNumber(n)||(n=0),this.IsNumber(s)||(s=0),i=i-s+n,a[r]=i/e}return a},this.COVAR=function(t,e,a){var i=[];if(a<1&&(a=1),!Array.isArray(t)||!Array.isArray(e))return i;for(var r=this.CalculateAverage(t,a),n=this.CalculateAverage(e,a),s=Math.max(t.length,e.length),o=(s=Math.max(t.length,e.length),0),h=0;o<s;++o)if(i[o]=null,!(o>=t.length||o>=e.length||o>=r.length||o>=n.length)){var l=r[o],u=n[o],C=0;for(h=o-a+1;h<=o;++h)C+=(t[h]-l)*(e[h]-u);i[o]=C/a}return i},this.HHVBARS=function(t,e){var a=[];if(!Array.isArray(t))return a;e<1&&(e=t.length);for(var i=null,r=0;r<t.length;++r)if(a[r]=null,this.IsNumber(t[r])){i=r;break}var n=0;for(r=i+1;r<t.length&&n<e;++r,++n)t[r]>=t[i]&&(i=r),e==t.length&&(a[r]=r-i);for(;r<t.length;++r){if(r-i<e)t[r]>=t[i]&&(i=r);else for(i=r-e+1,n=i;n<=r;++n)t[n]>=t[i]&&(i=n);a[r]=r-i}return a},this.LLVBARS=function(t,e){var a=[];if(!Array.isArray(t))return a;e<1&&(e=t.length);for(var i=null,r=0;r<t.length;++r)if(a[r]=null,this.IsNumber(t[r])){i=r;break}var n=0;for(r=i+1;r<t.length&&n<e;++r,++n)t[r]<=t[i]&&(i=r),e==t.length&&(a[r]=r-i);for(;r<t.length;++r){if(r-i<e)t[r]<=t[i]&&(i=r);else for(i=r-e+1,n=i;n<=r;++n)t[n]<=t[i]&&(i=n);a[r]=r-i}return a},this.BETA=function(t){var e=[],a=this.SymbolData.Data,i=this.SymbolData.IndexData;t<=0&&(t=1);for(var r=[],n=[],s=0;s<a.Data.length;++s){r[s]=0,n[s]=0;var o=a.Data[s],h=i.Data[s];o.Close>0&&o.YClose>0&&(r[s]=(o.Close-o.YClose)/o.YClose),h.Close>0&&h.YClose>0&&(n[s]=(h.Close-h.YClose)/h.YClose)}for(var l=this.CalculateAverage(r,t),u=this.CalculateAverage(n,t),C=0,D=0;C<a.Data.length;++C)if(e[C]=null,!(C>=r.length||C>=n.length||C>=l.length||C>=u.length)){var c=l[C],f=u[C],d=0,m=0;for(D=C-t+1;D<=C;++D){var v=n[D]-f,S=r[D]-c;d+=v*S,m+=v*v}this.IsDivideNumber(m)&&this.IsNumber(d)&&(e[C]=d/m)}return e},this.BETA2=function(t,e,a){var i=[];a<=0&&(a=1);for(var r=[null],n=[null],s=Math.max(t.length,e.length),o={X:t[0],Y:e[0]},h=1;h<s;++h){r[h]=0,n[h]=0;var l=t[h],u=e[h];o.X>0&&(r[h]=(l-o.X)/o.X),o.Y>0&&(n[h]=(u-o.Y)/o.Y),o={X:l,Y:u}}for(var C=this.CalculateAverage(r,a),D=this.CalculateAverage(n,a),c=(h=0,0);h<s;++h)if(i[h]=null,!(h>=r.length||h>=n.length||h>=C.length||h>=D.length)){var f=C[h],d=D[h],m=0,v=0;for(c=h-a+1;c<=h;++c){var S=r[c]-f,I=n[c]-d;m+=S*I,v+=S*S}this.IsDivideNumber(v)&&this.IsNumber(m)&&(i[h]=m/v)}return i},this.SAR=function(t,e,a){var i=[],r=this.SymbolData.Data;if(t>=r.Data.length)return i;for(var n=null,s=null,o=0;o<t;++o){var h=r.Data[o];null==n?n=h.High:n<h.High&&(n=h.High),null==s?s=h.Low:s>h.Low&&(s=h.Low)}var l=0,u=1,C=l;i[t-1]=s;var D=s,c=r.Data[0].High,f=e/100;for(o=t;o<r.Data.length;++o){var d=c,m=(h=r.Data[o],r.Data[o-1]);C==l?h.Low<i[o-1]?(C=u,c=h.Low,f=e/100,D=Math.max(h.High,m.High),D=Math.max(D,d+f*(c-d))):(C=l,h.High>d&&(c=h.High,f=Math.min(f+e/100,a/100)),D=Math.min(h.Low,m.Low),D=Math.min(D,i[o-1]+f*(c-i[o-1]))):C==u&&(h.High>i[o-1]?(C=l,c=h.High,f=e/100,D=Math.min(h.Low,m.Low),D=Math.min(D,i[o-1]+f*(c-d))):(C=u,h.Low<d&&(c=h.Low,f=Math.min(f+e/100,a/100)),D=Math.max(h.High,m.High),D=Math.max(D,i[o-1]+f*(c-i[o-1])))),i[o]=D}return i},this.SARTURN=function(t,e,a){var i=[],r=this.SAR(t,e,a),n=this.SymbolData.Data,s=0;for(s=0;s<r.length;++s)if(this.IsNumber(r[s]))break;var o=0;s<n.Data.length&&(o=n.Data[s].Close>r[s]);for(var h=s+1;h<n.Data.length;++h){var l=n.Data[h];l.Close<r[h]&&o?i[h]=-1:i[h]=l.Close>r[h]&&!o?1:0,o=l.Close>r[h]}return i},this.BACKSET=function(t,e){var a=[];if(!t)return a;var i=t.length;if(!this.IsNumber(i)||i<=0)return a;for(var r=0;r<i;++r)a[r]=0;for(var n=0;n<i;++n)if(this.IsNumber(t[n]))break;if(n==i)return a;for(var s=Math.min(i-n,Math.max(e,1)),o=(r=i-1,0);r>=0;--r){var h=t[r];if(this.IsNumber(h)&&h)for(o=r;o>r-s;--o)a[o]=1}if(t[r])for(o=r;o>=n;--o)a[o]=1;return a},this.BETWEEN=function(t,e,a){var i=[],r="number"==typeof t,n="number"==typeof e,s="number"==typeof a;if(r&&n&&s)return t>=e&&t<=a?1:0;for(var o in t){i[o]=0;var h=t[o],l=null,u=null;n?l=e:o<e.length-1&&(l=e[o]),s?u=a:o<a.length-1&&(u=a[o]),null!=l&&null!=u&&(l>u?h>=u&&h<=l&&(i[o]=1):h<=u&&h>=l&&(i[o]=1))}return i},this.STRCAT=function(t,e){var a=t+e;return a},this.CON2STR=function(t,e){var a=[];if(Array.isArray(t))for(var i=t.length-1;i>=0;--i){var r=t[i];if(this.IsNumber(r))return a=r.toFixed(e),a}else this.IsNumber(t)&&(a=t.toFixed(e));return a},this.CoverPeriod=function(t,e,a){var i=this.GetPeriodInfo({Name:e});if(!i)return null;var r,n=this.GetPeriodInfo({PeriodID:this.SymbolData.Data.Period});if(!n)return null;if(n.Order>i.Order)return null;if(n.Period==i.Period)r=this.SymbolData.Data;else{var s;if(It.IsMinutePeriod(n.Period,!0)&&It.IsDayPeriod(i.Period,!0))s=0==i.Period?this.SymbolData.DayData.Data:this.SymbolData.DayData.GetPeriodData(i.Period);else{var o=new It;if(o.Data=this.SymbolData.SourceData.Data,o.Period=this.SymbolData.Period,o.Right=this.SymbolData.Right,It.IsDayPeriod(i.Period,!0)&&o.Right>0){var h=o.GetRightData(o.Right);o.Data=h}s=o.GetPeriodData(i.Period)}var l=this.SymbolData.Data.CoverTo(s,n.Period,i.Period);r=new It,r.Data=l}if(Le.IsPlusNumber(a)){var u=new It;l=r.GetRef(a);u.Data=l,r=u}var C=this.SymbolData.Symbol.toUpperCase();switch(t){case"COVER_C":return r.GetClose();case"COVER_O":return r.GetOpen();case"COVER_H":return r.GetHigh();case"COVER_L":return r.GetLow();case"COVER_A":return r.GetAmount();case"COVER_V":return Li.IsSHSZ(C)?r.GetVol(100):r.GetVol();default:return null}},this.MOD=function(t,e){var a=[],i="number"==typeof t,r="number"==typeof e;if(i&&r)return ar.MOD(t,e);if(!i&&!r){for(var n=Math.max(t.length,e.length),s=0;s<n;++s)a[s]=null,s<t.length&&s<e.length&&this.IsNumber(t[s])&&this.IsNumber(e[s])&&(a[s]=ar.MOD(t[s],e[s]));return a}if(i&&!r){for(var o in e)a[o]=null,this.IsNumber(t)&&this.IsNumber(e[o])&&(a[o]=ar.MOD(t,e[o]));return a}if(!i&&r){for(var o in t)a[o]=null,this.IsNumber(t[o])&&this.IsNumber(e)&&(a[o]=ar.MOD(t[o],e));return a}return a},this.POW=function(t,e){var a=[];if(!Le.IsNumber(e))return a;var i="number"==typeof t;if(i)return Math.pow(t,e);for(var r in t){var n=t[r];this.IsNumber(n)?a[r]=Math.pow(n,e):a[r]=null}return a},this.CEILING=function(t){var e="number"==typeof t;if(e)return parseInt(t);var a=[];for(var i in t){var r=t[i];this.IsNumber(r)?a[i]=parseInt(r):a[i]=null}return a},this.FLOOR=function(t){var e="number"==typeof t;if(e)return parseInt(t-1);var a=[];for(var i in t){var r=t[i];this.IsNumber(r)?a[i]=parseInt(r-1):a[i]=null}return a},this.ZTPRICE=function(t,e){if(!this.IsNumber(e))return null;if(Array.isArray(t)){var a=[];for(var i in t){var r=t[i];this.IsNumber(r)?a[i]=(1+e)*r:a[i]=null}return a}if(this.IsNumber(t)){a=(1+e)*t;return a}},this.DTPRICE=function(t,e){if(!this.IsNumber(e))return null;if(Array.isArray(t)){var a=[];for(var i in t){var r=t[i];this.IsNumber(r)?a[i]=(1-e)*r:a[i]=null}return a}if(this.IsNumber(t)){a=(1-e)*t;return a}},this.FRACPART=function(t){if(Array.isArray(t)){var e=[],a=0;for(var i in t){var r=t[i];this.IsNumber(r)?(a=parseInt(r),e[i]=r-a):e[i]=null}return e}if(this.IsNumber(t)){a=parseInt(t);e=t-a;return e}},this.CallFunction=function(t,e,a,i){switch(t){case"MAX":return this.MAX(e[0],e[1]);case"MIN":return this.MIN(e[0],e[1]);case"REF":return this.REF(e[0],e[1]);case"REFV":return this.REFV(e[0],e[1]);case"REFX":return this.REFX(e[0],e[1]);case"REFXV":return this.REFXV(e[0],e[1]);case"ABS":return this.ABS(e[0]);case"MA":return this.MA(e[0],e[1]);case"EMA":return this.EMA(e[0],e[1]);case"SMA":return this.SMA(e[0],e[1],e[2]);case"DMA":return this.DMA(e[0],e[1]);case"XMA":return this.XMA(e[0],e[1]);case"EXPMA":return this.EXPMA(e[0],e[1]);case"EXPMEMA":return this.EXPMEMA(e[0],e[1]);case"COUNT":return this.COUNT(e[0],e[1]);case"LLV":return this.LLV(e[0],e[1]);case"LLVBARS":return this.LLVBARS(e[0],e[1]);case"HHV":return this.HHV(e[0],e[1]);case"HHVBARS":return this.HHVBARS(e[0],e[1]);case"MULAR":return this.MULAR(e[0],e[1]);case"CROSS":return this.CROSS(e[0],e[1]);case"LONGCROSS":return this.LONGCROSS(e[0],e[1],e[2]);case"AVEDEV":return this.AVEDEV(e[0],e[1]);case"STD":return this.STD(e[0],e[1]);case"IF":case"IFF":return this.IF(e[0],e[1],e[2]);case"IFN":return this.IFN(e[0],e[1],e[2]);case"NOT":return this.NOT(e[0]);case"SUM":return this.SUM(e[0],e[1]);case"RANGE":return this.RANGE(e[0],e[1],e[2]);case"EXIST":return this.EXIST(e[0],e[1]);case"EXISTR":return this.EXISTR(e[0],e[1],e[2]);case"FILTER":return this.FILTER(e[0],e[1]);case"TFILTER":return this.TFILTER(e[0],e[1],e[2]);case"SLOPE":return this.SLOPE(e[0],e[1]);case"BARSLAST":return this.BARSLAST(e[0]);case"BARSCOUNT":return this.BARSCOUNT(e[0]);case"BARSSINCEN":return this.BARSSINCEN(e[0],e[1]);case"BARSSINCE":return this.BARSSINCE(e[0]);case"LAST":return this.LAST(e[0],e[1],e[2]);case"EVERY":return this.EVERY(e[0],e[1]);case"DEVSQ":return this.DEVSQ(e[0],e[1]);case"ZIG":return this.ZIG(e[0],e[1]);case"TROUGHBARS":return this.TROUGHBARS(e[0],e[1],e[2]);case"TROUGH":return this.TROUGH(e[0],e[1],e[2]);case"PEAKBARS":return this.PEAKBARS(e[0],e[1],e[2]);case"PEAK":return this.PEAK(e[0],e[1],e[2]);case"COST":return this.COST(e[0]);case"WINNER":return this.WINNER(e[0],a);case"PPART":return this.PPART(e[0],a);case"COSTEX":return this.COSTEX(e[0],e[1],a);case"LWINNER":return this.LWINNER(e[0],e[1],a);case"PWINNER":return this.PWINNER(e[0],e[1],a);case"FORCAST":return this.FORCAST(e[0],e[1]);case"STDP":return this.STDP(e[0],e[1]);case"VAR":return this.VAR(e[0],e[1]);case"VARP":return this.VARP(e[0],e[1]);case"UPNDAY":return this.UPNDAY(e[0],e[1]);case"DOWNNDAY":return this.DOWNNDAY(e[0],e[1]);case"NDAY":return this.NDAY(e[0],e[1],e[2]);case"RELATE":return this.RELATE(e[0],e[1],e[2]);case"COVAR":return this.COVAR(e[0],e[1],e[2]);case"BETA":return this.BETA(e[0]);case"BETA2":return this.BETA2(e[0],e[1],e[2]);case"WMA":return this.WMA(e[0],e[1]);case"MEMA":return this.MEMA(e[0],e[1]);case"SUMBARS":return this.SUMBARS(e[0],e[1]);case"REVERSE":return this.REVERSE(e[0]);case"SAR":return this.SAR(e[0],e[1],e[2]);case"SARTURN":return this.SARTURN(e[0],e[1],e[2]);case"BACKSET":return this.BACKSET(e[0],e[1]);case"BETWEEN":return this.BETWEEN(e[0],e[1],e[2]);case"STRCAT":return this.STRCAT(e[0],e[1]);case"CON2STR":return this.CON2STR(e[0],e[1]);case"DTPRICE":return this.DTPRICE(e[0],e[1]);case"ZTPRICE":return this.ZTPRICE(e[0],e[1]);case"COVER_C":case"COVER_O":case"COVER_H":case"COVER_L":case"COVER_A":case"COVER_V":return 2==e.length?this.CoverPeriod(t,e[0],e[1]):this.CoverPeriod(t,e[0]);case"MOD":return this.MOD(e[0],e[1]);case"POW":return this.POW(e[0],e[1]);case"CEILING":return this.CEILING(e[0]);case"FLOOR":return this.FLOOR(e[0]);case"FRACPART":return this.FRACPART(e[0]);case"ATAN":return this.Trigonometric(e[0],Math.atan);case"ACOS":return this.ACOS(e[0]);case"ASIN":return this.ASIN(e[0]);case"COS":return this.Trigonometric(e[0],Math.cos);case"SIN":return this.Trigonometric(e[0],Math.sin);case"TAN":return this.Trigonometric(e[0],Math.tan);case"LN":return this.Trigonometric(e[0],Math.log);case"LOG":return this.Trigonometric(e[0],l.default);case"EXP":return this.Trigonometric(e[0],Math.exp);case"SQRT":return this.Trigonometric(e[0],Math.sqrt);default:this.ThrowUnexpectedNode(a,"函数"+t+"不存在")}},this.CallCustomFunction=function(t,e,a,i){var r=Xi.CustomFunction.Data.get(t);if(!r||!r.Invoke)return[];var n=this,s={Name:t,Args:e,Symbol:a.Symbol,Period:a.Period,Right:a.Right,KData:a.Data,ThrowError:function(t){n.ThrowUnexpectedNode(i,t)}};return r.Invoke(s)},this.ThrowUnexpectedNode=function(t,e){var a=t.Marker,i=e||"执行异常";return this.ErrorHandler.ThrowError(a.Index,a.Line,a.Column,i)}}function ir(t,e){this.ErrorHandler=t,this.SymbolData=e,this.DRAWTEXT=function(t,e,a){var i=[],r={DrawData:i,DrawType:"DRAWTEXT",Text:a};if(t.length<=0)return r;var n="number"==typeof e;for(var s in t)i[s]=null,!isNaN(t[s])&&t[s]&&(n?i[s]=e:this.IsNumber(e[s])&&(i[s]=e[s]));return r},this.DRAWTEXT_FIX=function(t,e,a,i,r){var n={Position:null,DrawType:"DRAWTEXT_FIX",Text:r};if(t.length<=0)return n;for(var s in t)if(!isNaN(t[s])&&t[s])return n.Position={X:e,Y:a,Type:i},n;return n},this.SUPERDRAWTEXT=function(t,e,a,i,r){var n=[],s={DrawData:n,DrawType:"SUPERDRAWTEXT",Text:a,YOffset:r,Direction:i,TextAlign:"center"};if(t.length<=0)return s;var o="number"==typeof e;for(var h in t)n[h]=null,!isNaN(t[h])&&t[h]&&(o?n[h]=e:this.IsNumber(e[h])&&(n[h]=e[h]));return s},this.STICKLINE=function(t,e,a,i,r){var n=[],s={DrawData:n,DrawType:"STICKLINE",Width:i,Type:r};if(s.Width<0&&(s.Width=50),s.Type<0&&(s.Type=1),t.length<=0)return s;var o="number"==typeof e,h="number"==typeof a;for(var l in t)if(n[l]=null,!isNaN(t[l])&&t[l])if(o&&h)n[l]={Value:e,Value2:a};else if(o&&!h){if(isNaN(a[l]))continue;n[l]={Value:e,Value2:a[l]}}else if(!o&&h){if(isNaN(e[l]))continue;n[l]={Value:e[l],Value2:a}}else{if(isNaN(e[l])||isNaN(a[l]))continue;n[l]={Value:e[l],Value2:a[l]}}return s},this.DRAWLINE=function(t,e,a,i,r){var n=[],s={DrawData:n,DrawType:"DRAWLINE",Expand:r};if(t.length<=0)return s;for(var o=Math.max(t.length,a.length),h=!1,l=!1,u={Start:{},End:{},List:new Array},C=0;C<o;++C)if(n[C]=null,C<t.length&&C<a.length){if(0==h&&0==l){if(null==t[C]||!t[C])continue;h=!0,u.Start={ID:C,Value:e[C]}}else if(1==h&&0==l){var D=null!=a[C]&&a[C];if(!D)continue;D&&(l=!0,u.End={ID:C,Value:i[C]})}if(1==h&&1==l){var c=this.CalculateDrawLine(u);for(var f in c){var d=c[f];n[d.ID]=d.Value}h=l=!1,u={Start:{},End:{}}}}return s},this.DRAWBAND=function(t,e,a,i){for(var r=[],n={DrawData:r,DrawType:"DRAWBAND",Color:[e.toLowerCase(),i.toLowerCase()]},s=Math.max(t.length,a.length),o=0;o<s;++o){var h={Value:null,Value2:null};o<t.length&&(h.Value=t[o]),o<a.length&&(h.Value2=a[o]),r.push(h)}return n},this.GetDataByIndex=function(t,e){var a={Result:!1,Data:null};return this.IsNumber(t)?(a.Result=!0,a.Data=t):e<t.length?(a.Result=!0,a.Data=t[e]):a.Result=!1,a},this.FILLRGN=function(t,e,a){var i=[],r={DrawData:i,DrawType:"FILLRGN"};this.IsNumber(e),this.IsNumber(a);if(Array.isArray(t))for(var n in t){i[n]=null;var s=t[n];if(s){var o=this.GetDataByIndex(e,n);if(o.Result){var h=this.GetDataByIndex(a,n);if(h.Result){var l={Value:o.Data,Value2:h.Data};i[n]=l}}}}else if(t)for(n=0;n<this.SymbolData.Data.Data.length;++n){i[n]=null;o=this.GetDataByIndex(e,n);if(o.Result){h=this.GetDataByIndex(a,n);if(h.Result){l={Value:o.Data,Value2:h.Data};i[n]=l}}}return r},this.DRAWKLINE=function(t,e,a,i){for(var r=[],n={DrawData:r,DrawType:"DRAWKLINE"},s=Math.max(t.length,e.length,a.length,i.length),o=0;o<s;++o){var h={Open:null,High:null,Low:null,Close:null};o<t.length&&o<e.length&&o<a.length&&o<i.length&&(h.Open=e[o],h.High=t[o],h.Low=a[o],h.Close=i[o]),r[o]=h}return n},this.DRAWKLINE_IF=function(t,e,a,i,r){for(var n=[],s={DrawData:n,DrawType:"DRAWKLINE_IF"},o=Math.max(t.length,e.length,a.length,i.length,r.length),h=0;h<o;++h){var l={Open:null,High:null,Low:null,Close:null};h<e.length&&h<a.length&&h<i.length&&h<r.length&&h<t.length&&t[h]&&(l.Open=a[h],l.High=e[h],l.Low=i[h],l.Close=r[h]),n[h]=l}return s},this.POLYLINE=function(t,e){var a=[],i={DrawData:a,DrawType:"POLYLINE"},r="number"==typeof e,n=!1,s=!1;if(r)for(var o in t)if(a[o]=null,0==n){if(!t[o])continue;a[o]=e,n=!0}else a[o]=e;else{var h={Start:{},End:{},List:new Array};for(var l in t)if(a[l]=null,0==n&&0==s){if(null==t[l]||!t[l])continue;if(l>=e.length||!this.IsNumber(e[l]))continue;n=!0,h.Start={ID:parseInt(l),Value:e[l]}}else if(1==n&&0==s){if(null==t[l]||!t[l])continue;if(l>=e.length||!this.IsNumber(e[l]))continue;h.End={ID:parseInt(l),Value:e[l]};var u=this.CalculateDrawLine(h);for(var C in u){var D=u[C];a[D.ID]=D.Value}var c={ID:h.End.ID,Value:h.End.Value};h={Start:c,End:{}}}}return i},this.DRAWNUMBER=function(t,e,a){var i={Value:new Array,Text:new Array},r={DrawData:i,DrawType:"DRAWNUMBER"},n="number"==typeof a,s=void 0;for(var o in n&&(s=a.toFixed(2)),t)if(i.Value[o]=null,t[o]&&!(o>=e.length)&&this.IsNumber(e[o]))if(n)i.Value[o]=e[o],i.Text[o]=s;else{if(o>=a.length||!a[o])continue;i.Value[o]=e[o],"number"==typeof a[o]?i.Text[o]=a[o].toFixed(2):i.Text[o]=a[o].toString()}return r},this.DRAWICON=function(t,e,a){var i=Xi.GetDrawIcon(a);if(!i){var r=new g.default([[1,{Symbol:"↑",Color:"rgb(238,44,44)"}],[2,{Symbol:"↓",Color:"rgb(0,139,69)"}],[3,{Symbol:"😧"}],[4,{Symbol:"😨"}],[5,{Symbol:"😁"}],[6,{Symbol:"😱"}],[7,{Symbol:"B",Color:"rgb(238,44,44)"}],[8,{Symbol:"S",Color:"rgb(0,139,69)"}],[9,{Symbol:"💰"}],[10,{Symbol:"📪"}],[11,{Symbol:"👆"}],[12,{Symbol:"👇"}],[13,{Symbol:"B",Color:"rgb(178,34,34)"}],[14,{Symbol:"S",Color:"rgb(0,139,69)"}],[36,{Symbol:"Χ",Color:"rgb(238,44,44)"}],[37,{Symbol:"X",Color:"rgb(0,139,69)"}],[38,{Symbol:"▲",Color:"rgb(238,44,44)"}],[39,{Symbol:"▼",Color:"rgb(0,139,69)"}],[40,{Symbol:"◉",Color:"rgb(238,44,44)"}],[41,{Symbol:"◈",Color:"rgb(238,44,44)"}],[42,{Symbol:"📌"}],[43,{Symbol:"💎"}],[44,{Symbol:"🥇"}],[45,{Symbol:"🥈"}],[46,{Symbol:"🥉"}],[47,{Symbol:"🏅"}]]);i=r.get(a)}i||(i={Symbol:"🚩"});var n=[],s={DrawData:n,DrawType:"DRAWICON",Icon:i};if(t.length<=0)return s;var o="number"==typeof e;if("number"==typeof t){if(!t)return s;for(var h=0;h<this.SymbolData.Data.Data.length;++h)o?n[h]=e:h<e.length&&this.IsNumber(e[h])?n[h]=e[h]:n[h]=null;return s}for(var h in t)n[h]=null,t[h]&&(o?n[h]=e:this.IsNumber(e[h])&&(n[h]=e[h]));return s},this.DRAWCHANNEL=function(t,e,a,i,r,n,s){var o=[],h={DrawData:o,DrawType:"DRAWCHANNEL",Border:{}};if(t.length<=0)return h;if(i&&(h.Border.Color=i),s&&(h.AreaColor=s),r>0&&(h.Border.Width=r),n){var l=n.split(",");for(var u in h.Border.Dotted=[],l){var C=l[u];if(C){var D=parseInt(l[u]);D<=0||h.Border.Dotted.push(D)}}h.Border.Dotted.length<=0&&(h.Border.Dotted=null)}var c="number"==typeof e,f="number"==typeof a;if("number"==typeof t){if(!t)return h;for(u=0;u<this.SymbolData.Data.Data.length;++u)if(o[u]=null,c&&f)o[u]={Value:e,Value2:a};else if(c&&!f){if(isNaN(a[u]))continue;o[u]={Value:e,Value2:a[u]}}else if(!c&&f){if(isNaN(e[u]))continue;o[u]={Value:e[u],Value2:a}}else{if(isNaN(e[u])||isNaN(a[u]))continue;o[u]={Value:e[u],Value2:a[u]}}}else for(u=0;u<t.length;++u)if(o[u]=null,!isNaN(t[u])&&t[u])if(c&&f)o[u]={Value:e,Value2:a};else if(c&&!f){if(isNaN(a[u]))continue;o[u]={Value:e,Value2:a[u]}}else if(!c&&f){if(isNaN(e[u]))continue;o[u]={Value:e[u],Value2:a}}else{if(isNaN(e[u])||isNaN(a[u]))continue;o[u]={Value:e[u],Value2:a[u]}}return h},this.RGB=function(t,e,a){var i="RGB("+t+","+e+","+a+")";return i},this.RGBA=function(t,e,a,i){var r="RGB("+t+","+e+","+a+","+i+")";return r},this.PARTLINE=function(t){var e=[],a={DrawData:e,DrawType:"PARTLINE"};if(t.length<3)return a;for(var i=t[0],r=[],n=1;n<t.length&&n+1<t.length;n+=2)r.push({Cond:t[n],RGB:t[n+1]});for(var n in i){var s={Value:null,RGB:null};e[n]=s;var o=i[n];if(this.IsNumber(o)){var h=null;for(var l in r){var u=r[l];if(Array.isArray(u.Cond)){if(n<u.Cond.length&&u.Cond[n]){h=u.RGB;break}}else if(this.IsNumber(u.Cond)&&u.Cond){h=u.RGB;break}}h&&(s.Value=o,s.RGB=h)}}return a},this.DRAWGBK=function(t,e,a,i){var r={Color:[],Angle:i};e&&r.Color.push(e),a&&r.Color.push(a);var n={DrawData:null,DrawType:"DRAWGBK"};if(Array.isArray(t))for(var s in t){var o=t[s];if(o){n.DrawData=r;break}}else t&&(n.DrawData=r);return n},this.DRAWTEXT_LINE=function(t,e,a,i,r,n,s){var o={Text:{Title:a,Color:i},Line:{Type:n,Color:s}};r<=0&&(r=12),o.Text.Font=r*V()+"px 微软雅黑";var h={DrawData:null,DrawType:"DRAWTEXT_LINE"};if(Array.isArray(t))for(var l in t){var u=t[l];if(u){Array.isArray(e)?o.Price=e[l]:o.Price=e,h.DrawData=o;break}}else t&&(Array.isArray(e)?o.Price=e[0]:o.Price=e,h.DrawData=o);return h},this.DRAWRECTREL=function(t,e,a,i,r){var n={Rect:{Left:t,Top:e,Right:a,Bottom:i},Color:r};0==r&&(n.Color=null);var s={DrawData:n,DrawType:"DRAWRECTREL"};return s},this.DRAWOVERLAYLINE=function(t,e,a){var i={Data:t,MainData:e};a&&"string"==typeof a&&(i.Title=a);var r={DrawData:i,DrawType:"DRAWOVERLAYLINE"};return r}}ar.prototype.GetPeriodInfo=function(t){var e=[{Name:"MIN1",Period:4,Order:1},{Name:"MIN5",Period:5,Order:2},{Name:"MIN15",Period:6,Order:3},{Name:"MIN30",Period:7,Order:4},{Name:"MIN60",Period:8,Order:5},{Name:"DAY",Period:0,Order:1e3},{Name:"WEEK",Period:1,Order:1001},{Name:"MONTH",Period:2,Order:1002},{Name:"YEAR",Period:3,Order:1003}];if(t.Name){for(var a in e)if(t.Name&&e[a].Name==t.Name)return e[a];return null}if(Le.IsNumber(t.PeriodID)){for(var a in e)if(e[a].Period==t.PeriodID)return e[a];return null}return null},ar.prototype.IsNumber=function(t){return null!=t&&!isNaN(t)},ar.prototype.IsDivideNumber=function(t){return null!=t&&(!isNaN(t)&&0!=t)},ar.MOD=function(t,e){if(t<0&&e<0||t>=0&&e>=0){if(parseInt(t)==t&&parseInt(e)==e)return t%e;var a=parseFloat((t-Math.floor(t/e)*e).toFixed(1));return a}var i=Math.abs(t),r=Math.abs(e);a=Math.abs(Math.abs(e)*(Math.floor(i/r)+1)-Math.abs(t));return e<0&&(a=-a),a},ir.prototype.CalculateDrawLine=function(t){t.List=[];for(var e=t.Start.ID;e<=t.End.ID;++e)t.List.push(e);var a=Math.abs(t.Start.Value-t.End.Value),i=t.List.length-1,r=[];if(r.push({ID:t.Start.ID,Value:t.Start.Value}),t.Start.Value>t.End.Value)for(var n=1;n<t.List.length-1;++n){var s=a*(t.List.length-1-n)/i+t.End.Value;r.push({ID:t.List[n],Value:s})}else for(var o=1;o<t.List.length-1;++o){s=a*o/i+t.Start.Value;r.push({ID:t.List[o],Value:s})}return r.push({ID:t.End.ID,Value:t.End.Value}),r},ir.prototype.IsNumber=function(t){return null!=t&&!isNaN(t)},ir.prototype.IsDrawFunction=function(t){var e=new I.default(["STICKLINE","DRAWTEXT","SUPERDRAWTEXT","DRAWLINE","DRAWBAND","DRAWKLINE","DRAWKLINE_IF","PLOYLINE","POLYLINE","DRAWNUMBER","DRAWICON","DRAWCHANNEL","PARTLINE","DRAWTEXT_FIX","DRAWGBK","DRAWTEXT_LINE","DRAWRECTREL","DRAWOVERLAYLINE","FILLRGN"]);return!!e.has(t)};var rr={YCLOSE:3,OPEN:4,HIGH:5,LOW:6,CLOSE:7,VOL:8,AMOUNT:10,AMPLITUDE:13,INCREASE:14,EXCHANGERATE:37};function nr(t,e,a){this.AST=t,this.Execute=a,this.Symbol="600000.sh",this.Name,this.Data=null,this.DayData=null,this.SourceData=null,this.MarketValue=null,this.Period=0,this.Right=0,this.DataType=0,this.IsBeforeData=!1,this.DayCount,this.Arguments=[],this.KLineApiUrl=Xi.Domain+"/API/KLine2",this.MinuteKLineApiUrl=Xi.Domain+"/API/KLine3",this.RealtimeApiUrl=Xi.Domain+"/API/stock",this.HistoryMinuteApiUrl=Ma.Domain+"/API/StockMinuteData",this.StockHistoryDayApiUrl=Xi.Domain+"/API/StockHistoryDay",this.StockHistoryDay3ApiUrl=Xi.Domain+"/API/StockHistoryDay3",this.StockNewsAnalysisApiUrl=Xi.CacheDomain+"/cache/newsanalyze",this.HKToSHSZApiUrl=[Xi.CacheDomain+"/cache/historyday/all/hk2shsz.json",Xi.CacheDomain+"/cache/analyze/hk2shsz/hk2shsz.json",Xi.Domain+"/API/HKToSHSZMinuteData",Xi.CacheDomain+"/cache/analyze/hk2szshanalyze"],this.MaxRequestDataCount=1e3,this.MaxRequestMinuteDayCount=5,this.KLineDateTimeRange,this.LatestData,this.IndexData,this.LatestIndexData,this.FinanceData=new g.default,this.MarginData=new g.default,this.HKToSHSZData=new g.default,this.NewsAnalysisData=new g.default,this.ExtendData=new g.default,this.UserData=new g.default,this.CustomAPIData=new g.default,this.ScriptIndexOutData=new g.default,this.OtherSymbolData=new g.default,this.SectionFinanceData=new g.default,this.ThrowSFPeirod=new I.default,this.NetworkFilter,e&&(e.HQDataType&&(this.DataType=e.HQDataType),e.Data&&(this.Data=e.Data,this.DataType!=ur.MINUTE_ID&&this.DataType!=ur.MULTIDAY_MINUTE_ID&&this.DataType!=ur.HISTORY_MINUTE_ID&&(this.Period=e.Data.Period,this.Right=e.Data.Right)),e.SourceData&&(this.SourceData=e.SourceData),e.Symbol&&(this.Symbol=e.Symbol),e.Name&&(this.Name=e.Name),e.MaxRequestDataCount>0&&(this.MaxRequestDataCount=e.MaxRequestDataCount),e.MaxRequestMinuteDayCount>0&&(this.MaxRequestMinuteDayCount=e.MaxRequestMinuteDayCount),e.KLineApiUrl&&(this.KLineApiUrl=e.KLineApiUrl),e.Right&&(this.Right=e.Right),e.Period&&(this.Period=e.Period),!0===e.IsBeforeData&&(this.IsBeforeData=e.IsBeforeData),e.NetworkFilter&&(this.NetworkFilter=e.NetworkFilter),e.DayCount>0&&(this.DayCount=e.DayCount),e.Arguments&&(this.Arguments=e.Arguments),e.KLineRange&&(this.KLineDateTimeRange=e.KLineRange)),this.RecvError=function(t){throw M.Complier.Log("[JSSymbolData::RecvError] ajax error.",t.status),{FunctionName:"RecvError",Request:t}},this.GetLatestData=function(){if(this.LatestData)return this.Execute.RunNextJob();var t=this;if(this.NetworkFilter){var e={Name:"JSSymbolData::GetLatestData",Explain:"DYNAINFO()",Request:{Url:t.RealtimeApiUrl,Type:"POST",Data:{symbol:[this.Symbol],field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","exchangerate","amplitude"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(e,(function(e){t.RecvLatestData(e),t.Execute.RunNextJob()})),1==e.PreventDefault)return}x.HttpRequest({url:t.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","exchangerate","amplitude"],symbol:[this.Symbol]},type:"post",dataType:"json",async:!0,success:function(e){t.RecvLatestData(e),t.Execute.RunNextJob()},error:function(e){t.RecvError(e)}})},this.RecvLatestData=function(t){if(t.stock&&1==t.stock.length){var e=t.stock[0];this.LatestData={Symbol:e.symbol,Name:e.name,Date:e.date,Time:e.time,YClose:e.yclose,Price:e.price,Open:e.open,High:e.high,Low:e.low,Vol:e.vol,Amount:e.amount,Increase:e.increase,Exchangerate:e.exchangerate,Amplitude:e.amplitude},M.Complier.Log("[JSSymbolData::RecvLatestData]",this.LatestData)}},this.GetLatestCacheData=function(t){if(!this.LatestData)return null;switch(t){case rr.YCLOSE:return this.LatestData.YClose;case rr.OPEN:return this.LatestData.Open;case rr.HIGH:return this.LatestData.High;case rr.LOW:return this.LatestData.Low;case rr.VOL:return this.LatestData.Vol;case rr.AMOUNT:return this.LatestData.Amount;case rr.INCREASE:return this.LatestData.Increase;case rr.EXCHANGERATE:return this.LatestData.Exchangerate;case rr.AMPLITUDE:return this.LatestData.Amplitude;case rr.CLOSE:return this.LatestData.Price;default:return null}},this.GetLatestIndexData=function(){if(this.LatestIndexData)return this.Execute.RunNextJob();var t=this;if(this.NetworkFilter){var e={Name:"JSSymbolData::GetLatestIndexData",Explain:"最新大盘数据",Request:{Url:t.RealtimeApiUrl,Type:"POST",Data:{symbol:["000001.sh"],field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","amplitude"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(e,(function(e){t.RecvLatestIndexData(e),t.Execute.RunNextJob()})),1==e.PreventDefault)return}x.HttpRequest({url:t.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","amplitude"],symbol:["000001.sh"]},type:"post",dataType:"json",async:!0,success:function(e){t.RecvLatestIndexData(e),t.Execute.RunNextJob()},error:function(e){t.RecvError(e)}})},this.RecvLatestIndexData=function(t){if(t.stock&&1==t.stock.length){var e=t.stock[0];this.LatestIndexData={Symbol:e.symbol,Name:e.name,Date:e.date,Time:e.time,YClose:e.yclose,Price:e.price,Open:e.open,High:e.high,Low:e.low,Vol:e.vol,Amount:e.amount,Increase:e.increase,Amplitude:e.amplitude},M.Complier.Log("[JSSymbolData::RecvLatestIndexData]",this.LatestIndexData)}},this.GetLatestIndexCacheData=function(t){if(!this.LatestIndexData)return null;switch(t){case"FROMOPEN":var e=parseInt(this.LatestIndexData.Time/100),a=60*parseInt(e/100)+e%100,i=0;return i=a<=565?0:a<570?1:a<=690?a-570+1:a<780?121:a<=900?122+a-780:242,i;default:return null}},this.GetVolRateData=function(t,e){var a=t.ID.toString()+"-VolRate-"+this.Symbol;if(this.ExtendData.has(a))return this.Execute.RunNextJob();var i=this;x.HttpRequest({url:i.RealtimeApiUrl,data:{field:["name","symbol","avgvol5","date"],symbol:[this.Symbol]},type:"post",dataType:"json",async:!0,success:function(t){i.RecvVolRateData(t,a),i.Execute.RunNextJob()},error:function(t){i.RecvError(t)}})},this.RecvVolRateData=function(t,e){if(t.stock&&1==t.stock.length){var a=t.stock[0].avgvol5,i=t.stock[0].date,r={AvgVol5:a,Date:i};this.ExtendData.set(e,r),M.Complier.Log("[JSSymbolData::RecvVolRateData]",r)}},this.GetVolRateCacheData=function(t){var e=or.JOB_DOWNLOAD_VOLR_DATA.toString()+"-VolRate-"+this.Symbol;e&&this.ExtendData.has(e)||this.Execute.ThrowUnexpectedNode(t,"不支持VOLR");for(var a=[],i=this.ExtendData.get(e),r=i.AvgVol5/241,n=0,s=0,o=0;s<this.Data.Data.length;++s){a[s]=null;var h=this.Data.Data[s],l=h.DateTime;if(l){var u=l.split(" ");if(2==u.length){var C=parseInt(u[0]);C==i.Date&&(n+=h.Vol,r>0&&(a[s]=n/(o+1)/r*100),++o)}}}return a},this.GetGroupData=function(t){var e=t.ID.toString()+"-Group-"+this.Symbol;if(this.ExtendData.has(e))return this.Execute.RunNextJob();var a=this;if(this.NetworkFilter){var i={Name:"JSSymbolData::GetGroupData",Explain:"HYBLOCK|DYBLOCK",Request:{Url:a.RealtimeApiUrl,Type:"POST",Data:{symbol:[this.Symbol],field:["name","symbol","industry","concept","region"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,(function(t){a.RecvGroupData(t,e),a.Execute.RunNextJob()})),1==i.PreventDefault)return}x.HttpRequest({url:a.RealtimeApiUrl,data:{field:["name","symbol","industry","concept","region"],symbol:[this.Symbol]},type:"post",dataType:"json",async:!0,success:function(t){a.RecvGroupData(t,e),a.Execute.RunNextJob()},error:function(t){a.RecvError(t)}})},this.RecvGroupData=function(t,e){if(t.stock&&1==t.stock.length){var a=t.stock[0],i=a.industry,r=a.concept,n=a.region,s={Industry:[],Concept:[],Region:[]};if(i)for(var o in i){var h=i[o];s.Industry.push({Name:h.name,Symbol:h.symbol})}if(r)for(var o in r){h=r[o];s.Concept.push({Name:h.name,Symbol:h.symbol})}if(n)for(var o in n){h=n[o];s.Region.push({Name:h.name,Symbol:h.symbol})}this.ExtendData.set(e,s)}},this.GetIndexData=function(){if(this.IndexData)return this.Execute.RunNextJob();var t=this;if(It.IsDayPeriod(this.Period,!0)){if(this.NetworkFilter){var e={Name:"JSSymbolData::GetIndexData",Explain:"大盘数据",Period:t.Period,Request:{Url:t.KLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol","up","down","stop","unchanged"],symbol:"000001.sh",start:-1,count:t.MaxRequestDataCount+500}},Self:this,PreventDefault:!1};if(this.NetworkFilter(e,(function(e){t.RecvIndexHistroyData(e),t.Execute.RunNextJob()})),1==e.PreventDefault)return}x.HttpRequest({url:t.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","up","down","stop","unchanged"],symbol:"000001.sh",start:-1,count:t.MaxRequestDataCount+500},type:"post",dataType:"json",async:!0,success:function(e){t.RecvIndexHistroyData(e),t.Execute.RunNextJob()},error:function(e){t.RecvError(e)}})}else if(It.IsMinutePeriod(this.Period,!0)){if(this.NetworkFilter){e={Name:"JSSymbolData::GetIndexData",Explain:"大盘数据",Period:t.Period,Request:{Url:t.MinuteKLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:"000001.sh",start:-1,count:t.MaxRequestDataCount+5}},Self:this,PreventDefault:!1};if(this.NetworkFilter(e,(function(e){t.RecvIndexMinuteHistroyData(e),t.Execute.RunNextJob()})),1==e.PreventDefault)return}x.HttpRequest({url:t.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:"000001.sh",start:-1,count:t.MaxRequestMinuteDayCount+5},type:"post",dataType:"json",async:!0,success:function(e){t.RecvIndexMinuteHistroyData(e),t.Execute.RunNextJob()},error:function(e){t.RecvError(e)}})}},this.RecvIndexHistroyData=function(t){M.Complier.Log("[JSSymbolData::RecvIndexHistroyData] recv data",t);var e=this.JsonDataToHistoryData(t);this.IndexData=new It,this.IndexData.DataType=0,this.IndexData.Data=e;var a=this.SourceData.GetOverlayData(this.IndexData.Data);if(this.IndexData.Data=a,It.IsDayPeriod(this.Period,!1)){var i=this.IndexData.GetPeriodData(this.Period);this.IndexData.Data=i}},this.RecvIndexMinuteHistroyData=function(t){M.Complier.Log("[JSSymbolData::RecvIndexMinuteHistroyData] recv data",t);var e=this.JsonDataToMinuteHistoryData(t);if(this.IndexData=new It,this.IndexData.DataType=1,this.IndexData.Data=e,It.IsMinutePeriod(this.Period,!1)){var a=this.IndexData.GetPeriodData(this.Period);this.IndexData.Data=a}},this.GetOtherSymbolData=function(t){var e=t.Args,a=this.Symbol;if(e.length>0){var i=e[0];if(i.Type==$i.Literal)a=i.Value;else if(i.Type==$i.Identifier){var r=!1;for(var n in this.Arguments){var s=this.Arguments[n];if(s.Name==i.Name){a=s.Value,r=!0;break}}if(!r){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,t.FunctionName+"() Error: can't read "+i.Name)}}}if(t.Symbol=a.toLowerCase(),t.Symbol==this.Symbol)return this.Execute.RunNextJob();if(this.OtherSymbolData.has(t.Symbol))return this.Execute.RunNextJob();var h=this;if(It.IsDayPeriod(this.Period,!0)){if(this.NetworkFilter){var l=this.Data.GetDateRange(),u={Name:"JSSymbolData::GetOtherSymbolData",Explain:"指定个股数据",Period:h.Period,DateRange:l,Request:{Url:h.KLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:h.MaxRequestDataCount+500}},Self:this,PreventDefault:!1};if(this.NetworkFilter(u,(function(e){h.RecvOtherSymbolKDayData(e,t),h.Execute.RunNextJob()})),1==u.PreventDefault)return}x.HttpRequest({url:h.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:h.MaxRequestDataCount+500},type:"post",dataType:"json",async:!0,success:function(e){h.RecvOtherSymbolKDayData(e,t),h.Execute.RunNextJob()},error:function(t){h.RecvError(t)}})}else if(It.IsMinutePeriod(this.Period,!0)){if(this.NetworkFilter){l=this.Data.GetDateRange(),u={Name:"JSSymbolData::GetOtherSymbolData",Explain:"指定个股数据",Period:h.Period,DateRange:l,Request:{Url:h.MinuteKLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:h.MaxRequestDataCount+5}},Self:this,PreventDefault:!1};if(this.NetworkFilter(u,(function(e){h.RecvOtherSymbolKMinuteData(e,t),h.Execute.RunNextJob()})),1==u.PreventDefault)return}x.HttpRequest({url:h.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:h.MaxRequestMinuteDayCount+5},type:"post",dataType:"json",async:!0,success:function(e){h.RecvOtherSymbolKMinuteData(e,t),h.Execute.RunNextJob()},error:function(t){h.RecvError(t)}})}},this.RecvOtherSymbolKDayData=function(t,e){M.Complier.Log("[JSSymbolData::RecvOtherSymbolKDayData] recv data",t);var a=this.JsonDataToHistoryData(t),i=new It;i.DataType=0,i.Data=a;var r=this.SourceData.GetOverlayData(i.Data);if(i.Data=r,It.IsDayPeriod(this.Period,!1)){var n=i.GetPeriodData(this.Period);i.Data=n}this.OtherSymbolData.set(e.Symbol,i)},this.RecvOtherSymbolKMinuteData=function(t,e){M.Complier.Log("[JSSymbolData::RecvOtherSymbolKMinuteData] recv data",t);var a=this.JsonDataToMinuteHistoryData(t),i=new It;if(i.DataType=1,i.Data=a,It.IsMinutePeriod(this.Period,!1)){var r=i.GetPeriodData(this.Period);i.Data=r}this.OtherSymbolData.set(e.Symbol,i)},this.GetOtherSymolCacheData=function(t,e){if(e.length<=0)return this.GetSymbolCacheData(t);var a=e[0].toString().toLowerCase();if(a==this.Symbol)return this.GetSymbolCacheData(t);if(!this.OtherSymbolData.has(a))return[];var i=this.OtherSymbolData.get(a),r=a.toUpperCase();switch(t){case"CLOSE":case"C":return i.GetClose();case"VOL":case"V":return Li.IsSHSZ(r)?i.GetVol(100):i.GetVol();case"OPEN":case"O":return i.GetOpen();case"HIGH":case"H":return i.GetHigh();case"LOW":case"L":return i.GetLow();case"AMOUNT":case"AMO":return i.GetAmount();case"VOLINSTK":return i.GetPosition()}},this.GetIndexCacheData=function(t){if(!this.IndexData)return new Array;switch(t){case"INDEXA":return this.IndexData.GetAmount();case"INDEXC":return this.IndexData.GetClose();case"INDEXH":return this.IndexData.GetHigh();case"INDEXL":return this.IndexData.GetLow();case"INDEXO":return this.IndexData.GetOpen();case"INDEXV":return this.IndexData.GetVol();case"INDEXADV":return this.IndexData.GetUp();case"INDEXDEC":return this.IndexData.GetDown()}},this.GetBlockSymbol=function(t){var e=new g.default([["沪深A股","CNA.ci"],["创业板","GEM.ci"],["沪市A股","SHA.ci"],["中小板","SME.ci"],["深市A股","SZA.ci"]]);if(e.has(t))return e.get(t);if(!t)return null;var a=null,i=t.toUpperCase();if(i.indexOf(".SH")>0||i.indexOf(".SZ")>0){var r=new I.default(["000001.SH","000003.SH","000016.SH","000300.SH","000905.SH","399001.SZ"," 399005.SZ","399006.SZ"]);if(!r.has(i))return null;a=t.replace(".SH",".sh"),a=t.replace(".SZ",".sz")}else t.indexOf(".CI")>0&&(a=t.replace(".CI",".ci"));return a},this.GetIndexIncreaseData=function(t){var e=null;if(t.IsSelfSymbol)e=this.Symbol;else{if(!t.Args||t.Args.length<=0){var a=t.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,t.FunctionName+" Error: 参数不能为空")}e=t.Args[0].Value}var i=this.GetBlockSymbol(e);if(!i){a=t.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,t.FunctionName+" Error: can't support "+e)}var r=t.ID.toString()+"-UpCount-"+i,n=t.ID.toString()+"-DownCount-"+i;if(this.ExtendData.has(r)&&this.ExtendData.has(n))return this.Execute.RunNextJob();var s=this;if(this.DataType===ur.MINUTE_ID||this.DataType===ur.MULTIDAY_MINUTE_ID){var o=Xi.CacheDomain+"/cache/analyze/increaseanalyze/"+i+".json";M.Complier.Log("[JSSymbolData::GetIndexIncreaseData] minute Get url=",o),x.HttpRequest({url:o,type:"get",dataType:"json",async:!0,success:function(t){s.RecvMinuteIncreaseData(t,{UpKey:r,DownKey:n}),s.Execute.RunNextJob()},error:function(t){s.RecvError(t)}})}else this.DataType===ur.KLINE_ID&&It.IsDayPeriod(this.Period,!0)?(M.Complier.Log("[JSSymbolData::GetIndexIncreaseData] K day Get url=",s.KLineApiUrl),x.HttpRequest({url:s.KLineApiUrl,data:{symbol:i,start:-1,count:s.MaxRequestDataCount,field:["up","down"]},type:"post",dataType:"json",async:!0,success:function(t){s.RecvHistoryIncreaseData(t,{UpKey:r,DownKey:n}),s.Execute.RunNextJob()},error:function(t){s.RecvError(t)}})):this.Execute.RunNextJob()},this.RecvHistoryIncreaseData=function(t,e){M.Complier.Log("[JSSymbolData::RecvHistoryIncreaseData] recv data",t);var a,i,r=[],n=[];for(var s in t.data){var o=t.data[s],h=new ft,l=new ft;h.Date=o[0],h.Value=o[8],r[s]=h,l.Date=o[0],l.Value=o[9],n[s]=l}a=this.SourceData?this.SourceData.GetFittingData(r):this.Data.GetFittingData(aryData),i=this.SourceData?this.SourceData.GetFittingData(n):this.Data.GetFittingData(aryData),this.ExtendData.set(e.UpKey,a),this.ExtendData.set(e.DownKey,i)},this.RecvMinuteIncreaseData=function(t,e){if(M.Complier.Log("[JSSymbolData::RecvMinuteIncreaseData] recv data",t),t.minute){var a=t.minute;if(a.time&&a.up&&a.down){var i=[],r=[];if(this.IsBeforeData)for(var n=0,s=0;n<this.Data.Data.length;++n){i[n]=null,r[n]=null;var o=this.Data.Data[n];if(!o.Before){var h=o.DateTime;if(h){var l=h.split(" ");if(2==l.length){var u=parseInt(l[0]);u==t.date&&(i[n]=a.up[s],r[n]=a.down[s],++s)}}}}else for(n=0,s=0;n<this.Data.Data.length;++n){i[n]=null,r[n]=null;o=this.Data.Data[n],h=o.DateTime;if(h){l=h.split(" ");if(2==l.length){u=parseInt(l[0]);u==t.date&&(i[n]=a.up[s],r[n]=a.down[s],++s)}}}this.ExtendData.set(e.UpKey,i),this.ExtendData.set(e.DownKey,r)}}},this.GetIndexIncreaseCacheData=function(t,e,a){var i,r=this.GetBlockSymbol(e);if(r||this.Execute.ThrowUnexpectedNode(a,"不支持函数"+t+"("+e+")"),"UPCOUNT"==t||"ADVANCE"==t?i=or.JOB_DOWNLOAD_INDEX_INCREASE_DATA.toString()+"-UpCount-"+r:"DOWNCOUNT"!=t&&"DECLINE"!=t||(i=or.JOB_DOWNLOAD_INDEX_INCREASE_DATA.toString()+"-DownCount-"+r),i&&this.ExtendData.has(i)||this.Execute.ThrowUnexpectedNode(a,"不支持函数"+t+"("+e+")"),this.DataType===ur.MINUTE_ID||this.DataType===ur.MULTIDAY_MINUTE_ID)return this.ExtendData.get(i);if(this.DataType===ur.KLINE_ID&&It.IsDayPeriod(this.Period,!0)){var n=this.ExtendData.get(i),s=new It;if(s.Data=n,s.Period=this.Period,s.Period>0){var o=s.GetPeriodSingleData(s.Period);s.Data=o}return s.GetValue()}return null},this.GetSymbolData=function(){if(this.Data)return this.Execute.RunNextJob();var t=this;if(this.DataType!==ur.MINUTE_ID)if(this.DataType!==ur.MULTIDAY_MINUTE_ID){if(It.IsDayPeriod(this.Period,!0)){if(this.NetworkFilter){var e={Name:"JSSymbolData::GetSymbolData",Explain:"日线数据",Request:{Url:t.RealtimeApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestDataCount}},Self:this,PreventDefault:!1};if(this.KLineDateTimeRange&&(e.Request.KLineDataTimeRange={Start:{Date:this.KLineDateTimeRange.Start.Date},End:{Date:this.KLineDateTimeRange.End.Date}},this.IsNumber(this.KLineDateTimeRange.Start.Time)&&(e.Request.KLineDataTimeRange.Start.Time=this.KLineDateTimeRange.Start.Time),this.IsNumber(this.KLineDateTimeRange.End.Time)&&(e.Request.KLineDataTimeRange.End.Time=this.KLineDateTimeRange.End.Time)),this.NetworkFilter(e,(function(e){t.RecvHistroyData(e),t.Execute.RunNextJob()})),1==e.PreventDefault)return}x.HttpRequest({url:t.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(e){t.RecvHistroyData(e),t.Execute.RunNextJob()},error:function(e){t.RecvError(e)}})}else if(It.IsMinutePeriod(this.Period,!0)){if(this.NetworkFilter){e={Name:"JSSymbolData::GetSymbolData",Explain:"分钟K线数据",Request:{Url:t.MinuteKLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestMinuteDayCount}},Self:this,PreventDefault:!1};if(this.KLineDateTimeRange&&(e.Request.KLineDataTimeRange={Start:{Date:this.KLineDateTimeRange.Start.Date},End:{Date:this.KLineDateTimeRange.End.Date}},this.IsNumber(this.KLineDateTimeRange.Start.Time)&&(e.Request.KLineDataTimeRange.Start.Time=this.KLineDateTimeRange.Start.Time),this.IsNumber(this.KLineDateTimeRange.End.Time)&&(e.Request.KLineDataTimeRange.End.Time=this.KLineDateTimeRange.End.Time)),this.NetworkFilter(e,(function(e){t.RecvMinuteHistroyData(e),t.Execute.RunNextJob()})),1==e.PreventDefault)return}x.HttpRequest({url:this.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(e){t.RecvMinuteHistroyData(e),t.Execute.RunNextJob()},error:function(e){t.RecvError(e)}})}}else x.HttpRequest({url:t.HistoryMinuteApiUrl,data:{symbol:t.Symbol,daycount:t.DayCount},type:"post",dataType:"json",async:!0,success:function(e){t.RecvMultiDayMinuteData(e),t.Execute.RunNextJob()}});else x.HttpRequest({url:t.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","minute","time","minutecount"],symbol:[t.Symbol],start:-1},type:"post",dataType:"json",async:!0,success:function(e){t.RecvMinuteData(e),t.Execute.RunNextJob()}})},this.RecvHistroyData=function(t){M.Complier.Log("[JSSymbolData::RecvHistroyData] recv data",t);var e=this.JsonDataToHistoryData(t);if(this.Data=new It,this.Data.DataType=0,this.Data.Data=e,this.SourceData=new It,this.SourceData.Data=e,this.Right>0){var a=this.Data.GetRightDate(this.Right);this.Data.Data=a}if(It.IsDayPeriod(this.Period,!1)){var i=this.Data.GetPeriodData(this.Period);this.Data.Data=i}this.Data.Right=this.Right,this.Data.Period=this.Period,this.Name=t.name},this.RecvMinuteHistroyData=function(t){M.Complier.Log("[JSSymbolData::RecvMinuteHistroyData] recv data",t);var e=this.JsonDataToMinuteHistoryData(t);if(this.Data=new It,this.Data.DataType=1,this.Data.Data=e,this.SourceData=new It,this.SourceData.Data=e,It.IsMinutePeriod(this.Period,!1)){var a=this.Data.GetPeriodData(this.Period);this.Data.Data=a}this.Data.Period=this.Period,this.Name=t.name},this.RecvMinuteData=function(t){M.Complier.Log("[JSSymbolData::RecvMinuteData] recv data",t);var e=this.JsonDataToMinuteData(t);this.Data=new It,this.Data.DataType=2,this.Data.Data=e,this.Name=t.stock[0].name},this.RecvMultiDayMinuteData=function(t){var e=this.JsonDataToMultiDayMinuteData(t);this.Data=new It,this.Data.DataType=2,this.Data.Data=e,this.Name=t.name},this.GetSymbolCacheData=function(t){if(!this.Data)return new Array;var e=this.Symbol.toUpperCase();switch(t){case"CLOSE":case"C":return this.Data.GetClose();case"VOL":case"V":return Li.IsSHSZ(e)?this.Data.GetVol(100):this.Data.GetVol();case"OPEN":case"O":return this.Data.GetOpen();case"HIGH":case"H":return this.Data.GetHigh();case"LOW":case"L":return this.Data.GetLow();case"AMOUNT":case"AMO":return this.Data.GetAmount();case"VOLINSTK":return this.Data.GetPosition()}},this.GetSymbolDayData=function(){if(this.DataType!=ur.KLINE_ID||!It.IsMinutePeriod(this.Period,!0)||this.DayData)return this.Execute.RunNextJob();var t=this;x.HttpRequest({url:t.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(e){t.RecvSymbolDayData(e),t.Execute.RunNextJob()},error:function(e){t.RecvError(e)}})},this.RecvSymbolDayData=function(t){M.Complier.Log("[JSSymbolData::RecvSymbolDayData] recv data",t);var e=this.JsonDataToHistoryData(t),a=new It;a.DataType=0,a.Data=e,a.Right=this.Right,a.Period=this.Period,this.DayData=a},this.GetCurrBarsCount=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var e=this.Data.Data.length,a=e-1;a>=0;--a)t.push(a+1);return t},this.GetTotalTradeMinuteCount=function(){var t=Bi.GetCoordinateData(this.Symbol);return t&&t.Count>0?t.Count-1:242},this.GetTotalBarsCount=function(){var t=this.Data.Data.length;return t},this.GetIsLastBar=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var e=this.Data.Data.length,a=0;a<e;++a)a==e-1?t.push(1):t.push(0);return t},this.GetFinanceCacheData=function(t,e){var a=or.GetFinnanceJobID(t);return a||this.Execute.ThrowUnexpectedNode(e,"不支持FINANCE("+t+")"),this.FinanceData.has(a)?this.FinanceData.get(a):[]},this.GetCompanyReleaseDate=function(t){if(this.FinanceData.has(t))return this.Execute.RunNextJob();var e=this;x.HttpRequest({url:e.RealtimeApiUrl,data:{field:["name","symbol","company.releasedate"],symbol:[this.Symbol]},type:"post",dataType:"json",async:!0,success:function(a){e.RecvCompanyReleaseDate(t,a),e.Execute.RunNextJob()},error:function(t){e.RecvError(t)}})},this.RecvCompanyReleaseDate=function(t,e){if(e.stock&&1==e.stock.length){var a=e.stock[0].company.releasedate,i=new Date(a/1e4,a%1e4/100,a%100),r=[];for(var n in this.Data.Data){a=this.Data.Data[n].Date;var s=new Date(a/1e4,a%1e4/100,a%100),o=new ft;o.Date=a,o.Value=parseInt((s-i)/864e5),r[n]=o}M.Complier.Log("[JSSymbolData::RecvCompanyReleaseDate] jobID=",t,r);var h=new It;if(h.Data=r,h.Period=this.Period,h.Period>0){var l=h.GetPeriodSingleData(h.Period);h.Data=l}var u=h.GetValue();this.FinanceData.set(t,u)}},this.GetFinanceData=function(t){if(this.FinanceData.has(t))return this.Execute.RunNextJob();M.Complier.Log("[JSSymbolData::GetFinanceData] jobID=",t);var e=this,a=["name","date","symbol"];switch(t){case or.JOB_DOWNLOAD_FLOW_EQUITY_DATA:case or.JOB_DOWNLOAD_CAPITAL_DATA:case or.JOB_DOWNLOAD_FLOW_MARKETVALUE_DATA:case or.JOB_DOWNLOAD_EXCHANGE_DATA:a.push("capital.a");break;case or.JOB_DOWNLOAD_TOTAL_EQUITY_DATA:case or.JOB_DOWNLOAD_MARKETVALUE_DATA:a.push("capital.total");break;case or.JOB_DOWNLOAD_PER_U_PROFIT_DATA:a.push("finance.peruprofit");break;case or.JOB_DOWNLOAD_PER_NETASSET_DATA:a.push("finance.pernetasset");break;case or.JOB_DOWNLOAD_PER_C_RESERVE_DATA:a.push("finance.percreserve");break;case or.JOB_DOWNLOAD_PER_S_EARNING_DATA:case or.JOB_DOWNLOAD_PER_S_EARNING2_DATA:a.push("finance.persearning");break;case or.JOB_DOWNLOAD_N_PROFIT_DATA:a.push("finance.nprofit");break;case or.JOB_DOWNLOAD_AL_RATIO_DATA:a.push("finance.alratio");break;case or.JOB_DOWNLOAD_PROFIT_YOY_DATA:a.push("finance.profityoy");break;case or.JOB_DOWNLOAD_DIVIDEND_YIELD_DATA:a.push("execdividend.quarter4");break;case or.JOB_DOWNLOAD_SHAREHOLDER_DATA:a.push("shareholder");break}if(this.NetworkFilter){var i={Name:"JSSymbolData::GetFinanceData",Explain:"财务数据",JobID:t,Request:{Url:e.StockHistoryDayApiUrl,Type:"POST",Data:{field:a,symbol:[this.Symbol],orderfield:"date"}},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,(function(a){e.RecvFinanceData(a,t),e.Execute.RunNextJob()})),1==i.PreventDefault)return}x.HttpRequest({url:this.StockHistoryDayApiUrl,data:{field:a,symbol:[this.Symbol],orderfield:"date"},type:"post",dataType:"json",async:!0,success:function(a){e.RecvFinanceData(a,t),e.Execute.RunNextJob()}})},this.RecvFinanceData=function(t,e){switch(e){case or.JOB_DOWNLOAD_FLOW_EQUITY_DATA:case or.JOB_DOWNLOAD_CAPITAL_DATA:case or.JOB_DOWNLOAD_TOTAL_EQUITY_DATA:case or.JOB_DOWNLOAD_PER_U_PROFIT_DATA:case or.JOB_DOWNLOAD_PER_NETASSET_DATA:case or.JOB_DOWNLOAD_PER_C_RESERVE_DATA:case or.JOB_DOWNLOAD_PER_S_EARNING_DATA:case or.JOB_DOWNLOAD_PER_S_EARNING2_DATA:case or.JOB_DOWNLOAD_N_PROFIT_DATA:case or.JOB_DOWNLOAD_FLOW_MARKETVALUE_DATA:case or.JOB_DOWNLOAD_MARKETVALUE_DATA:case or.JOB_DOWNLOAD_EXCHANGE_DATA:case or.JOB_DOWNLOAD_AL_RATIO_DATA:case or.JOB_DOWNLOAD_PROFIT_YOY_DATA:case or.JOB_DOWNLOAD_DIVIDEND_YIELD_DATA:case or.JOB_DOWNLOAD_SHAREHOLDER_DATA:return this.RecvStockDayData(t,e)}},this.RecvStockDayData=function(t,e){if(t.stock&&1==t.stock.length){var a=t.stock[0],i=!1,r=!1,n=new Array;for(var s in a.stockday){var o=a.stockday[s],h=new ft;switch(h.Date=o.date,e){case or.JOB_DOWNLOAD_CAPITAL_DATA:var l=o.capital;if(!l)continue;if(!this.IsNumber(l.a))continue;h.Value=l.a/100,i=!0;break;case or.JOB_DOWNLOAD_TOTAL_EQUITY_DATA:l=o.capital;if(!l)continue;if(!this.IsNumber(l.total))continue;h.Value=l.total/1e4,i=!0;break;case or.JOB_DOWNLOAD_FLOW_EQUITY_DATA:l=o.capital;if(!l)continue;if(!this.IsNumber(l.a))continue;h.Value=l.a,i=!0;break;case or.JOB_DOWNLOAD_FLOW_MARKETVALUE_DATA:l=o.capital;if(!l)continue;if(!this.IsNumber(l.a))continue;h.Value=l.a,r=!0;break;case or.JOB_DOWNLOAD_MARKETVALUE_DATA:l=o.capital;if(!l)continue;if(!this.IsNumber(l.total))continue;h.Value=l.total,r=!0;break;case or.JOB_DOWNLOAD_EXCHANGE_DATA:l=o.capital;if(!l)continue;if(!this.IsNumber(l.a))continue;h.Value=l.a,i=!0;break;case or.JOB_DOWNLOAD_PER_U_PROFIT_DATA:l=this.JsonDataToFinance(o);if(!l)continue;if(!this.IsNumber(l.Finance.peruprofit))continue;h.Value=l.Finance.peruprofit,i=!0;break;case or.JOB_DOWNLOAD_PER_NETASSET_DATA:l=this.JsonDataToFinance(o);if(!l)continue;if(!this.IsNumber(l.Finance.pernetasset))continue;h.Value=l.Finance.pernetasset,i=!0;break;case or.JOB_DOWNLOAD_PER_C_RESERVE_DATA:l=this.JsonDataToFinance(o);if(!l)continue;if(!this.IsNumber(l.Finance.percreserve))continue;h.Value=l.Finance.percreserve,i=!0;break;case or.JOB_DOWNLOAD_PER_S_EARNING_DATA:l=this.JsonDataToFinance(o);if(!l)continue;if(!this.IsNumber(l.Finance.persearning))continue;h.Value=l.Finance.persearning,i=!0;break;case or.JOB_DOWNLOAD_PER_S_EARNING2_DATA:l=this.JsonDataToFinance(o);if(!l)continue;if(!this.IsNumber(l.Finance.persearning))continue;h.Value=l.Finance.persearning/l.Announcement.quarter*4,i=!0;break;case or.JOB_DOWNLOAD_N_PROFIT_DATA:l=this.JsonDataToFinance(o);if(!l)continue;if(!this.IsNumber(l.Finance.nprofit))continue;h.Value=l.Finance.nprofit,i=!0;break;case or.JOB_DOWNLOAD_AL_RATIO_DATA:l=this.JsonDataToFinance(o);if(!l)continue;if(!this.IsNumber(l.Finance.alratio))continue;h.Value=l.Finance.alratio,i=!0;break;case or.JOB_DOWNLOAD_PROFIT_YOY_DATA:l=this.JsonDataToFinance(o);if(!l)continue;if(!this.IsNumber(l.Finance.profityoy))continue;h.Value=l.Finance.profityoy,i=!0;break;case or.JOB_DOWNLOAD_DIVIDEND_YIELD_DATA:l=o.execdividend;if(!l)continue;if(!this.IsNumber(l.quarter4))continue;h.Value=l.quarter4,i=!0;break;case or.JOB_DOWNLOAD_SHAREHOLDER_DATA:var u=o.shareholder;if(!u||!this.IsNumber(u.count))continue;h.Value=u.count,i=!0;break;default:continue}n.push(h)}if(e==or.JOB_DOWNLOAD_CAPITAL_DATA){var C=null;return n.length>0&&(C=parseInt(n[n.length-1].Value)),void this.FinanceData.set(e,C)}var D=void 0;i?D=this.SourceData?this.SourceData.GetFittingFinanceData(n):this.Data.GetFittingFinanceData(n):r?(D=this.SourceData?this.SourceData.GetFittingMarketValueData(n):this.Data.GetFittingMarketValueData(n),e==or.JOB_DOWNLOAD_MARKETVALUE_DATA&&(this.MarketValue=D)):D=e==or.JOB_DOWNLOAD_DIVIDEND_YIELD_DATA?this.CalculateDividendYield(n):this.SourceData.GetFittingData(n);var c=new It;if(c.Data=D,c.Period=this.Period,c.Period>0){var f=c.GetPeriodSingleData(c.Period);c.Data=f}if(e==or.JOB_DOWNLOAD_EXCHANGE_DATA)for(var d in this.Data.Data)c.Data[d]&&(this.IsNumber(c.Data[d].Value)&&0!=c.Data[d].Value?c.Data[d].Value=this.Data.Data[d].Vol/c.Data[d].Value*100:c.Data[d].Value=1);var m=c.GetValue();this.FinanceData.set(e,m)}},this.CalculateDividendYield=function(t){var e=[];if(!this.MarketValue)return e;for(var a=0,i=0;a<this.Data.Data.length;++a){var r=this.Data.Data[a],n=this.MarketValue[a];if(r&&n){var s=new ft;if(s.Date=r.Date,s.Value=0,i+1<t.length&&t[i].Date<r.Date&&t[i+1].Date<=r.Date)++i,--a;else{if(i<t.length){var o=t[i],h=o.Date+1e4;r.Date>=o.Date&&r.Date<=h&&this.IsDivideNumber(n.Value)&&this.IsNumber(o.Value)&&(s.Value=o.Value/n.Value*100)}e.push(s)}}}return e},this.GetMarginCacheData=function(t,e){var a=or.GetMarginJobID(t);return a||this.Execute.ThrowUnexpectedNode(e,"不支持MARGIN("+t+")"),this.MarginData.has(a)?this.MarginData.get(a):[]},this.GetMarginData=function(t){if(this.MarginData.has(t))return this.Execute.RunNextJob();M.Complier.Log("[JSSymbolData::GetMarginData] jobID=",t);var e=this,a=["name","date","symbol"];switch(t){case or.JOB_DOWNLOAD_MARGIN_BALANCE:a.push("margin.balance");break;case or.JOB_DOWNLOAD_MARGIN_RATE:a.push("margin.rate");break;case or.JOB_DOWNLOAD_MARGIN_BUY_BALANCE:case or.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:case or.JOB_DOWNLOAD_MARGIN_BUY_REPAY:case or.JOB_DOWNLOAD_MARGIN_BUY_NET:a.push("margin.buy");break;case or.JOB_DOWNLOAD_MARGIN_SELL_BALANCE:case or.JOB_DOWNLOAD_MARGIN_SELL_VOLUME:case or.JOB_DOWNLOAD_MARGIN_SELL_REPAY:case or.JOB_DOWNLOAD_MARGIN_SELL_NET:a.push("margin.sell");break}x.HttpRequest({url:this.StockHistoryDayApiUrl,data:{field:a,symbol:[this.Symbol],orderfield:"date"},type:"post",dataType:"json",async:!0,success:function(a){e.RecvMarginData(a,t),e.Execute.RunNextJob()}})},this.RecvMarginData=function(t,e){if(M.Complier.Log(t),t.stock&&1==t.stock.length){var a=t.stock[0],i=new Array,r=[],n=[],s=[];for(var o in a.stockday){var h=a.stockday[o],l=h.margin;if(l){var u=new ft;switch(u.Date=h.date,e){case or.JOB_DOWNLOAD_MARGIN_BALANCE:if(!this.IsNumber(l.balance))continue;u.Value=l.balance,i.push(u);break;case or.JOB_DOWNLOAD_MARGIN_RATE:if(!this.IsNumber(l.rate))continue;u.Value=l.rate,i.push(u);break;case or.JOB_DOWNLOAD_MARGIN_BUY_BALANCE:case or.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:case or.JOB_DOWNLOAD_MARGIN_BUY_REPAY:case or.JOB_DOWNLOAD_MARGIN_BUY_NET:var C=l.buy;if(!C)continue;if(!this.IsNumber(C.balance)||!this.IsNumber(C.amount)||!this.IsNumber(C.repay)||!this.IsNumber(C.net))continue;u.Value=C.balance;var D=new ft;D.Date=h.date,D.Value=C.amount;var c=new ft;c.Date=h.date,c.Value=C.repay;var f=new ft;f.Date=h.date,f.Value=C.net,i.push(u),r.push(D),n.push(c),s.push(f);break;case or.JOB_DOWNLOAD_MARGIN_SELL_BALANCE:case or.JOB_DOWNLOAD_MARGIN_SELL_VOLUME:case or.JOB_DOWNLOAD_MARGIN_SELL_REPAY:case or.JOB_DOWNLOAD_MARGIN_SELL_NET:var d=l.sell;if(!d)continue;if(!this.IsNumber(d.balance)||!this.IsNumber(d.volume)||!this.IsNumber(d.repay)||!this.IsNumber(d.net))continue;u.Value=C.balance;D=new ft;D.Date=h.date,D.Value=C.volume;c=new ft;c.Date=h.date,c.Value=C.repay;f=new ft;f.Date=h.date,f.Value=C.net,i.push(u),r.push(D),n.push(c),s.push(f);break;default:continue}}}var m=[];for(var v in e===or.JOB_DOWNLOAD_MARGIN_BALANCE||e===or.JOB_DOWNLOAD_MARGIN_RATE?m.push({JobID:e,Data:i}):e===or.JOB_DOWNLOAD_MARGIN_BUY_BALANCE||e===or.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT||e===or.JOB_DOWNLOAD_MARGIN_BUY_REPAY||e===or.JOB_DOWNLOAD_MARGIN_BUY_NET?(m.push({JobID:or.JOB_DOWNLOAD_MARGIN_BUY_BALANCE,Data:i}),m.push({JobID:or.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT,Data:r}),m.push({JobID:or.JOB_DOWNLOAD_MARGIN_BUY_REPAY,Data:n}),m.push({JobID:or.JOB_DOWNLOAD_MARGIN_BUY_NET,Data:s})):e!==or.JOB_DOWNLOAD_MARGIN_SELL_BALANCE&&e!==or.JOB_DOWNLOAD_MARGIN_SELL_VOLUME&&e!==or.JOB_DOWNLOAD_MARGIN_SELL_REPAY&&e!==or.JOB_DOWNLOAD_MARGIN_SELL_NET||(m.push({JobID:or.JOB_DOWNLOAD_MARGIN_SELL_BALANCE,Data:i}),m.push({JobID:or.JOB_DOWNLOAD_MARGIN_SELL_VOLUME,Data:r}),m.push({JobID:or.JOB_DOWNLOAD_MARGIN_SELL_REPAY,Data:n}),m.push({JobID:or.JOB_DOWNLOAD_MARGIN_SELL_NET,Data:s})),m){var S=this.SourceData.GetFittingData(m[v].Data),I=new It;if(I.Data=S,I.Period=this.Period,I.Period>0){var p=I.GetPeriodSingleData(I.Period);I.Data=p}var T=I.GetValue();this.MarginData.set(m[v].JobID,T)}}},this.GetNewsAnalysisCacheData=function(t,e){var a=or.GetNewsAnalysisID(t);return a||this.Execute.ThrowUnexpectedNode(e,"不支持NEWS("+t+")"),this.NewsAnalysisData.has(a)?this.NewsAnalysisData.get(a):[]},this.GetHKToSHSZData=function(t){var e=t.Args,a=this.Symbol;if(e.length>0){var i=e[0];if(i.Type==$i.Literal)a=i.Value;else if(i.Type==$i.Identifier){var r=!1;for(var n in this.Arguments){var s=this.Arguments[n];if(s.Name==i.Name){a=s.Value,r=!0;break}}if(!r){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,"HK2SHSZ() Error: can't read "+i.Name)}}}t.Symbol=a,1==a||2==a||3==a?this.GetHKToSHSZMarketData(a,t):this.GetHKToSHSZStockData(a,t)},this.GetHKToSHSZStockData=function(t,e){if(this.HKToSHSZData.has(t))return this.Execute.RunNextJob();var a=t.toLowerCase(),i=this,r=this.HKToSHSZApiUrl[3]+"/"+a+".json";x.HttpRequest({url:r,type:"get",dataType:"json",async:!0,success:function(t){i.RecvHKToSHSZStockData(t,e),i.Execute.RunNextJob()},error:function(t){console.warn("[JSSymbolData::GetHKToSHSZStockData] request url="+r+" failed. error="+t.status),i.RecvHKToSHSZStockData(null,e),i.Execute.RunNextJob()}})},this.RecvHKToSHSZStockData=function(t,e){if(t){for(var a=t.symbol,i=a.toUpperCase(),r=[],n=0;n<t.date.length;++n){var s=new ft;s.Date=t.date[n],s.Value=t.vol[n],r.push(s)}var o=this.Data.GetFittingData(r),h=new It;if(h.Data=o,h.Period=this.Period,h.Period>0){var l=h.GetPeriodSingleData(h.Period);h.Data=l}t=h.GetValue();this.HKToSHSZData.set(i,t)}},this.GetHKToSHSZMarketData=function(t,e){if(this.HKToSHSZData.has(t))return this.Execute.RunNextJob();var a,i=0;this.DataType===ur.MINUTE_ID?i=1:this.DataType==ur.MULTIDAY_MINUTE_ID?i=2:this.Period<=3&&(i=0),a=this.HKToSHSZApiUrl[i];var r=this;M.Complier.Log("[JSSymbolData::GetHKToSHSZMarketData] code="+t+" url="+a+", dataType="+i),2===i?x.HttpRequest({url:a,data:{symbol:this.Symbol,daycount:this.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(t){r.RecvMulitMinuteHKToSHSZData(t,e),r.Execute.RunNextJob()}}):x.HttpRequest({url:a,type:"get",dataType:"json",async:!0,success:function(t){0==i?r.RecvHKToSHSZData(t,e):1==i&&r.RecvMinuteHKToSHSZData(t,e),r.Execute.RunNextJob()}})},this.RecvMinuteHKToSHSZData=function(t,e){var a=[],i=[],r=[];if(this.IsBeforeData){for(s in this.SourceData.Data){var n=this.SourceData.Data[s];if(!n.Before)break;a.push(null),i.push(null),r.push(null)}for(var s=0;s<t.time.length;++s){var o=t.time[s];if(925!==o){var h=t.hk2sh[s],l=t.hk2sz[s],u=h+l;a.push(u),i.push(h),r.push(l)}}}else for(s=0;s<t.time.length;++s){o=t.time[s],h=t.hk2sh[s],l=t.hk2sz[s],u=h+l;a.push(u),i.push(h),r.push(l)}var C=[{Data:a,ID:1},{Data:i,ID:2},{Data:r,ID:3}];for(var s in C){n=C[s];this.HKToSHSZData.set(n.ID,n.Data)}},this.RecvHKToSHSZData=function(t,e){for(var a=[],i=[],r=[],n=0;n<t.date.length;++n){var s=t.date[n],o=1e6*t.hk2sh[n],h=1e6*t.hk2sz[n],l=o+h,u=new ft;u.Date=s,u.Value=l;var C=new ft;C.Date=s,C.Value=o;var D=new ft;D.Date=s,D.Value=h,a.push(u),i.push(C),r.push(D)}var c=[{Data:a,ID:1},{Data:i,ID:2},{Data:r,ID:3}];for(var f in c){var d=this.Data.GetFittingData(c[f].Data),m=new It;if(m.Data=d,m.Period=this.Period,m.Period>0){var v=m.GetPeriodSingleData(m.Period);m.Data=v}var S=m.GetValue();this.HKToSHSZData.set(c[f].ID,S)}},this.RecvMulitMinuteHKToSHSZData=function(t,e){if(t.data&&!(t.data.length<=0)){for(var a=[],i=[],r=[],n=0,s=0;n<this.Data.Data.length&&s<t.data.length;){a[n]=null,i[n]=null,r[n]=null;var o=this.Data.Data[n],h=o.DateTime;if(h){var l=h.split(" ");if(2==l.length){var u=parseInt(l[0]),C=t.data[s];if(!C.minute||C.minute.length<=0)++s;else if(C.date>u)++n;else if(C.date<u)++s;else{for(var D in C.minute){var c=C.minute[D],f=c[1],d=c[2],m=f+d;a[n]=m,i[n]=f,r[n]=d,++n}++s}}else++n}else++n}var v=[{Data:a,ID:1},{Data:i,ID:2},{Data:r,ID:3}];for(var n in v){o=v[n];this.HKToSHSZData.set(o.ID,o.Data)}}},this.GetHKToSHSZCacheData=function(t,e){return t||(t=this.Symbol),"string"==typeof t&&(t=t.toUpperCase()),this.HKToSHSZData.has(t)?this.HKToSHSZData.get(t):[]},this.GetNewsAnalysisData=function(t){if(this.NewsAnalysisData.has(t))return this.Execute.RunNextJob();var e=this,a=new g.default([[or.JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE,"negative"],[or.JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH,"research"],[or.JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT,"interact"],[or.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE,"holderchange"],[or.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2,"holderchange"],[or.JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER,"trustholder"],[or.JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING,"Blocktrading"],[or.JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS,"companynews"],[or.JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS,"topmanagers"],[or.JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE,"Pledge"]]);if(a.has(t)){var i=a.get(t),r=this.StockNewsAnalysisApiUrl+"/"+i+"/"+this.Symbol+".json";x.HttpRequest({url:r,type:"get",dataType:"json",async:!0,success:function(a){e.RecvNewsAnalysisData(a,t),e.Execute.RunNextJob()},error:function(a,i){e.RecvNewsAnalysisDataError(a,i,t),e.Execute.RunNextJob()}})}else this.Execute.RunNextJob()},this.RecvNewsAnalysisDataError=function(t,e,a){M.Complier.Log("[JSSymbolData::RecvNewsAnalysisDataError] ajax error.",t.status);for(var i=[],r=0;r<this.Data.Data.length;++r){var n=new ft;n.Date=this.Data.Data[r].Date,n.Value=0,i.push(n)}var s=new It;s.Data=i,this.NewsAnalysisData.set(a,s.GetValue())},this.RecvNewsAnalysisData=function(t,e){if(t.data&&t.date&&!(t.data.length<=0||t.data.length!=t.date.length))if(M.Complier.Log("[JSSymbolData::RecvNewsAnalysisData] jobID",e,t.update),e==or.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE||e==or.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2){for(var a=[],i=[],r=0;r<t.data.length;++r){var n=new ft;n.Date=t.date[r],n.Value=t.data[r],this.IsNumber(n.Value)&&a.push(n),r<t.data2.length&&(n=new ft,n.Date=t.date[r],n.Value=t.data2[r],this.IsNumber(n.Value)&&i.push(n))}var s=this.Data.GetFittingData2(a,0),o=new It;o.Data=s,this.NewsAnalysisData.set(or.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE,o.GetValue()),s=this.Data.GetFittingData2(i,0),o=new It,o.Data=s,this.NewsAnalysisData.set(or.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2,o.GetValue())}else{for(a=[],r=0;r<t.data.length;++r){n=new ft;n.Date=t.date[r],n.Value=t.data[r],a.push(n)}var h=this.Data.GetFittingData2(a,0);o=new It;o.Data=h,this.NewsAnalysisData.set(e,o.GetValue())}},this.GetSectionFinanceData=function(t){var e=t.SF[0],a=t.SF[1].Period;if(this.SectionFinanceData.has(e))return this.Execute.RunNextJob();M.Complier.Log("[JSSymbolData::GetSectionFinanceData] "+a.Year+"-"+a.Quarter);var i="announcement"+a.Quarter,r=this,n=["name","date","symbol",i,"finance"+a.Quarter],s=[i+".year","int32","eq",a.Year.toString()];x.HttpRequest({url:this.StockHistoryDayApiUrl,data:{field:n,symbol:[this.Symbol],condition:[{item:s}]},type:"post",dataType:"json",async:!0,success:function(e){r.RecvSectionFinanceData(e,t),r.Execute.RunNextJob()}})},this.RecvSectionFinanceData=function(t,e){if(t.stock&&1==t.stock.length){var a=t.stock[0];if(a.stockday&&!(a.stockday.length<=0)){var i=a.stockday[0],r=e.SF[1].Period,n=null;if(1===r.Quarter?n=i.finance1:2===r.Quarter?n=i.finance2:3===r.Quarter?n=i.finance3:4===r.Quarter&&(n=i.finance4),n){t=new g.default([[or.JOB_DOWNLOAD_SECTION_F_01,n.currentassets],[or.JOB_DOWNLOAD_SECTION_F_02,n.monetaryfunds],[or.JOB_DOWNLOAD_SECTION_F_03,n.inventory],[or.JOB_DOWNLOAD_SECTION_F_04,n.currentliabilities],[or.JOB_DOWNLOAD_SECTION_F_05,n.ncurrentliabilities],[or.JOB_DOWNLOAD_SECTION_F_06,n.expenses3],[or.JOB_DOWNLOAD_SECTION_F_07,n.investmentincome],[or.JOB_DOWNLOAD_SECTION_F_08,n.pcnprofit],[or.JOB_DOWNLOAD_SECTION_F_09,n.nnetprofit],[or.JOB_DOWNLOAD_SECTION_F_10,n.npersearning],[or.JOB_DOWNLOAD_SECTION_F_11,n.woewa],[or.JOB_DOWNLOAD_SECTION_F_12,n.inprocess],[or.JOB_DOWNLOAD_SECTION_F_13,n.accdepreciation],[or.JOB_DOWNLOAD_SECTION_F_14,n.mholderprofit],[or.JOB_DOWNLOAD_SECTION_F_15,n.lossexchange],[or.JOB_DOWNLOAD_SECTION_F_16,n.baddebts],[or.JOB_DOWNLOAD_SECTION_F_17,n.fixedassets],[or.JOB_DOWNLOAD_SECTION_F_18,n.curdepreciation],[or.JOB_DOWNLOAD_SECTION_F_19,n.orevenues],[or.JOB_DOWNLOAD_SECTION_F_20,n.moprofit],[or.JOB_DOWNLOAD_SECTION_F_21,n.oprofit],[or.JOB_DOWNLOAD_SECTION_F_22,n.nprofit],[or.JOB_DOWNLOAD_SECTION_F_23,n.areceivable],[or.JOB_DOWNLOAD_SECTION_F_24,n.financialcost],[or.JOB_DOWNLOAD_SECTION_F_25,n.ccfo],[or.JOB_DOWNLOAD_SECTION_F_26,n.totalassets],[or.JOB_DOWNLOAD_SECTION_F_27,n.totalliabilities],[or.JOB_DOWNLOAD_SECTION_F_28,n.totalownersequity],[or.JOB_DOWNLOAD_SECTION_F_29,n.grossmargin],[or.JOB_DOWNLOAD_SECTION_F_30,n.percreserve],[or.JOB_DOWNLOAD_SECTION_F_31,n.peruprofit],[or.JOB_DOWNLOAD_SECTION_F_32,n.persearning],[or.JOB_DOWNLOAD_SECTION_F_33,n.pernetasset],[or.JOB_DOWNLOAD_SECTION_F_34,n.perccfo],[or.JOB_DOWNLOAD_SECTION_F_38,n.alratio],[or.JOB_DOWNLOAD_SECTION_F_39,n.profityoy]]);4===r.Quarter&&(t.set(or.JOB_DOWNLOAD_SECTION_F_35,n.nnprofitincrease),t.set(or.JOB_DOWNLOAD_SECTION_F_36,n.nnprofitspeed),t.set(or.JOB_DOWNLOAD_SECTION_F_37,n.nprofitincrease));var s=e.SF[0];this.SectionFinanceData.set(s,t)}}}},this.GetSectionFinanceCacheData=function(t,e,a,i){var r=or.GetSectionReportPeriod(t,e);r||this.Execute.ThrowUnexpectedNode(i,"不支持FS("+t+", "+e+", '"+a+"') 报告期错误");var n=or.GetSectionFinanceID(a);n||this.Execute.ThrowUnexpectedNode(i,"不支持FS("+t+", "+e+",'"+a+"') 财务数据字段名称错误");var s=r.Year+"-"+r.Quarter;if(!this.SectionFinanceData.has(s)&&!this.ThrowSFPeirod.has(s)){this.ThrowSFPeirod.add(s);var o={ID:or.JOB_DOWNLOAD_SECTION_SF,SF:[s,{Period:r,Fields:new I.default([n])}]};this.Execute.ThrowDownloadSF(i,o,"FS("+t+", "+e+", '"+a+"') 动态下载")}if(!this.SectionFinanceData.has(s))return this.Execute.ThrowUnexpectedNode(i,"不支持FS("+t+", "+e+", '"+a+"') 没有这期财务数据");var h=this.SectionFinanceData.get(s);return h.has(n)||this.Execute.ThrowUnexpectedNode(i,"不支持FS("+t+", "+e+", '"+a+"') 没有这期财务数据字段"),h.get(n)},this.DownloadCustomVariantData=function(t){var e=Xi.CustomVariant.Data.get(t.Name);if(!e||!e.Download)return this.Execute.RunNextJob();var a=this,i={Name:t.Name,Symbol:this.Symbol,KData:this.Data,Period:this.Period,Right:this.Right,Success:function(){a.Execute.RunNextJob()}};e.Download(i)},this.DownloadCustomFunctionData=function(t){var e=Xi.CustomFunction.Data.get(t.Name);if(!e||!e.Download)return this.Execute.RunNextJob();var a=[];for(var i in t.Args){var r=t.Args[i];if(r.Type==$i.Literal)a.push(r.Value);else{if(r.Type!=$i.Identifier)return this.Execute.RunNextJob();var n=!1;for(var s in this.Arguments){var o=this.Arguments[s];if(o.Name==r.Name){a.push(o.Value),n=!0;break}}n||a.push(null)}}var h=this,l={Symbol:this.Symbol,KData:this.Data,Period:this.Period,Right:this.Right,Args:a,Name:t.Name,Token:t.Token,ThrowError:function(e){var a=t.Token;h.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,e)},Success:function(){h.Execute.RunNextJob()}};e.Download(l)},this.DownloadCustomAPIData=function(t){if(!this.NetworkFilter)return this.Execute.RunNextJob();var e=[];for(var a in t.Args){var i=t.Args[a];if(i.Type==$i.Literal)e.push(i.Value);else{if(i.Type!=$i.Identifier)return this.Execute.RunNextJob();var r=!1;for(var n in this.Arguments){var s=this.Arguments[n];if(s.Name==i.Name){e.push(s.Value),r=!0;break}}if(!r){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,"LoadAPIData() Error: can't read "+i.Name)}}}var h=this,l={Name:"JSSymbolData::DownloadCustomAPIData",Explain:"下载自定义api数据",Period:this.Period,Right:this.Right,Symbol:this.Symbol,KData:this.Data,Cache:this.CustomAPIData,Args:e,Self:this,PreventDefault:!1};this.NetworkFilter(l,(function(t){h.RecvCustomAPIData(t,e),h.Execute.RunNextJob()})),1!=l.PreventDefault&&this.Execute.RunNextJob()},this.RecvCustomAPIData=function(t,e){t&&(1==t.Type?this.RecvCustomAPISingleData(t,e):this.RecvCustomAPIGroupData(t,e))},this.RecvCustomAPIGroupData=function(t,e){if(t&&t.data){var a=t.data,i=this.GenerateCustomAPIKey(e);if(It.IsMinutePeriod(this.Period,!0)){if(!a.date||!a.time)return;var r=a.date;a.time;for(var n in a)if("date"!=n&&"time"!=n)var s=a[n]}else if(It.IsDayPeriod(this.Period,!0)){if(!a.date)return;r=a.date;var o={__Type__:"Object"};for(var n in a)if("date"!=n){s=a[n];if(Array.isArray(s)){var h=this.FittingCustomAPIArray(s,r);o[n]=h}else this.IsNumber(s)&&(o[n]=s)}this.CustomAPIData.set(i,o)}}},this.RecvCustomAPISingleData=function(t,e){var a=t.data,i=this.GenerateCustomAPIKey(e);if(It.IsMinutePeriod(this.Period,!0)){if(!a.date||!a.time)return;var r=a.date;a.time;for(var n in a)if("date"!=n&&"time"!=n)a[n]}else if(It.IsDayPeriod(this.Period,!0)){if(!a.date)return;r=a.date;var s=a.value,o=null;o=Array.isArray(s)?1==t.DataType?this.FittingCustomAPIFinanceArray(s,r):this.FittingCustomAPIArray(s,r):s,this.CustomAPIData.set(i,o)}},this.FittingCustomAPIFinanceArray=function(t,e,a){var i,r=this.Data,n=[];for(var s in t){var o=t[s],h=new ft;h.Date=e[s],a&&s<a.length&&(h.Time=a[s]),h.Value=o,n.push(h)}if(It.IsDayPeriod(this.Period,!0))i=r.GetFittingFinanceData(n);else{if(!It.IsMinutePeriod(this.Period,!0))return null;i=r.GetMinuteFittingFinanceData(n)}var l=new It;l.Data=i;var u=l.GetValue();return u},this.FittingCustomAPIArray=function(t,e,a){var i,r=this.Data,n=[];for(var s in t){var o=t[s],h=new ft;h.Date=e[s],a&&s<a.length&&(h.Time=a[s]),h.Value=o,n.push(h)}if(It.IsDayPeriod(this.Period,!0))i=r.GetFittingData(n);else{if(!It.IsMinutePeriod(this.Period,!0))return null;i=r.GetMinuteFittingData(n)}var l=new It;l.Data=i;var u=l.GetValue();return u},this.GenerateCustomAPIKey=function(t){if(t.length<=0)return"__12_EMPTY_ARGS__";var e="";for(var a in t)e.length>0&&(e+=","),e+=t[a];return e},this.GetCustomApiData=function(t){var e=this.GenerateCustomAPIKey(t);return this.CustomAPIData.has(e)?this.CustomAPIData.get(e):(M.Complier.Log("[JSSymbolData::GetCustomApiData] can't find api data key=["+e+"]"),null)},this.ReadArgumentValue=function(t,e){if(e.Name=t.Name,t.Type==$i.Literal)return e.Value=t.Value,!0;if(t.Type==$i.Identifier){var a=!1;for(var i in this.Arguments){var r=this.Arguments[i];if(r.Name==t.Name)return e.Value=r.Value,a=!0,!0}if(!a)return e.Error="can't read "+t.Name,!1}return e.Error="can't read "+t.Name+", type error.",!1},this.ReadIndexFunctionValue=function(t,e){var a={};if("object"===("undefined"===typeof t?"undefined":(0,d.default)(t))){if(!this.ReadArgumentValue(t,a))return e.Error=a.Error,!1}else a.Value=t;var i=a.Value.indexOf(".");if(-1!=i){e.Name=a.Value.slice(0,i);var r=a.Value.indexOf("#",i+1);-1!=r?(e.Out=a.Value.slice(i+1,r),e.Period=a.Value.slice(r+1)):e.Out=a.Value.slice(i+1)}else{r=a.Value.indexOf("#");-1!=r?(e.Name=a.Value.slice(0,r),e.Period=a.Value.slice(r+1)):e.Name=a.Value}var n=new g.default([["DAY",0],["WEEK",1],["MONTH",2],["SEASON",9],["YEAR",3],["MIN1",4],["MIN5",5],["MIN15",6],["MIN30",7],["MIN60",8]]);if(e.Period){if(!n.has(e.Period))return e.Error=e.Period+", 周期错误",!1;e.PeriodID=n.get(e.Period)}return!0},this.ReadSymbolArgumentValue=function(t,e){var a={};if("object"===("undefined"===typeof t?"undefined":(0,d.default)(t))){if(!this.ReadArgumentValue(t,a))return e.Error=a.Error,!1}else a.Value=t;return""==a.Value&&(a.Value=this.Symbol),a.Value.indexOf(".SH")>0?e.Symbol=a.Value.replace(".SH",".sh"):a.Value.indexOf(".SZ")>0?e.Symbol=a.Value.replace(".SZ",".sz"):e.Symbol=a.Value,!0},this.ReadIndexArgumentValue=function(t,e){for(var a in e.Args=[],e.SytemIndex.Args){var i=e.SytemIndex.Args[a];e.Args.push({Value:i.Value,Name:i.Name})}if(t.length>2&&e.SytemIndex.Args&&e.SytemIndex.Args.length>0){a=2;for(var r=0;a<t.length&&r<e.SytemIndex.Args.length;++a,++r){var n={};i=t[a];if("object"===("undefined"===typeof i?"undefined":(0,d.default)(i))){if(!this.ReadArgumentValue(i,n))return e.Error=n.Error,!1}else n.Value=i;e.Args[r].Value=n.Value}}return!0},this.GenerateScriptIndexKey=function(t){var e="",a=t.Args;for(var i in a){e.length>0&&(e+=",");var r=a[i];e+=r.Value.toString()}var n=t.Out?t.Out:"ALL",s="("+t.Symbol+","+t.PeriodID+"), "+t.Name+"("+e+")=>"+n;return s},this.CallScriptIndex=function(t){var e=this;if(!t.Args||!(t.Args.length>=2)){var a=t.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,"CallScriptIndex() Error: "+t.FunctionName+" 参数错误")}var i={Job:t,PeriodID:this.Period};if(!this.ReadSymbolArgumentValue(t.Args[0],i)){a=t.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,"CallScriptIndex() Error: "+i.Error)}if(!this.ReadIndexFunctionValue(t.Args[1],i)){a=t.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,"CallScriptIndex() Error: "+i.Error)}var r=new P,n=r.Get(i.Name);if(!n){a=t.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,"CallScriptIndex() "+i.Name+" 指标不存在")}if(i.SytemIndex=n,!this.ReadIndexArgumentValue(t.Args,i)){a=t.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,"CallScriptIndex() "+i.Name+" 指标参数错误 : "+i.Error+" ")}M.Complier.Log("[JSSymbolData::CallScriptIndex] call script index",i);var s=null;if(this.Data&&this.Data.Data.length>0){var o=this.Data.Data[0],h=this.Data.Data[this.Data.Data.length-1];s={Start:{Date:o.Date,Time:o.Time},End:{Date:h.Date,Time:h.Time}}}var l={HQDataType:this.DataType,Symbol:i.Symbol,Name:"",Right:this.Right,Period:i.PeriodID,Data:null,SourceData:null,Callback:function(t,a,i){e.RecvScriptIndexData(t,a,i),e.Execute.RunNextJob()},CallbackParam:i,Async:!0,MaxRequestDataCount:this.MaxRequestDataCount+60,MaxRequestMinuteDayCount:this.MaxRequestMinuteDayCount+2,Arguments:i.Args,IsBeforeData:this.IsBeforeData,NetworkFilter:this.NetworkFilter,KLineRange:s};lr.Execute(i.SytemIndex.Script,l,(function(t,a){e.ExecuteScriptIndexError(t,a)}))},this.RecvScriptIndexData=function(t,e,a){var i=this.GenerateScriptIndexKey(e);M.Complier.Log("[JSSymbolData::RecvScriptIndexData] ",t,e,a,i);var r=a.Data.Data,n=t;if(e.Out){for(var s in t){var o=t[s];if(o.Name==e.Out){n=[o];break}}var h=this.Data.FitKLineIndex(r,n,this.Period,e.PeriodID);this.ScriptIndexOutData.set(i,h[0].Data)}else{h=this.Data.FitKLineIndex(r,n,this.Period,e.PeriodID);var l={__Type__:"Object"};for(var s in h){o=h[s];l[o.Name]=o.Data}this.ScriptIndexOutData.set(i,l)}},this.ExecuteScriptIndexError=function(t,e){var a=e.Job.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,"CallScriptIndex() "+e.Name+" 指标执行错误 : "+t+" ")},this.GetScriptIndexOutData=function(t,e){var a={PeriodID:this.Period};this.ReadSymbolArgumentValue(t[0],a)||this.Execute.ThrowUnexpectedNode(e,"STKINDI() 股票代码错误: "+a.Error),this.ReadIndexFunctionValue(t[1],a)||this.Execute.ThrowUnexpectedNode(e,"STKINDI() 指标错误: "+a.Error);var i=new P,r=i.Get(a.Name);r||this.Execute.ThrowUnexpectedNode(e,"STKINDI() 指标错误: "+a.Name+" 指标不存在"),a.SytemIndex=r,this.ReadIndexArgumentValue(t,a)||this.Execute.ThrowUnexpectedNode(e,"STKINDI()  指标参数错误: "+a.Error);var n=this.GenerateScriptIndexKey(a);return this.ScriptIndexOutData.has(n)?this.ScriptIndexOutData.get(n):null},this.JsonDataToHistoryData=function(t){for(var e=t.data,a=new Array,i=0,r=1,n=2,s=3,o=4,h=5,l=6,u=7,C=8,D=9,c=10,f=11,d=0;d<e.length;++d){var m=new Dt;m.Date=e[d][i],m.Open=e[d][n],m.YClose=e[d][r],m.Close=e[d][h],m.High=e[d][s],m.Low=e[d][o],m.Vol=e[d][l],m.Amount=e[d][u],e[d].length>C&&(m.Up=e[d][C]),e[d].length>D&&(m.Down=e[d][D]),e[d].length>c&&(m.Stop=e[d][c]),e[d].length>f&&(m.Unchanged=e[d][f]),isNaN(m.Open)||m.Open<=0||a.push(m)}return a},this.JsonDataToMinuteHistoryData=function(t){for(var e=t.data,a=new Array,i=0,r=1,n=2,s=3,o=4,h=5,l=6,u=7,C=8,D=0;D<e.length;++D){var c=new Dt;c.Date=e[D][i],c.Open=e[D][n],c.YClose=e[D][r],c.Close=e[D][h],c.High=e[D][s],c.Low=e[D][o],c.Vol=e[D][l],c.Amount=e[D][u],c.Time=e[D][C],a.push(c)}for(var f=0;f<a.length;++f){var d=a[f];if(null==d&&coninue,isNaN(d.Open)||d.Open<=0||isNaN(d.High)||d.High<=0||isNaN(d.Low)||d.Low<=0||isNaN(d.Close)||d.Close<=0||isNaN(d.YClose)||d.YClose<=0)if(0==f)d.YClose>0&&(d.Open=d.YClose,d.High=d.YClose,d.Low=d.YClose,d.Close=d.YClose);else for(var m=f-1;m>=0;--m){var v=a[m];if(null==v&&coninue,v.Open>0&&v.High>0&&v.Low>0&&v.Close>0){d.YClose<=0&&(d.YClose=v.Close),d.Open=v.Open,d.High=v.High,d.Low=v.Low,d.Close=v.Close;break}}}return a},this.JsonDataToMinuteData=function(t){var e=new Array;for(var a in t.stock[0].minute){var i=t.stock[0].minute[a],r=new ct;r.Close=i.price,r.Open=i.open,r.High=i.high,r.Low=i.low,r.Vol=i.vol,r.Amount=i.amount,r.DateTime=0==a?t.stock[0].date.toString()+" 0925":t.stock[0].date.toString()+" "+i.time.toString(),r.Date=t.stock[0].date,r.Time=i.time,r.Increase=i.increase,r.Risefall=i.risefall,r.AvPrice=i.avprice,e[a]=r}return e},this.JsonDataToMultiDayMinuteData=function(t){var e=t.symbol,a=e.toUpperCase(),i=Li.IsSHSZ(a),r=(Li.IsChinaFutures(a),[]);for(var n in t.data){var s=[],o=t.data[n],h=o.date,l=o.yclose,u=l,C=null;for(var D in o.minute){var c=o.minute[D];c[2]&&(u=c[2]);var f=new ct;f.Close=c[2],f.Open=c[1],f.High=c[3],f.Low=c[4],f.Vol=c[5]/100,f.Amount=c[6],7<c.length&&c[7]>0&&(f.AvPrice=c[7],C=c[7]),f.DateTime=h.toString()+" "+c[0].toString(),f.Date=h,f.Time=c[0],f.Close||(f.Close=u,f.Open=f.High=f.Low=f.Close),!f.AvPrice&&C&&(f.AvPrice=C),f.Close&&l?f.Increase=(f.Close-l)/l*100:f.Increase=null,0==D&&(i&&(f.DateTime=h.toString()+" 0925"),f.IsFristData=!0),f.Open<=0&&(f.Open=null),f.Close<=0&&(f.Close=null),f.AvPrice<=0&&(f.AvPrice=null),f.High<=0&&(f.High=null),f.Low<=0&&(f.Low=null),f.AvPrice<=0&&(f.AvPrice=null),s[D]=f}var d=new It;d.Data=s,d.YClose=l,d.Close=o.close,d.Date=h,r.push(d)}for(s=[],n=r.length-1;n>=0;--n){f=r[n];for(var D in f.Data)s.push(f.Data[D])}return s},this.CODELIKE=function(t){return this.Symbol&&0==this.Symbol.indexOf(t)?1:0},this.NAMELIKE=function(t){return this.Name&&0==this.Name.indexOf(t)?1:0},this.SETCODE=function(){return this.Symbol.indexOf(".sh")?1:(this.Symbol.indexOf(".sz"),0)},this.GetSymbol=function(){return this.Symbol},this.GetName=function(){return this.Name},this.GetIndustry=function(){var t=or.JOB_DOWNLOAD_GROUP_DATA.toString()+"-Group-"+this.Symbol;if(!this.ExtendData.has(t))return"";var e=this.ExtendData.get(t);if(!e.Industry||e.Industry.length<=0)return"";var a="";for(var i in e.Industry){var r=e.Industry[i];a.length>0&&(a+=" "),a+=r.Name}return a},this.GetRegion=function(){var t=or.JOB_DOWNLOAD_GROUP_DATA.toString()+"-Group-"+this.Symbol;if(!this.ExtendData.has(t))return"";var e=this.ExtendData.get(t);if(!e.Region||e.Region.length<=0)return"";var a="";for(var i in e.Region){var r=e.Region[i];a.length>0&&(a+=" "),a+=r.Name}return a},this.GetConcept=function(){var t=or.JOB_DOWNLOAD_GROUP_DATA.toString()+"-Group-"+this.Symbol;if(!this.ExtendData.has(t))return"";var e=this.ExtendData.get(t);if(!e.Concept||e.Concept.length<=0)return"";var a="";for(var i in e.Concept){var r=e.Concept[i];a.length>0&&(a+=" "),a+=r.Name}return a},this.DATE=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var e in this.Data.Data){var a=this.Data.Data[e];t[e]=a.Date-19e6}return t},this.YEAR=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var e in this.Data.Data){var a=this.Data.Data[e];this.IsNumber(a.Date)?t[e]=parseInt(a.Date/1e4):t[e]=null}return t},this.MONTH=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var e in this.Data.Data){var a=this.Data.Data[e];this.IsNumber(a.Date)?t[e]=parseInt(a.Date%1e4/100):t[e]=null}return t},this.WEEK=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;var e=new Date;for(var a in this.Data.Data){var i=this.Data.Data[a];if(t[a]=null,this.IsNumber(i.Date)){var r=parseInt(i.Date/1e4),n=parseInt(i.Date%1e4/100),s=i.Date%100;e.setFullYear(r),e.setMonth(n-1),e.setDate(s),t[a]=e.getDay()}}return t},this.REFDATE=function(t,e){var a=null;for(var i in this.Data.Data)if(this.Data.Data[i].Date==e){a=parseInt(i);break}return null==a||a>=t.length?null:t[a]},this.PERIOD=function(){var t=[5,6,7,11,0,1,2,3,4,5,9];return this.Period>=0&&this.Period<=t.length-1?t[this.Period]:this.Period},this.GetDrawNull=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var e in this.Data.Data)t[e]=null;return t}}nr.prototype.IsNumber=function(t){return null!=t&&!isNaN(t)},nr.prototype.IsDivideNumber=function(t){return null!=t&&(!isNaN(t)&&0!=t)},nr.prototype.JsonDataToFinance=function(t){for(var e,a=1;a<=4;++a){switch(a){case 1:var i=t.finance1,r=t.announcement1;break;case 2:i=t.finance2,r=t.announcement2;break;case 3:i=t.finance3,r=t.announcement3;break;case 4:i=t.finance4,r=t.announcement4;break;default:break}i&&r&&this.IsNumber(r.year)&&this.IsNumber(r.quarter)&&(e?e.Announcement.year<r.year&&(e={Date:t.date,Finance:i,Announcement:r}):e={Date:t.date,Finance:i,Announcement:r})}return e};var sr=!1,or={JOB_DOWNLOAD_SYMBOL_DATA:1,JOB_DOWNLOAD_INDEX_DATA:2,JOB_DOWNLOAD_SYMBOL_LATEST_DATA:3,JOB_DOWNLOAD_INDEX_INCREASE_DATA:4,JOB_DOWNLOAD_VOLR_DATA:5,JOB_DOWNLOAD_GROUP_DATA:6,JOB_DOWNLOAD_SYMBOL_DAY_DATA:7,JOB_DOWNLOAD_LATEST_INDEX_DATA:8,JOB_DOWNLOAD_OTHER_SYMBOL_DATA:9,JOB_DOWNLOAD_TOTAL_EQUITY_DATA:100,JOB_DOWNLOAD_FLOW_EQUITY_DATA:101,JOB_DOWNLOAD_PER_U_PROFIT_DATA:102,JOB_DOWNLOAD_PER_NETASSET_DATA:103,JOB_DOWNLOAD_PER_C_RESERVE_DATA:104,JOB_DOWNLOAD_PER_S_EARNING_DATA:105,JOB_DOWNLOAD_PER_S_EARNING2_DATA:106,JOB_DOWNLOAD_RELEASE_DATE_DATA:107,JOB_DOWNLOAD_N_PROFIT_DATA:108,JOB_DOWNLOAD_FLOW_MARKETVALUE_DATA:109,JOB_DOWNLOAD_MARKETVALUE_DATA:110,JOB_DOWNLOAD_PROFIT_YOY_DATA:111,JOB_DOWNLOAD_AL_RATIO_DATA:112,JOB_DOWNLOAD_DIVIDEND_YIELD_DATA:113,JOB_DOWNLOAD_SHAREHOLDER_DATA:114,JOB_DOWNLOAD_CAPITAL_DATA:200,JOB_DOWNLOAD_EXCHANGE_DATA:201,JOB_DOWNLOAD_MARGIN_BALANCE:1e3,JOB_DOWNLOAD_MARGIN_RATE:1001,JOB_DOWNLOAD_MARGIN_BUY_BALANCE:1010,JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:1011,JOB_DOWNLOAD_MARGIN_BUY_REPAY:1012,JOB_DOWNLOAD_MARGIN_BUY_NET:1013,JOB_DOWNLOAD_MARGIN_SELL_BALANCE:1020,JOB_DOWNLOAD_MARGIN_SELL_VOLUME:1021,JOB_DOWNLOAD_MARGIN_SELL_REPAY:1022,JOB_DOWNLOAD_MARGIN_SELL_NET:1023,JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE:2e3,JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH:2001,JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT:2002,JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE:2003,JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2:2004,JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER:2005,JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING:2006,JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS:2007,JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS:2008,JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE:2009,JOB_DOWNLOAD_HK_TO_SH:2050,JOB_DOWNLOAD_HK_TO_SZ:2051,JOB_DOWNLOAD_HK_TO_SH_SZ:2052,JOB_DOWNLOAD_HK_TO_SHSZ:2053,JOB_CUSTOM_FUNCTION_DATA:6e3,JOB_CUSTOM_VARIANT_DATA:6001,JOB_DOWNLOAD_SECTION_SF:2e4,JOB_DOWNLOAD_SECTION_F_01:20001,JOB_DOWNLOAD_SECTION_F_02:20002,JOB_DOWNLOAD_SECTION_F_03:20003,JOB_DOWNLOAD_SECTION_F_04:20004,JOB_DOWNLOAD_SECTION_F_05:20005,JOB_DOWNLOAD_SECTION_F_06:20006,JOB_DOWNLOAD_SECTION_F_07:20007,JOB_DOWNLOAD_SECTION_F_08:20008,JOB_DOWNLOAD_SECTION_F_09:20009,JOB_DOWNLOAD_SECTION_F_10:20010,JOB_DOWNLOAD_SECTION_F_11:20011,JOB_DOWNLOAD_SECTION_F_12:20012,JOB_DOWNLOAD_SECTION_F_13:20013,JOB_DOWNLOAD_SECTION_F_14:20014,JOB_DOWNLOAD_SECTION_F_15:20015,JOB_DOWNLOAD_SECTION_F_16:20016,JOB_DOWNLOAD_SECTION_F_17:20017,JOB_DOWNLOAD_SECTION_F_18:20018,JOB_DOWNLOAD_SECTION_F_19:20019,JOB_DOWNLOAD_SECTION_F_20:20020,JOB_DOWNLOAD_SECTION_F_21:20021,JOB_DOWNLOAD_SECTION_F_22:20022,JOB_DOWNLOAD_SECTION_F_23:20023,JOB_DOWNLOAD_SECTION_F_24:20024,JOB_DOWNLOAD_SECTION_F_25:20025,JOB_DOWNLOAD_SECTION_F_26:20026,JOB_DOWNLOAD_SECTION_F_27:20027,JOB_DOWNLOAD_SECTION_F_28:20028,JOB_DOWNLOAD_SECTION_F_29:20029,JOB_DOWNLOAD_SECTION_F_30:20030,JOB_DOWNLOAD_SECTION_F_31:20031,JOB_DOWNLOAD_SECTION_F_32:20032,JOB_DOWNLOAD_SECTION_F_33:20033,JOB_DOWNLOAD_SECTION_F_34:20034,JOB_DOWNLOAD_SECTION_F_35:20035,JOB_DOWNLOAD_SECTION_F_36:20036,JOB_DOWNLOAD_SECTION_F_37:20037,JOB_DOWNLOAD_SECTION_F_38:20038,JOB_DOWNLOAD_SECTION_F_39:20039,JOB_DOWNLOAD_CUSTOM_API_DATA:3e4,JOB_EXECUTE_INDEX:30010,JOB_RUN_SCRIPT:1e4,GetFinnanceJobID:function(t){var e=new g.default([[1,or.JOB_DOWNLOAD_TOTAL_EQUITY_DATA],[7,or.JOB_DOWNLOAD_FLOW_EQUITY_DATA],[9,or.JOB_DOWNLOAD_AL_RATIO_DATA],[18,or.JOB_DOWNLOAD_PER_C_RESERVE_DATA],[30,or.JOB_DOWNLOAD_N_PROFIT_DATA],[32,or.JOB_DOWNLOAD_PER_U_PROFIT_DATA],[33,or.JOB_DOWNLOAD_PER_S_EARNING2_DATA],[34,or.JOB_DOWNLOAD_PER_NETASSET_DATA],[38,or.JOB_DOWNLOAD_PER_S_EARNING_DATA],[40,or.JOB_DOWNLOAD_FLOW_MARKETVALUE_DATA],[41,or.JOB_DOWNLOAD_MARKETVALUE_DATA],[42,or.JOB_DOWNLOAD_RELEASE_DATE_DATA],[43,or.JOB_DOWNLOAD_PROFIT_YOY_DATA],[45,or.JOB_DOWNLOAD_DIVIDEND_YIELD_DATA],[100,or.JOB_DOWNLOAD_SHAREHOLDER_DATA],[200,or.JOB_DOWNLOAD_CAPITAL_DATA],[201,or.JOB_DOWNLOAD_EXCHANGE_DATA]]);return e.has(t)?e.get(t):null},GetMarginJobID:function(t){var e=new g.default([[1,or.JOB_DOWNLOAD_MARGIN_BALANCE],[2,or.JOB_DOWNLOAD_MARGIN_RATE],[3,or.JOB_DOWNLOAD_MARGIN_BUY_BALANCE],[4,or.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT],[5,or.JOB_DOWNLOAD_MARGIN_BUY_REPAY],[6,or.JOB_DOWNLOAD_MARGIN_BUY_NET],[7,or.JOB_DOWNLOAD_MARGIN_SELL_BALANCE],[8,or.JOB_DOWNLOAD_MARGIN_SELL_VOLUME],[9,or.JOB_DOWNLOAD_MARGIN_SELL_REPAY],[10,or.JOB_DOWNLOAD_MARGIN_SELL_NET]]);return e.has(t)?e.get(t):null},GetNewsAnalysisID:function(t){var e=new g.default([[1,or.JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE],[2,or.JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH],[3,or.JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT],[4,or.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE],[5,or.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2],[6,or.JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER],[7,or.JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING],[8,or.JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS],[9,or.JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS],[10,or.JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE]]);return e.has(t)?e.get(t):null},GetSectionFinanceID:function(t){var e=new g.default([["流动资产",or.JOB_DOWNLOAD_SECTION_F_01],["货币资金",or.JOB_DOWNLOAD_SECTION_F_02],["存货",or.JOB_DOWNLOAD_SECTION_F_03],["流动负债",or.JOB_DOWNLOAD_SECTION_F_04],["非流动负债",or.JOB_DOWNLOAD_SECTION_F_05],["三项费用",or.JOB_DOWNLOAD_SECTION_F_06],["投资收益",or.JOB_DOWNLOAD_SECTION_F_07],["归母净利润",or.JOB_DOWNLOAD_SECTION_F_08],["扣非净利润",or.JOB_DOWNLOAD_SECTION_F_09],["扣非每股收益",or.JOB_DOWNLOAD_SECTION_F_10],["加权平均净资产收益",or.JOB_DOWNLOAD_SECTION_F_11],["在建工程",or.JOB_DOWNLOAD_SECTION_F_12],["累计折旧",or.JOB_DOWNLOAD_SECTION_F_13],["少数股东利润",or.JOB_DOWNLOAD_SECTION_F_14],["汇兑损益",or.JOB_DOWNLOAD_SECTION_F_15],["坏账计提",or.JOB_DOWNLOAD_SECTION_F_16],["固定资产",or.JOB_DOWNLOAD_SECTION_F_17],["当期折旧",or.JOB_DOWNLOAD_SECTION_F_18],["营业总收入",or.JOB_DOWNLOAD_SECTION_F_19],["主营业务利润",or.JOB_DOWNLOAD_SECTION_F_20],["营业利润",or.JOB_DOWNLOAD_SECTION_F_21],["净利润",or.JOB_DOWNLOAD_SECTION_F_22],["应收账款",or.JOB_DOWNLOAD_SECTION_F_23],["财务费用",or.JOB_DOWNLOAD_SECTION_F_24],["经营性现金流",or.JOB_DOWNLOAD_SECTION_F_25],["资产总计",or.JOB_DOWNLOAD_SECTION_F_26],["负债总计",or.JOB_DOWNLOAD_SECTION_F_27],["所有者权益总计",or.JOB_DOWNLOAD_SECTION_F_28],["毛利率",or.JOB_DOWNLOAD_SECTION_F_29],["每股资本公积金",or.JOB_DOWNLOAD_SECTION_F_30],["每股未分配利润",or.JOB_DOWNLOAD_SECTION_F_31],["每股收益",or.JOB_DOWNLOAD_SECTION_F_32],["每股净资产",or.JOB_DOWNLOAD_SECTION_F_33],["每股经营性现金流",or.JOB_DOWNLOAD_SECTION_F_34],["扣非净利润涨幅",or.JOB_DOWNLOAD_SECTION_F_35],["扣非净利润涨速",or.JOB_DOWNLOAD_SECTION_F_36],["净利润涨幅",or.JOB_DOWNLOAD_SECTION_F_37],["资产负债率",or.JOB_DOWNLOAD_SECTION_F_38],["利润同比",or.JOB_DOWNLOAD_SECTION_F_39]]);return e.has(t)?e.get(t):null},GetSectionReportPeriod:function(t,e){return t>=2e3&&e>=1&&e<=4?{Year:t,Quarter:e}:null}};function hr(t,e){this.AST=t,this.ErrorHandler=new Zi,this.VarTable=new g.default,this.OutVarTable=[],this.Arguments=[],this.ErrorCallback,this.ConstVarTable=new g.default([["CLOSE",null],["VOL",null],["OPEN",null],["HIGH",null],["LOW",null],["AMOUNT",null],["C",null],["V",null],["O",null],["H",null],["L",null],["AMO",null],["VOLR",null],["VOLINSTK",null],["DATE",null],["YEAR",null],["MONTH",null],["PERIOD",null],["WEEK",null],["INDEXA",null],["INDEXC",null],["INDEXH",null],["INDEXL",null],["INDEXO",null],["INDEXV",null],["INDEXADV",null],["INDEXDEC",null],["ADVANCE",null],["DECLINE",null],["FROMOPEN",null],["TOTALFZNUM",null],["CURRBARSCOUNT",null],["TOTALBARSCOUNT",null],["ISLASTBAR",null],["CAPITAL",null],["EXCHANGE",null],["SETCODE",null],["CODE",null],["STKNAME",null],["HYBLOCK",null],["DYBLOCK",null],["GNBLOCK",null],["DRAWNULL",null]]),this.SymbolData=new nr(this.AST,e,this),this.Algorithm=new ar(this.ErrorHandler,this.SymbolData),this.Draw=new ir(this.ErrorHandler,this.SymbolData),this.JobList=[],this.UpdateUICallback=null,this.CallbackParam=null,this.IsSectionMode=!1,e&&(e.Callback&&(this.UpdateUICallback=e.Callback),e.CallbackParam&&(this.CallbackParam=e.CallbackParam),e.Arguments&&(this.Arguments=e.Arguments),e.IsSectionMode&&(this.IsSectionMode=e.IsSectionMode)),this.Execute=function(){for(var t in this.OutVarTable=[],this.VarTable=new g.default,M.Complier.Log("[JSExecute::Execute] Load Arguments",this.Arguments),this.Arguments){var e=this.Arguments[t];this.VarTable.set(e.Name,e.Value)}this.RunNextJob()},this.RunNextJob=function(){if(!(this.JobList.length<=0)){M.Complier.Log("[JSExecute::Execute] JobList",this.JobList);var t=this.JobList.shift();switch(t.ID){case or.JOB_DOWNLOAD_SYMBOL_DATA:return this.SymbolData.GetSymbolData();case or.JOB_DOWNLOAD_SYMBOL_DAY_DATA:return this.SymbolData.GetSymbolDayData();case or.JOB_DOWNLOAD_INDEX_DATA:return this.SymbolData.GetIndexData();case or.JOB_DOWNLOAD_LATEST_INDEX_DATA:return this.SymbolData.GetLatestIndexData();case or.JOB_DOWNLOAD_INDEX_INCREASE_DATA:return this.SymbolData.GetIndexIncreaseData(t);case or.JOB_DOWNLOAD_SYMBOL_LATEST_DATA:return this.SymbolData.GetLatestData();case or.JOB_DOWNLOAD_VOLR_DATA:return this.SymbolData.GetVolRateData(t);case or.JOB_DOWNLOAD_GROUP_DATA:return this.SymbolData.GetGroupData(t);case or.JOB_DOWNLOAD_OTHER_SYMBOL_DATA:return this.SymbolData.GetOtherSymbolData(t);case or.JOB_DOWNLOAD_TOTAL_EQUITY_DATA:case or.JOB_DOWNLOAD_CAPITAL_DATA:case or.JOB_DOWNLOAD_FLOW_EQUITY_DATA:case or.JOB_DOWNLOAD_PER_NETASSET_DATA:case or.JOB_DOWNLOAD_PER_U_PROFIT_DATA:case or.JOB_DOWNLOAD_PER_C_RESERVE_DATA:case or.JOB_DOWNLOAD_PER_S_EARNING_DATA:case or.JOB_DOWNLOAD_PER_S_EARNING2_DATA:case or.JOB_DOWNLOAD_N_PROFIT_DATA:case or.JOB_DOWNLOAD_FLOW_MARKETVALUE_DATA:case or.JOB_DOWNLOAD_MARKETVALUE_DATA:case or.JOB_DOWNLOAD_EXCHANGE_DATA:case or.JOB_DOWNLOAD_AL_RATIO_DATA:case or.JOB_DOWNLOAD_PROFIT_YOY_DATA:case or.JOB_DOWNLOAD_DIVIDEND_YIELD_DATA:case or.JOB_DOWNLOAD_SHAREHOLDER_DATA:return this.SymbolData.GetFinanceData(t.ID);case or.JOB_DOWNLOAD_RELEASE_DATE_DATA:return this.SymbolData.GetCompanyReleaseDate(t.ID);case or.JOB_DOWNLOAD_MARGIN_BALANCE:case or.JOB_DOWNLOAD_MARGIN_RATE:case or.JOB_DOWNLOAD_MARGIN_BUY_BALANCE:case or.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:case or.JOB_DOWNLOAD_MARGIN_BUY_REPAY:case or.JOB_DOWNLOAD_MARGIN_BUY_NET:case or.JOB_DOWNLOAD_MARGIN_SELL_BALANCE:case or.JOB_DOWNLOAD_MARGIN_SELL_VOLUME:case or.JOB_DOWNLOAD_MARGIN_SELL_REPAY:case or.JOB_DOWNLOAD_MARGIN_SELL_NET:return this.SymbolData.GetMarginData(t.ID);case or.JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE:case or.JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH:case or.JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT:case or.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE:case or.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2:case or.JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER:case or.JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING:case or.JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS:case or.JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS:case or.JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE:return this.SymbolData.GetNewsAnalysisData(t.ID);case or.JOB_DOWNLOAD_HK_TO_SHSZ:return this.SymbolData.GetHKToSHSZData(t);case or.JOB_DOWNLOAD_SECTION_SF:return this.SymbolData.GetSectionFinanceData(t);case or.JOB_CUSTOM_VARIANT_DATA:return this.SymbolData.DownloadCustomVariantData(t);case or.JOB_CUSTOM_FUNCTION_DATA:return this.SymbolData.DownloadCustomFunctionData(t);case or.JOB_DOWNLOAD_CUSTOM_API_DATA:return this.SymbolData.DownloadCustomAPIData(t);case or.JOB_EXECUTE_INDEX:return this.SymbolData.CallScriptIndex(t);case or.JOB_RUN_SCRIPT:return this.Run()}}},this.ReadSymbolData=function(t,e){switch(t){case"CLOSE":case"C":case"VOL":case"V":case"OPEN":case"O":case"HIGH":case"H":case"LOW":case"L":case"AMOUNT":case"AMO":case"VOLINSTK":return this.SymbolData.GetSymbolCacheData(t);case"VOLR":return this.SymbolData.GetVolRateCacheData(e);case"INDEXA":case"INDEXC":case"INDEXH":case"INDEXH":case"INDEXO":case"INDEXV":case"INDEXL":case"INDEXADV":case"INDEXDEC":return this.SymbolData.GetIndexCacheData(t);case"CURRBARSCOUNT":return this.SymbolData.GetCurrBarsCount();case"TOTALBARSCOUNT":return this.SymbolData.GetTotalBarsCount();case"TOTALFZNUM":return this.SymbolData.GetTotalTradeMinuteCount();case"ISLASTBAR":return this.SymbolData.GetIsLastBar();case"CAPITAL":return this.SymbolData.GetFinanceCacheData(or.JOB_DOWNLOAD_CAPITAL_DATA);case"EXCHANGE":return this.SymbolData.GetFinanceCacheData(or.JOB_DOWNLOAD_EXCHANGE_DATA);case"SETCODE":return this.SymbolData.SETCODE();case"CODE":return this.SymbolData.GetSymbol();case"STKNAME":return this.SymbolData.GetName();case"HYBLOCK":return this.SymbolData.GetIndustry();case"DYBLOCK":return this.SymbolData.GetRegion();case"GNBLOCK":return this.SymbolData.GetConcept();case"DATE":return this.SymbolData.DATE();case"YEAR":return this.SymbolData.YEAR();case"MONTH":return this.SymbolData.MONTH();case"WEEK":return this.SymbolData.WEEK();case"PERIOD":return this.SymbolData.PERIOD();case"FROMOPEN":return this.SymbolData.GetLatestIndexCacheData("FROMOPEN");case"DRAWNULL":return this.SymbolData.GetDrawNull();case"ADVANCE":case"DECLINE":return this.SymbolData.GetIndexIncreaseCacheData(t,this.SymbolData.Symbol,e)}},this.ReadCustomVariant=function(t,e){var a=Xi.CustomVariant.Data.get(t);if(!a||!a.Read)return[];var i={Name:t,Symbol:this.SymbolData.Symbol,KData:this.SymbolData.Data,Period:this.SymbolData.Period,Right:this.SymbolData.Right};return a.Read(i)},this.ReadVariable=function(t,e){if(this.ConstVarTable.has(t)){var a=this.ConstVarTable.get(t);return null==a&&(a=this.ReadSymbolData(t,e),this.ConstVarTable.set(t,a)),a}return Xi.IsCustomVariant(t)?this.ReadCustomVariant(t,e):this.VarTable.has(t)?this.VarTable.get(t):(this.ThrowUnexpectedNode(e,"变量"+t+"不存在"),null)},this.ReadMemberVariable=function(t){var e=t.Object,a=t.Property,i=void 0;if(i=e.Type==$i.BinaryExpression||e.Type==$i.LogicalExpression?this.VisitBinaryExpression(e):e.Type==$i.CallExpression?this.VisitCallExpression(e):this.GetNodeValue(e),!i)return null;var r=i[a.Name];return r||null},this.SingleDataToArrayData=function(t){for(var e=this.SymbolData.Data.Data.length,a=[],i=0;i<e;++i)a[i]=t;return a},this.RunAST=function(){for(var t in this.AST||this.ThrowError(),this.AST.Body||this.ThrowError(),this.AST.Body){var e=this.AST.Body[t];if(this.VisitNode(e),e.Type==$i.ExpressionStatement&&e.Expression)if(e.Expression.Type==$i.AssignmentExpression&&":"==e.Expression.Operator&&e.Expression.Left){var a=e.Expression,i=a.Left.Name,r=this.VarTable.get(i),n=0;r&&"object"==("undefined"===typeof r?"undefined":(0,d.default)(r))&&"Object"==r.__Type__?n=1e3:this.IsSectionMode||Array.isArray(r)||(r="string"==typeof r?this.SingleDataToArrayData(parseFloat(r)):this.SingleDataToArrayData(r)),this.OutVarTable.push({Name:i,Data:r,Type:n})}else if(e.Expression.Type==$i.CallExpression){var s=e.Expression;if(this.Draw.IsDrawFunction(s.Callee.Name)){var o=s.Draw;o.Name=s.Callee.Name,this.OutVarTable.push({Name:o.Name,Draw:o,Type:1})}}else if(e.Expression.Type==$i.SequenceExpression){var h=void 0,l=void 0,u=void 0,C=void 0,D=!1,c=!1,f=!1,m=!1,v=!1,S=!1,I=!0,p=!1,T=!1,A=!1;for(var g in e.Expression.Expression){var F=e.Expression.Expression[g];if(F.Type==$i.AssignmentExpression&&":"==F.Operator&&F.Left){h=F.Left.Name;var E=this.VarTable.get(h);Array.isArray(E)||(E=this.SingleDataToArrayData(E),this.VarTable.set(h,E))}else if(F.Type==$i.Identifier){var L=F.Name;"COLORSTICK"===L?D=!0:"POINTDOT"===L?c=!0:"CIRCLEDOT"===L?f=!0:"DOTLINE"==L?T=!0:"LINESTICK"===L?m=!0:"STICK"===L?v=!0:"VOLSTICK"===L?S=!0:0==L.indexOf("COLOR")?u=L:0==L.indexOf("LINETHICK")?C=L:0==L.indexOf("NODRAW")?I=!1:0==L.indexOf("EXDATA")?p=!0:0==L.indexOf("LINEOVERLAY")&&(A=!0)}else if(F.Type==$i.Literal){var x=this.SingleDataToArrayData(F.Value);h=F.Value.toString(),this.VarTable.set(h,x)}else F.Type==$i.CallExpression&&this.Draw.IsDrawFunction(F.Callee.Name)&&(l=F.Draw,l.Name=F.Callee.Name)}if(c&&h){var N=this.VarTable.get(h);Array.isArray(N)||(N=this.SingleDataToArrayData(N));var O={Name:h,Data:N,Radius:2,Type:3};u&&(O.Color=u),C&&(O.LineWidth=C),this.OutVarTable.push(O)}else if(f&&h){var y=this.VarTable.get(h);Array.isArray(y)||(y=this.SingleDataToArrayData(y));var R={Name:h,Data:y,Radius:1.3,Type:3};u&&(R.Color=u),C&&(R.LineWidth=C),this.OutVarTable.push(R)}else if(m&&h){var P=this.VarTable.get(h),w={Name:h,Data:P,Type:4};u&&(w.Color=u),C&&(w.LineWidth=C),this.OutVarTable.push(w)}else if(v&&h){var b=this.VarTable.get(h),B={Name:h,Data:b,Type:5};u&&(B.Color=u),C&&(B.LineWidth=C),this.OutVarTable.push(B)}else if(S&&h){var _=this.VarTable.get(h),H={Name:h,Data:_,Type:6};u&&(H.Color=u),this.OutVarTable.push(H)}else if(h&&u){var V=this.VarTable.get(h);Array.isArray(V)||(V=this.SingleDataToArrayData(V));var G={Name:h,Data:V,Color:u,Type:0};C&&(G.LineWidth=C),0==I&&(G.IsShow=!1),1==p&&(G.IsExData=!0),1==T&&(G.IsDotLine=!0),1==A&&(G.IsOverlayLine=!0),this.OutVarTable.push(G)}else if(l){var k={Name:l.Name,Draw:l,Type:1};u&&(k.Color=u),C&&(k.LineWidth=C),this.OutVarTable.push(k)}else if(D&&h){var Y=this.VarTable.get(h),U={Name:h,Data:Y,Color:u,Type:2};C&&(U.LineWidth=C),this.OutVarTable.push(U)}else if(h){var W=this.VarTable.get(h),X={Name:h,Data:W,Type:0};u&&(X.Color=u),C&&(X.LineWidth=C),0==I&&(X.IsShow=!1),1==p&&(X.IsExData=!0),1==T&&(X.IsDotLine=!0),1==A&&(X.IsOverlayLine=!0),this.OutVarTable.push(X)}}}return M.Complier.Log("[JSExecute::Run]",this.VarTable),this.OutVarTable},this.Run=function(){try{var t=this.RunAST();M.Complier.Log("[JSComplier.Run] execute finish",t),this.UpdateUICallback&&(M.Complier.Log("[JSComplier.Run] invoke UpdateUICallback."),this.CallbackParam&&this.CallbackParam.Job&&this.CallbackParam.Job.ID==or.JOB_EXECUTE_INDEX?this.UpdateUICallback(t,this.CallbackParam,this.SymbolData):(this.CallbackParam&&this.CallbackParam.Self&&"ScriptIndexConsole"===this.CallbackParam.Self.ClassName&&(this.CallbackParam.JSExecute=this),this.UpdateUICallback(t,this.CallbackParam)))}catch(e){M.Complier.Log(e),e.Job?(M.Complier.Log("[JSComplier.Run] download job and reexectue",e.Job),this.JobList.push(e.Job),this.JobList.push({ID:or.JOB_RUN_SCRIPT}),this.Execute()):this.ErrorCallback&&this.ErrorCallback(e,this.CallbackParam)}},this.VisitNode=function(t){switch(t.Type){case $i.SequenceExpression:this.VisitSequenceExpression(t);break;case $i.ExpressionStatement:this.VisitNode(t.Expression);break;case $i.AssignmentExpression:this.VisitAssignmentExpression(t);break;case $i.BinaryExpression:case $i.LogicalExpression:this.VisitBinaryExpression(t);break;case $i.CallExpression:this.VisitCallExpression(t);break}},this.VisitSequenceExpression=function(t){for(var e in t.Expression){var a=t.Expression[e];this.VisitNode(a)}},this.VisitCallExpression=function(t){var e=t.Callee.Name,a=[];for(var i in t.Arguments){var r=t.Arguments[i],n=void 0;n=r.Type==$i.BinaryExpression||r.Type==$i.LogicalExpression?this.VisitBinaryExpression(r):r.Type==$i.CallExpression?this.VisitCallExpression(r):this.GetNodeValue(r),a.push(n)}if(sr&&M.Complier.Log("[JSExecute::VisitCallExpression]",e,"(",a.toString(),")"),Xi.IsCustomFunction(e))return t.Out=this.Algorithm.CallCustomFunction(e,a,this.SymbolData,t),t.Out;switch(e){case"DYNAINFO":t.Out=this.SymbolData.GetLatestCacheData(a[0]);break;case"STICKLINE":t.Draw=this.Draw.STICKLINE(a[0],a[1],a[2],a[3],a[4]),t.Out=[];break;case"DRAWTEXT":t.Draw=this.Draw.DRAWTEXT(a[0],a[1],a[2]),t.Out=[];break;case"DRAWTEXT_FIX":t.Draw=this.Draw.DRAWTEXT_FIX(a[0],a[1],a[2],a[3],a[4]),t.Out=[];break;case"SUPERDRAWTEXT":t.Draw=this.Draw.SUPERDRAWTEXT(a[0],a[1],a[2],a[3],a[4]),t.Out=[];break;case"DRAWICON":t.Draw=this.Draw.DRAWICON(a[0],a[1],a[2]),t.Out=[];break;case"DRAWLINE":t.Draw=this.Draw.DRAWLINE(a[0],a[1],a[2],a[3],a[4]),t.Out=t.Draw.DrawData;break;case"DRAWBAND":t.Draw=this.Draw.DRAWBAND(a[0],a[1],a[2],a[3]),t.Out=[];break;case"FILLRGN":t.Draw=this.Draw.FILLRGN(a[0],a[1],a[2]),t.Out=[];break;case"DRAWKLINE":t.Draw=this.Draw.DRAWKLINE(a[0],a[1],a[2],a[3]),t.Out=[];break;case"DRAWKLINE_IF":t.Draw=this.Draw.DRAWKLINE_IF(a[0],a[1],a[2],a[3],a[4]),t.Out=[];break;case"PLOYLINE":case"POLYLINE":t.Draw=this.Draw.POLYLINE(a[0],a[1]),t.Out=t.Draw.DrawData;break;case"DRAWNUMBER":t.Draw=this.Draw.DRAWNUMBER(a[0],a[1],a[2]),t.Out=t.Draw.DrawData.Value;break;case"DRAWCHANNEL":t.Draw=this.Draw.DRAWCHANNEL(a[0],a[1],a[2],a[3],a[4],a[5],a[6]),t.Out=[];break;case"RGB":t.Out=this.Draw.RGB(a[0],a[1],a[2]);break;case"PARTLINE":t.Draw=this.Draw.PARTLINE(a),t.Out=[];break;case"DRAWGBK":t.Draw=this.Draw.DRAWGBK(a[0],a[1],a[2],a[3]),t.Out=[];break;case"DRAWTEXT_LINE":t.Draw=this.Draw.DRAWTEXT_LINE(a[0],a[1],a[2],a[3],a[4],a[5],a[6]),t.Out=[];break;case"DRAWRECTREL":t.Draw=this.Draw.DRAWRECTREL(a[0],a[1],a[2],a[3],a[4]),t.Out=[];break;case"DRAWOVERLAYLINE":t.Draw=this.Draw.DRAWOVERLAYLINE(a[0],a[1],a[2]),t.Out=t.Draw.DrawData.Data;break;case"CODELIKE":t.Out=this.SymbolData.CODELIKE(a[0]);break;case"NAMELIKE":t.Out=this.SymbolData.NAMELIKE(a[1]);break;case"REFDATE":t.Out=this.SymbolData.REFDATE(a[0],a[1]);break;case"FINANCE":t.Out=this.SymbolData.GetFinanceCacheData(a[0],t);break;case"MARGIN":t.Out=this.SymbolData.GetMarginCacheData(a[0],t);break;case"HK2SHSZ":t.Out=this.SymbolData.GetHKToSHSZCacheData(a[0],t);break;case"NEWS":t.Out=this.SymbolData.GetNewsAnalysisCacheData(a[0],t);break;case"UPCOUNT":case"DOWNCOUNT":t.Out=this.SymbolData.GetIndexIncreaseCacheData(e,a[0],t);break;case"SF":t.Out=this.SymbolData.GetSectionFinanceCacheData(a[0],a[1],a[2],t);break;case"LOADAPIDATA":t.Out=this.SymbolData.GetCustomApiData(a);break;case"STKINDI":t.Out=this.SymbolData.GetScriptIndexOutData(a,t);break;case"CLOSE":case"C":case"VOL":case"V":case"OPEN":case"O":case"HIGH":case"H":case"LOW":case"L":case"AMOUNT":case"AMO":t.Out=this.SymbolData.GetOtherSymolCacheData(e,a);break;default:t.Out=this.Algorithm.CallFunction(e,a,t,this.SymbolData);break}return t.Out},this.VisitAssignmentExpression=function(t){var e=t.Left;e.Type!=$i.Identifier&&this.ThrowUnexpectedNode(t);var a=e.Name,i=t.Right,r=null;if(i.Type==$i.BinaryExpression||i.Type==$i.LogicalExpression)r=this.VisitBinaryExpression(i);else if(i.Type==$i.CallExpression)r=this.VisitCallExpression(i);else if(i.Type==$i.Literal)r=i.Value;else if(i.Type==$i.Identifier)r=this.ReadVariable(i.Name,i);else if(i.Type==$i.MemberExpression)r=this.ReadMemberVariable(i);else if(i.Type==$i.UnaryExpression)if("-"==i.Operator){var n=this.GetNodeValue(i.Argument);r=this.Algorithm.Subtract(0,n)}else r=i.Argument.Value;sr&&M.Complier.Log("[JSExecute::VisitAssignmentExpression]",a," = ",r),this.VarTable.set(a,r)},this.VisitBinaryExpression=function(t){var e=[];e.push(t);var a=null;while(0!=e.length)if(a=e[e.length-1],a.Left&&t!=a.Left&&t!=a.Right)e.push(a.Left);else if(a.Right&&t!=a.Right)e.push(a.Right);else{var i=e.pop();if(i.Type==$i.BinaryExpression){var r=this.GetNodeValue(i.Left),n=this.GetNodeValue(i.Right);switch(sr&&M.Complier.Log("[JSExecute::VisitBinaryExpression] BinaryExpression",i,r,n),i.Out=null,i.Operator){case"-":i.Out=this.Algorithm.Subtract(r,n);break;case"*":i.Out=this.Algorithm.Multiply(r,n);break;case"/":i.Out=this.Algorithm.Divide(r,n);break;case"+":i.Out=this.Algorithm.Add(r,n);break;case">":i.Out=this.Algorithm.GT(r,n);break;case">=":i.Out=this.Algorithm.GTE(r,n);break;case"<":i.Out=this.Algorithm.LT(r,n);break;case"<=":i.Out=this.Algorithm.LTE(r,n);break;case"==":case"=":i.Out=this.Algorithm.EQ(r,n);break;case"!=":case"<>":i.Out=this.Algorithm.NEQ(r,n);break}sr&&M.Complier.Log("[JSExecute::VisitBinaryExpression] BinaryExpression",i)}else if(i.Type==$i.LogicalExpression){var s=this.GetNodeValue(i.Left),o=this.GetNodeValue(i.Right);switch(sr&&M.Complier.Log("[JSExecute::VisitBinaryExpression] LogicalExpression",i,s,o),i.Out=null,i.Operator){case"&&":case"AND":i.Out=this.Algorithm.And(s,o);break;case"||":case"OR":i.Out=this.Algorithm.Or(s,o);break}sr&&M.Complier.Log("[JSExecute::VisitBinaryExpression] LogicalExpression",i)}t=a}return t.Out},this.GetNodeValue=function(t){switch(t.Type){case $i.Literal:return t.Value;case $i.UnaryExpression:if("-"==t.Operator){var e=this.GetNodeValue(t.Argument);return this.Algorithm.Subtract(0,e)}return t.Argument.Value;case $i.Identifier:var a=this.ReadVariable(t.Name,t);return a;case $i.BinaryExpression:case $i.LogicalExpression:return t.Out;case $i.CallExpression:return this.VisitCallExpression(t);default:this.ThrowUnexpectedNode(t)}},this.ThrowUnexpectedNode=function(t,e){var a=t.Marker,i=e||"执行异常";return this.ErrorHandler.ThrowError(a.Index,a.Line,a.Column,i)},this.ThrowDownloadSF=function(t,e,a){var i=t.Marker,r=a;return this.ErrorHandler.ThrowDownloadJob(i.Index,i.Line,i.Column,r,e)},this.ThrowError=function(){}}function lr(){}lr.Tokenize=function(t){M.Complier.Log("[JSComplier.Tokenize]",t);var e=new ji(t),a=[];try{while(1){var i=e.GetNextToken();if(!i)break;a.push(i)}}catch(r){}return a},lr.Parse=function(t){M.Complier.Log("[JSComplier.Parse]",t);var e=new er(t);e.Initialize();var a=e.ParseScript(),i=a;return i},lr.Execute=function(t,e,a){var i=function(){try{M.Complier.Log("[JSComplier.Execute]",t,e),M.Complier.Log("[JSComplier.Execute] parser .....");var i=new er(t);i.Initialize();var r=i.ParseScript(),n=r;M.Complier.Log("[JSComplier.Execute] parser finish.",n),M.Complier.Log("[JSComplier.Execute] execute .....");var s=new hr(n,e);s.ErrorCallback=a,s.JobList=i.Node.GetDataJobList(),"ScriptIndexConsole"==e.ClassName&&s.JobList.unshift({ID:or.JOB_DOWNLOAD_SYMBOL_DATA}),s.JobList.push({ID:or.JOB_RUN_SCRIPT});s.Execute()}catch(o){M.Complier.Log(o),a&&a(o,e.CallbackParam)}};i(),M.Complier.Log("[JSComplier.Execute] async execute.")},lr.SetDomain=function(t,e){t&&(Xi.Domain=t),e&&(Xi.CacheDomain=e)},lr.AddIcon=function(t){Xi.CustomDrawIcon.Data.set(t.ID,t)},lr.AddFunction=function(t){if(t&&t){var e=t.Name.toUpperCase();Xi.CustomFunction.Data.set(e,t)}},lr.AddVariant=function(t){if(t&&t){var e=t.Name.toUpperCase();Xi.CustomVariant.Data.set(e,t)}};var ur={KLINE_ID:0,MINUTE_ID:2,HISTORY_MINUTE_ID:3,MULTIDAY_MINUTE_ID:4};function Cr(t,e,a,i){this.newMethod=Wa,this.newMethod(t),delete this.newMethod,this.Script=e,this.Arguments=[],this.OutVar=[],this.ID,this.FloatPrecision=2,this.StringFormat,this.KLineType=null,this.InstructionType,this.YSpecificMaxMin=null,this.YSplitScale=null,this.Condition=null,this.IsLocked=!1,this.LockCallback=null,this.LockID=null,this.LockBG=null,this.LockTextColor=null,this.LockText=null,this.LockFont=null,this.LockCount=20,this.LockMinWidth=null,this.TitleFont=Ma.TitleFont,this.IsShortTitle=!1,i&&(i.FloatPrecision>=0&&(this.FloatPrecision=i.FloatPrecision),i.StringFormat>0&&(this.StringFormat=i.StringFormat),i.ID&&(this.ID=i.ID),(i.KLineType>=0||-1===i.KLineType)&&(this.KLineType=i.KLineType),i.InstructionType&&(this.InstructionType=i.InstructionType),i.YSpecificMaxMin&&(this.YSpecificMaxMin=i.YSpecificMaxMin),i.YSplitScale&&(this.YSplitScale=i.YSplitScale),i.Condition&&(this.Condition=i.Condition),i.TitleFont&&(this.TitleFont=i.TitleFont),i.IsShortTitle&&(this.IsShortTitle=i.IsShortTitle)),i&&i.Lock&&(1==i.Lock.IsLocked&&(this.IsLocked=!0),i.Lock.Callback&&(this.LockCallback=i.Lock.Callback),i.Lock.ID&&(this.LockID=i.Lock.ID),i.Lock.BG&&(this.LockBG=i.Lock.BG),i.Lock.TextColor&&(this.LockTextColor=i.Lock.TextColor),i.Lock.Text&&(this.LockText=i.Lock.Text),i.Lock.Font&&(this.LockFont=i.Lock.Font),i.Lock.Count&&(this.LockCount=i.Lock.Count),i.Lock.MinWidth&&(this.LockMinWidth=i.Lock.MinWidth*V())),a&&(this.Arguments=a),this.SetLock=function(t){1==t.IsLocked?(this.IsLocked=!0,t.Callback&&(this.LockCallback=t.Callback),t.ID&&(this.LockID=t.ID),t.BG&&(this.LockBG=t.BG),t.TextColor&&(this.LockTextColor=t.TextColor),t.Text&&(this.LockText=t.Text),t.Font&&(this.LockFont=t.Font),t.Count&&(this.LockCount=t.Count),t.MinWidth&&(this.LockMinWidth=t.MinWidth*V())):(this.IsLocked=!1,this.LockCallback=null,this.LockID=null,this.LockBG=null,this.LockTextColor=null,this.LockText=null,this.LockFont=null,this.LockCount=20)},this.ExecuteScript=function(t,e,a){this.OutVar=[];var i={HQChart:t,WindowIndex:e,HistoryData:a,Self:this},r=ur.KLINE_ID;"MinuteChartContainer"===t.ClassName||"MinuteChartHScreenContainer"===t.ClassName?r=t.DayCount>1?ur.MULTIDAY_MINUTE_ID:ur.MINUTE_ID:"HistoryMinuteChartContainer"===t.ClassName&&(r=ur.HISTORY_MINUTE_ID);var n={HQDataType:r,Symbol:t.Symbol,Name:t.Name,Data:a,SourceData:t.SourceData,Callback:this.RecvResultData,CallbackParam:i,Async:!0,MaxRequestDataCount:t.MaxReqeustDataCount,MaxRequestMinuteDayCount:t.MaxRequestMinuteDayCount,Arguments:this.Arguments,Condition:this.Condition,IsBeforeData:t.IsBeforeData};if(r===ur.HISTORY_MINUTE_ID&&(n.TrateDate=t.TradeDate),r===ur.MULTIDAY_MINUTE_ID&&(n.DayCount=t.DayCount),t.NetworkFilter&&(n.NetworkFilter=t.NetworkFilter),!this.Condition||this.IsMeetCondition(i,n)){var s=this.Script;lr.Execute(s,n,t.ScriptErrorCallback)}else this.ShowConditionError(i)},this.IsMeetCondition=function(t,e){if(M.Complier.Log("[ScriptIndex::IsMeetCondition] ",this.Condition),this.Condition.Period){if(!this.IsMeetPeriodCondition(t,e))return!1;if(!this.IsMeetIncludeCondition(t,e))return!1}return!0},this.IsMeetPeriodCondition=function(t,e){if(!this.Condition.Period)return!0;for(var a in this.Condition.Period){var i=this.Condition.Period[a];switch(i){case N.MINUTE_ID:if(e.HQDataType==ur.MINUTE_ID)return!0;break;case N.MULTIDAY_MINUTE_ID:if(e.HQDataType==ur.MULTIDAY_MINUTE_ID)return!0;break;case N.KLINE_DAY_ID:case N.KLINE_WEEK_ID:case N.KLINE_MONTH_ID:case N.KLINE_YEAR_ID:case N.KLINE_TWOWEEK_ID:case N.KLINE_QUARTER_ID:case N.KLINE_MINUTE_ID:case N.KLINE_5_MINUTE_ID:case N.KLINE_15_MINUTE_ID:case N.KLINE_30_MINUTE_ID:case N.KLINE_60_MINUTE_ID:if(t.HQChart.Period==i)return!0;break}}return!1},this.IsMeetIncludeCondition=function(t,e){if(!this.Condition.Include||this.Condition.Include.length<=0)return!0;var a=t.HQChart.Symbol;for(var i in a&&(a=a.toUpperCase()),this.Condition.Include){var r=this.Condition.Include[i];if(a==r)return!0}return!1},this.ShowConditionError=function(t){var e=t.HQChart,a=t.WindowIndex;e.DeleteIndexPaint(a),0==a&&e.ShowKLine(!0);var i="指标不支持当前品种或周期",r=new Bt;r.Canvas=e.Canvas,r.ChartBorder=e.Frame.SubFrame[a].Frame.ChartBorder,r.ChartFrame=e.Frame.SubFrame[a].Frame,r.NotSupportMessage=i,e.ChartPaint.push(r),e.Draw()},this.RecvResultData=function(t,e){var a=e.HQChart,i=e.WindowIndex,r=e.HistoryData;if(e.Self.OutVar=t,e.Self.BindData(a,i,r),0==e.Self.IsLocked)e.HQChart.Frame.SubFrame[i].Frame.SetLock(null);else{var n={IsLocked:!0,Callback:e.Self.LockCallback,IndexName:e.Self.Name,ID:e.Self.LockID,BG:e.Self.LockBG,Text:e.Self.LockText,TextColor:e.Self.LockTextColor,Font:e.Self.LockFont,Count:e.Self.LockCount,MinWidth:e.Self.LockMinWidth};e.HQChart.Frame.SubFrame[i].Frame.SetLock(n)}if(e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw(),a.GetIndexEvent){var s=a.GetIndexEvent();if(s){var o=e.Self,h={OutVar:o.OutVar,WindowIndex:i,Name:o.Name,Arguments:o.Arguments,HistoryData:r,Stock:{Symbol:a.Symbol,Name:a.Name}};s.Callback(s,h,o)}}},this.CreateLine=function(t,e,a,i){var r=new Bt;if(r.Canvas=t.Canvas,r.DrawType=1,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=this.GetColor(a.Color):r.Color=this.GetDefaultColor(i),a.LineWidth){var n=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(n)&&n>0&&(r.LineWidth=n)}a.IsDotLine&&(r.IsDotLine=!0),0==a.IsShow&&(r.IsShow=!1);var s=e+1;r.Data.Data=a.Data,t.TitlePaint[s].Data[i]=new je(r.Data,a.Name,r.Color),t.ChartPaint.push(r)},this.CreateOverlayLine=function(t,e,a,i){var r=new _t;if(r.Canvas=t.Canvas,r.DrawType=1,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=this.GetColor(a.Color):r.Color=this.GetDefaultColor(i),a.LineWidth){var n=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(n)&&n>0&&(r.LineWidth=n)}a.IsDotLine&&(r.IsDotLine=!0),0==a.IsShow&&(r.IsShow=!1);var s=e+1;r.Data.Data=a.Data,t.TitlePaint[s].Data[i]=new je(r.Data,a.Name,r.Color),t.ChartPaint.push(r)},this.CreateBar=function(t,e,a,i){var r=new Xt;r.Canvas=t.Canvas,a.Draw.Width>0?r.LineWidth=a.Draw.Width:r.LineWidth=1,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=this.GetColor(a.Color):r.Color=this.GetDefaultColor(i);r.Data.Data=a.Draw.DrawData,r.BarType=a.Draw.Type,t.ChartPaint.push(r)},this.CreateText=function(t,e,a,i){var r=new Jt;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=this.GetColor(a.Color):r.Color=this.GetDefaultColor(i);a.Draw.Position&&(r.Position=a.Draw.Position),a.Draw.DrawData&&(r.Data.Data=a.Draw.DrawData),r.Text=a.Draw.Text,a.Draw.Direction>0&&(r.Direction=a.Draw.Direction),a.Draw.YOffset>0&&(r.YOffset=a.Draw.YOffset),a.Draw.TextAlign&&(r.TextAlign=a.Draw.TextAlign),t.ChartPaint.push(r)},this.CreateMACD=function(t,e,a,i){var r=new $t;if(r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.LineWidth){var n=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(n)&&n>0&&(r.LineWidth=n)}var s=e+1;r.Data.Data=a.Data,t.TitlePaint[s].Data[i]=new je(r.Data,a.Name,this.GetDefaultColor(i)),t.ChartPaint.push(r)},this.CreatePointDot=function(t,e,a,i){var r=new Gt;if(r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=this.GetColor(a.Color):r.Color=this.GetDefaultColor(i),a.Radius&&(r.Radius=a.Radius),a.LineWidth){var n=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(n)&&n>0&&(r.Radius=n)}var s=e+1;r.Data.Data=a.Data,t.TitlePaint[s].Data[i]=new je(r.Data,a.Name,r.Color),t.ChartPaint.push(r)},this.CreateStick=function(t,e,a,i){var r=new kt;if(r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=this.GetColor(a.Color):r.Color=this.GetDefaultColor(i),a.LineWidth){var n=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(n)&&n>0&&(r.LineWidth=n)}var s=e+1;r.Data.Data=a.Data,t.TitlePaint[s].Data[i]=new je(r.Data,a.Name,r.Color),t.ChartPaint.push(r)},this.CreateLineStick=function(t,e,a,i){var r=new Yt;if(r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=this.GetColor(a.Color):r.Color=this.GetDefaultColor(i),a.LineWidth){var n=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(n)&&n>0&&(r.LineWidth=n)}var s=e+1;r.Data.Data=a.Data,t.TitlePaint[s].Data[i]=new je(r.Data,a.Name,r.Color),t.ChartPaint.push(r)},this.CreateStraightLine=function(t,e,a,i){var r=new Bt;if(r.DrawType=1,r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=this.GetColor(a.Color):r.Color=this.GetDefaultColor(i),a.LineWidth){var n=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(n)&&n>0&&(r.LineWidth=n)}r.Data.Data=a.Draw.DrawData,t.ChartPaint.push(r)},this.CreateVolStick=function(t,e,a,i,r){var n=new Ut;n.Canvas=t.Canvas,n.Name=a.Name,n.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,n.ChartFrame=t.Frame.SubFrame[e].Frame,n.KLineDrawType=t.KLineDrawType,a.Color?n.Color=this.GetColor(a.Color):n.Color=this.GetDefaultColor(i);var s=e+1;n.Data.Data=a.Data,n.HistoryData=r,t.TitlePaint[s].Data[i]=new je(n.Data,a.Name,n.Color),t.ChartPaint.push(n)},this.CreateBand=function(t,e,a,i){var r=new ee;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,r.FirstColor=a.Draw.Color[0],r.SecondColor=a.Draw.Color[1],r.Data.Data=a.Draw.DrawData,t.ChartPaint.push(r)},this.CreateFillRGN=function(t,e,a,i){var r=new ae;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,r.Data.Data=a.Draw.DrawData,a.Color?r.Color=this.GetColor(a.Color):r.Color=this.GetDefaultColor(i),t.ChartPaint.push(r)},this.CreateKLine=function(t,e,a,i){var r=new Ot;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,r.Data.Data=a.Draw.DrawData,r.IsShowMaxMinPrice=!1,r.IsShowKTooltip=!1,a.Color&&(r.UnchagneColor=r.DownColor=r.UpColor=this.GetColor(a.Color)),t.ChartPaint.push(r)},this.CreatePolyLine=function(t,e,a,i){var r=new Bt;if(r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=this.GetColor(a.Color):r.Color=this.GetDefaultColor(i),a.LineWidth){var n=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(n)&&n>0&&(r.LineWidth=n)}var s=e+1;r.Data.Data=a.Draw.DrawData,t.TitlePaint[s].Data[i]=new je(r.Data," ",r.Color),t.ChartPaint.push(r)},this.CreateBackgroud=function(t,e,a,i){var r=new re;if(r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Draw&&a.Draw.DrawData){var n=a.Draw.DrawData;r.Color=n.Color,r.ColorAngle=n.Angle}t.ChartPaint.push(r)},this.CreateTextLine=function(t,e,a,i){var r=new se;if(r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Draw&&a.Draw.DrawData){var n=a.Draw.DrawData;r.Text=n.Text,r.Line=n.Line,r.Price=n.Price}t.ChartPaint.push(r)},this.CreateNumberText=function(t,e,a,i){var r=new Jt;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=this.GetColor(a.Color):r.Color=this.GetDefaultColor(i);r.Data.Data=a.Draw.DrawData.Value,r.Text=a.Draw.DrawData.Text,t.ChartPaint.push(r)},this.CreateIcon=function(t,e,a,i){var r=new Jt;r.Canvas=t.Canvas,r.TextAlign="center",r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame;r.Data.Data=a.Draw.DrawData;var n=a.Draw.Icon;1==n.IconFont?r.IconFont={Family:n.Family,Text:n.Symbol,Color:n.Color}:(r.Text=n.Symbol,a.Color?r.Color=this.GetColor(a.Color):n.Color?r.Color=n.Color:r.Color="rgb(0,0,0)"),t.ChartPaint.push(r)},this.CreateChannel=function(t,e,a,i){var r=new ie;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Draw.AreaColor?r.AreaColor=a.Draw.AreaColor:a.Color?r.AreaColor=this.GetColor(a.Color):r.AreaColor=this.GetDefaultColor(i),a.Draw.Border.Color?r.LineColor=a.Draw.Border.Color:r.LineColor=null,a.Draw.Border.Dotted&&(r.LineDotted=a.Draw.Border.Dotted),a.Draw.Border.Width>0&&(r.LineWidth=a.Draw.Border.Width),r.Data.Data=a.Draw.DrawData,t.ChartPaint.push(r)},this.CreatePartLine=function(t,e,a,i){var r=new Vt;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,r.Data.Data=a.Draw.DrawData,t.ChartPaint.push(r)},this.CreateMultiLine=function(t,e,a,i){var r=new he;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,r.Data=t.ChartPaint[0].Data,r.Lines=a.Draw.DrawData,t.ChartPaint.push(r)},this.CreateMultiBar=function(t,e,a,i){var r=new oe;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,r.Data=t.ChartPaint[0].Data,r.Bars=a.Draw.DrawData,t.ChartPaint.push(r)},this.CreateMultiText=function(t,e,a,i){var r=new le;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,r.Data=t.ChartPaint[0].Data,r.Texts=a.Draw.DrawData,t.ChartPaint.push(r)},this.CreateMultiSVGIcon=function(t,e,a,i){var r=new ue;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,r.Data=t.ChartPaint[0].Data,r.Family=a.Draw.DrawData.Family,r.Icon=a.Draw.DrawData.Icon,t.ChartPaint.push(r)},this.CreateColorKLine=function(t,e,a,i){var r=new yt;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,r.Data=t.ChartPaint[0].Data,r.KLineColor=a.Draw.DrawData.KLine,a.Color&&(r.Color=a.Color),t.ChartPaint.push(r)},this.CreateRectangle=function(t,e,a,i){var r=new ne;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,r.Color=[a.Draw.DrawData.Color],r.Rect=a.Draw.DrawData.Rect,a.Color&&(r.BorderColor=this.GetColor(a.Color)),t.ChartPaint.push(r)},this.CreateScriptOverlayLine=function(t,e,a,i){var r=new Ht;if(r.Canvas=t.Canvas,r.DrawType=1,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=this.GetColor(a.Color):r.Color=this.GetDefaultColor(i),a.LineWidth){var n=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(n)&&n>0&&(r.LineWidth=n)}a.IsDotLine&&(r.IsDotLine=!0),0==a.IsShow&&(r.IsShow=!1);var s=e+1;r.Data.Data=a.Draw.DrawData.Data,r.MainData.Data=a.Draw.DrawData.MainData,a.Draw.DrawData.Title&&(t.TitlePaint[s].Data[i]=new je(r.Data,a.Draw.DrawData.Title,r.Color)),t.ChartPaint.push(r)},this.CreateSelfKLine=function(t,e,a){var i=new Ot;i.Canvas=t.Canvas,i.Name="Self Kline",i.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,i.ChartFrame=t.Frame.SubFrame[e].Frame,i.Data=a,i.IsShowMaxMinPrice=!1,i.IsShowKTooltip=!1,i.DrawType=this.KLineType,t.ChartPaint.push(i)},this.BindInstructionData=function(t,e,a){if(!(null==this.OutVar||this.OutVar.length<0)){var i="";for(var r in this.Arguments){var n=this.Arguments[r];i.length>0&&(i+=","),i+=n.Value.toString()}if(i.length>0&&(i="("+i+")"),2==this.InstructionType){var s=this.OutVar[this.OutVar.length-1];return t.SetInstructionData(this.InstructionType,{Data:s.Data,Name:this.Name,Param:i,ID:this.ID}),!0}if(1==this.InstructionType){var o,h;for(var l in this.OutVar){var u=this.OutVar[l];"ENTERLONG"==u.Name?o=u.Data:"EXITLONG"==u.Name&&(h=u.Data)}return t.SetInstructionData(this.InstructionType,{Buy:o,Sell:h,Name:this.Name,Param:i,ID:this.ID}),!0}}},this.BindData=function(t,e,a){if(0==e&&this.InstructionType)this.BindInstructionData(t,e,a);else if(t.DeleteIndexPaint(e),0==e&&t.ShowKLine(!0),!(null==this.OutVar||this.OutVar.length<0)){for(var i in null!=this.KLineType&&(0===this.KLineType||1===this.KLineType||2===this.KLineType?this.CreateSelfKLine(t,e,a):-1===this.KLineType&&0==e&&t.ShowKLine(!1)),e>=1&&t.Frame&&(t.Frame.SubFrame[e].Frame.YSplitOperator.FloatPrecision=this.FloatPrecision,this.YSpecificMaxMin&&(t.Frame.SubFrame[e].Frame.YSpecificMaxMin=this.YSpecificMaxMin),this.YSplitScale&&(t.Frame.SubFrame[e].Frame.YSplitScale=this.YSplitScale)),this.OutVar){var r=this.OutVar[i];if(!0!==r.IsExData&&1e3!=r.Type){if(0==r.Type)r.IsOverlayLine?this.CreateOverlayLine(t,e,r,i):this.CreateLine(t,e,r,i);else if(1==r.Type)switch(r.Draw.DrawType){case"STICKLINE":this.CreateBar(t,e,r,i);break;case"DRAWTEXT":case"SUPERDRAWTEXT":case"DRAWTEXT_FIX":this.CreateText(t,e,r,i);break;case"DRAWLINE":this.CreateStraightLine(t,e,r,i);break;case"DRAWBAND":this.CreateBand(t,e,r,i);break;case"FILLRGN":this.CreateFillRGN(t,e,r,i);break;case"DRAWKLINE":this.CreateKLine(t,e,r,i);break;case"DRAWKLINE_IF":this.CreateKLine(t,e,r,i);break;case"POLYLINE":this.CreatePolyLine(t,e,r,i);break;case"DRAWGBK":this.CreateBackgroud(t,e,r,i);break;case"DRAWTEXT_LINE":this.CreateTextLine(t,e,r,i);break;case"DRAWNUMBER":this.CreateNumberText(t,e,r,i);break;case"DRAWICON":this.CreateIcon(t,e,r,i);break;case"DRAWCHANNEL":this.CreateChannel(t,e,r,i);break;case"PARTLINE":this.CreatePartLine(t,e,r,i);break;case"DRAWRECTREL":this.CreateRectangle(t,e,r,i);break;case"DRAWOVERLAYLINE":this.CreateScriptOverlayLine(t,e,r,i);break;case"MULTI_LINE":this.CreateMultiLine(t,e,r,i);break;case"MULTI_BAR":this.CreateMultiBar(t,e,r,i);break;case"MULTI_TEXT":this.CreateMultiText(t,e,r,i);break;case"MULTI_SVGICON":this.CreateMultiSVGIcon(t,e,r,i);break;case"COLOR_KLINE":this.CreateColorKLine(t,e,r,i);break}else 2==r.Type?this.CreateMACD(t,e,r,i):3==r.Type?this.CreatePointDot(t,e,r,i):4==r.Type?this.CreateLineStick(t,e,r,i):5==r.Type?this.CreateStick(t,e,r,i):6==r.Type&&this.CreateVolStick(t,e,r,i,a);var n=t.TitlePaint[e+1];n&&n.Data&&i<n.Data.length&&(this.StringFormat>0&&(n.Data[i].StringFormat=this.StringFormat),this.FloatPrecision>=0&&(n.Data[i].FloatPrecision=this.FloatPrecision))}}var s=e+1;if(t.TitlePaint[s].Title=this.Name,!this.IsShortTitle){var o="";for(var h in this.Arguments){var l=this.Arguments[h];o.length>0&&(o+=","),o+=l.Value.toString()}o.length>0&&(t.TitlePaint[s].Title=this.Name+"("+o+")")}return this.TitleFont&&(t.TitlePaint[s].Font=this.TitleFont),!0}},this.GetDefaultColor=function(t){var e=null;Ma&&Ma.Index&&Ma.Index.LineColor&&(e=Ma.Index.LineColor),e&&Array.isArray(e)||(e=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"]);var a=parseInt(t);return e[a%(e.length-1)]},this.GetColor=function(t){var e=new g.default([["COLORBLACK","rgb(0,0,0)"],["COLORBLUE","rgb(18,95,216)"],["COLORGREEN","rgb(25,158,0)"],["COLORCYAN","rgb(0,255,198)"],["COLORRED","rgb(238,21,21)"],["COLORMAGENTA","rgb(255,0,222)"],["COLORBROWN","rgb(149,94,15)"],["COLORLIGRAY","rgb(218,218,218)"],["COLORGRAY","rgb(133,133,133)"],["COLORLIBLUE","rgb(94,204,255)"],["COLORLIGREEN","rgb(183,255,190)"],["COLORLICYAN","rgb(154,255,242)"],["COLORLIRED","rgb(255,172,172)"],["COLORLIMAGENTA","rgb(255,145,241)"],["COLORWHITE","rgb(255,255,255)"],["COLORYELLOW","rgb(255,198,0)"]]);return e.has(t)?e.get(t):0==t.indexOf("COLOR")?"#"+t.substr(5):"rgb(30,144,255)"}}function Dr(t,e,a,i){this.newMethod=Cr,this.newMethod(t,e,a,i),delete this.newMethod,this.OverlayIndex=null,this.BindData=function(t,e,a){if(this.OverlayIndex&&1==this.OverlayIndex.IsOverlay&&(this.OverlayIndex.Frame.ChartPaint=[],!(null==this.OutVar||this.OutVar.length<0))){var i={Data:[],Title:this.Name},r="";for(var n in this.Arguments){var s=this.Arguments[n];r.length>0&&(r+=","),r+=s.Value.toString()}r.length>0&&(i.Title=this.Name+"("+r+")");var o=e+1,h=t.TitlePaint[o];for(var n in h.OverlayIndex.set(this.OverlayIndex.Identify,i),this.OverlayIndex.Frame.Frame.Title=i.Title,this.OutVar){var l=this.OutVar[n];if(!0!==l.IsExData)if(0==l.Type)this.CreateLine(t,e,l,n);else if(1==l.Type)switch(l.Draw.DrawType){case"STICKLINE":this.CreateBar(t,e,l,n);break;case"DRAWTEXT":case"SUPERDRAWTEXT":case"DRAWTEXT_FIX":this.CreateText(t,e,l,n);break;case"DRAWLINE":this.CreateStraightLine(t,e,l,n);break;case"DRAWBAND":this.CreateBand(t,e,l,n);break;case"DRAWKLINE":this.CreateKLine(t,e,l,n);break;case"DRAWKLINE_IF":this.CreateKLine(t,e,l,n);break;case"POLYLINE":this.CreatePolyLine(t,e,l,n);break;case"DRAWNUMBER":this.CreateNumberText(t,e,l,n);break;case"DRAWICON":this.CreateIcon(t,e,l,n);break;case"DRAWCHANNEL":this.CreateChannel(t,e,l,n);break;case"MULTI_LINE":this.CreateMultiLine(t,e,l,n);break;case"MULTI_BAR":this.CreateMultiBar(t,e,l,n);break;case"MULTI_TEXT":this.CreateMultiText(t,e,l,n);break;case"MULTI_SVGICON":this.CreateMultiSVGIcon(t,e,l,n);break}else 2==l.Type?this.CreateMACD(t,e,l,n):3==l.Type?this.CreatePointDot(t,e,l,n):4==l.Type?this.CreateLineStick(t,e,l,n):5==l.Type?this.CreateStick(t,e,l,n):6==l.Type&&this.CreateVolStick(t,e,l,n,a)}return!0}},this.RecvResultData=function(t,e){var a=e.HQChart,i=e.WindowIndex,r=e.HistoryData;e.Self.OutVar=t,e.Self.BindData(a,i,r),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw();var n=a.GetOverlayIndexEvent();if(n){var s=e.Self,o={OutVar:s.OutVar,WindowIndex:i,Name:s.Name,Arguments:s.Arguments,HistoryData:r,Identify:s.OverlayIndex.Identify,Stock:{Symbol:a.Symbol,Name:a.Name}};n.Callback(n,o,s)}},this.CreateLine=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new Bt;if(s.Canvas=t.Canvas,s.DrawType=1,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(i),a.LineWidth){var o=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(o)&&o>0&&(line.LineWidth=o)}0==a.IsShow&&(line.IsShow=!1);var h=e+1;s.Data.Data=a.Data;var l=t.TitlePaint[h];l.OverlayIndex.get(r.Identify).Data[i]=new je(s.Data,a.Name,s.Color),n.ChartPaint.push(s)},this.CreateBar=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new Xt;s.Canvas=t.Canvas,a.Draw.Width>0?s.LineWidth=a.Draw.Width:s.LineWidth=1,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(i);s.Data.Data=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateText=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new Jt;s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(i);a.Draw.Position&&(s.Position=a.Draw.Position),a.Draw.DrawData&&(s.Data.Data=a.Draw.DrawData),s.Text=a.Draw.Text,a.Draw.Direction>0&&(s.Direction=a.Draw.Direction),a.Draw.YOffset>0&&(s.YOffset=a.Draw.YOffset),a.Draw.TextAlign&&(s.TextAlign=a.Draw.TextAlign),n.ChartPaint.push(s)},this.CreateMACD=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new $t;s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify;var o=e+1;s.Data.Data=a.Data;var h=t.TitlePaint[o];h.OverlayIndex.get(r.Identify).Data[i]=new je(s.Data,a.Name,this.GetDefaultColor(i)),n.ChartPaint.push(s)},this.CreatePointDot=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new Gt;if(s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(i),a.Radius&&(s.Radius=a.Radius),a.LineWidth){var o=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(o)&&o>0&&(s.Radius=o)}var h=e+1;s.Data.Data=a.Data;var l=t.TitlePaint[h];l.OverlayIndex.get(r.Identify).Data[i]=new je(s.Data,a.Name,s.Color),n.ChartPaint.push(s)},this.CreateStick=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new kt;if(s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(i),a.LineWidth){var o=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(o)&&o>0&&(s.LineWidth=o)}var h=e+1;s.Data.Data=a.Data;var l=t.TitlePaint[h];l.OverlayIndex.get(r.Identify).Data[i]=new je(s.Data,a.Name,s.Color),n.ChartPaint.push(s)},this.CreateLineStick=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new Yt;if(s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(i),a.LineWidth){var o=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(o)&&o>0&&(s.LineWidth=o)}var h=e+1;s.Data.Data=a.Data;var l=t.TitlePaint[h];l.OverlayIndex.get(r.Identify).Data[i]=new je(s.Data,a.Name,s.Color),n.ChartPaint.push(s)},this.CreateStraightLine=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new Bt;if(s.DrawType=1,s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(i),a.LineWidth){var o=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(o)&&o>0&&(s.LineWidth=o)}s.Data.Data=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateVolStick=function(t,e,a,i,r){var n=this.OverlayIndex,s=n.Frame,o=new Ut;o.Canvas=t.Canvas,o.Name=a.Name,o.ChartBorder=s.Frame.ChartBorder,o.ChartFrame=s.Frame,o.Identify=n.Identify,o.KLineDrawType=t.KLineDrawType,a.Color?o.Color=this.GetColor(a.Color):o.Color=this.GetDefaultColor(i);var h=e+1;o.Data.Data=a.Data,o.HistoryData=r;var l=t.TitlePaint[h];l.OverlayIndex.get(n.Identify).Data[i]=new je(o.Data,a.Name,o.Color),s.ChartPaint.push(o)},this.CreateBand=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new ee;s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,s.FirstColor=a.Draw.Color[0],s.SecondColor=a.Draw.Color[1],s.Data.Data=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateKLine=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new Ot;s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,s.Data.Data=a.Draw.DrawData,s.IsShowMaxMinPrice=!1,s.IsShowKTooltip=!1,a.Color&&(s.UnchagneColor=s.DownColor=s.UpColor=this.GetColor(a.Color)),n.ChartPaint.push(s)},this.CreatePolyLine=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new Bt;if(s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(i),a.LineWidth){var o=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(o)&&o>0&&(s.LineWidth=o)}var h=e+1;s.Data.Data=a.Draw.DrawData;var l=t.TitlePaint[h];l.OverlayIndex.get(r.Identify).Data[i]=new je(line.Data," ",line.Color),n.ChartPaint.push(s)},this.CreateNumberText=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new Jt;s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(i);s.Data.Data=a.Draw.DrawData.Value,s.Text=a.Draw.DrawData.Text,n.ChartPaint.push(s)},this.CreateIcon=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new Jt;s.Canvas=t.Canvas,s.TextAlign="center",s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify;s.Data.Data=a.Draw.DrawData;var o=a.Draw.Icon;1==o.IconFont?s.IconFont={Family:o.Family,Text:o.Symbol,Color:o.Color}:(s.Text=o.Symbol,a.Color?s.Color=this.GetColor(a.Color):o.Color?s.Color=o.Color:s.Color="rgb(0,0,0)"),n.ChartPaint.push(s)},this.CreateChannel=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new ie;s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,a.Draw.AreaColor?s.AreaColor=a.Draw.AreaColor:a.Color?s.AreaColor=this.GetColor(a.Color):s.AreaColor=this.GetDefaultColor(i),a.Draw.Border.Color?s.LineColor=a.Draw.Border.Color:s.LineColor=null,a.Draw.Border.Dotted&&(s.LineDotted=a.Draw.Border.Dotted),a.Draw.Border.Width>0&&(s.LineWidth=a.Draw.Border.Width),s.Data.Data=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreatePartLine=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new Vt;s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,s.Data.Data=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateMultiLine=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new he;s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,s.Data=t.ChartPaint[0].Data,s.Lines=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateMultiBar=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new oe;s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,s.Data=t.ChartPaint[0].Data,s.Bars=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateMultiText=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new le;s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,s.Data=t.ChartPaint[0].Data,s.Texts=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateMultiSVGIcon=function(t,e,a,i){var r=this.OverlayIndex,n=r.Frame,s=new ue;s.Canvas=t.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=r.Identify,s.Data=t.ChartPaint[0].Data,s.Family=a.Draw.DrawData.Family,s.Icon=a.Draw.DrawData.Icon,n.ChartPaint.push(s)},this.CreateSelfKLine=function(t,e,a){var i=this.OverlayIndex,r=i.Frame,n=new Ot;n.Canvas=t.Canvas,n.Name="Self Kline",n.ChartBorder=r.Frame.ChartBorder,n.ChartFrame=r.Frame,n.Identify=i.Identify,n.Data=a,n.IsShowMaxMinPrice=!1,n.IsShowKTooltip=!1,n.DrawType=this.KLineType,r.ChartPaint.push(n)},this.GetDefaultColor=function(t){var e=["rgb(24,71,178)","rgb(42,230,215)","rgb(252,96,154)","rgb(0,128,255)","rgb(229,0,79)","rgb(68,114,196)","rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)"],a=parseInt(t);return e[a%(e.length-1)]}}function cr(t,e,a,i,r){this.newMethod=r?Dr:Cr,this.newMethod(t,e,a,i),delete this.newMethod,this.IsOverlayIndex=1==r,this.ApiUrl,this.HQDataType,i.API&&(i.API.Url&&(this.ApiUrl=i.API.Url),i.API.Name&&(this.Name=this.ID=i.API.Name),i.API.ID&&(this.ID=i.API.ID)),this.ExecuteScript=function(t,e,a){M.Complier.Log("[APIScriptIndex::ExecuteScript] name, Arguments ",this.Name,this.Arguments);var i=ur.KLINE_ID;"MinuteChartContainer"===t.ClassName||"MinuteChartHScreenContainer"===t.ClassName?i=t.DayCount>1?ur.MULTIDAY_MINUTE_ID:ur.MINUTE_ID:"HistoryMinuteChartContainer"===t.ClassName&&(i=ur.HISTORY_MINUTE_ID);var r,n=[];if(this.Arguments)for(var s in this.Arguments){var o=this.Arguments[s];n.push({name:o.Name,value:o.Value})}t.GetRequestDataCount&&(r=t.GetRequestDataCount());var h=this,l={indexname:this.ID,symbol:t.Symbol,script:this.Script,args:n,period:t.Period,right:t.Right,hqdatatype:i};if(r&&(l.maxdatacount=r.MaxRequestDataCount,l.maxminutedaycount=r.MaxRequestMinuteDayCount),i!=ur.MULTIDAY_MINUTE_ID&&i!=ur.MINUTE_ID||(l.daycount=t.DayCount),this.HQDataType=i,t.NetworkFilter){var u={Name:"APIScriptIndex::ExecuteScript",Explain:"指标计算",Request:{Url:h.ApiUrl,Type:"POST",Data:l},Self:this,HQChart:t,PreventDefault:!1};if(t.NetworkFilter(u,(function(i){h.RecvAPIData(i,t,e,a)})),1==u.PreventDefault)return}x.HttpRequest({url:h.ApiUrl,data:l,type:"post",dataType:"json",async:!0,success:function(i){h.RecvAPIData(i,t,e,a)},error:function(t){h.RecvError(t)}})},this.RecvAPIData=function(t,e,a,i){if(M.Complier.Log("[APIScriptIndex::RecvAPIData] recv data ",this.Name,t),0==t.code){if(t.outdata&&t.outdata.name&&(this.Name=t.outdata.name),t.outdata.args)for(var r in this.Arguments=[],t.outdata.args){var n=t.outdata.args[r];this.Arguments.push({Name:n.name,Value:n.value})}if(this.HQDataType==ur.KLINE_ID?(this.OutVar=this.FittingData(t.outdata,e),M.Complier.Log("[APIScriptIndex::RecvAPIData] conver to OutVar ",this.OutVar)):this.OutVar=this.FittingMinuteData(t.outdata,e),this.BindData(e,a,i),0==this.IsLocked)e.Frame.SubFrame[a].Frame.SetLock(null);else{var s={IsLocked:!0,Callback:this.LockCallback,IndexName:this.Name,ID:this.LockID,BG:this.LockBG,Text:this.LockText,TextColor:this.LockTextColor,Font:this.LockFont,Count:this.LockCount,MinWidth:this.LockMinWidth};e.Frame.SubFrame[a].Frame.SetLock(s)}if(e.UpdataDataoffset(),e.UpdateFrameMaxMin(),e.Draw(),e.GetIndexEvent){var o=e.GetIndexEvent();if(o){t={OutVar:this.OutVar,WindowIndex:a,Name:this.Name,Arguments:this.Arguments,HistoryData:i,Stock:{Symbol:e.Symbol,Name:e.Name}};o.Callback(o,t,this)}}}},this.FittingArray=function(t,e,a,i,r){var n,s=i.ChartPaint[0].Data,o=[];for(var h in t){var l=t[h],u=new ft;u.Date=e[h],a&&h<a.length&&(u.Time=a[h]),u.Value=l,o.push(u)}n=It.IsDayPeriod(i.Period,!0)?s.GetFittingData(o):s.GetMinuteFittingData(o);var C,D=new It;return D.Data=n,C=1==r?D.GetObject():D.GetValue(),C},this.FittingMultiLine=function(t,e,a,i){var r=i.ChartPaint[0].Data;if(It.IsDayPeriod(i.Period,!0)){var n=[];for(var s in t){var o=t[s];for(var h in o.Point){var l=o.Point[h];n.push(l)}}return n.sort((function(t,e){return t.Date-e.Date})),r.GetDateIndex(n),t}if(It.IsMinutePeriod(i.Period,!0)){n=[];for(var s in t){o=t[s];for(var h in o.Point){l=o.Point[h];n.push(l)}}return n.sort((function(t,e){return t.Date==e.Date?t.Time-e.Time:t.Date-e.Date})),r.GetDateTimeIndex(n),t}return null},this.FittingMultiText=function(t,e,a,i){var r=i.ChartPaint[0].Data;return It.IsDayPeriod(i.Period,!0)?(t.sort((function(t,e){return t.Date-e.Date})),r.GetDateIndex(t),t):It.IsMinutePeriod(i.Period,!0)?(t.sort((function(t,e){return t.Date==e.Date?t.Time-e.Time:t.Date-e.Date})),r.GetDateTimeIndex(t),t):null},this.FittingData=function(t,e){var a=t.outvar,i=t.date,r=t.time,n=(e.ChartPaint[0].Data,[]);for(var s in a){var o=a[s],h={Name:o.name,Type:o.type};if(o.color&&(h.Color=o.color),o.data)h.Data=this.FittingArray(o.data,i,r,e),o.color&&(h.Color=o.color),o.linewidth>=1&&(h.LineWidth=o.linewidth),0==o.isshow&&(h.IsShow=!1),1==o.isexdata&&(h.IsExData=!0),n.push(h);else if(o.Draw){var l=o.Draw,u={};if("DRAWICON"==l.DrawType)u.Icon=l.Icon,u.Name=l.Name,u.DrawType=l.DrawType,u.DrawData=this.FittingArray(l.DrawData,i,r,e),h.Draw=u,n.push(h);else if("DRAWTEXT"==l.DrawType)u.Text=l.Text,u.Name=l.Name,u.DrawType=l.DrawType,u.DrawData=this.FittingArray(l.DrawData,i,r,e),h.Draw=u,n.push(h);else if("STICKLINE"==l.DrawType)u.Name=l.Name,u.Type=l.Type,u.Width=l.Width,u.DrawType=l.DrawType,u.DrawData=this.FittingArray(l.DrawData,i,r,e,1),h.Draw=u,n.push(h);else if("MULTI_LINE"==l.DrawType)u.Text=l.Text,u.Name=l.Name,u.DrawType=l.DrawType,u.DrawData=this.FittingMultiLine(l.DrawData,i,r,e),h.Draw=u,n.push(h);else if("MULTI_BAR"==l.DrawType)u.Text=l.Text,u.Name=l.Name,u.DrawType=l.DrawType,u.DrawData=this.FittingMultiLine(l.DrawData,i,r,e),h.Draw=u,n.push(h);else if("MULTI_TEXT"==l.DrawType)u.Text=l.Text,u.Name=l.Name,u.DrawType=l.DrawType,u.DrawData=this.FittingMultiText(l.DrawData,i,r,e),h.Draw=u,n.push(h);else if("MULTI_SVGICON"==l.DrawType)u.Text=l.Text,u.Name=l.Name,u.DrawType=l.DrawType,u.DrawData={Icon:this.FittingMultiText(l.DrawData.Icon,i,r,e),Family:l.DrawData.Family},h.Draw=u,n.push(h);else if("COLOR_KLINE"==l.DrawType){u.Text=l.Text,u.Name=l.Name,u.DrawType=l.DrawType;var C=this.FittingMultiText(l.DrawData.KLine,i,r,e),D=new g.default;for(var s in C){o=C[s];D.set(o.Index,o)}u.DrawData={KLine:D},l.Color&&(h.Color=l.Color),h.Draw=u,n.push(h)}}}return n},this.FittingMinuteData=function(t,e){var a=t.outvar,i=t.date,r=t.time,n=[];for(var s in a){item=a[s];var o={Name:item.name,Type:item.type};item.data&&(o.Data=this.FittingMinuteArray(item.data,i,r,e),item.color&&(o.Color=item.color),item.linewidth>=1&&(o.LineWidth=item.linewidth),0==item.isshow&&(o.IsShow=!1),1==item.isexdata&&(o.IsExData=!0),n.push(o))}return n},this.FittingMinuteArray=function(t,e,a,i){var r=i.SourceData,n=[];for(var s in t){var o=t[s],h=new ft;h.Date=e[s],a&&s<a.length&&(h.Time=a[s]),h.Value=o,n.push(h)}var l=r.GetMinuteFittingData(n),u=new It;u.Data=l;var C=u.GetValue();return C}}function fr(t,e,a){this.newMethod=Cr,this.newMethod(t,null,e,null),delete this.newMethod,this.JsonData,a.JsonData&&(this.JsonData=a.JsonData),this.RequestData=function(t,e,a){if(!this.JsonData)return console.warn("[LocalJsonDataIndex::RequestData] JsonData is null"),void(param.HQChart.ScriptErrorCallback&&param.HQChart.ScriptErrorCallback("json 数据不能为空"));this.OutVar=this.FittingData(this.JsonData,a),this.BindData(t,e,a)},this.FittingData=function(t,e){for(i in outVar=t.OutVar,date=t.Date,time=t.Time,result=[],outVar)if(item=outVar[i],M.Complier.Log("[LocalJsonDataIndex::FittingData] item",item),0==item.Type||3==item.Type){var a=[];for(j in outVarItem={Name:item.Name,Type:item.Type},item.Data){var r=new ft;r.Date=date[j],time&&j<time.length&&(r.Time=time[j]),r.Value=item.Data[j],a.push(r)}if(e.Period<4)var n=e.GetFittingData(a);else n=e.GetMinuteFittingData(a);var s=new It;s.Data=n,outVarItem.Data=s.GetValue(),result.push(outVarItem)}else console.warn("[LocalJsonDataIndex::FittingData] can't support ",item.Name,item.Type);return result}}function dr(t){this.ID,this.Name,this.Script,this.Arguments=[],this.ClassName="ScriptIndexConsole",this.ErrorCallback,this.FinishCallback,this.IsSectionMode=!1,t&&(t.Name&&(this.Name=t.Name),t.Script&&(this.Script=t.Script),t.ID&&(this.ID=t.ID),t.Args&&(this.Arguments=t.Args),t.ErrorCallback&&(this.ErrorCallback=t.ErrorCallback),t.FinishCallback&&(this.FinishCallback=t.FinishCallback),t.IsSectionMode&&(this.IsSectionMode=t.IsSectionMode)),this.ExecuteScript=function(t){this.OutVar=[];var e={Self:this},a={HQDataType:t.HQDataType,Symbol:t.Stock.Symbol,Name:t.Stock.Name,Period:t.Period,Right:t.Right,Callback:this.RecvResultData,CallbackParam:e,Async:!0,MaxRequestDataCount:t.Request.MaxDataCount,MaxRequestMinuteDayCount:t.Request.MaxMinuteDayCount,Arguments:this.Arguments,IsSectionMode:this.IsSectionMode,ClassName:"ScriptIndexConsole"};t.HQDataType===ur.HISTORY_MINUTE_ID&&(a.TrateDate=t.Request.TradeDate),t.HQDataType==ur.MULTIDAY_MINUTE_ID&&(a.DayCount=t.DayCount);var i=this.Script;lr.Execute(i,a,this.ErrorCallback)},this.RecvResultData=function(t,e){var a=e.Self,i=e.JSExecute,r=null;i.SymbolData.Data&&(r=i.SymbolData.Data.GetDate());var n={Out:t,Date:r,Stock:{Name:i.SymbolData.Name,Symbol:i.SymbolData.Symbol},Index:{Name:a.Name,ID:a.ID}};i.SymbolData.DataType==ur.MULTIDAY_MINUTE_ID||i.SymbolData.DataType==ur.MINUTE_ID?n.Time=i.SymbolData.Data.GetTime():i.SymbolData.DataType==ur.KLINE_ID&&It.IsMinutePeriod(i.SymbolData.Period,!0)&&(n.Time=i.SymbolData.Data.GetTime()),a.FinishCallback&&a.FinishCallback(n,e.JSExecute)}}dr.SetDomain=function(t,e){lr.SetDomain(t,e)};var mr={BGColor:"rgb(0,0,0)",TooltipBGColor:"rgb(255, 255, 255)",TooltipAlpha:.92,SelectRectBGColor:"rgba(1,130,212,0.06)",UpBarColor:"rgb(238,21,21)",DownBarColor:"rgb(25,158,0)",UnchagneBarColor:"rgb(228,228,228)",Minute:{VolBarColor:"rgb(255,236,0)",PriceColor:"rgb(25,180,231)",AreaPriceColor:"rgba(63,158,255,.3)",AvPriceColor:"rgb(255,236,0)",PositionColor:"rgb(218,165,32)"},DefaultTextColor:"rgb(101,104,112)",DefaultTextFont:14*V()+"px 微软雅黑",TitleFont:13*V()+"px 微软雅黑",UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchagneTextColor:"rgb(101,104,112)",CloseLineColor:"rgb(178,34,34)",FrameBorderPen:"rgba(236,236,236,0.13)",FrameSplitPen:"rgba(236,236,236,0.13)",FrameSplitTextColor:"rgb(101,104,112)",FrameSplitTextFont:12*V()+"px 微软雅黑",FrameTitleBGColor:"rgb(0,0,0)",Frame:{XBottomOffset:1*V()},FrameLatestPrice:{TextColor:"rgb(255,255,255)",UpBarColor:"rgb(238,21,21)",DownBarColor:"rgb(25,158,0)",UnchagneBarColor:"rgb(190,190,190)",BGAlpha:.6},CorssCursorBGColor:"rgb(43,54,69)",CorssCursorTextColor:"rgb(255,255,255)",CorssCursorTextFont:12*V()+"px 微软雅黑",CorssCursorHPenColor:"rgb(130,130,130)",CorssCursorVPenColor:"rgb(130,130,130)",KLine:{MaxMin:{Font:12*V()+"px 微软雅黑",Color:"rgb(255,250,240)"},Info:{Investor:{ApiUrl:"https://opensource.zealink.com/API/NewsInteract",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#1c65db"}},Announcement:{ApiUrl:"https://opensource.zealink.com/API/ReportList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f5a521"},IconFont2:{Family:"iconfont",Text:"",HScreenText:"",Color:"#ed7520"}},Pforecast:{ApiUrl:"https://opensource.zealink.com/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#986cad"}},Research:{ApiUrl:"https://opensource.zealink.com/API/InvestorRelationsList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#19b1b7"}},BlockTrading:{ApiUrl:"https://opensource.zealink.com/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f39f7c"}},TradeDetail:{ApiUrl:"https://opensource.zealink.com/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#b22626"}}},NumIcon:{Color:"rgb(251,80,80)",Family:"iconfont",Text:["","","","","","","","","","","","","","","","","","","","",""]},TradeIcon:{Family:"iconfont",Buy:{Color:"rgb(255,15,4)",Text:"",HScreenText:""},Sell:{Color:"rgb(64,122,22)",Text:"",HScreenText:""}}},Index:{LineColor:["rgb(255,189,09)","rgb(22,198,255)","rgb(174,35,161)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],NotSupport:{Font:"14px 微软雅黑",TextColor:"rgb(52,52,52)"}},ColorArray:["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],DrawPicture:{LineColor:"rgb(30,144,255)",PointColor:"rgb(105,105,105)"},TooltipPaint:{BGColor:"rgba(20,20,20,0.8)",BorderColor:"rgb(210,210,210)",TitleColor:"rgb(210,210,210)",TitleFont:13*V()+"px 微软雅黑"},MinuteInfo:{TextColor:"rgb(84,143,255)",Font:14*V()+"px 微软雅黑",PointColor:"rgb(38,113,254)",LineColor:"rgb(120,167,255)",TextBGColor:"rgba(255,255,255,1)"}},vr={BLACK_ID:1};function Sr(){}Sr.GetStyleConfig=function(t){switch(t){case vr.BLACK_ID:return mr;default:return null}},e.default=(r={jsChartInit:w.Init,jsChartStyle:w.SetStyle,JSChart:w,ChartData:It,HistoryData:Dt,MARKET_SUFFIX_NAME:Li,IFrameSplitOperator:Le,JSKLineInfoMap:ii,JSCHART_EVENT_ID:b,JSCHART_OPERATOR_ID:B,JSAlgorithm:ar,JSComplier:lr,JSIndexScript:P,GetDevicePixelRatio:V},(0,s.default)(r,"GetDevicePixelRatio",V),(0,s.default)(r,"ScriptIndexConsole",dr),(0,s.default)(r,"STYLE_TYPE_ID",vr),(0,s.default)(r,"HQChartStyle",Sr),(0,s.default)(r,"JSConsole",M),r)},"9c0c7":function(t,e,a){var i=a("1609");t.exports=function(t,e,a){if(i(t),void 0===e)return t;switch(a){case 1:return function(a){return t.call(e,a)};case 2:return function(a,i){return t.call(e,a,i)};case 3:return function(a,i,r){return t.call(e,a,i,r)}}return function(){return t.apply(e,arguments)}}},"9c0e":function(t,e){var a={}.hasOwnProperty;t.exports=function(t,e){return a.call(t,e)}},"9d11":function(t,e,a){var i=a("fc5e"),r=Math.max,n=Math.min;t.exports=function(t,e){return t=i(t),t<0?r(t+e,0):n(t,e)}},"9e12":function(t,e,a){a("3c9f")("Map")},"9f63":function(t,e,a){},"9fbb":function(t,e,a){var i=a("4d88");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==i(t)?t.split(""):Object(t)}},a73c:function(t,e,a){t.exports={default:a("b88f"),__esModule:!0}},acd1:function(t,e,a){var i=a("9c0c7"),r=a("9fbb"),n=a("0983"),s=a("d16a"),o=a("f964");t.exports=function(t,e){var a=1==t,h=2==t,l=3==t,u=4==t,C=6==t,D=5==t||C,c=e||o;return function(e,o,f){for(var d,m,v=n(e),S=r(v),I=i(o,f,3),p=s(S.length),T=0,A=a?c(e,p):h?c(e,0):void 0;p>T;T++)if((D||T in S)&&(d=S[T],m=I(d,T,v),t))if(a)A[T]=m;else if(m)switch(t){case 3:return!0;case 5:return d;case 6:return T;case 2:A.push(d)}else if(u)return!1;return C?-1:l||u?u:A}}},acd8:function(t,e,a){var i=a("23e7"),r=a("6fe5");i({global:!0,forced:parseFloat!=r},{parseFloat:r})},add8:function(t,e,a){"use strict";var i=a("1a14").f,r=a("6f4f"),n=a("899e"),s=a("9c0c7"),o=a("ba43"),h=a("c253"),l=a("393a"),u=a("ea34"),C=a("bdad"),D=a("0bad"),c=a("e34a").fastKey,f=a("2405"),d=D?"_s":"size",m=function(t,e){var a,i=c(e);if("F"!==i)return t._i[i];for(a=t._f;a;a=a.n)if(a.k==e)return a};t.exports={getConstructor:function(t,e,a,l){var u=t((function(t,i){o(t,u,e,"_i"),t._t=e,t._i=r(null),t._f=void 0,t._l=void 0,t[d]=0,void 0!=i&&h(i,a,t[l],t)}));return n(u.prototype,{clear:function(){for(var t=f(this,e),a=t._i,i=t._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete a[i.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var a=f(this,e),i=m(a,t);if(i){var r=i.n,n=i.p;delete a._i[i.i],i.r=!0,n&&(n.n=r),r&&(r.p=n),a._f==i&&(a._f=r),a._l==i&&(a._l=n),a[d]--}return!!i},forEach:function(t){f(this,e);var a,i=s(t,arguments.length>1?arguments[1]:void 0,3);while(a=a?a.n:this._f){i(a.v,a.k,this);while(a&&a.r)a=a.p}},has:function(t){return!!m(f(this,e),t)}}),D&&i(u.prototype,"size",{get:function(){return f(this,e)[d]}}),u},def:function(t,e,a){var i,r,n=m(t,e);return n?n.v=a:(t._l=n={i:r=c(e,!0),k:e,v:a,p:i=t._l,n:void 0,r:!1},t._f||(t._f=n),i&&(i.n=n),t[d]++,"F"!==r&&(t._i[r]=n)),t},getEntry:m,setStrong:function(t,e,a){l(t,e,(function(t,a){this._t=f(t,e),this._k=a,this._l=void 0}),(function(){var t=this,e=t._k,a=t._l;while(a&&a.r)a=a.p;return t._t&&(t._l=a=a?a.n:t._t._f)?u(0,"keys"==e?a.k:"values"==e?a.v:[a.k,a.v]):(t._t=void 0,u(1))}),a?"entries":"values",!a,!0),C(e)}}},afa7:function(t,e,a){a("dfe5"),a("0b99"),a("658f"),a("3df4"),a("8a87"),a("1eeb"),a("2e2e"),t.exports=a("5524").Set},b1b3:function(t,e,a){var i=a("77e9"),r=a("23dd");t.exports=a("5524").getIterator=function(t){var e=r(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return i(e.call(t))}},b367:function(t,e,a){var i=a("5524"),r=a("ef08"),n="__core-js_shared__",s=r[n]||(r[n]={});(t.exports=function(t,e){return s[t]||(s[t]=void 0!==e?e:{})})("versions",[]).push({version:i.version,mode:a("e444")?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},b680:function(t,e,a){"use strict";var i=a("23e7"),r=a("a691"),n=a("408a"),s=a("1148"),o=a("d039"),h=1..toFixed,l=Math.floor,u=function(t,e,a){return 0===e?a:e%2===1?u(t,e-1,a*t):u(t*t,e/2,a)},C=function(t){var e=0,a=t;while(a>=4096)e+=12,a/=4096;while(a>=2)e+=1,a/=2;return e},D=h&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!o((function(){h.call({})}));i({target:"Number",proto:!0,forced:D},{toFixed:function(t){var e,a,i,o,h=n(this),D=r(t),c=[0,0,0,0,0,0],f="",d="0",m=function(t,e){var a=-1,i=e;while(++a<6)i+=t*c[a],c[a]=i%1e7,i=l(i/1e7)},v=function(t){var e=6,a=0;while(--e>=0)a+=c[e],c[e]=l(a/t),a=a%t*1e7},S=function(){var t=6,e="";while(--t>=0)if(""!==e||0===t||0!==c[t]){var a=String(c[t]);e=""===e?a:e+s.call("0",7-a.length)+a}return e};if(D<0||D>20)throw RangeError("Incorrect fraction digits");if(h!=h)return"NaN";if(h<=-1e21||h>=1e21)return String(h);if(h<0&&(f="-",h=-h),h>1e-21)if(e=C(h*u(2,69,1))-69,a=e<0?h*u(2,-e,1):h/u(2,e,1),a*=4503599627370496,e=52-e,e>0){m(0,a),i=D;while(i>=7)m(1e7,0),i-=7;m(u(10,i,1),0),i=e-1;while(i>=23)v(1<<23),i-=23;v(1<<i),m(1,1),v(2),d=S()}else m(0,a),m(1<<-e,0),d=S()+s.call("0",D);return D>0?(o=d.length,d=f+(o<=D?"0."+s.call("0",D-o)+d:d.slice(0,o-D)+"."+d.slice(o-D))):d=f+d,d}})},b7fa:function(t,e,a){var i=a("5524"),r=i.JSON||(i.JSON={stringify:JSON.stringify});t.exports=function(t){return r.stringify.apply(r,arguments)}},b88f:function(t,e,a){a("e9dc"),t.exports=a("5524").Math.log10},ba01:function(t,e,a){t.exports=a("051b")},ba43:function(t,e){t.exports=function(t,e,a,i){if(!(t instanceof e)||void 0!==i&&i in t)throw TypeError(a+": incorrect invocation!");return t}},bcd6:function(t,e,a){a("76ef");var i=a("5524").Object;t.exports=function(t,e){return i.create(t,e)}},bce0:function(t,e,a){var i,r,n,s=a("9c0c7"),o=a("4de9"),h=a("9141"),l=a("05f5"),u=a("ef08"),C=u.process,D=u.setImmediate,c=u.clearImmediate,f=u.MessageChannel,d=u.Dispatch,m=0,v={},S="onreadystatechange",I=function(){var t=+this;if(v.hasOwnProperty(t)){var e=v[t];delete v[t],e()}},p=function(t){I.call(t.data)};D&&c||(D=function(t){var e=[],a=1;while(arguments.length>a)e.push(arguments[a++]);return v[++m]=function(){o("function"==typeof t?t:Function(t),e)},i(m),m},c=function(t){delete v[t]},"process"==a("4d88")(C)?i=function(t){C.nextTick(s(I,t,1))}:d&&d.now?i=function(t){d.now(s(I,t,1))}:f?(r=new f,n=r.port2,r.port1.onmessage=p,i=s(n.postMessage,n,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(i=function(t){u.postMessage(t+"","*")},u.addEventListener("message",p,!1)):i=S in l("script")?function(t){h.appendChild(l("script"))[S]=function(){h.removeChild(this),I.call(t)}}:function(t){setTimeout(s(I,t,1),0)}),t.exports={set:D,clear:c}},bdad:function(t,e,a){"use strict";var i=a("ef08"),r=a("5524"),n=a("1a14"),s=a("0bad"),o=a("cc15a")("species");t.exports=function(t){var e="function"==typeof r[t]?r[t]:i[t];s&&e&&!e[o]&&n.f(e,o,{configurable:!0,get:function(){return this}})}},c183:function(t,e,a){var i=a("512c");i(i.S+i.F*!a("0bad"),"Object",{defineProperty:a("1a14").f})},c253:function(t,e,a){var i=a("9c0c7"),r=a("c4c1"),n=a("6d2f"),s=a("77e9"),o=a("d16a"),h=a("23dd"),l={},u={};e=t.exports=function(t,e,a,C,D){var c,f,d,m,v=D?function(){return t}:h(t),S=i(a,C,e?2:1),I=0;if("function"!=typeof v)throw TypeError(t+" is not iterable!");if(n(v)){for(c=o(t.length);c>I;I++)if(m=e?S(s(f=t[I])[0],f[1]):S(t[I]),m===l||m===u)return m}else for(d=v.call(t);!(f=d.next()).done;)if(m=r(d,S,f.value,e),m===l||m===u)return m};e.BREAK=l,e.RETURN=u},c2a3:function(t,e){t.exports=function(t){try{return{e:!1,v:t()}}catch(e){return{e:!0,v:e}}}},c4c1:function(t,e,a){var i=a("77e9");t.exports=function(t,e,a,r){try{return r?e(i(a)[0],a[1]):e(a)}catch(s){var n=t["return"];throw void 0!==n&&i(n.call(t)),s}}},c579:function(t,e,a){"use strict";var i,r,n,s,o=a("e444"),h=a("ef08"),l=a("9c0c7"),u=a("6aa8"),C=a("512c"),D=a("7a41"),c=a("1609"),f=a("ba43"),d=a("c253"),m=a("db37"),v=a("bce0").set,S=a("8ecb")(),I=a("f2c2"),p=a("c2a3"),T=a("8e5c"),A=a("24a2"),g="Promise",F=h.TypeError,E=h.process,L=E&&E.versions,M=L&&L.v8||"",x=h[g],N="process"==u(E),O=function(){},y=r=I.f,R=!!function(){try{var t=x.resolve(1),e=(t.constructor={})[a("cc15a")("species")]=function(t){t(O,O)};return(N||"function"==typeof PromiseRejectionEvent)&&t.then(O)instanceof e&&0!==M.indexOf("6.6")&&-1===T.indexOf("Chrome/66")}catch(i){}}(),P=function(t){var e;return!(!D(t)||"function"!=typeof(e=t.then))&&e},w=function(t,e){if(!t._n){t._n=!0;var a=t._c;S((function(){var i=t._v,r=1==t._s,n=0,s=function(e){var a,n,s,o=r?e.ok:e.fail,h=e.resolve,l=e.reject,u=e.domain;try{o?(r||(2==t._h&&_(t),t._h=1),!0===o?a=i:(u&&u.enter(),a=o(i),u&&(u.exit(),s=!0)),a===e.promise?l(F("Promise-chain cycle")):(n=P(a))?n.call(a,h,l):h(a)):l(i)}catch(C){u&&!s&&u.exit(),l(C)}};while(a.length>n)s(a[n++]);t._c=[],t._n=!1,e&&!t._h&&b(t)}))}},b=function(t){v.call(h,(function(){var e,a,i,r=t._v,n=B(t);if(n&&(e=p((function(){N?E.emit("unhandledRejection",r,t):(a=h.onunhandledrejection)?a({promise:t,reason:r}):(i=h.console)&&i.error&&i.error("Unhandled promise rejection",r)})),t._h=N||B(t)?2:1),t._a=void 0,n&&e.e)throw e.v}))},B=function(t){return 1!==t._h&&0===(t._a||t._c).length},_=function(t){v.call(h,(function(){var e;N?E.emit("rejectionHandled",t):(e=h.onrejectionhandled)&&e({promise:t,reason:t._v})}))},H=function(t){var e=this;e._d||(e._d=!0,e=e._w||e,e._v=t,e._s=2,e._a||(e._a=e._c.slice()),w(e,!0))},V=function(t){var e,a=this;if(!a._d){a._d=!0,a=a._w||a;try{if(a===t)throw F("Promise can't be resolved itself");(e=P(t))?S((function(){var i={_w:a,_d:!1};try{e.call(t,l(V,i,1),l(H,i,1))}catch(r){H.call(i,r)}})):(a._v=t,a._s=1,w(a,!1))}catch(i){H.call({_w:a,_d:!1},i)}}};R||(x=function(t){f(this,x,g,"_h"),c(t),i.call(this);try{t(l(V,this,1),l(H,this,1))}catch(e){H.call(this,e)}},i=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},i.prototype=a("899e")(x.prototype,{then:function(t,e){var a=y(m(this,x));return a.ok="function"!=typeof t||t,a.fail="function"==typeof e&&e,a.domain=N?E.domain:void 0,this._c.push(a),this._a&&this._a.push(a),this._s&&w(this,!1),a.promise},catch:function(t){return this.then(void 0,t)}}),n=function(){var t=new i;this.promise=t,this.resolve=l(V,t,1),this.reject=l(H,t,1)},I.f=y=function(t){return t===x||t===s?new n(t):r(t)}),C(C.G+C.W+C.F*!R,{Promise:x}),a("92f0")(x,g),a("bdad")(g),s=a("5524")[g],C(C.S+C.F*!R,g,{reject:function(t){var e=y(this),a=e.reject;return a(t),e.promise}}),C(C.S+C.F*(o||!R),g,{resolve:function(t){return A(o&&this===s?x:this,t)}}),C(C.S+C.F*!(R&&a("8771")((function(t){x.all(t)["catch"](O)}))),g,{all:function(t){var e=this,a=y(e),i=a.resolve,r=a.reject,n=p((function(){var a=[],n=0,s=1;d(t,!1,(function(t){var o=n++,h=!1;a.push(void 0),s++,e.resolve(t).then((function(t){h||(h=!0,a[o]=t,--s||i(a))}),r)})),--s||i(a)}));return n.e&&r(n.v),a.promise},race:function(t){var e=this,a=y(e),i=a.reject,r=p((function(){d(t,!1,(function(t){e.resolve(t).then(a.resolve,i)}))}));return r.e&&i(r.v),a.promise}})},c901:function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},cb29:function(t,e,a){var i=a("23e7"),r=a("81d56"),n=a("44d2");i({target:"Array",proto:!0},{fill:r}),n("fill")},cc15a:function(t,e,a){var i=a("b367")("wks"),r=a("8b1a"),n=a("ef08").Symbol,s="function"==typeof n,o=t.exports=function(t){return i[t]||(i[t]=s&&n[t]||(s?n:r)("Symbol."+t))};o.store=i},ce7a:function(t,e,a){var i=a("9c0e"),r=a("0983"),n=a("5a94")("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),i(t,n)?t[n]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?s:null}},d16a:function(t,e,a){var i=a("fc5e"),r=Math.min;t.exports=function(t){return t>0?r(i(t),9007199254740991):0}},d62d:function(t,e,a){"use strict";var i=a("512c"),r=a("1609"),n=a("9c0c7"),s=a("c253");t.exports=function(t){i(i.S,t,{from:function(t){var e,a,i,o,h=arguments[1];return r(this),e=void 0!==h,e&&r(h),void 0==t?new this:(a=[],e?(i=0,o=n(h,arguments[2],2),s(t,!1,(function(t){a.push(o(t,i++))}))):s(t,!1,a.push,a),new this(a))}})}},db37:function(t,e,a){var i=a("77e9"),r=a("1609"),n=a("cc15a")("species");t.exports=function(t,e){var a,s=i(t).constructor;return void 0===s||void 0==(a=i(s)[n])?e:r(a)}},dcfd:function(t,e,a){var i=a("512c");i(i.P+i.R,"Map",{toJSON:a("2ad9")("Map")})},dfe5:function(t,e){},e070:function(t,e,a){var i=a("d039"),r=a("5899"),n="​᠎";t.exports=function(t){return i((function(){return!!r[t]()||n[t]()!=n||r[t].name!==t}))}},e198:function(t,e,a){var i=a("ef08"),r=a("5524"),n=a("e444"),s=a("fcd4"),o=a("1a14").f;t.exports=function(t){var e=r.Symbol||(r.Symbol=n?{}:i.Symbol||{});"_"==t.charAt(0)||t in e||o(e,t,{value:s.f(t)})}},e1de:function(t,e,a){t.exports={default:a("22bf"),__esModule:!0}},e25e:function(t,e,a){var i=a("23e7"),r=a("e583");i({global:!0,forced:parseInt!=r},{parseInt:r})},e34a:function(t,e,a){var i=a("8b1a")("meta"),r=a("7a41"),n=a("9c0e"),s=a("1a14").f,o=0,h=Object.isExtensible||function(){return!0},l=!a("4b8b")((function(){return h(Object.preventExtensions({}))})),u=function(t){s(t,i,{value:{i:"O"+ ++o,w:{}}})},C=function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!n(t,i)){if(!h(t))return"F";if(!e)return"E";u(t)}return t[i].i},D=function(t,e){if(!n(t,i)){if(!h(t))return!0;if(!e)return!1;u(t)}return t[i].w},c=function(t){return l&&f.NEED&&h(t)&&!n(t,i)&&u(t),t},f=t.exports={KEY:i,NEED:!1,fastKey:C,getWeak:D,onFreeze:c}},e444:function(t,e){t.exports=!0},e583:function(t,e,a){var i=a("da84"),r=a("58a8").trim,n=a("5899"),s=i.parseInt,o=/^[+-]?0[Xx]/,h=8!==s(n+"08")||22!==s(n+"0x16");t.exports=h?function(t,e){var a=r(String(t));return s(a,e>>>0||(o.test(a)?16:10))}:s},e9dc:function(t,e,a){var i=a("512c");i(i.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},ea34:function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},ef08:function(t,e){var a=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=a)},f2c2:function(t,e,a){"use strict";var i=a("1609");function r(t){var e,a;this.promise=new t((function(t,i){if(void 0!==e||void 0!==a)throw TypeError("Bad Promise constructor");e=t,a=i})),this.resolve=i(e),this.reject=i(a)}t.exports.f=function(t){return new r(t)}},f893:function(t,e,a){t.exports={default:a("8119"),__esModule:!0}},f964:function(t,e,a){var i=a("febf");t.exports=function(t,e){return new(i(t))(e)}},faf5:function(t,e,a){t.exports=!a("0bad")&&!a("4b8b")((function(){return 7!=Object.defineProperty(a("05f5")("div"),"a",{get:function(){return 7}}).a}))},fc5e:function(t,e){var a=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:a)(t)}},fc96:function(t,e,a){var i=a("512c");i(i.S+i.F*!a("0bad"),"Object",{defineProperties:a("85e7")})},fcd4:function(t,e,a){e.f=a("cc15a")},febf:function(t,e,a){var i=a("7a41"),r=a("4ebc7"),n=a("cc15a")("species");t.exports=function(t){var e;return r(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!r(e.prototype)||(e=void 0),i(e)&&(e=e[n],null===e&&(e=void 0))),void 0===e?Array:e}},fed5:function(t,e){e.f=Object.getOwnPropertySymbols}}]);